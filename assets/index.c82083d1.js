var t=Object.defineProperty,i=(i,s,n)=>(((i,s,n)=>{s in i?t(i,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[s]=n})(i,"symbol"!=typeof s?s+"":s,n),n);import{E as s,V as n,c as a,T as o,Q as e,d as r,e as _,W as h,S as l,f as c,M as m,b,A as p,P as d,g as u,h as f,i as x,j as g,k as v,C as y,H as X,l as z,R as M,I as Y,m as Z,n as w,D as I,o as V,p as L,q as A,O as k,U as S,r as B,s as P,L as C,t as T,u as j,v as E,w as R,x as D,y as F,z as q,F as N,G as H,N as O,J as W,K as G,X as U,Y as J,Z as $,_ as K,$ as Q,a0 as tt,a1 as it,a2 as st,a3 as nt,a4 as at,a5 as ot,a6 as et,B as rt,a as _t,a7 as ht,a8 as lt,a9 as ct,aa as mt,ab as bt,ac as pt,ad as dt,ae as ut,af as ft,ag as xt,ah as gt}from"./three.module.cdea25df.js";import{G as vt}from"./GLTFLoader.d6e4e05a.js";import{d as yt,u as Xt,o as zt,c as Mt}from"./index.4df16fed.js";const Yt={type:"change"},Zt={type:"start"},wt={type:"end"};class It extends s{constructor(t,i){super(),void 0===i&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),i===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=i,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new n,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:a.ROTATE,MIDDLE:a.DOLLY,RIGHT:a.PAN},this.touches={ONE:o.ROTATE,TWO:o.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return m.phi},this.getAzimuthalAngle=function(){return m.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",U),this._domElementKeyEvents=t},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(Yt),s.update(),l=h.NONE},this.update=function(){const i=new n,a=(new e).setFromUnitVectors(t.up,new n(0,1,0)),o=a.clone().invert(),r=new n,_=new e,f=2*Math.PI;return function(){const t=s.object.position;i.copy(t).sub(s.target),i.applyQuaternion(a),m.setFromVector3(i),s.autoRotate&&l===h.NONE&&V(2*Math.PI/60/60*s.autoRotateSpeed),s.enableDamping?(m.theta+=b.theta*s.dampingFactor,m.phi+=b.phi*s.dampingFactor):(m.theta+=b.theta,m.phi+=b.phi);let n=s.minAzimuthAngle,e=s.maxAzimuthAngle;return isFinite(n)&&isFinite(e)&&(n<-Math.PI?n+=f:n>Math.PI&&(n-=f),e<-Math.PI?e+=f:e>Math.PI&&(e-=f),m.theta=n<=e?Math.max(n,Math.min(e,m.theta)):m.theta>(n+e)/2?Math.max(n,m.theta):Math.min(e,m.theta)),m.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,m.phi)),m.makeSafe(),m.radius*=p,m.radius=Math.max(s.minDistance,Math.min(s.maxDistance,m.radius)),!0===s.enableDamping?s.target.addScaledVector(d,s.dampingFactor):s.target.add(d),i.setFromSpherical(m),i.applyQuaternion(o),t.copy(s.target).add(i),s.object.lookAt(s.target),!0===s.enableDamping?(b.theta*=1-s.dampingFactor,b.phi*=1-s.dampingFactor,d.multiplyScalar(1-s.dampingFactor)):(b.set(0,0,0),d.set(0,0,0)),p=1,!!(u||r.distanceToSquared(s.object.position)>c||8*(1-_.dot(s.object.quaternion))>c)&&(s.dispatchEvent(Yt),r.copy(s.object.position),_.copy(s.object.quaternion),u=!1,!0)}}(),this.dispose=function(){s.domElement.removeEventListener("contextmenu",J),s.domElement.removeEventListener("pointerdown",N),s.domElement.removeEventListener("pointercancel",W),s.domElement.removeEventListener("wheel",G),s.domElement.removeEventListener("pointermove",H),s.domElement.removeEventListener("pointerup",O),null!==s._domElementKeyEvents&&s._domElementKeyEvents.removeEventListener("keydown",U)};const s=this,h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=h.NONE;const c=1e-6,m=new r,b=new r;let p=1;const d=new n;let u=!1;const f=new _,x=new _,g=new _,v=new _,y=new _,X=new _,z=new _,M=new _,Y=new _,Z=[],w={};function I(){return Math.pow(.95,s.zoomSpeed)}function V(t){b.theta-=t}function L(t){b.phi-=t}const A=function(){const t=new n;return function(i,s){t.setFromMatrixColumn(s,0),t.multiplyScalar(-i),d.add(t)}}(),k=function(){const t=new n;return function(i,n){!0===s.screenSpacePanning?t.setFromMatrixColumn(n,1):(t.setFromMatrixColumn(n,0),t.crossVectors(s.object.up,t)),t.multiplyScalar(i),d.add(t)}}(),S=function(){const t=new n;return function(i,n){const a=s.domElement;if(s.object.isPerspectiveCamera){const o=s.object.position;t.copy(o).sub(s.target);let e=t.length();e*=Math.tan(s.object.fov/2*Math.PI/180),A(2*i*e/a.clientHeight,s.object.matrix),k(2*n*e/a.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(A(i*(s.object.right-s.object.left)/s.object.zoom/a.clientWidth,s.object.matrix),k(n*(s.object.top-s.object.bottom)/s.object.zoom/a.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function B(t){s.object.isPerspectiveCamera?p/=t:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*t)),s.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function P(t){s.object.isPerspectiveCamera?p*=t:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/t)),s.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function C(t){f.set(t.clientX,t.clientY)}function T(t){v.set(t.clientX,t.clientY)}function j(){if(1===Z.length)f.set(Z[0].pageX,Z[0].pageY);else{const t=.5*(Z[0].pageX+Z[1].pageX),i=.5*(Z[0].pageY+Z[1].pageY);f.set(t,i)}}function E(){if(1===Z.length)v.set(Z[0].pageX,Z[0].pageY);else{const t=.5*(Z[0].pageX+Z[1].pageX),i=.5*(Z[0].pageY+Z[1].pageY);v.set(t,i)}}function R(){const t=Z[0].pageX-Z[1].pageX,i=Z[0].pageY-Z[1].pageY,s=Math.sqrt(t*t+i*i);z.set(0,s)}function D(t){if(1==Z.length)x.set(t.pageX,t.pageY);else{const i=Q(t),s=.5*(t.pageX+i.x),n=.5*(t.pageY+i.y);x.set(s,n)}g.subVectors(x,f).multiplyScalar(s.rotateSpeed);const i=s.domElement;V(2*Math.PI*g.x/i.clientHeight),L(2*Math.PI*g.y/i.clientHeight),f.copy(x)}function F(t){if(1===Z.length)y.set(t.pageX,t.pageY);else{const i=Q(t),s=.5*(t.pageX+i.x),n=.5*(t.pageY+i.y);y.set(s,n)}X.subVectors(y,v).multiplyScalar(s.panSpeed),S(X.x,X.y),v.copy(y)}function q(t){const i=Q(t),n=t.pageX-i.x,a=t.pageY-i.y,o=Math.sqrt(n*n+a*a);M.set(0,o),Y.set(0,Math.pow(M.y/z.y,s.zoomSpeed)),B(Y.y),z.copy(M)}function N(t){!1!==s.enabled&&(0===Z.length&&(s.domElement.setPointerCapture(t.pointerId),s.domElement.addEventListener("pointermove",H),s.domElement.addEventListener("pointerup",O)),function(t){Z.push(t)}(t),"touch"===t.pointerType?function(t){switch(K(t),Z.length){case 1:switch(s.touches.ONE){case o.ROTATE:if(!1===s.enableRotate)return;j(),l=h.TOUCH_ROTATE;break;case o.PAN:if(!1===s.enablePan)return;E(),l=h.TOUCH_PAN;break;default:l=h.NONE}break;case 2:switch(s.touches.TWO){case o.DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;s.enableZoom&&R(),s.enablePan&&E(),l=h.TOUCH_DOLLY_PAN;break;case o.DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;s.enableZoom&&R(),s.enableRotate&&j(),l=h.TOUCH_DOLLY_ROTATE;break;default:l=h.NONE}break;default:l=h.NONE}l!==h.NONE&&s.dispatchEvent(Zt)}(t):function(t){let i;switch(t.button){case 0:i=s.mouseButtons.LEFT;break;case 1:i=s.mouseButtons.MIDDLE;break;case 2:i=s.mouseButtons.RIGHT;break;default:i=-1}switch(i){case a.DOLLY:if(!1===s.enableZoom)return;!function(t){z.set(t.clientX,t.clientY)}(t),l=h.DOLLY;break;case a.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===s.enablePan)return;T(t),l=h.PAN}else{if(!1===s.enableRotate)return;C(t),l=h.ROTATE}break;case a.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===s.enableRotate)return;C(t),l=h.ROTATE}else{if(!1===s.enablePan)return;T(t),l=h.PAN}break;default:l=h.NONE}l!==h.NONE&&s.dispatchEvent(Zt)}(t))}function H(t){!1!==s.enabled&&("touch"===t.pointerType?function(t){switch(K(t),l){case h.TOUCH_ROTATE:if(!1===s.enableRotate)return;D(t),s.update();break;case h.TOUCH_PAN:if(!1===s.enablePan)return;F(t),s.update();break;case h.TOUCH_DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(t){s.enableZoom&&q(t),s.enablePan&&F(t)}(t),s.update();break;case h.TOUCH_DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;!function(t){s.enableZoom&&q(t),s.enableRotate&&D(t)}(t),s.update();break;default:l=h.NONE}}(t):function(t){if(!1===s.enabled)return;switch(l){case h.ROTATE:if(!1===s.enableRotate)return;!function(t){x.set(t.clientX,t.clientY),g.subVectors(x,f).multiplyScalar(s.rotateSpeed);const i=s.domElement;V(2*Math.PI*g.x/i.clientHeight),L(2*Math.PI*g.y/i.clientHeight),f.copy(x),s.update()}(t);break;case h.DOLLY:if(!1===s.enableZoom)return;!function(t){M.set(t.clientX,t.clientY),Y.subVectors(M,z),Y.y>0?B(I()):Y.y<0&&P(I()),z.copy(M),s.update()}(t);break;case h.PAN:if(!1===s.enablePan)return;!function(t){y.set(t.clientX,t.clientY),X.subVectors(y,v).multiplyScalar(s.panSpeed),S(X.x,X.y),v.copy(y),s.update()}(t)}}(t))}function O(t){$(t),0===Z.length&&(s.domElement.releasePointerCapture(t.pointerId),s.domElement.removeEventListener("pointermove",H),s.domElement.removeEventListener("pointerup",O)),s.dispatchEvent(wt),l=h.NONE}function W(t){$(t)}function G(t){!1!==s.enabled&&!1!==s.enableZoom&&l===h.NONE&&(t.preventDefault(),s.dispatchEvent(Zt),function(t){t.deltaY<0?P(I()):t.deltaY>0&&B(I()),s.update()}(t),s.dispatchEvent(wt))}function U(t){!1!==s.enabled&&!1!==s.enablePan&&function(t){let i=!1;switch(t.code){case s.keys.UP:S(0,s.keyPanSpeed),i=!0;break;case s.keys.BOTTOM:S(0,-s.keyPanSpeed),i=!0;break;case s.keys.LEFT:S(s.keyPanSpeed,0),i=!0;break;case s.keys.RIGHT:S(-s.keyPanSpeed,0),i=!0}i&&(t.preventDefault(),s.update())}(t)}function J(t){!1!==s.enabled&&t.preventDefault()}function $(t){delete w[t.pointerId];for(let i=0;i<Z.length;i++)if(Z[i].pointerId==t.pointerId)return void Z.splice(i,1)}function K(t){let i=w[t.pointerId];void 0===i&&(i=new _,w[t.pointerId]=i),i.set(t.pageX,t.pageY)}function Q(t){const i=t.pointerId===Z[0].pointerId?Z[1]:Z[0];return w[i.pointerId]}s.domElement.addEventListener("contextmenu",J),s.domElement.addEventListener("pointerdown",N),s.domElement.addEventListener("pointercancel",W),s.domElement.addEventListener("wheel",G,{passive:!1}),this.update()}}var Vt=Object.freeze(Object.defineProperty({__proto__:null,default:class{constructor(){i(this,"scene",null),i(this,"camera",null),i(this,"renderer",null),i(this,"cube",null),i(this,"axesHelper",null),i(this,"controls",null),this.init()}init(){this.initScene(),this.initCamera(),this.initRender(),this.render()}initRender(){this.renderer=new h({antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),this.controls=new It(this.camera,this.renderer.domElement)}initScene(){this.scene=new l;const t=new c(1,1,1),i=new m({color:16776960});this.cube=new b(t,i),this.scene.add(this.cube),this.axesHelper=new p(3),this.scene.add(this.axesHelper)}initCamera(){this.camera=new d(75,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.z=5}render(){this.renderer&&this.scene&&this.camera&&(this.renderer.render(this.scene,this.camera),this.cube&&(this.cube.rotation.y+=.1),requestAnimationFrame((()=>{this.render()})))}}},Symbol.toStringTag,{value:"Module"}));var Lt=Object.freeze(Object.defineProperty({__proto__:null,default:class{constructor(){i(this,"scene",null),i(this,"camera",null),i(this,"renderer",null),i(this,"plane",null),i(this,"cylinder",null),i(this,"axesHelper",null),i(this,"controls",null),i(this,"ambientLight",new u(16777215,.2)),i(this,"spotLight",new f(16777215,1)),this.init()}init(){this.initCamera(),this.initRender(),this.initScene(),this.initShadow(),this.render()}initRender(){this.renderer=new h({antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),this.controls=new It(this.camera,this.renderer.domElement),this.controls.addEventListener("change",(()=>{this.render()}))}initScene(){this.scene=new l,this.scene.add(this.ambientLight),this.spotLight.position.set(-50,80,0),this.spotLight.angle=Math.PI/6,this.spotLight.penumbra=.2,this.scene.add(this.spotLight);const t=new x(this.spotLight);this.scene.add(t);const i=new g(200,200),s=new v({color:8421504});this.plane=new b(i,s),this.plane.rotation.x=-Math.PI/2,this.plane.position.set(0,-10,0),this.scene.add(this.plane);const n=new y(5,5,2,24,10),a=new v({color:4227200});this.cylinder=new b(n,a),this.cylinder.position.set(0,10,0),this.scene.add(this.cylinder),this.axesHelper=new p(50),this.scene.add(this.axesHelper)}initCamera(){this.camera=new d(40,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.set(0,120,200),this.camera.lookAt(0,0,0)}initShadow(){this.plane.receiveShadow=!0,this.cylinder.castShadow=!0,this.spotLight.castShadow=!0,this.renderer.shadowMap.enabled=!0}render(){this.renderer&&this.scene&&this.camera&&(this.renderer.render(this.scene,this.camera),requestAnimationFrame((()=>{this.render()})))}}},Symbol.toStringTag,{value:"Module"}));
/**
 * lil-gui
 * https://lil-gui.georgealways.com
 * @version 0.17.0
 * @author George Michael Brower
 * @license MIT
 */class At{constructor(t,i,s,n,a="div"){this.parent=t,this.object=i,this.property=s,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement("div"),this.domElement.classList.add("controller"),this.domElement.classList.add(n),this.$name=document.createElement("div"),this.$name.classList.add("name"),At.nextNameID=At.nextNameID||0,this.$name.id="lil-gui-name-"+ ++At.nextNameID,this.$widget=document.createElement(a),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(s)}name(t){return this._name=t,this.$name.innerHTML=t,this}onChange(t){return this._onChange=t,this}_callOnChange(){this.parent._callOnChange(this),void 0!==this._onChange&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),void 0!==this._onFinishChange&&this._onFinishChange.call(this,this.getValue())),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(t=!0){return this.disable(!t)}disable(t=!0){return t===this._disabled||(this._disabled=t,this.domElement.classList.toggle("disabled",t),this.$disable.toggleAttribute("disabled",t)),this}show(t=!0){return this._hidden=!t,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(t){const i=this.parent.add(this.object,this.property,t);return i.name(this._name),this.destroy(),i}min(t){return this}max(t){return this}step(t){return this}decimals(t){return this}listen(t=!0){return this._listening=t,void 0!==this._listenCallbackID&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const t=this.save();t!==this._listenPrevValue&&this.updateDisplay(),this._listenPrevValue=t}getValue(){return this.object[this.property]}setValue(t){return this.object[this.property]=t,this._callOnChange(),this.updateDisplay(),this}updateDisplay(){return this}load(t){return this.setValue(t),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class kt extends At{constructor(t,i,s){super(t,i,s,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",(()=>{this.setValue(this.$input.checked),this._callOnFinishChange()})),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function St(t){let i,s;return(i=t.match(/(#|0x)?([a-f0-9]{6})/i))?s=i[2]:(i=t.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?s=parseInt(i[1]).toString(16).padStart(2,0)+parseInt(i[2]).toString(16).padStart(2,0)+parseInt(i[3]).toString(16).padStart(2,0):(i=t.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(s=i[1]+i[1]+i[2]+i[2]+i[3]+i[3]),!!s&&"#"+s}const Bt={isPrimitive:!0,match:t=>"string"==typeof t,fromHexString:St,toHexString:St},Pt={isPrimitive:!0,match:t=>"number"==typeof t,fromHexString:t=>parseInt(t.substring(1),16),toHexString:t=>"#"+t.toString(16).padStart(6,0)},Ct={isPrimitive:!1,match:Array.isArray,fromHexString(t,i,s=1){const n=Pt.fromHexString(t);i[0]=(n>>16&255)/255*s,i[1]=(n>>8&255)/255*s,i[2]=(255&n)/255*s},toHexString:([t,i,s],n=1)=>Pt.toHexString(t*(n=255/n)<<16^i*n<<8^s*n<<0)},Tt={isPrimitive:!1,match:t=>Object(t)===t,fromHexString(t,i,s=1){const n=Pt.fromHexString(t);i.r=(n>>16&255)/255*s,i.g=(n>>8&255)/255*s,i.b=(255&n)/255*s},toHexString:({r:t,g:i,b:s},n=1)=>Pt.toHexString(t*(n=255/n)<<16^i*n<<8^s*n<<0)},jt=[Bt,Pt,Ct,Tt];class Et extends At{constructor(t,i,s,n){var a;super(t,i,s,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=(a=this.initialValue,jt.find((t=>t.match(a)))),this._rgbScale=n,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",(()=>{this._setValueFromHexString(this.$input.value)})),this.$input.addEventListener("blur",(()=>{this._callOnFinishChange()})),this.$text.addEventListener("input",(()=>{const t=St(this.$text.value);t&&this._setValueFromHexString(t)})),this.$text.addEventListener("focus",(()=>{this._textFocused=!0,this.$text.select()})),this.$text.addEventListener("blur",(()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()})),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(t){if(this._format.isPrimitive){const i=this._format.fromHexString(t);this.setValue(i)}else this._format.fromHexString(t,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(t){return this._setValueFromHexString(t),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class Rt extends At{constructor(t,i,s){super(t,i,s,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",(t=>{t.preventDefault(),this.getValue().call(this.object)})),this.$button.addEventListener("touchstart",(()=>{}),{passive:!0}),this.$disable=this.$button}}class Dt extends At{constructor(t,i,s,n,a,o){super(t,i,s,"number"),this._initInput(),this.min(n),this.max(a);const e=void 0!==o;this.step(e?o:this._getImplicitStep(),e),this.updateDisplay()}decimals(t){return this._decimals=t,this.updateDisplay(),this}min(t){return this._min=t,this._onUpdateMinMax(),this}max(t){return this._max=t,this._onUpdateMinMax(),this}step(t,i=!0){return this._step=t,this._stepExplicit=i,this}updateDisplay(){const t=this.getValue();if(this._hasSlider){let i=(t-this._min)/(this._max-this._min);i=Math.max(0,Math.min(i,1)),this.$fill.style.width=100*i+"%"}return this._inputFocused||(this.$input.value=void 0===this._decimals?t:t.toFixed(this._decimals)),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$disable=this.$input;const t=t=>{const i=parseFloat(this.$input.value);isNaN(i)||(this._snapClampSetValue(i+t),this.$input.value=this.getValue())};let i,s,n,a,o,e=!1;const r=t=>{if(e){const n=t.clientX-i,a=t.clientY-s;Math.abs(a)>5?(t.preventDefault(),this.$input.blur(),e=!1,this._setDraggingStyle(!0,"vertical")):Math.abs(n)>5&&_()}if(!e){const i=t.clientY-n;o-=i*this._step*this._arrowKeyMultiplier(t),a+o>this._max?o=this._max-a:a+o<this._min&&(o=this._min-a),this._snapClampSetValue(a+o)}n=t.clientY},_=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",_)};this.$input.addEventListener("input",(()=>{let t=parseFloat(this.$input.value);isNaN(t)||(this._stepExplicit&&(t=this._snap(t)),this.setValue(this._clamp(t)))})),this.$input.addEventListener("keydown",(i=>{"Enter"===i.code&&this.$input.blur(),"ArrowUp"===i.code&&(i.preventDefault(),t(this._step*this._arrowKeyMultiplier(i))),"ArrowDown"===i.code&&(i.preventDefault(),t(this._step*this._arrowKeyMultiplier(i)*-1))})),this.$input.addEventListener("wheel",(i=>{this._inputFocused&&(i.preventDefault(),t(this._step*this._normalizeMouseWheel(i)))}),{passive:!1}),this.$input.addEventListener("mousedown",(t=>{i=t.clientX,s=n=t.clientY,e=!0,a=this.getValue(),o=0,window.addEventListener("mousemove",r),window.addEventListener("mouseup",_)})),this.$input.addEventListener("focus",(()=>{this._inputFocused=!0})),this.$input.addEventListener("blur",(()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()}))}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const t=t=>{const i=this.$slider.getBoundingClientRect();let s=(n=t,a=i.left,o=i.right,e=this._min,r=this._max,(n-a)/(o-a)*(r-e)+e);var n,a,o,e,r;this._snapClampSetValue(s)},i=i=>{t(i.clientX)},s=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",s)};let n,a,o=!1;const e=i=>{i.preventDefault(),this._setDraggingStyle(!0),t(i.touches[0].clientX),o=!1},r=i=>{if(o){const t=i.touches[0].clientX-n,s=i.touches[0].clientY-a;Math.abs(t)>Math.abs(s)?e(i):(window.removeEventListener("touchmove",r),window.removeEventListener("touchend",_))}else i.preventDefault(),t(i.touches[0].clientX)},_=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",r),window.removeEventListener("touchend",_)},h=this._callOnFinishChange.bind(this);let l;this.$slider.addEventListener("mousedown",(n=>{this._setDraggingStyle(!0),t(n.clientX),window.addEventListener("mousemove",i),window.addEventListener("mouseup",s)})),this.$slider.addEventListener("touchstart",(t=>{t.touches.length>1||(this._hasScrollBar?(n=t.touches[0].clientX,a=t.touches[0].clientY,o=!0):e(t),window.addEventListener("touchmove",r,{passive:!1}),window.addEventListener("touchend",_))}),{passive:!1}),this.$slider.addEventListener("wheel",(t=>{if(Math.abs(t.deltaX)<Math.abs(t.deltaY)&&this._hasScrollBar)return;t.preventDefault();const i=this._normalizeMouseWheel(t)*this._step;this._snapClampSetValue(this.getValue()+i),this.$input.value=this.getValue(),clearTimeout(l),l=setTimeout(h,400)}),{passive:!1})}_setDraggingStyle(t,i="horizontal"){this.$slider&&this.$slider.classList.toggle("active",t),document.body.classList.toggle("lil-gui-dragging",t),document.body.classList.toggle(`lil-gui-${i}`,t)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(t){let{deltaX:i,deltaY:s}=t;Math.floor(t.deltaY)!==t.deltaY&&t.wheelDelta&&(i=0,s=-t.wheelDelta/120,s*=this._stepExplicit?1:10);return i+-s}_arrowKeyMultiplier(t){let i=this._stepExplicit?1:10;return t.shiftKey?i*=10:t.altKey&&(i/=10),i}_snap(t){const i=Math.round(t/this._step)*this._step;return parseFloat(i.toPrecision(15))}_clamp(t){return t<this._min&&(t=this._min),t>this._max&&(t=this._max),t}_snapClampSetValue(t){this.setValue(this._clamp(this._snap(t)))}get _hasScrollBar(){const t=this.parent.root.$children;return t.scrollHeight>t.clientHeight}get _hasMin(){return void 0!==this._min}get _hasMax(){return void 0!==this._max}}class Ft extends At{constructor(t,i,s,n){super(t,i,s,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this._values=Array.isArray(n)?n:Object.values(n),this._names=Array.isArray(n)?n:Object.keys(n),this._names.forEach((t=>{const i=document.createElement("option");i.innerHTML=t,this.$select.appendChild(i)})),this.$select.addEventListener("change",(()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()})),this.$select.addEventListener("focus",(()=>{this.$display.classList.add("focus")})),this.$select.addEventListener("blur",(()=>{this.$display.classList.remove("focus")})),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.updateDisplay()}updateDisplay(){const t=this.getValue(),i=this._values.indexOf(t);return this.$select.selectedIndex=i,this.$display.innerHTML=-1===i?t:this._names[i],this}}class qt extends At{constructor(t,i,s){super(t,i,s,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",(()=>{this.setValue(this.$input.value)})),this.$input.addEventListener("keydown",(t=>{"Enter"===t.code&&this.$input.blur()})),this.$input.addEventListener("blur",(()=>{this._callOnFinishChange()})),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}let Nt=!1;class Ht{constructor({parent:t,autoPlace:i=void 0===t,container:s,width:n,title:a="Controls",injectStyles:o=!0,touchStyles:e=!0}={}){if(this.parent=t,this.root=t?t.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("div"),this.$title.classList.add("title"),this.$title.setAttribute("role","button"),this.$title.setAttribute("aria-expanded",!0),this.$title.setAttribute("tabindex",0),this.$title.addEventListener("click",(()=>this.openAnimated(this._closed))),this.$title.addEventListener("keydown",(t=>{"Enter"!==t.code&&"Space"!==t.code||(t.preventDefault(),this.$title.click())})),this.$title.addEventListener("touchstart",(()=>{}),{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(a),e&&this.domElement.classList.add("allow-touch-styles"),this.parent)return this.parent.children.push(this),this.parent.folders.push(this),void this.parent.$children.appendChild(this.domElement);this.domElement.classList.add("root"),!Nt&&o&&(!function(t){const i=document.createElement("style");i.innerHTML=t;const s=document.querySelector("head link[rel=stylesheet], head style");s?document.head.insertBefore(i,s):document.head.appendChild(i)}('.lil-gui {\n  font-family: var(--font-family);\n  font-size: var(--font-size);\n  line-height: 1;\n  font-weight: normal;\n  font-style: normal;\n  text-align: left;\n  background-color: var(--background-color);\n  color: var(--text-color);\n  user-select: none;\n  -webkit-user-select: none;\n  touch-action: manipulation;\n  --background-color: #1f1f1f;\n  --text-color: #ebebeb;\n  --title-background-color: #111111;\n  --title-text-color: #ebebeb;\n  --widget-color: #424242;\n  --hover-color: #4f4f4f;\n  --focus-color: #595959;\n  --number-color: #2cc9ff;\n  --string-color: #a2db3c;\n  --font-size: 11px;\n  --input-font-size: 11px;\n  --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;\n  --font-family-mono: Menlo, Monaco, Consolas, "Droid Sans Mono", monospace;\n  --padding: 4px;\n  --spacing: 4px;\n  --widget-height: 20px;\n  --name-width: 45%;\n  --slider-knob-width: 2px;\n  --slider-input-width: 27%;\n  --color-input-width: 27%;\n  --slider-input-min-width: 45px;\n  --color-input-min-width: 45px;\n  --folder-indent: 7px;\n  --widget-padding: 0 0 0 3px;\n  --widget-border-radius: 2px;\n  --checkbox-size: calc(0.75 * var(--widget-height));\n  --scrollbar-width: 5px;\n}\n.lil-gui, .lil-gui * {\n  box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n}\n.lil-gui.root {\n  width: var(--width, 245px);\n  display: flex;\n  flex-direction: column;\n}\n.lil-gui.root > .title {\n  background: var(--title-background-color);\n  color: var(--title-text-color);\n}\n.lil-gui.root > .children {\n  overflow-x: hidden;\n  overflow-y: auto;\n}\n.lil-gui.root > .children::-webkit-scrollbar {\n  width: var(--scrollbar-width);\n  height: var(--scrollbar-width);\n  background: var(--background-color);\n}\n.lil-gui.root > .children::-webkit-scrollbar-thumb {\n  border-radius: var(--scrollbar-width);\n  background: var(--focus-color);\n}\n@media (pointer: coarse) {\n  .lil-gui.allow-touch-styles {\n    --widget-height: 28px;\n    --padding: 6px;\n    --spacing: 6px;\n    --font-size: 13px;\n    --input-font-size: 16px;\n    --folder-indent: 10px;\n    --scrollbar-width: 7px;\n    --slider-input-min-width: 50px;\n    --color-input-min-width: 65px;\n  }\n}\n.lil-gui.force-touch-styles {\n  --widget-height: 28px;\n  --padding: 6px;\n  --spacing: 6px;\n  --font-size: 13px;\n  --input-font-size: 16px;\n  --folder-indent: 10px;\n  --scrollbar-width: 7px;\n  --slider-input-min-width: 50px;\n  --color-input-min-width: 65px;\n}\n.lil-gui.autoPlace {\n  max-height: 100%;\n  position: fixed;\n  top: 0;\n  right: 15px;\n  z-index: 1001;\n}\n\n.lil-gui .controller {\n  display: flex;\n  align-items: center;\n  padding: 0 var(--padding);\n  margin: var(--spacing) 0;\n}\n.lil-gui .controller.disabled {\n  opacity: 0.5;\n}\n.lil-gui .controller.disabled, .lil-gui .controller.disabled * {\n  pointer-events: none !important;\n}\n.lil-gui .controller > .name {\n  min-width: var(--name-width);\n  flex-shrink: 0;\n  white-space: pre;\n  padding-right: var(--spacing);\n  line-height: var(--widget-height);\n}\n.lil-gui .controller .widget {\n  position: relative;\n  display: flex;\n  align-items: center;\n  width: 100%;\n  min-height: var(--widget-height);\n}\n.lil-gui .controller.string input {\n  color: var(--string-color);\n}\n.lil-gui .controller.boolean .widget {\n  cursor: pointer;\n}\n.lil-gui .controller.color .display {\n  width: 100%;\n  height: var(--widget-height);\n  border-radius: var(--widget-border-radius);\n  position: relative;\n}\n@media (hover: hover) {\n  .lil-gui .controller.color .display:hover:before {\n    content: " ";\n    display: block;\n    position: absolute;\n    border-radius: var(--widget-border-radius);\n    border: 1px solid #fff9;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n  }\n}\n.lil-gui .controller.color input[type=color] {\n  opacity: 0;\n  width: 100%;\n  height: 100%;\n  cursor: pointer;\n}\n.lil-gui .controller.color input[type=text] {\n  margin-left: var(--spacing);\n  font-family: var(--font-family-mono);\n  min-width: var(--color-input-min-width);\n  width: var(--color-input-width);\n  flex-shrink: 0;\n}\n.lil-gui .controller.option select {\n  opacity: 0;\n  position: absolute;\n  width: 100%;\n  max-width: 100%;\n}\n.lil-gui .controller.option .display {\n  position: relative;\n  pointer-events: none;\n  border-radius: var(--widget-border-radius);\n  height: var(--widget-height);\n  line-height: var(--widget-height);\n  max-width: 100%;\n  overflow: hidden;\n  word-break: break-all;\n  padding-left: 0.55em;\n  padding-right: 1.75em;\n  background: var(--widget-color);\n}\n@media (hover: hover) {\n  .lil-gui .controller.option .display.focus {\n    background: var(--focus-color);\n  }\n}\n.lil-gui .controller.option .display.active {\n  background: var(--focus-color);\n}\n.lil-gui .controller.option .display:after {\n  font-family: "lil-gui";\n  content: "↕";\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  padding-right: 0.375em;\n}\n.lil-gui .controller.option .widget,\n.lil-gui .controller.option select {\n  cursor: pointer;\n}\n@media (hover: hover) {\n  .lil-gui .controller.option .widget:hover .display {\n    background: var(--hover-color);\n  }\n}\n.lil-gui .controller.number input {\n  color: var(--number-color);\n}\n.lil-gui .controller.number.hasSlider input {\n  margin-left: var(--spacing);\n  width: var(--slider-input-width);\n  min-width: var(--slider-input-min-width);\n  flex-shrink: 0;\n}\n.lil-gui .controller.number .slider {\n  width: 100%;\n  height: var(--widget-height);\n  background-color: var(--widget-color);\n  border-radius: var(--widget-border-radius);\n  padding-right: var(--slider-knob-width);\n  overflow: hidden;\n  cursor: ew-resize;\n  touch-action: pan-y;\n}\n@media (hover: hover) {\n  .lil-gui .controller.number .slider:hover {\n    background-color: var(--hover-color);\n  }\n}\n.lil-gui .controller.number .slider.active {\n  background-color: var(--focus-color);\n}\n.lil-gui .controller.number .slider.active .fill {\n  opacity: 0.95;\n}\n.lil-gui .controller.number .fill {\n  height: 100%;\n  border-right: var(--slider-knob-width) solid var(--number-color);\n  box-sizing: content-box;\n}\n\n.lil-gui-dragging .lil-gui {\n  --hover-color: var(--widget-color);\n}\n.lil-gui-dragging * {\n  cursor: ew-resize !important;\n}\n\n.lil-gui-dragging.lil-gui-vertical * {\n  cursor: ns-resize !important;\n}\n\n.lil-gui .title {\n  --title-height: calc(var(--widget-height) + var(--spacing) * 1.25);\n  height: var(--title-height);\n  line-height: calc(var(--title-height) - 4px);\n  font-weight: 600;\n  padding: 0 var(--padding);\n  -webkit-tap-highlight-color: transparent;\n  cursor: pointer;\n  outline: none;\n  text-decoration-skip: objects;\n}\n.lil-gui .title:before {\n  font-family: "lil-gui";\n  content: "▾";\n  padding-right: 2px;\n  display: inline-block;\n}\n.lil-gui .title:active {\n  background: var(--title-background-color);\n  opacity: 0.75;\n}\n@media (hover: hover) {\n  body:not(.lil-gui-dragging) .lil-gui .title:hover {\n    background: var(--title-background-color);\n    opacity: 0.85;\n  }\n  .lil-gui .title:focus {\n    text-decoration: underline var(--focus-color);\n  }\n}\n.lil-gui.root > .title:focus {\n  text-decoration: none !important;\n}\n.lil-gui.closed > .title:before {\n  content: "▸";\n}\n.lil-gui.closed > .children {\n  transform: translateY(-7px);\n  opacity: 0;\n}\n.lil-gui.closed:not(.transition) > .children {\n  display: none;\n}\n.lil-gui.transition > .children {\n  transition-duration: 300ms;\n  transition-property: height, opacity, transform;\n  transition-timing-function: cubic-bezier(0.2, 0.6, 0.35, 1);\n  overflow: hidden;\n  pointer-events: none;\n}\n.lil-gui .children:empty:before {\n  content: "Empty";\n  padding: 0 var(--padding);\n  margin: var(--spacing) 0;\n  display: block;\n  height: var(--widget-height);\n  font-style: italic;\n  line-height: var(--widget-height);\n  opacity: 0.5;\n}\n.lil-gui.root > .children > .lil-gui > .title {\n  border: 0 solid var(--widget-color);\n  border-width: 1px 0;\n  transition: border-color 300ms;\n}\n.lil-gui.root > .children > .lil-gui.closed > .title {\n  border-bottom-color: transparent;\n}\n.lil-gui + .controller {\n  border-top: 1px solid var(--widget-color);\n  margin-top: 0;\n  padding-top: var(--spacing);\n}\n.lil-gui .lil-gui .lil-gui > .title {\n  border: none;\n}\n.lil-gui .lil-gui .lil-gui > .children {\n  border: none;\n  margin-left: var(--folder-indent);\n  border-left: 2px solid var(--widget-color);\n}\n.lil-gui .lil-gui .controller {\n  border: none;\n}\n\n.lil-gui input {\n  -webkit-tap-highlight-color: transparent;\n  border: 0;\n  outline: none;\n  font-family: var(--font-family);\n  font-size: var(--input-font-size);\n  border-radius: var(--widget-border-radius);\n  height: var(--widget-height);\n  background: var(--widget-color);\n  color: var(--text-color);\n  width: 100%;\n}\n@media (hover: hover) {\n  .lil-gui input:hover {\n    background: var(--hover-color);\n  }\n  .lil-gui input:active {\n    background: var(--focus-color);\n  }\n}\n.lil-gui input:disabled {\n  opacity: 1;\n}\n.lil-gui input[type=text],\n.lil-gui input[type=number] {\n  padding: var(--widget-padding);\n}\n.lil-gui input[type=text]:focus,\n.lil-gui input[type=number]:focus {\n  background: var(--focus-color);\n}\n.lil-gui input::-webkit-outer-spin-button,\n.lil-gui input::-webkit-inner-spin-button {\n  -webkit-appearance: none;\n  margin: 0;\n}\n.lil-gui input[type=number] {\n  -moz-appearance: textfield;\n}\n.lil-gui input[type=checkbox] {\n  appearance: none;\n  -webkit-appearance: none;\n  height: var(--checkbox-size);\n  width: var(--checkbox-size);\n  border-radius: var(--widget-border-radius);\n  text-align: center;\n  cursor: pointer;\n}\n.lil-gui input[type=checkbox]:checked:before {\n  font-family: "lil-gui";\n  content: "✓";\n  font-size: var(--checkbox-size);\n  line-height: var(--checkbox-size);\n}\n@media (hover: hover) {\n  .lil-gui input[type=checkbox]:focus {\n    box-shadow: inset 0 0 0 1px var(--focus-color);\n  }\n}\n.lil-gui button {\n  -webkit-tap-highlight-color: transparent;\n  outline: none;\n  cursor: pointer;\n  font-family: var(--font-family);\n  font-size: var(--font-size);\n  color: var(--text-color);\n  width: 100%;\n  height: var(--widget-height);\n  text-transform: none;\n  background: var(--widget-color);\n  border-radius: var(--widget-border-radius);\n  border: 1px solid var(--widget-color);\n  text-align: center;\n  line-height: calc(var(--widget-height) - 4px);\n}\n@media (hover: hover) {\n  .lil-gui button:hover {\n    background: var(--hover-color);\n    border-color: var(--hover-color);\n  }\n  .lil-gui button:focus {\n    border-color: var(--focus-color);\n  }\n}\n.lil-gui button:active {\n  background: var(--focus-color);\n}\n\n@font-face {\n  font-family: "lil-gui";\n  src: url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff");\n}'),Nt=!0),s?s.appendChild(this.domElement):i&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),n&&this.domElement.style.setProperty("--width",n+"px"),this.domElement.addEventListener("keydown",(t=>t.stopPropagation())),this.domElement.addEventListener("keyup",(t=>t.stopPropagation()))}add(t,i,s,n,a){if(Object(s)===s)return new Ft(this,t,i,s);const o=t[i];switch(typeof o){case"number":return new Dt(this,t,i,s,n,a);case"boolean":return new kt(this,t,i);case"string":return new qt(this,t,i);case"function":return new Rt(this,t,i)}console.error("gui.add failed\n\tproperty:",i,"\n\tobject:",t,"\n\tvalue:",o)}addColor(t,i,s=1){return new Et(this,t,i,s)}addFolder(t){return new Ht({parent:this,title:t})}load(t,i=!0){return t.controllers&&this.controllers.forEach((i=>{i instanceof Rt||i._name in t.controllers&&i.load(t.controllers[i._name])})),i&&t.folders&&this.folders.forEach((i=>{i._title in t.folders&&i.load(t.folders[i._title])})),this}save(t=!0){const i={controllers:{},folders:{}};return this.controllers.forEach((t=>{if(!(t instanceof Rt)){if(t._name in i.controllers)throw new Error(`Cannot save GUI with duplicate property "${t._name}"`);i.controllers[t._name]=t.save()}})),t&&this.folders.forEach((t=>{if(t._title in i.folders)throw new Error(`Cannot save GUI with duplicate folder "${t._title}"`);i.folders[t._title]=t.save()})),i}open(t=!0){return this._closed=!t,this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}show(t=!0){return this._hidden=!t,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(t=!0){return this._closed=!t,this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame((()=>{const i=this.$children.clientHeight;this.$children.style.height=i+"px",this.domElement.classList.add("transition");const s=t=>{t.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",s))};this.$children.addEventListener("transitionend",s);const n=t?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!t),requestAnimationFrame((()=>{this.$children.style.height=n+"px"}))})),this}title(t){return this._title=t,this.$title.innerHTML=t,this}reset(t=!0){return(t?this.controllersRecursive():this.controllers).forEach((t=>t.reset())),this}onChange(t){return this._onChange=t,this}_callOnChange(t){this.parent&&this.parent._callOnChange(t),void 0!==this._onChange&&this._onChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(t){this.parent&&this.parent._callOnFinishChange(t),void 0!==this._onFinishChange&&this._onFinishChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach((t=>t.destroy()))}controllersRecursive(){let t=Array.from(this.controllers);return this.folders.forEach((i=>{t=t.concat(i.controllersRecursive())})),t}foldersRecursive(){let t=Array.from(this.folders);return this.folders.forEach((i=>{t=t.concat(i.foldersRecursive())})),t}}var Ot=Object.freeze(Object.defineProperty({__proto__:null,default:class{constructor(){i(this,"scene",null),i(this,"camera",null),i(this,"renderer",null),i(this,"plane",null),i(this,"cylinder",null),i(this,"axesHelper",null),i(this,"spotLightHelper",null),i(this,"controls",null),i(this,"ambientLight",new u(16777215,.2)),i(this,"spotLight",new f(16777215,1)),i(this,"gui",new Ht),this.init()}init(){this.initCamera(),this.initRender(),this.initScene(),this.initShadow(),this.buildGUI(),this.render()}initRender(){this.renderer=new h({antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),this.controls=new It(this.camera,this.renderer.domElement),this.controls.addEventListener("change",(()=>{this.render()}))}initScene(){this.scene=new l,this.scene.add(this.ambientLight),this.spotLight.position.set(-50,80,0),this.spotLight.angle=Math.PI/6,this.spotLight.penumbra=.2,this.scene.add(this.spotLight),this.spotLightHelper=new x(this.spotLight),this.scene.add(this.spotLightHelper);const t=new g(200,200),i=new v({color:8421504});this.plane=new b(t,i),this.plane.rotation.x=-Math.PI/2,this.plane.position.set(0,-10,0),this.scene.add(this.plane);const s=new y(5,5,2,24,10),n=new v({color:4227200});this.cylinder=new b(s,n),this.cylinder.position.set(0,10,0),this.scene.add(this.cylinder),this.axesHelper=new p(50),this.scene.add(this.axesHelper)}initCamera(){this.camera=new d(40,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.set(0,120,200),this.camera.lookAt(0,0,0)}initShadow(){this.plane.receiveShadow=!0,this.cylinder.castShadow=!0,this.spotLight.castShadow=!0,this.renderer.shadowMap.enabled=!0}buildGUI(){this.gui=new Ht;const t=this.gui.addFolder("Spot Light");t.addColor(this.spotLight,"color").onChange((t=>{var i;this.spotLight.color.set(t),this.render(),null==(i=this.spotLightHelper)||i.update()})),t.add(this.spotLight,"angle",0,Math.PI/2).onChange((t=>{var i;this.spotLight.angle=t,this.render(),null==(i=this.spotLightHelper)||i.update()})),t.add(this.spotLight,"penumbra",0,1).onChange((t=>{var i;this.spotLight.penumbra=t,this.render(),null==(i=this.spotLightHelper)||i.update()}));const i=this.gui.addFolder("Camera");i.add(this.camera.position,"x",-1e3,1e3).onChange((t=>{this.camera.position.x=t,this.render()})),i.close(),this.gui.close()}render(){this.renderer&&this.scene&&this.camera&&(this.renderer.render(this.scene,this.camera),requestAnimationFrame((()=>{this.render()})))}}},Symbol.toStringTag,{value:"Module"}));var Wt=Object.freeze(Object.defineProperty({__proto__:null,default:class{constructor(){i(this,"scene",new l),i(this,"camera",new d(60,window.innerWidth/window.innerHeight,1,100)),i(this,"renderer",new h({antialias:!0})),i(this,"controls",null),i(this,"gui",new Ht),i(this,"axesHelper",new p(3)),i(this,"light",new X(16777215,8947848)),i(this,"mesh",null),i(this,"color",new z),i(this,"white",(new z).setHex(16777215)),i(this,"mouse",new _(1,1)),i(this,"raycaster",new M),i(this,"indexNum"),this.init(),this.indexNum=0}init(){this.initCamera(),this.initRender(),this.initScene(),this.buildGUI(),this.initListener(),this.render()}initCamera(){this.camera.position.set(10,10,10),this.camera.lookAt(0,0,0)}initRender(){this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),this.controls=new It(this.camera,this.renderer.domElement)}initScene(){this.light.position.set(0,1,0),this.scene.add(this.light),this.scene.add(this.axesHelper),this.initMesh()}initMesh(){const t=new Y(.5,3),i=new v({color:16777215}),s=Math.pow(10,3);this.mesh=new Z(t,i,s);let n=0;const a=new w;for(let o=0;o<10;o++)for(let t=0;t<10;t++)for(let i=0;i<10;i++)a.setPosition(4.5-o,4.5-t,4.5-i),this.mesh.setMatrixAt(n,a),this.mesh.setColorAt(n,this.white),n++;this.scene.add(this.mesh)}buildGUI(){this.gui=new Ht,this.gui.add(this.mesh,"count",0,Math.pow(10,3)),this.gui.close()}initListener(){window.addEventListener("resize",(()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)})),document.addEventListener("mousemove",(t=>{t.preventDefault(),this.mouse.x=t.clientX/window.innerWidth*2-1,this.mouse.y=-t.clientY/window.innerHeight*2+1}))}render(){this.renderer.render(this.scene,this.camera),this.animate()}animate(){var t,i,s;null==(t=this.controls)||t.update(),this.raycaster.setFromCamera(this.mouse,this.camera);const n=this.raycaster.intersectObject(this.mesh);if(n.length){const t=n[0].instanceId;null==(i=this.mesh)||i.getColorAt(t,this.color),this.color.equals(this.white)&&(null==(s=this.mesh)||s.setColorAt(t,this.color.setHex(16777215*Math.random())),this.mesh.instanceColor.needsUpdate=!0,this.indexNum++,console.log("indexNum",this.indexNum))}this.renderer.render(this.scene,this.camera),requestAnimationFrame((()=>{this.animate()}))}}},Symbol.toStringTag,{value:"Module"})),Gt=function(){var t=0,i=document.createElement("div");function s(t){return i.appendChild(t.dom),t}function n(s){for(var n=0;n<i.children.length;n++)i.children[n].style.display=n===s?"block":"none";t=s}i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(s){s.preventDefault(),n(++t%i.children.length)}),!1);var a=(performance||Date).now(),o=a,e=0,r=s(new Gt.Panel("FPS","#0ff","#002")),_=s(new Gt.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=s(new Gt.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:i,addPanel:s,showPanel:n,begin:function(){a=(performance||Date).now()},end:function(){e++;var t=(performance||Date).now();if(_.update(t-a,200),t>=o+1e3&&(r.update(1e3*e/(t-o),100),o=t,e=0,h)){var i=performance.memory;h.update(i.usedJSHeapSize/1048576,i.jsHeapSizeLimit/1048576)}return t},update:function(){a=this.end()},domElement:i,setMode:n}};Gt.Panel=function(t,i,s){var n=1/0,a=0,o=Math.round,e=o(window.devicePixelRatio||1),r=80*e,_=48*e,h=3*e,l=2*e,c=3*e,m=15*e,b=74*e,p=30*e,d=document.createElement("canvas");d.width=r,d.height=_,d.style.cssText="width:80px;height:48px";var u=d.getContext("2d");return u.font="bold "+9*e+"px Helvetica,Arial,sans-serif",u.textBaseline="top",u.fillStyle=s,u.fillRect(0,0,r,_),u.fillStyle=i,u.fillText(t,h,l),u.fillRect(c,m,b,p),u.fillStyle=s,u.globalAlpha=.9,u.fillRect(c,m,b,p),{dom:d,update:function(_,f){n=Math.min(n,_),a=Math.max(a,_),u.fillStyle=s,u.globalAlpha=1,u.fillRect(0,0,r,m),u.fillStyle=i,u.fillText(o(_)+" "+t+" ("+o(n)+"-"+o(a)+")",h,l),u.drawImage(d,c+e,m,b-e,p,c,m,b-e,p),u.fillRect(c+b-e,m,e,p),u.fillStyle=s,u.globalAlpha=.9,u.fillRect(c+b-e,m,e,o((1-_/f)*p))}}};var Ut=Ut||{};Ut.collision||(Ut.collision={}),Ut.collision.broadphase||(Ut.collision.broadphase={}),Ut.collision.broadphase.BroadPhase=class{constructor(t){this._type=t,this._numProxies=0,this._proxyList=null,this._proxyListLast=null,this._proxyPairList=null,this._incremental=!1,this._testCount=0,this._proxyPairPool=null,this._idCount=0,this._convexSweep=new Ut.collision.broadphase._BroadPhase.ConvexSweepGeometry,this._aabb=new Ut.collision.broadphase._BroadPhase.AabbGeometry,this.identity=new Ut.common.Transform,this.zero=new Ut.common.Vec3,this.rayCastHit=new Ut.collision.geometry.RayCastHit}createProxy(t,i){return null}destroyProxy(t){}moveProxy(t,i,s){}isOverlapping(t,i){return t._aabbMinX<i._aabbMaxX&&t._aabbMaxX>i._aabbMinX&&t._aabbMinY<i._aabbMaxY&&t._aabbMaxY>i._aabbMinY&&t._aabbMinZ<i._aabbMaxZ&&t._aabbMaxZ>i._aabbMinZ}collectPairs(){}getProxyPairList(){return this._proxyPairList}isIncremental(){return this._incremental}getTestCount(){return this._testCount}rayCast(t,i,s){}convexCast(t,i,s,n){}aabbTest(t,i){}},Ut.collision.geometry||(Ut.collision.geometry={}),Ut.collision.geometry.Geometry=class{constructor(t){this._type=t,this._volume=0}_updateMass(){}_computeAabb(t,i){}_rayCastLocal(t,i,s,n,a,o,e){return!1}getType(){return this._type}getVolume(){return this._volume}rayCast(t,i,s,n){let a,o,e,r,_,h,l,c,m,b,p,d;if(a=t.x,o=t.y,e=t.z,r=i.x,_=i.y,h=i.z,a-=s._positionX,o-=s._positionY,e-=s._positionZ,r-=s._positionX,_-=s._positionY,h-=s._positionZ,l=s._rotation00*a+s._rotation10*o+s._rotation20*e,c=s._rotation01*a+s._rotation11*o+s._rotation21*e,m=s._rotation02*a+s._rotation12*o+s._rotation22*e,a=l,o=c,e=m,b=s._rotation00*r+s._rotation10*_+s._rotation20*h,p=s._rotation01*r+s._rotation11*_+s._rotation21*h,d=s._rotation02*r+s._rotation12*_+s._rotation22*h,r=b,_=p,h=d,this._rayCastLocal(a,o,e,r,_,h,n)){let t,i,a,o,e,r,_=n.position;t=_.x,i=_.y,a=_.z;let h,l,c,m,b,p,d=n.normal;o=d.x,e=d.y,r=d.z,h=s._rotation00*t+s._rotation01*i+s._rotation02*a,l=s._rotation10*t+s._rotation11*i+s._rotation12*a,c=s._rotation20*t+s._rotation21*i+s._rotation22*a,t=h,i=l,a=c,m=s._rotation00*o+s._rotation01*e+s._rotation02*r,b=s._rotation10*o+s._rotation11*e+s._rotation12*r,p=s._rotation20*o+s._rotation21*e+s._rotation22*r,o=m,e=b,r=p,t+=s._positionX,i+=s._positionY,a+=s._positionZ;let u=n.position;u.x=t,u.y=i,u.z=a;let f=n.normal;return f.x=o,f.y=e,f.z=r,!0}return!1}},Ut.collision.geometry.ConvexGeometry=class extends Ut.collision.geometry.Geometry{constructor(t){super(t),this._gjkMargin=Ut.common.Setting.defaultGJKMargin,this._useGjkRayCast=!1}getGjkMergin(){return this._gjkMargin}setGjkMergin(t){t<0&&(t=0),this._gjkMargin=t}computeLocalSupportingVertex(t,i){}rayCast(t,i,s,n){return this._useGjkRayCast?Ut.collision.narrowphase.detector.gjkepa.GjkEpa.instance.rayCast(this,s,t,i,n):super.rayCast(t,i,s,n)}},Ut.collision.broadphase._BroadPhase||(Ut.collision.broadphase._BroadPhase={}),Ut.collision.broadphase._BroadPhase.ConvexSweepGeometry=class extends Ut.collision.geometry.ConvexGeometry{constructor(){super(-1)}init(t,i,s){let n,a,o,e,r,_,h,l,c;this.c=t,n=s.x,a=s.y,o=s.z,h=i._rotation00*n+i._rotation10*a+i._rotation20*o,l=i._rotation01*n+i._rotation11*a+i._rotation21*o,c=i._rotation02*n+i._rotation12*a+i._rotation22*o,e=h,r=l,_=c,this.localTranslation=new Ut.common.Vec3;let m=this.localTranslation;m.x=e,m.y=r,m.z=_,this._gjkMargin=t._gjkMargin}computeLocalSupportingVertex(t,i){this.c.computeLocalSupportingVertex(t,i);let s=this.localTranslation;if(t.x*s.x+t.y*s.y+t.z*s.z>0){let t=this.localTranslation;i.x+=t.x,i.y+=t.y,i.z+=t.z}}},Ut.collision.broadphase._BroadPhase.AabbGeometry=class extends Ut.collision.geometry.ConvexGeometry{constructor(){super(-1),this.min=new Ut.common.Vec3,this.max=new Ut.common.Vec3}computeLocalSupportingVertex(t,i){i.x=t.x>0?this.max.x:this.min.x,i.y=t.y>0?this.max.y:this.min.y,i.z=t.z>0?this.max.z:this.min.z}},Ut.collision.broadphase.BroadPhaseProxyCallback=class{constructor(){}process(t){}},Ut.collision.broadphase.BroadPhaseType=class{},Ut.collision.broadphase.Proxy=class{constructor(t,i){this.userData=t,this._id=i,this._prev=null,this._next=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}getId(){return this._id}getFatAabb(){let t=new Ut.collision.geometry.Aabb;return t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ,t}getFatAabbTo(t){t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ}},Ut.collision.broadphase.ProxyPair=class{constructor(){this._p1=null,this._p2=null}getProxy1(){return this._p1}getProxy2(){return this._p2}getNext(){return this._next}},Ut.collision.broadphase.bruteforce||(Ut.collision.broadphase.bruteforce={}),Ut.collision.broadphase.bruteforce.BruteForceBroadPhase=class extends Ut.collision.broadphase.BroadPhase{constructor(){super(1),this._incremental=!1}createProxy(t,i){let s=new Ut.collision.broadphase.Proxy(t,this._idCount++);return this._numProxies++,null==this._proxyList?(this._proxyList=s,this._proxyListLast=s):(this._proxyListLast._next=s,s._prev=this._proxyListLast,this._proxyListLast=s),s._aabbMinX=i._minX,s._aabbMinY=i._minY,s._aabbMinZ=i._minZ,s._aabbMaxX=i._maxX,s._aabbMaxY=i._maxY,s._aabbMaxZ=i._maxZ,s}destroyProxy(t){this._numProxies--;let i=t._prev,s=t._next;null!=i&&(i._next=s),null!=s&&(s._prev=i),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null,t.userData=null}moveProxy(t,i,s){t._aabbMinX=i._minX,t._aabbMinY=i._minY,t._aabbMinZ=i._minZ,t._aabbMaxX=i._maxX,t._aabbMaxY=i._maxY,t._aabbMaxZ=i._maxZ}collectPairs(){let t=this._proxyPairList;if(null!=t){for(;t._p1=null,t._p2=null,t=t._next,null!=t;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}this._testCount=0;let i=this._proxyList;for(;null!=i;){let t=i._next,s=i._next;for(;null!=s;){let t=s._next;if(this._testCount++,i._aabbMinX<s._aabbMaxX&&i._aabbMaxX>s._aabbMinX&&i._aabbMinY<s._aabbMaxY&&i._aabbMaxY>s._aabbMinY&&i._aabbMinZ<s._aabbMaxZ&&i._aabbMaxZ>s._aabbMinZ){let t=this._proxyPairPool;null!=t?(this._proxyPairPool=t._next,t._next=null):t=new Ut.collision.broadphase.ProxyPair;let n=t;null==this._proxyPairList||(n._next=this._proxyPairList),this._proxyPairList=n,n._p1=i,n._p2=s}s=t}i=t}}rayCast(t,i,s){let n,a,o,e,r,_;n=t.x,a=t.y,o=t.z,e=i.x,r=i.y,_=i.z;let h=this._proxyList;for(;null!=h;){let t,i=h._next,l=n,c=a,m=o,b=e,p=r,d=_,u=h._aabbMinX,f=h._aabbMinY,x=h._aabbMinZ,g=h._aabbMaxX,v=h._aabbMaxY,y=h._aabbMaxZ;if(u>(l>b?l:b)||g<(l<b?l:b)||f>(c>p?c:p)||v<(c<p?c:p)||x>(m>d?m:d)||y<(m<d?m:d))t=!1;else{let i,s,n=b-l,a=p-c,o=d-m,e=n<0?-n:n,r=a<0?-a:a,_=o<0?-o:o,h=.5*(g-u),X=.5*(v-f),z=.5*(y-x),M=l-.5*(g+u),Y=c-.5*(v+f),Z=m-.5*(y+x),w=Y*o-Z*a;if((w<0?-w:w)-(X*_+z*r)>0)s=!0;else{let t=Z*n-M*o;s=(t<0?-t:t)-(z*e+h*_)>0}if(s)i=!0;else{let t=M*a-Y*n;i=(t<0?-t:t)-(h*r+X*e)>0}t=!i}t&&s.process(h),h=i}}convexCast(t,i,s,n){let a=this._proxyList;for(;null!=a;){let o=a._next,e=this._aabb.min;e.x=a._aabbMinX,e.y=a._aabbMinY,e.z=a._aabbMinZ;let r=this._aabb.max;r.x=a._aabbMaxX,r.y=a._aabbMaxY,r.z=a._aabbMaxZ,this._convexSweep.init(t,i,s);let _=Ut.collision.narrowphase.detector.gjkepa.GjkEpa.instance;0==_.computeClosestPointsImpl(this._convexSweep,this._aabb,i,this.identity,null,!1)&&_.distance<=0&&n.process(a),a=o}}aabbTest(t,i){let s=this._proxyList;for(;null!=s;){let n=s._next;t._minX<s._aabbMaxX&&t._maxX>s._aabbMinX&&t._minY<s._aabbMaxY&&t._maxY>s._aabbMinY&&t._minZ<s._aabbMaxZ&&t._maxZ>s._aabbMinZ&&i.process(s),s=n}}},Ut.collision.broadphase.bvh||(Ut.collision.broadphase.bvh={}),Ut.collision.broadphase.bvh.BvhBroadPhase=class extends Ut.collision.broadphase.BroadPhase{constructor(){super(2),this._incremental=!0,this._tree=new Ut.collision.broadphase.bvh.BvhTree,this.movedProxies=new Array(1024),this.numMovedProxies=0}collide(t,i){this._testCount++;let s=0==t._height,n=0==i._height;if(t==i){if(s)return;return this.collide(t._children[0],i),void this.collide(t._children[1],i)}if(t._aabbMinX<i._aabbMaxX&&t._aabbMaxX>i._aabbMinX&&t._aabbMinY<i._aabbMaxY&&t._aabbMaxY>i._aabbMinY&&t._aabbMinZ<i._aabbMaxZ&&t._aabbMaxZ>i._aabbMinZ){if(s&&n){let s=this._proxyPairPool;null!=s?(this._proxyPairPool=s._next,s._next=null):s=new Ut.collision.broadphase.ProxyPair;let n=s;return null==this._proxyPairList||(n._next=this._proxyPairList),this._proxyPairList=n,n._p1=t._proxy,void(n._p2=i._proxy)}n||t._height>i._height?(this.collide(t._children[0],i),this.collide(t._children[1],i)):(this.collide(i._children[0],t),this.collide(i._children[1],t))}}rayCastRecursive(t,i,s,n,a,o,e,r){let _,h=i,l=s,c=n,m=a,b=o,p=e,d=t._aabbMinX,u=t._aabbMinY,f=t._aabbMinZ,x=t._aabbMaxX,g=t._aabbMaxY,v=t._aabbMaxZ;if(d>(h>m?h:m)||x<(h<m?h:m)||u>(l>b?l:b)||g<(l<b?l:b)||f>(c>p?c:p)||v<(c<p?c:p))_=!1;else{let t,i,s=m-h,n=b-l,a=p-c,o=s<0?-s:s,e=n<0?-n:n,r=a<0?-a:a,y=.5*(x-d),X=.5*(g-u),z=.5*(v-f),M=h-.5*(x+d),Y=l-.5*(g+u),Z=c-.5*(v+f),w=Y*a-Z*n;if((w<0?-w:w)-(X*r+z*e)>0)i=!0;else{let t=Z*s-M*a;i=(t<0?-t:t)-(z*o+y*r)>0}if(i)t=!0;else{let i=M*n-Y*s;t=(i<0?-i:i)-(y*e+X*o)>0}_=!t}_&&(0!=t._height?(this.rayCastRecursive(t._children[0],i,s,n,a,o,e,r),this.rayCastRecursive(t._children[1],i,s,n,a,o,e,r)):r.process(t._proxy))}convexCastRecursive(t,i,s,n,a){let o=this._aabb.min;o.x=t._aabbMinX,o.y=t._aabbMinY,o.z=t._aabbMinZ;let e=this._aabb.max;e.x=t._aabbMaxX,e.y=t._aabbMaxY,e.z=t._aabbMaxZ,this._convexSweep.init(i,s,n);let r=Ut.collision.narrowphase.detector.gjkepa.GjkEpa.instance;0==r.computeClosestPointsImpl(this._convexSweep,this._aabb,s,this.identity,null,!1)&&r.distance<=0&&(0!=t._height?(this.convexCastRecursive(t._children[0],i,s,n,a),this.convexCastRecursive(t._children[1],i,s,n,a)):a.process(t._proxy))}aabbTestRecursive(t,i,s){t._aabbMinX<i._maxX&&t._aabbMaxX>i._minX&&t._aabbMinY<i._maxY&&t._aabbMaxY>i._minY&&t._aabbMinZ<i._maxZ&&t._aabbMaxZ>i._minZ&&(0!=t._height?(this.aabbTestRecursive(t._children[0],i,s),this.aabbTestRecursive(t._children[1],i,s)):s.process(t._proxy))}createProxy(t,i){let s=new Ut.collision.broadphase.bvh.BvhProxy(t,this._idCount++);this._numProxies++,null==this._proxyList?(this._proxyList=s,this._proxyListLast=s):(this._proxyListLast._next=s,s._prev=this._proxyListLast,this._proxyListLast=s),s._aabbMinX=i._minX,s._aabbMinY=i._minY,s._aabbMinZ=i._minZ,s._aabbMaxX=i._maxX,s._aabbMaxY=i._maxY,s._aabbMaxZ=i._maxZ;let n=Ut.common.Setting.bvhProxyPadding;s._aabbMinX-=n,s._aabbMinY-=n,s._aabbMinZ-=n,s._aabbMaxX+=n,s._aabbMaxY+=n,s._aabbMaxZ+=n;let a=this._tree,o=a._nodePool;null!=o?(a._nodePool=o._next,o._next=null):o=new Ut.collision.broadphase.bvh.BvhNode;let e=o;if(e._proxy=s,s._leaf=e,e._aabbMinX=s._aabbMinX,e._aabbMinY=s._aabbMinY,e._aabbMinZ=s._aabbMinZ,e._aabbMaxX=s._aabbMaxX,e._aabbMaxY=s._aabbMaxY,e._aabbMaxZ=s._aabbMaxZ,a._numLeaves++,null==a.leafList?(a.leafList=e,a.leafListLast=e):(a.leafListLast._nextLeaf=e,e._prevLeaf=a.leafListLast,a.leafListLast=e),null==a._root)a._root=e;else{let t=a._root;for(;t._height>0;){let i=a._strategy._decideInsertion(t,e);if(-1==i)break;t=t._children[i]}let i=t._parent,s=a._nodePool;null!=s?(a._nodePool=s._next,s._next=null):s=new Ut.collision.broadphase.bvh.BvhNode;let n=s;if(null==i)a._root=n;else{let s=t._childIndex;i._children[s]=n,n._parent=i,n._childIndex=s}let o=t._childIndex;n._children[o]=t,t._parent=n,t._childIndex=o;let r=1^t._childIndex;for(n._children[r]=e,e._parent=n,e._childIndex=r;null!=n;){if(a._strategy._balancingEnabled&&n._height>=2){let t=n._parent,i=n._children[0],s=n._children[1],o=i._height-s._height,e=n._childIndex;if(o>1){let s=i._children[0],o=i._children[1];if(s._height>o._height){i._children[1]=n,n._parent=i,n._childIndex=1,n._children[0]=o,o._parent=n,o._childIndex=0;let t=i._children[0],s=i._children[1];i._aabbMinX=t._aabbMinX<s._aabbMinX?t._aabbMinX:s._aabbMinX,i._aabbMinY=t._aabbMinY<s._aabbMinY?t._aabbMinY:s._aabbMinY,i._aabbMinZ=t._aabbMinZ<s._aabbMinZ?t._aabbMinZ:s._aabbMinZ,i._aabbMaxX=t._aabbMaxX>s._aabbMaxX?t._aabbMaxX:s._aabbMaxX,i._aabbMaxY=t._aabbMaxY>s._aabbMaxY?t._aabbMaxY:s._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>s._aabbMaxZ?t._aabbMaxZ:s._aabbMaxZ;let a=i._children[0]._height,e=i._children[1]._height;i._height=(a>e?a:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let h=n._children[0]._height,l=n._children[1]._height;n._height=(h>l?h:l)+1}else{i._children[0]=n,n._parent=i,n._childIndex=0,n._children[0]=s,s._parent=n,s._childIndex=0;let t=i._children[0],a=i._children[1];i._aabbMinX=t._aabbMinX<a._aabbMinX?t._aabbMinX:a._aabbMinX,i._aabbMinY=t._aabbMinY<a._aabbMinY?t._aabbMinY:a._aabbMinY,i._aabbMinZ=t._aabbMinZ<a._aabbMinZ?t._aabbMinZ:a._aabbMinZ,i._aabbMaxX=t._aabbMaxX>a._aabbMaxX?t._aabbMaxX:a._aabbMaxX,i._aabbMaxY=t._aabbMaxY>a._aabbMaxY?t._aabbMaxY:a._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>a._aabbMaxZ?t._aabbMaxZ:a._aabbMaxZ;let o=i._children[0]._height,e=i._children[1]._height;i._height=(o>e?o:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let h=n._children[0]._height,l=n._children[1]._height;n._height=(h>l?h:l)+1}null!=t?(t._children[e]=i,i._parent=t,i._childIndex=e):(a._root=i,i._parent=null),n=i}else if(o<-1){let i=s._children[0],o=s._children[1];if(i._height>o._height){s._children[1]=n,n._parent=s,n._childIndex=1,n._children[1]=o,o._parent=n,o._childIndex=1;let t=s._children[0],i=s._children[1];s._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,s._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,s._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,s._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,s._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let a=s._children[0]._height,e=s._children[1]._height;s._height=(a>e?a:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let h=n._children[0]._height,l=n._children[1]._height;n._height=(h>l?h:l)+1}else{s._children[0]=n,n._parent=s,n._childIndex=0,n._children[1]=i,i._parent=n,i._childIndex=1;let t=s._children[0],a=s._children[1];s._aabbMinX=t._aabbMinX<a._aabbMinX?t._aabbMinX:a._aabbMinX,s._aabbMinY=t._aabbMinY<a._aabbMinY?t._aabbMinY:a._aabbMinY,s._aabbMinZ=t._aabbMinZ<a._aabbMinZ?t._aabbMinZ:a._aabbMinZ,s._aabbMaxX=t._aabbMaxX>a._aabbMaxX?t._aabbMaxX:a._aabbMaxX,s._aabbMaxY=t._aabbMaxY>a._aabbMaxY?t._aabbMaxY:a._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>a._aabbMaxZ?t._aabbMaxZ:a._aabbMaxZ;let o=s._children[0]._height,e=s._children[1]._height;s._height=(o>e?o:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let h=n._children[0]._height,l=n._children[1]._height;n._height=(h>l?h:l)+1}null!=t?(t._children[e]=s,s._parent=t,s._childIndex=e):(a._root=s,s._parent=null),n=s}}let t=n._children[0]._height,i=n._children[1]._height;n._height=(t>i?t:i)+1;let s=n._children[0],o=n._children[1];n._aabbMinX=s._aabbMinX<o._aabbMinX?s._aabbMinX:o._aabbMinX,n._aabbMinY=s._aabbMinY<o._aabbMinY?s._aabbMinY:o._aabbMinY,n._aabbMinZ=s._aabbMinZ<o._aabbMinZ?s._aabbMinZ:o._aabbMinZ,n._aabbMaxX=s._aabbMaxX>o._aabbMaxX?s._aabbMaxX:o._aabbMaxX,n._aabbMaxY=s._aabbMaxY>o._aabbMaxY?s._aabbMaxY:o._aabbMaxY,n._aabbMaxZ=s._aabbMaxZ>o._aabbMaxZ?s._aabbMaxZ:o._aabbMaxZ,n=n._parent}}if(!s._moved){if(s._moved=!0,this.movedProxies.length==this.numMovedProxies){let t=new Array(this.numMovedProxies<<1),i=0,s=this.numMovedProxies;for(;i<s;){let s=i++;t[s]=this.movedProxies[s],this.movedProxies[s]=null}this.movedProxies=t}this.movedProxies[this.numMovedProxies++]=s}return s}destroyProxy(t){this._numProxies--;let i=t._prev,s=t._next;null!=i&&(i._next=s),null!=s&&(s._prev=i),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null;let n=t,a=this._tree,o=n._leaf;a._numLeaves--;let e=o._prevLeaf,r=o._nextLeaf;if(null!=e&&(e._nextLeaf=r),null!=r&&(r._prevLeaf=e),o==a.leafList&&(a.leafList=a.leafList._nextLeaf),o==a.leafListLast&&(a.leafListLast=a.leafListLast._prevLeaf),o._nextLeaf=null,o._prevLeaf=null,a._root==o)a._root=null;else{let t=o._parent,i=t._children[1^o._childIndex],s=t._parent;if(null==s)i._parent=null,i._childIndex=0,a._root=i,t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=a._nodePool,a._nodePool=t;else{i._parent=s;let n=t._childIndex;s._children[n]=i,i._parent=s,i._childIndex=n,t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=a._nodePool,a._nodePool=t;let o=s;for(;null!=o;){if(a._strategy._balancingEnabled&&o._height>=2){let t=o._parent,i=o._children[0],s=o._children[1],n=i._height-s._height,e=o._childIndex;if(n>1){let s=i._children[0],n=i._children[1];if(s._height>n._height){i._children[1]=o,o._parent=i,o._childIndex=1,o._children[0]=n,n._parent=o,n._childIndex=0;let t=i._children[0],s=i._children[1];i._aabbMinX=t._aabbMinX<s._aabbMinX?t._aabbMinX:s._aabbMinX,i._aabbMinY=t._aabbMinY<s._aabbMinY?t._aabbMinY:s._aabbMinY,i._aabbMinZ=t._aabbMinZ<s._aabbMinZ?t._aabbMinZ:s._aabbMinZ,i._aabbMaxX=t._aabbMaxX>s._aabbMaxX?t._aabbMaxX:s._aabbMaxX,i._aabbMaxY=t._aabbMaxY>s._aabbMaxY?t._aabbMaxY:s._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>s._aabbMaxZ?t._aabbMaxZ:s._aabbMaxZ;let a=i._children[0]._height,e=i._children[1]._height;i._height=(a>e?a:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let h=o._children[0]._height,l=o._children[1]._height;o._height=(h>l?h:l)+1}else{i._children[0]=o,o._parent=i,o._childIndex=0,o._children[0]=s,s._parent=o,s._childIndex=0;let t=i._children[0],n=i._children[1];i._aabbMinX=t._aabbMinX<n._aabbMinX?t._aabbMinX:n._aabbMinX,i._aabbMinY=t._aabbMinY<n._aabbMinY?t._aabbMinY:n._aabbMinY,i._aabbMinZ=t._aabbMinZ<n._aabbMinZ?t._aabbMinZ:n._aabbMinZ,i._aabbMaxX=t._aabbMaxX>n._aabbMaxX?t._aabbMaxX:n._aabbMaxX,i._aabbMaxY=t._aabbMaxY>n._aabbMaxY?t._aabbMaxY:n._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>n._aabbMaxZ?t._aabbMaxZ:n._aabbMaxZ;let a=i._children[0]._height,e=i._children[1]._height;i._height=(a>e?a:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let h=o._children[0]._height,l=o._children[1]._height;o._height=(h>l?h:l)+1}null!=t?(t._children[e]=i,i._parent=t,i._childIndex=e):(a._root=i,i._parent=null),o=i}else if(n<-1){let i=s._children[0],n=s._children[1];if(i._height>n._height){s._children[1]=o,o._parent=s,o._childIndex=1,o._children[1]=n,n._parent=o,n._childIndex=1;let t=s._children[0],i=s._children[1];s._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,s._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,s._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,s._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,s._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let a=s._children[0]._height,e=s._children[1]._height;s._height=(a>e?a:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let h=o._children[0]._height,l=o._children[1]._height;o._height=(h>l?h:l)+1}else{s._children[0]=o,o._parent=s,o._childIndex=0,o._children[1]=i,i._parent=o,i._childIndex=1;let t=s._children[0],n=s._children[1];s._aabbMinX=t._aabbMinX<n._aabbMinX?t._aabbMinX:n._aabbMinX,s._aabbMinY=t._aabbMinY<n._aabbMinY?t._aabbMinY:n._aabbMinY,s._aabbMinZ=t._aabbMinZ<n._aabbMinZ?t._aabbMinZ:n._aabbMinZ,s._aabbMaxX=t._aabbMaxX>n._aabbMaxX?t._aabbMaxX:n._aabbMaxX,s._aabbMaxY=t._aabbMaxY>n._aabbMaxY?t._aabbMaxY:n._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>n._aabbMaxZ?t._aabbMaxZ:n._aabbMaxZ;let a=s._children[0]._height,e=s._children[1]._height;s._height=(a>e?a:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let h=o._children[0]._height,l=o._children[1]._height;o._height=(h>l?h:l)+1}null!=t?(t._children[e]=s,s._parent=t,s._childIndex=e):(a._root=s,s._parent=null),o=s}}let t=o._children[0]._height,i=o._children[1]._height;o._height=(t>i?t:i)+1;let s=o._children[0],n=o._children[1];o._aabbMinX=s._aabbMinX<n._aabbMinX?s._aabbMinX:n._aabbMinX,o._aabbMinY=s._aabbMinY<n._aabbMinY?s._aabbMinY:n._aabbMinY,o._aabbMinZ=s._aabbMinZ<n._aabbMinZ?s._aabbMinZ:n._aabbMinZ,o._aabbMaxX=s._aabbMaxX>n._aabbMaxX?s._aabbMaxX:n._aabbMaxX,o._aabbMaxY=s._aabbMaxY>n._aabbMaxY?s._aabbMaxY:n._aabbMaxY,o._aabbMaxZ=s._aabbMaxZ>n._aabbMaxZ?s._aabbMaxZ:n._aabbMaxZ,o=o._parent}}}n._leaf=null,o._next=null,o._childIndex=0,o._children[0]=null,o._children[1]=null,o._childIndex=0,o._parent=null,o._height=0,o._proxy=null,o._next=a._nodePool,a._nodePool=o,n.userData=null,n._next=null,n._prev=null,n._moved&&(n._moved=!1)}moveProxy(t,i,s){let n=t;if(n._aabbMinX<=i._minX&&n._aabbMaxX>=i._maxX&&n._aabbMinY<=i._minY&&n._aabbMaxY>=i._maxY&&n._aabbMinZ<=i._minZ&&n._aabbMaxZ>=i._maxZ)return;n._aabbMinX=i._minX,n._aabbMinY=i._minY,n._aabbMinZ=i._minZ,n._aabbMaxX=i._maxX,n._aabbMaxY=i._maxY,n._aabbMaxZ=i._maxZ;let a=Ut.common.Setting.bvhProxyPadding;if(n._aabbMinX-=a,n._aabbMinY-=a,n._aabbMinZ-=a,n._aabbMaxX+=a,n._aabbMaxY+=a,n._aabbMaxZ+=a,null!=s){let t,i,a,o,e,r,_,h,l,c,m,b;o=0,e=0,r=0,t=s.x,i=s.y,a=s.z,_=o<t?o:t,h=e<i?e:i,l=r<a?r:a,c=o>t?o:t,m=e>i?e:i,b=r>a?r:a,n._aabbMinX+=_,n._aabbMinY+=h,n._aabbMinZ+=l,n._aabbMaxX+=c,n._aabbMaxY+=m,n._aabbMaxZ+=b}if(!n._moved){if(n._moved=!0,this.movedProxies.length==this.numMovedProxies){let t=new Array(this.numMovedProxies<<1),i=0,s=this.numMovedProxies;for(;i<s;){let s=i++;t[s]=this.movedProxies[s],this.movedProxies[s]=null}this.movedProxies=t}this.movedProxies[this.numMovedProxies++]=n}}collectPairs(){let t=this._proxyPairList;if(null!=t){for(;t._p1=null,t._p2=null,t=t._next,null!=t;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}if(this._testCount=0,this._numProxies<2)return;let i=this.numMovedProxies/this._numProxies<Ut.common.Setting.bvhIncrementalCollisionThreshold,s=0,n=this.numMovedProxies;for(;s<n;){let t=s++,n=this.movedProxies[t];if(n._moved){let t=this._tree,s=n._leaf;t._numLeaves--;let a=s._prevLeaf,o=s._nextLeaf;if(null!=a&&(a._nextLeaf=o),null!=o&&(o._prevLeaf=a),s==t.leafList&&(t.leafList=t.leafList._nextLeaf),s==t.leafListLast&&(t.leafListLast=t.leafListLast._prevLeaf),s._nextLeaf=null,s._prevLeaf=null,t._root==s)t._root=null;else{let i=s._parent,n=i._children[1^s._childIndex],a=i._parent;if(null==a)n._parent=null,n._childIndex=0,t._root=n,i._next=null,i._childIndex=0,i._children[0]=null,i._children[1]=null,i._childIndex=0,i._parent=null,i._height=0,i._proxy=null,i._next=t._nodePool,t._nodePool=i;else{n._parent=a;let s=i._childIndex;a._children[s]=n,n._parent=a,n._childIndex=s,i._next=null,i._childIndex=0,i._children[0]=null,i._children[1]=null,i._childIndex=0,i._parent=null,i._height=0,i._proxy=null,i._next=t._nodePool,t._nodePool=i;let o=a;for(;null!=o;){if(t._strategy._balancingEnabled&&o._height>=2){let i=o._parent,s=o._children[0],n=o._children[1],a=s._height-n._height,e=o._childIndex;if(a>1){let n=s._children[0],a=s._children[1];if(n._height>a._height){s._children[1]=o,o._parent=s,o._childIndex=1,o._children[0]=a,a._parent=o,a._childIndex=0;let t=s._children[0],i=s._children[1];s._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,s._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,s._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,s._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,s._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let n=s._children[0]._height,e=s._children[1]._height;s._height=(n>e?n:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let h=o._children[0]._height,l=o._children[1]._height;o._height=(h>l?h:l)+1}else{s._children[0]=o,o._parent=s,o._childIndex=0,o._children[0]=n,n._parent=o,n._childIndex=0;let t=s._children[0],i=s._children[1];s._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,s._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,s._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,s._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,s._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let a=s._children[0]._height,e=s._children[1]._height;s._height=(a>e?a:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let h=o._children[0]._height,l=o._children[1]._height;o._height=(h>l?h:l)+1}null!=i?(i._children[e]=s,s._parent=i,s._childIndex=e):(t._root=s,s._parent=null),o=s}else if(a<-1){let s=n._children[0],a=n._children[1];if(s._height>a._height){n._children[1]=o,o._parent=n,o._childIndex=1,o._children[1]=a,a._parent=o,a._childIndex=1;let t=n._children[0],i=n._children[1];n._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,n._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,n._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,n._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,n._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,n._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let s=n._children[0]._height,e=n._children[1]._height;n._height=(s>e?s:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let h=o._children[0]._height,l=o._children[1]._height;o._height=(h>l?h:l)+1}else{n._children[0]=o,o._parent=n,o._childIndex=0,o._children[1]=s,s._parent=o,s._childIndex=1;let t=n._children[0],i=n._children[1];n._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,n._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,n._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,n._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,n._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,n._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let a=n._children[0]._height,e=n._children[1]._height;n._height=(a>e?a:e)+1;let r=o._children[0],_=o._children[1];o._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,o._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,o._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,o._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,o._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,o._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let h=o._children[0]._height,l=o._children[1]._height;o._height=(h>l?h:l)+1}null!=i?(i._children[e]=n,n._parent=i,n._childIndex=e):(t._root=n,n._parent=null),o=n}}let i=o._children[0]._height,s=o._children[1]._height;o._height=(i>s?i:s)+1;let n=o._children[0],a=o._children[1];o._aabbMinX=n._aabbMinX<a._aabbMinX?n._aabbMinX:a._aabbMinX,o._aabbMinY=n._aabbMinY<a._aabbMinY?n._aabbMinY:a._aabbMinY,o._aabbMinZ=n._aabbMinZ<a._aabbMinZ?n._aabbMinZ:a._aabbMinZ,o._aabbMaxX=n._aabbMaxX>a._aabbMaxX?n._aabbMaxX:a._aabbMaxX,o._aabbMaxY=n._aabbMaxY>a._aabbMaxY?n._aabbMaxY:a._aabbMaxY,o._aabbMaxZ=n._aabbMaxZ>a._aabbMaxZ?n._aabbMaxZ:a._aabbMaxZ,o=o._parent}}}n._leaf=null,s._next=null,s._childIndex=0,s._children[0]=null,s._children[1]=null,s._childIndex=0,s._parent=null,s._height=0,s._proxy=null,s._next=t._nodePool,t._nodePool=s;let e=this._tree,r=e._nodePool;null!=r?(e._nodePool=r._next,r._next=null):r=new Ut.collision.broadphase.bvh.BvhNode;let _=r;if(_._proxy=n,n._leaf=_,_._aabbMinX=n._aabbMinX,_._aabbMinY=n._aabbMinY,_._aabbMinZ=n._aabbMinZ,_._aabbMaxX=n._aabbMaxX,_._aabbMaxY=n._aabbMaxY,_._aabbMaxZ=n._aabbMaxZ,e._numLeaves++,null==e.leafList?(e.leafList=_,e.leafListLast=_):(e.leafListLast._nextLeaf=_,_._prevLeaf=e.leafListLast,e.leafListLast=_),null==e._root)e._root=_;else{let t=e._root;for(;t._height>0;){let i=e._strategy._decideInsertion(t,_);if(-1==i)break;t=t._children[i]}let i=t._parent,s=e._nodePool;null!=s?(e._nodePool=s._next,s._next=null):s=new Ut.collision.broadphase.bvh.BvhNode;let n=s;if(null==i)e._root=n;else{let s=t._childIndex;i._children[s]=n,n._parent=i,n._childIndex=s}let a=t._childIndex;n._children[a]=t,t._parent=n,t._childIndex=a;let o=1^t._childIndex;for(n._children[o]=_,_._parent=n,_._childIndex=o;null!=n;){if(e._strategy._balancingEnabled&&n._height>=2){let t=n._parent,i=n._children[0],s=n._children[1],a=i._height-s._height,o=n._childIndex;if(a>1){let s=i._children[0],a=i._children[1];if(s._height>a._height){i._children[1]=n,n._parent=i,n._childIndex=1,n._children[0]=a,a._parent=n,a._childIndex=0;let t=i._children[0],s=i._children[1];i._aabbMinX=t._aabbMinX<s._aabbMinX?t._aabbMinX:s._aabbMinX,i._aabbMinY=t._aabbMinY<s._aabbMinY?t._aabbMinY:s._aabbMinY,i._aabbMinZ=t._aabbMinZ<s._aabbMinZ?t._aabbMinZ:s._aabbMinZ,i._aabbMaxX=t._aabbMaxX>s._aabbMaxX?t._aabbMaxX:s._aabbMaxX,i._aabbMaxY=t._aabbMaxY>s._aabbMaxY?t._aabbMaxY:s._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>s._aabbMaxZ?t._aabbMaxZ:s._aabbMaxZ;let o=i._children[0]._height,e=i._children[1]._height;i._height=(o>e?o:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let h=n._children[0]._height,l=n._children[1]._height;n._height=(h>l?h:l)+1}else{i._children[0]=n,n._parent=i,n._childIndex=0,n._children[0]=s,s._parent=n,s._childIndex=0;let t=i._children[0],a=i._children[1];i._aabbMinX=t._aabbMinX<a._aabbMinX?t._aabbMinX:a._aabbMinX,i._aabbMinY=t._aabbMinY<a._aabbMinY?t._aabbMinY:a._aabbMinY,i._aabbMinZ=t._aabbMinZ<a._aabbMinZ?t._aabbMinZ:a._aabbMinZ,i._aabbMaxX=t._aabbMaxX>a._aabbMaxX?t._aabbMaxX:a._aabbMaxX,i._aabbMaxY=t._aabbMaxY>a._aabbMaxY?t._aabbMaxY:a._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>a._aabbMaxZ?t._aabbMaxZ:a._aabbMaxZ;let o=i._children[0]._height,e=i._children[1]._height;i._height=(o>e?o:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let h=n._children[0]._height,l=n._children[1]._height;n._height=(h>l?h:l)+1}null!=t?(t._children[o]=i,i._parent=t,i._childIndex=o):(e._root=i,i._parent=null),n=i}else if(a<-1){let i=s._children[0],a=s._children[1];if(i._height>a._height){s._children[1]=n,n._parent=s,n._childIndex=1,n._children[1]=a,a._parent=n,a._childIndex=1;let t=s._children[0],i=s._children[1];s._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,s._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,s._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,s._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,s._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let o=s._children[0]._height,e=s._children[1]._height;s._height=(o>e?o:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let h=n._children[0]._height,l=n._children[1]._height;n._height=(h>l?h:l)+1}else{s._children[0]=n,n._parent=s,n._childIndex=0,n._children[1]=i,i._parent=n,i._childIndex=1;let t=s._children[0],a=s._children[1];s._aabbMinX=t._aabbMinX<a._aabbMinX?t._aabbMinX:a._aabbMinX,s._aabbMinY=t._aabbMinY<a._aabbMinY?t._aabbMinY:a._aabbMinY,s._aabbMinZ=t._aabbMinZ<a._aabbMinZ?t._aabbMinZ:a._aabbMinZ,s._aabbMaxX=t._aabbMaxX>a._aabbMaxX?t._aabbMaxX:a._aabbMaxX,s._aabbMaxY=t._aabbMaxY>a._aabbMaxY?t._aabbMaxY:a._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>a._aabbMaxZ?t._aabbMaxZ:a._aabbMaxZ;let o=s._children[0]._height,e=s._children[1]._height;s._height=(o>e?o:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let h=n._children[0]._height,l=n._children[1]._height;n._height=(h>l?h:l)+1}null!=t?(t._children[o]=s,s._parent=t,s._childIndex=o):(e._root=s,s._parent=null),n=s}}let t=n._children[0]._height,i=n._children[1]._height;n._height=(t>i?t:i)+1;let s=n._children[0],a=n._children[1];n._aabbMinX=s._aabbMinX<a._aabbMinX?s._aabbMinX:a._aabbMinX,n._aabbMinY=s._aabbMinY<a._aabbMinY?s._aabbMinY:a._aabbMinY,n._aabbMinZ=s._aabbMinZ<a._aabbMinZ?s._aabbMinZ:a._aabbMinZ,n._aabbMaxX=s._aabbMaxX>a._aabbMaxX?s._aabbMaxX:a._aabbMaxX,n._aabbMaxY=s._aabbMaxY>a._aabbMaxY?s._aabbMaxY:a._aabbMaxY,n._aabbMaxZ=s._aabbMaxZ>a._aabbMaxZ?s._aabbMaxZ:a._aabbMaxZ,n=n._parent}}i&&this.collide(this._tree._root,n._leaf),n._moved=!1}this.movedProxies[t]=null}i||this.collide(this._tree._root,this._tree._root),this.numMovedProxies=0}rayCast(t,i,s){if(null==this._tree._root)return;let n,a,o,e,r,_;n=t.x,a=t.y,o=t.z,e=i.x,r=i.y,_=i.z,this.rayCastRecursive(this._tree._root,n,a,o,e,r,_,s)}convexCast(t,i,s,n){null!=this._tree._root&&this.convexCastRecursive(this._tree._root,t,i,s,n)}aabbTest(t,i){null!=this._tree._root&&this.aabbTestRecursive(this._tree._root,t,i)}getTreeBalance(){return this._tree._getBalance()}},Ut.collision.broadphase.bvh.BvhInsertionStrategy=class{},Ut.collision.broadphase.bvh.BvhNode=class{constructor(){this._next=null,this._prevLeaf=null,this._nextLeaf=null,this._children=new Array(2),this._childIndex=0,this._parent=null,this._height=0,this._proxy=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}},Ut.collision.broadphase.bvh.BvhProxy=class extends Ut.collision.broadphase.Proxy{constructor(t,i){super(t,i),this._leaf=null,this._moved=!1}},Ut.collision.broadphase.bvh.BvhStrategy=class{constructor(){this._insertionStrategy=0,this._balancingEnabled=!1}_decideInsertion(t,i){switch(this._insertionStrategy){case 0:let s,n,a;s=i._aabbMinX+i._aabbMaxX,n=i._aabbMinY+i._aabbMaxY,a=i._aabbMinZ+i._aabbMaxZ;let o,e,r,_,h,l,c=t._children[0],m=t._children[1];return o=c._aabbMinX+c._aabbMaxX,e=c._aabbMinY+c._aabbMaxY,r=c._aabbMinZ+c._aabbMaxZ,_=m._aabbMinX+m._aabbMaxX,h=m._aabbMinY+m._aabbMaxY,l=m._aabbMinZ+m._aabbMaxZ,o-=s,e-=n,r-=a,_-=s,h-=n,l-=a,o*o+e*e+r*r<_*_+h*h+l*l?0:1;case 1:let b,p,d,u,f,x,g=t._children[0],v=t._children[1],y=t._aabbMaxY-t._aabbMinY,X=t._aabbMaxZ-t._aabbMinZ;b=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,p=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,d=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,u=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,f=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,x=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let z,M,Y=f-p,Z=x-d,w=2*((u-b)*(Y+Z)+Y*Z),I=2*w,V=2*(w-2*((t._aabbMaxX-t._aabbMinX)*(y+X)+y*X));if(b=g._aabbMinX<i._aabbMinX?g._aabbMinX:i._aabbMinX,p=g._aabbMinY<i._aabbMinY?g._aabbMinY:i._aabbMinY,d=g._aabbMinZ<i._aabbMinZ?g._aabbMinZ:i._aabbMinZ,u=g._aabbMaxX>i._aabbMaxX?g._aabbMaxX:i._aabbMaxX,f=g._aabbMaxY>i._aabbMaxY?g._aabbMaxY:i._aabbMaxY,x=g._aabbMaxZ>i._aabbMaxZ?g._aabbMaxZ:i._aabbMaxZ,0==g._height){let t=f-p,i=x-d;z=V+2*((u-b)*(t+i)+t*i)}else{let t=f-p,i=x-d,s=g._aabbMaxY-g._aabbMinY,n=g._aabbMaxZ-g._aabbMinZ;z=V+(2*((u-b)*(t+i)+t*i)-2*((g._aabbMaxX-g._aabbMinX)*(s+n)+s*n))}if(b=v._aabbMinX<i._aabbMinX?v._aabbMinX:i._aabbMinX,p=v._aabbMinY<i._aabbMinY?v._aabbMinY:i._aabbMinY,d=v._aabbMinZ<i._aabbMinZ?v._aabbMinZ:i._aabbMinZ,u=v._aabbMaxX>i._aabbMaxX?v._aabbMaxX:i._aabbMaxX,f=v._aabbMaxY>i._aabbMaxY?v._aabbMaxY:i._aabbMaxY,x=v._aabbMaxZ>i._aabbMaxZ?v._aabbMaxZ:i._aabbMaxZ,0==v._height){let t=f-p,i=x-d;M=V+2*((u-b)*(t+i)+t*i)}else{let t=f-p,i=x-d,s=v._aabbMaxY-v._aabbMinY,n=v._aabbMaxZ-v._aabbMinZ;M=V+(2*((u-b)*(t+i)+t*i)-2*((v._aabbMaxX-v._aabbMinX)*(s+n)+s*n))}return I<z?I<M?-1:1:z<M?0:1;default:return console.log("src/oimo/collision/broadphase/bvh/BvhStrategy.hx:37:","invalid BVH insertion strategy: "+this._insertionStrategy),-1}}_splitLeaves(t,i,s){let n,a,o,e=1/(s-i);n=0,a=0,o=0;let r,_,h,l=i;for(;l<s;){let i=t[l++];i._tmpX=i._aabbMaxX+i._aabbMinX,i._tmpY=i._aabbMaxY+i._aabbMinY,i._tmpZ=i._aabbMaxZ+i._aabbMinZ,n+=i._tmpX,a+=i._tmpY,o+=i._tmpZ}n*=e,a*=e,o*=e,r=0,_=0,h=0;let c=i;for(;c<s;){let i,s,e,l=t[c++];i=l._tmpX-n,s=l._tmpY-a,e=l._tmpZ-o,i*=i,s*=s,e*=e,r+=i,_+=s,h+=e}let m=_,b=h,p=i,d=s-1;if(r>m)if(r>b){let i=n;for(;;){for(;!(t[p]._tmpX<=i);)++p;for(;!(t[d]._tmpX>=i);)--d;if(p>=d)break;let s=t[p];t[p]=t[d],t[d]=s,++p,--d}}else{let i=o;for(;;){for(;!(t[p]._tmpZ<=i);)++p;for(;!(t[d]._tmpZ>=i);)--d;if(p>=d)break;let s=t[p];t[p]=t[d],t[d]=s,++p,--d}}else if(m>b){let i=a;for(;;){for(;!(t[p]._tmpY<=i);)++p;for(;!(t[d]._tmpY>=i);)--d;if(p>=d)break;let s=t[p];t[p]=t[d],t[d]=s,++p,--d}}else{let i=o;for(;;){for(;!(t[p]._tmpZ<=i);)++p;for(;!(t[d]._tmpZ>=i);)--d;if(p>=d)break;let s=t[p];t[p]=t[d],t[d]=s,++p,--d}}return p}},Ut.collision.broadphase.bvh.BvhTree=class{constructor(){this._root=null,this._numLeaves=0,this._strategy=new Ut.collision.broadphase.bvh.BvhStrategy,this._nodePool=null,this.leafList=null,this.leafListLast=null,this.tmp=new Array(1024)}_print(t,i){if(null==i&&(i=""),null!=t)if(0==t._height)console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:39:",i+t._proxy._id);else{let s,n,a,o;this._print(t._children[0],i+"  "),n=t._aabbMaxX-t._aabbMinX,a=t._aabbMaxY-t._aabbMinY,o=t._aabbMaxZ-t._aabbMinZ;if(n*(a+o)+a*o>0){let i,n,a;i=t._aabbMaxX-t._aabbMinX,n=t._aabbMaxY-t._aabbMinY,a=t._aabbMaxZ-t._aabbMinZ;s=(1e3*(i*(n+a)+n*a)+.5|0)/1e3}else{let i,n,a;i=t._aabbMaxX-t._aabbMinX,n=t._aabbMaxY-t._aabbMinY,a=t._aabbMaxZ-t._aabbMinZ;s=(1e3*(i*(n+a)+n*a)-.5|0)/1e3}console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:42:",i+"#"+t._height+", "+s),this._print(t._children[1],i+"  ")}}_getBalance(){return this.getBalanceRecursive(this._root)}deleteRecursive(t){if(0==t._height){let i=t._prevLeaf,s=t._nextLeaf;return null!=i&&(i._nextLeaf=s),null!=s&&(s._prevLeaf=i),t==this.leafList&&(this.leafList=this.leafList._nextLeaf),t==this.leafListLast&&(this.leafListLast=this.leafListLast._prevLeaf),t._nextLeaf=null,t._prevLeaf=null,t._proxy._leaf=null,t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,void(this._nodePool=t)}this.deleteRecursive(t._children[0]),this.deleteRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t}decomposeRecursive(t){if(0==t._height)return t._childIndex=0,void(t._parent=null);this.decomposeRecursive(t._children[0]),this.decomposeRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t}buildTopDownRecursive(t,i,s){if(s-i==1){let s=t[i],n=s._proxy;return s._aabbMinX=n._aabbMinX,s._aabbMinY=n._aabbMinY,s._aabbMinZ=n._aabbMinZ,s._aabbMaxX=n._aabbMaxX,s._aabbMaxY=n._aabbMaxY,s._aabbMaxZ=n._aabbMaxZ,s}let n=this._strategy._splitLeaves(t,i,s),a=this.buildTopDownRecursive(t,i,n),o=this.buildTopDownRecursive(t,n,s),e=this._nodePool;null!=e?(this._nodePool=e._next,e._next=null):e=new Ut.collision.broadphase.bvh.BvhNode;let r=e;r._children[0]=a,a._parent=r,a._childIndex=0,r._children[1]=o,o._parent=r,o._childIndex=1;let _=r._children[0],h=r._children[1];r._aabbMinX=_._aabbMinX<h._aabbMinX?_._aabbMinX:h._aabbMinX,r._aabbMinY=_._aabbMinY<h._aabbMinY?_._aabbMinY:h._aabbMinY,r._aabbMinZ=_._aabbMinZ<h._aabbMinZ?_._aabbMinZ:h._aabbMinZ,r._aabbMaxX=_._aabbMaxX>h._aabbMaxX?_._aabbMaxX:h._aabbMaxX,r._aabbMaxY=_._aabbMaxY>h._aabbMaxY?_._aabbMaxY:h._aabbMaxY,r._aabbMaxZ=_._aabbMaxZ>h._aabbMaxZ?_._aabbMaxZ:h._aabbMaxZ;let l=r._children[0]._height,c=r._children[1]._height;return r._height=(l>c?l:c)+1,r}getBalanceRecursive(t){if(null==t||0==t._height)return 0;let i=t._children[0]._height-t._children[1]._height;return i<0&&(i=-i),i+this.getBalanceRecursive(t._children[0])+this.getBalanceRecursive(t._children[1])}},Ut.collision.geometry.Aabb=class{constructor(){this._minX=0,this._minY=0,this._minZ=0,this._maxX=0,this._maxY=0,this._maxZ=0}init(t,i){return this._minX=t.x,this._minY=t.y,this._minZ=t.z,this._maxX=i.x,this._maxY=i.y,this._maxZ=i.z,this}getMin(){let t=new Ut.common.Vec3;return t.x=this._minX,t.y=this._minY,t.z=this._minZ,t}getMinTo(t){t.x=this._minX,t.y=this._minY,t.z=this._minZ}setMin(t){return this._minX=t.x,this._minY=t.y,this._minZ=t.z,this}getMax(){let t=new Ut.common.Vec3;return t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ,t}getMaxTo(t){t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ}setMax(t){return this._maxX=t.x,this._maxY=t.y,this._maxZ=t.z,this}getCenter(){let t,i,s,n=new Ut.common.Vec3;return t=this._minX+this._maxX,i=this._minY+this._maxY,s=this._minZ+this._maxZ,t*=.5,i*=.5,s*=.5,n.x=t,n.y=i,n.z=s,n}getCenterTo(t){let i,s,n;i=this._minX+this._maxX,s=this._minY+this._maxY,n=this._minZ+this._maxZ,i*=.5,s*=.5,n*=.5,t.x=i,t.y=s,t.z=n}getExtents(){let t,i,s,n=new Ut.common.Vec3;return t=this._maxX-this._minX,i=this._maxY-this._minY,s=this._maxZ-this._minZ,t*=.5,i*=.5,s*=.5,n.x=t,n.y=i,n.z=s,n}getExtentsTo(t){let i,s,n;i=this._maxX-this._minX,s=this._maxY-this._minY,n=this._maxZ-this._minZ,i*=.5,s*=.5,n*=.5,t.x=i,t.y=s,t.z=n}combine(t){return this._minX=this._minX<t._minX?this._minX:t._minX,this._minY=this._minY<t._minY?this._minY:t._minY,this._minZ=this._minZ<t._minZ?this._minZ:t._minZ,this._maxX=this._maxX>t._maxX?this._maxX:t._maxX,this._maxY=this._maxY>t._maxY?this._maxY:t._maxY,this._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,this}combined(t){let i=new Ut.collision.geometry.Aabb;return i._minX=this._minX<t._minX?this._minX:t._minX,i._minY=this._minY<t._minY?this._minY:t._minY,i._minZ=this._minZ<t._minZ?this._minZ:t._minZ,i._maxX=this._maxX>t._maxX?this._maxX:t._maxX,i._maxY=this._maxY>t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,i}overlap(t){return this._minX<t._maxX&&this._maxX>t._minX&&this._minY<t._maxY&&this._maxY>t._minY&&this._minZ<t._maxZ&&this._maxZ>t._minZ}getIntersection(t){let i=new Ut.collision.geometry.Aabb;return i._minX=this._minX>t._minX?this._minX:t._minX,i._minY=this._minY>t._minY?this._minY:t._minY,i._minZ=this._minZ>t._minZ?this._minZ:t._minZ,i._maxX=this._maxX<t._maxX?this._maxX:t._maxX,i._maxY=this._maxY<t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ,i}getIntersectionTo(t,i){i._minX=this._minX>t._minX?this._minX:t._minX,i._minY=this._minY>t._minY?this._minY:t._minY,i._minZ=this._minZ>t._minZ?this._minZ:t._minZ,i._maxX=this._maxX<t._maxX?this._maxX:t._maxX,i._maxY=this._maxY<t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ}copyFrom(t){return this._minX=t._minX,this._minY=t._minY,this._minZ=t._minZ,this._maxX=t._maxX,this._maxY=t._maxY,this._maxZ=t._maxZ,this}clone(){let t=new Ut.collision.geometry.Aabb;return t._minX=this._minX,t._minY=this._minY,t._minZ=this._minZ,t._maxX=this._maxX,t._maxY=this._maxY,t._maxZ=this._maxZ,t}},Ut.collision.geometry.BoxGeometry=class extends Ut.collision.geometry.ConvexGeometry{constructor(t){super(1),this._halfExtentsX=t.x,this._halfExtentsY=t.y,this._halfExtentsZ=t.z,this._halfAxisXX=t.x,this._halfAxisXY=0,this._halfAxisXZ=0,this._halfAxisYX=0,this._halfAxisYY=t.y,this._halfAxisYZ=0,this._halfAxisZX=0,this._halfAxisZY=0,this._halfAxisZZ=t.z,this._updateMass();let i=t.x<t.y?t.z<t.x?t.z:t.x:t.z<t.y?t.z:t.y;this._gjkMargin>.2*i&&(this._gjkMargin=.2*i)}getHalfExtents(){let t=new Ut.common.Vec3;return t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ,t}getHalfExtentsTo(t){t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ}_updateMass(){let t,i,s;this._volume=this._halfExtentsX*this._halfExtentsY*this._halfExtentsZ*8,t=this._halfExtentsX*this._halfExtentsX,i=this._halfExtentsY*this._halfExtentsY,s=this._halfExtentsZ*this._halfExtentsZ,this._inertiaCoeff00=.3333333333333333*(i+s),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(s+t),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(t+i)}_computeAabb(t,i){let s,n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X;c=i._rotation00*this._halfAxisXX+i._rotation01*this._halfAxisXY+i._rotation02*this._halfAxisXZ,m=i._rotation10*this._halfAxisXX+i._rotation11*this._halfAxisXY+i._rotation12*this._halfAxisXZ,b=i._rotation20*this._halfAxisXX+i._rotation21*this._halfAxisXY+i._rotation22*this._halfAxisXZ,s=c,n=m,a=b,p=i._rotation00*this._halfAxisYX+i._rotation01*this._halfAxisYY+i._rotation02*this._halfAxisYZ,d=i._rotation10*this._halfAxisYX+i._rotation11*this._halfAxisYY+i._rotation12*this._halfAxisYZ,u=i._rotation20*this._halfAxisYX+i._rotation21*this._halfAxisYY+i._rotation22*this._halfAxisYZ,o=p,e=d,r=u,f=i._rotation00*this._halfAxisZX+i._rotation01*this._halfAxisZY+i._rotation02*this._halfAxisZZ,x=i._rotation10*this._halfAxisZX+i._rotation11*this._halfAxisZY+i._rotation12*this._halfAxisZZ,g=i._rotation20*this._halfAxisZX+i._rotation21*this._halfAxisZY+i._rotation22*this._halfAxisZZ,_=f,h=x,l=g,s<0&&(s=-s),n<0&&(n=-n),a<0&&(a=-a),o<0&&(o=-o),e<0&&(e=-e),r<0&&(r=-r),_<0&&(_=-_),h<0&&(h=-h),l<0&&(l=-l),v=s+o,y=n+e,X=a+r,v+=_,y+=h,X+=l,t._minX=i._positionX-v,t._minY=i._positionY-y,t._minZ=i._positionZ-X,t._maxX=i._positionX+v,t._maxY=i._positionY+y,t._maxZ=i._positionZ+X}computeLocalSupportingVertex(t,i){let s,n,a,o,e,r;s=this._gjkMargin,n=this._gjkMargin,a=this._gjkMargin,s<this._halfExtentsX||(s=this._halfExtentsX),n<this._halfExtentsY||(n=this._halfExtentsY),a<this._halfExtentsZ||(a=this._halfExtentsZ),o=this._halfExtentsX-s,e=this._halfExtentsY-n,r=this._halfExtentsZ-a,i.x=t.x>0?o:-o,i.y=t.y>0?e:-e,i.z=t.z>0?r:-r}_rayCastLocal(t,i,s,n,a,o,e){let r=this._halfExtentsX,_=this._halfExtentsY,h=this._halfExtentsZ,l=n-t,c=a-i,m=o-s,b=0,p=0,d=0,u=1,f=1,x=1;if(l>-1e-6&&l<1e-6){if(t<=-r||t>=r)return!1}else{let i=1/l,s=(-r-t)*i,n=(r-t)*i;if(s>n){let t=s;s=n,n=t}s>0&&(b=s),n<1&&(u=n)}if(c>-1e-6&&c<1e-6){if(i<=-_||i>=_)return!1}else{let t=1/c,s=(-_-i)*t,n=(_-i)*t;if(s>n){let t=s;s=n,n=t}s>0&&(p=s),n<1&&(f=n)}if(m>-1e-6&&m<1e-6){if(s<=-h||s>=h)return!1}else{let t=1/m,i=(-h-s)*t,n=(h-s)*t;if(i>n){let t=i;i=n,n=t}i>0&&(d=i),n<1&&(x=n)}if(b>=1||p>=1||d>=1||u<=0||f<=0||x<=0)return!1;let g=b,v=u,y=0;if(p>g&&(g=p,y=1),d>g&&(g=d,y=2),f<v&&(v=f),x<v&&(v=x),g>v)return!1;if(0==g)return!1;switch(y){case 0:e.normal.init(l>0?-1:1,0,0);break;case 1:e.normal.init(0,c>0?-1:1,0);break;case 2:e.normal.init(0,0,m>0?-1:1)}return e.position.init(t+g*l,i+g*c,s+g*m),e.fraction=g,!0}},Ut.collision.geometry.CapsuleGeometry=class extends Ut.collision.geometry.ConvexGeometry{constructor(t,i){super(4),this._radius=t,this._halfHeight=i,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,i=this._halfHeight*this._halfHeight,s=6.28318530717958*t*this._halfHeight,n=3.14159265358979*t*this._radius*4/3;this._volume=s+n;let a=0==this._volume?0:1/this._volume,o=a*(s*(.25*t+i/3)+n*(.4*t+this._halfHeight*this._radius*.75+i));this._inertiaCoeff00=o,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=a*(s*t*.5+n*t*.4),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=o}_computeAabb(t,i){let s,n,a,o,e,r;s=this._radius,n=this._radius,a=this._radius,o=i._rotation01,e=i._rotation11,r=i._rotation21,o<0&&(o=-o),e<0&&(e=-e),r<0&&(r=-r),o*=this._halfHeight,e*=this._halfHeight,r*=this._halfHeight,s+=o,n+=e,a+=r,t._minX=i._positionX-s,t._minY=i._positionY-n,t._minZ=i._positionZ-a,t._maxX=i._positionX+s,t._maxY=i._positionY+n,t._maxZ=i._positionZ+a}computeLocalSupportingVertex(t,i){t.y>0?i.init(0,this._halfHeight,0):i.init(0,-this._halfHeight,0)}_rayCastLocal(t,i,s,n,a,o,e){let r,_=this._halfHeight,h=n-t,l=o-s,c=0,m=h*h+l*l,b=t*h+s*l,p=t*t+s*s-this._radius*this._radius,d=b*b-m*p;if(d<0)return!1;if(m>0){let t=Math.sqrt(d);if(c=(-b-t)/m,r=(-b+t)/m,c>=1||r<=0)return!1}else{if(p>=0)return!1;c=0}let u,f,x,g,v,y,X,z,M,Y,Z=i+(a-i)*c;if(Z>-_&&Z<_){if(c>0){u=c;let i=e.normal.init(t+h*u,0,s+l*u),n=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z);return n>0&&(n=1/n),i.x*=n,i.y*=n,i.z*=n,e.position.init(t+u*h,Z,s+u*l),e.fraction=u,!0}return!1}if(f=0,x=Z<0?-_:_,g=0,v=t-0,y=i-x,X=s-0,z=n-t,M=a-i,Y=o-s,m=z*z+M*M+Y*Y,b=v*z+y*M+X*Y,p=v*v+y*y+X*X-this._radius*this._radius,d=b*b-m*p,d<0)return!1;let w,I,V,L,A,k,S=(-b-Math.sqrt(d))/m;if(S<0||S>1)return!1;w=v+z*S,I=y+M*S,V=X+Y*S;let B=w*w+I*I+V*V;B>0&&(B=1/Math.sqrt(B)),L=w*B,A=I*B,k=V*B,w+=0,I+=x,V+=0;let P=e.position;P.x=w,P.y=I,P.z=V;let C=e.normal;return C.x=L,C.y=A,C.z=k,e.fraction=S,!0}},Ut.collision.geometry.ConeGeometry=class extends Ut.collision.geometry.ConvexGeometry{constructor(t,i){super(3),this._radius=t,this._halfHeight=i,this.sinTheta=t/Math.sqrt(t*t+4*i*i),this.cosTheta=2*i/Math.sqrt(t*t+4*i*i),this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,i=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2/3,this._inertiaCoeff00=.05*(3*t+2*i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.05*(3*t+2*i)}_computeAabb(t,i){let s,n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y;s=i._rotation01,n=i._rotation11,a=i._rotation21,o=s*s,e=n*n,r=a*a,c=Math.sqrt(1-o),m=Math.sqrt(1-e),b=Math.sqrt(1-r),c*=this._radius,m*=this._radius,b*=this._radius,_=s*this._halfHeight,h=n*this._halfHeight,l=a*this._halfHeight,p=-_,d=-h,u=-l,p-=c,d-=m,u-=b,f=-_,x=-h,g=-l,f+=c,x+=m,g+=b,v=p>f?p:f,y=d>x?d:x,X=u>g?u:g,v>_||(v=_),y>h||(y=h),X>l||(X=l),z=p<f?p:f,M=d<x?d:x,Y=u<g?u:g,z<_||(z=_),M<h||(M=h),Y<l||(Y=l),t._minX=i._positionX+z,t._minY=i._positionY+M,t._minZ=i._positionZ+Y,t._maxX=i._positionX+v,t._maxY=i._positionY+y,t._maxZ=i._positionZ+X}computeLocalSupportingVertex(t,i){let s=t.x,n=t.y,a=t.z;if(n>0&&n*n>this.sinTheta*this.sinTheta*(s*s+n*n+a*a))return i.init(0,this._halfHeight-this._gjkMargin/this.sinTheta,0),void(i.y<0&&(i.y=0));let o=t.x,e=t.z,r=o*o+e*e,_=2*this._halfHeight,h=(_-this._gjkMargin)/_*this._radius-this._gjkMargin/this.cosTheta;h<0&&(h=0);let l=r>0?h/Math.sqrt(r):0,c=this._halfHeight-this._gjkMargin;c<0&&(c=0),i.x=o*l,i.y=-c,i.z=e*l}_rayCastLocal(t,i,s,n,a,o,e){let r,_=this._halfHeight,h=n-t,l=a-i,c=o-s,m=0,b=1;if(l>-1e-6&&l<1e-6){if(i<=-_||i>=_)return!1}else{let t=1/l,s=(-_-i)*t,n=(_-i)*t;if(s>n){let t=s;s=n,n=t}s>0&&(m=s),n<1&&(b=n)}if(m>=1||b<=0)return!1;let p=0,d=0;r=i-_;let u,f=this.cosTheta*this.cosTheta,x=f*(h*h+l*l+c*c)-l*l,g=f*(t*h+r*l+s*c)-r*l,v=f*(t*t+r*r+s*s)-r*r,y=g*g-x*v;if(0!=x){if(y<0)return!1;let t=Math.sqrt(y);if(x<0){if(l>0){if(p=0,d=(-g+t)/x,d<=0)return!1}else if(p=(-g-t)/x,d=1,p>=1)return!1}else if(p=(-g-t)/x,d=(-g+t)/x,p>=1||d<=0)return!1}else{let t=-v/(2*g);if(g>0){if(p=0,d=t,t<=0)return!1}else if(p=t,d=1,t>=1)return!1}if(r+=_,d<=m||b<=p)return!1;if(p<m){if(u=m,0==u)return!1;e.normal.init(0,l>0?-1:1,0)}else{if(u=p,0==u)return!1;let i=e.normal.init(t+h*u,0,s+c*u),n=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z);n>0&&(n=1/n),i.x*=n,i.y*=n,i.z*=n;let a=this.cosTheta;i.x*=a,i.y*=a,i.z*=a,e.normal.y+=this.sinTheta}return e.position.init(t+u*h,r+u*l,s+u*c),e.fraction=u,!0}},Ut.collision.geometry.ConvexHullGeometry=class extends Ut.collision.geometry.ConvexGeometry{constructor(t){super(5),this._numVertices=t.length,this._vertices=new Array(this._numVertices),this._tmpVertices=new Array(this._numVertices);let i=0,s=this._numVertices;for(;i<s;){let s=i++;this._vertices[s]=t[s],this._tmpVertices[s]=new Ut.common.Vec3}this._useGjkRayCast=!0,this._updateMass()}getVertices(){return this._vertices}_updateMass(){this._volume=1,this._inertiaCoeff00=1,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=1,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=1;let t=this._vertices[0].x,i=this._vertices[0].y,s=this._vertices[0].z,n=this._vertices[0].x,a=this._vertices[0].y,o=this._vertices[0].z,e=1,r=this._numVertices;for(;e<r;){let r=e++,_=this._vertices[r].x,h=this._vertices[r].y,l=this._vertices[r].z;_<t?t=_:_>n&&(n=_),h<i?i=h:h>a&&(a=h),l<s?s=l:l>o&&(o=l)}let _=n-t,h=a-i,l=o-s;this._volume=_*h*l;let c=.25*((t+n)*(t+n)+(i+a)*(i+a)+(s+o)*(s+o));_=_*_*.25,h=h*h*.25,l=l*l*.25,this._inertiaCoeff00=.3333333333333333*(h+l)+c,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(l+_)+c,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(_+h)+c}_computeAabb(t,i){let s,n,a,o,e,r,_,h,l,c,m,b;_=this._gjkMargin,h=this._gjkMargin,l=this._gjkMargin;let p,d,u,f,x,g,v=this._vertices[0];c=v.x,m=v.y,b=v.z,f=i._rotation00*c+i._rotation01*m+i._rotation02*b,x=i._rotation10*c+i._rotation11*m+i._rotation12*b,g=i._rotation20*c+i._rotation21*m+i._rotation22*b,p=f,d=x,u=g,p+=i._positionX,d+=i._positionY,u+=i._positionZ,s=p,n=d,a=u,o=p,e=d,r=u;let y=1,X=this._numVertices;for(;y<X;){let t,_,h,l=this._vertices[y++];c=l.x,m=l.y,b=l.z,t=i._rotation00*c+i._rotation01*m+i._rotation02*b,_=i._rotation10*c+i._rotation11*m+i._rotation12*b,h=i._rotation20*c+i._rotation21*m+i._rotation22*b,p=t,d=_,u=h,p+=i._positionX,d+=i._positionY,u+=i._positionZ,s<p||(s=p),n<d||(n=d),a<u||(a=u),o>p||(o=p),e>d||(e=d),r>u||(r=u)}t._minX=s-_,t._minY=n-h,t._minZ=a-l,t._maxX=o+_,t._maxY=e+h,t._maxZ=r+l}computeLocalSupportingVertex(t,i){let s=this._vertices[0],n=s.x*t.x+s.y*t.y+s.z*t.z,a=0,o=1,e=this._numVertices;for(;o<e;){let i=o++,s=this._vertices[i],e=s.x*t.x+s.y*t.y+s.z*t.z;e>n&&(n=e,a=i)}let r=this._vertices[a];i.x=r.x,i.y=r.y,i.z=r.z}},Ut.collision.geometry.CylinderGeometry=class extends Ut.collision.geometry.ConvexGeometry{constructor(t,i){super(2),this._radius=t,this._halfHeight=i,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,i=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2,this._inertiaCoeff00=.08333333333333333*(3*t+i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.5*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.08333333333333333*(3*t+i)}_computeAabb(t,i){let s,n,a,o,e,r,_,h,l,c,m,b,p,d,u;s=i._rotation01,n=i._rotation11,a=i._rotation21,s<0&&(s=-s),n<0&&(n=-n),a<0&&(a=-a),o=s*s,e=n*n,r=a*a,c=Math.sqrt(1-o),m=Math.sqrt(1-e),b=Math.sqrt(1-r),c*=this._radius,m*=this._radius,b*=this._radius,_=s*this._halfHeight,h=n*this._halfHeight,l=a*this._halfHeight,p=c+_,d=m+h,u=b+l,t._minX=i._positionX-p,t._minY=i._positionY-d,t._minZ=i._positionZ-u,t._maxX=i._positionX+p,t._maxY=i._positionY+d,t._maxZ=i._positionZ+u}computeLocalSupportingVertex(t,i){let s=t.x,n=t.z,a=s*s+n*n,o=this._radius-this._gjkMargin;o<0&&(o=0);let e=a>0?o/Math.sqrt(a):0,r=this._halfHeight-this._gjkMargin;r<0&&(r=0),i.x=s*e,i.y=t.y>0?r:-r,i.z=n*e}_rayCastLocal(t,i,s,n,a,o,e){let r=this._halfHeight,_=n-t,h=a-i,l=o-s,c=0,m=1;if(h>-1e-6&&h<1e-6){if(i<=-r||i>=r)return!1}else{let t=1/h,s=(-r-i)*t,n=(r-i)*t;if(s>n){let t=s;s=n,n=t}s>0&&(c=s),n<1&&(m=n)}if(c>=1||m<=0)return!1;let b,p,d=0,u=_*_+l*l,f=t*_+s*l,x=t*t+s*s-this._radius*this._radius,g=f*f-u*x;if(g<0)return!1;if(u>0){let t=Math.sqrt(g);if(d=(-f-t)/u,b=(-f+t)/u,d>=1||b<=0)return!1}else{if(x>=0)return!1;d=0,b=1}if(b<=c||m<=d)return!1;if(d<c){if(p=c,0==p)return!1;e.normal.init(0,h>0?-1:1,0)}else{if(p=d,0==p)return!1;let i=e.normal.init(t+_*p,0,s+l*p),n=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z);n>0&&(n=1/n),i.x*=n,i.y*=n,i.z*=n}return e.position.init(t+p*_,i+p*h,s+p*l),e.fraction=p,!0}},Ut.collision.geometry.GeometryType=class{},Ut.collision.geometry.RayCastHit=class{constructor(){this.position=new Ut.common.Vec3,this.normal=new Ut.common.Vec3,this.fraction=0}},Ut.collision.geometry.SphereGeometry=class extends Ut.collision.geometry.ConvexGeometry{constructor(t){super(0),this._radius=t,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}_updateMass(){this._volume=4.188790204786386*this._radius*this._radius*this._radius,this._inertiaCoeff00=.4*this._radius*this._radius,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.4*this._radius*this._radius,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.4*this._radius*this._radius}_computeAabb(t,i){let s,n,a;s=this._radius,n=this._radius,a=this._radius,t._minX=i._positionX-s,t._minY=i._positionY-n,t._minZ=i._positionZ-a,t._maxX=i._positionX+s,t._maxY=i._positionY+n,t._maxZ=i._positionZ+a}computeLocalSupportingVertex(t,i){i.zero()}_rayCastLocal(t,i,s,n,a,o,e){let r,_,h;r=n-t,_=a-i,h=o-s;let l=r*r+_*_+h*h,c=t*r+i*_+s*h,m=c*c-l*(t*t+i*i+s*s-this._radius*this._radius);if(m<0)return!1;let b,p,d,u,f,x,g=(-c-Math.sqrt(m))/l;if(g<0||g>1)return!1;b=t+r*g,p=i+_*g,d=s+h*g;let v=b*b+p*p+d*d;v>0&&(v=1/Math.sqrt(v)),u=b*v,f=p*v,x=d*v;let y=e.position;y.x=b,y.y=p,y.z=d;let X=e.normal;return X.x=u,X.y=f,X.z=x,e.fraction=g,!0}},Ut.collision.narrowphase||(Ut.collision.narrowphase={}),Ut.collision.narrowphase.CollisionMatrix=class{constructor(){this.detectors=new Array(8),this.detectors[0]=new Array(8),this.detectors[1]=new Array(8),this.detectors[2]=new Array(8),this.detectors[3]=new Array(8),this.detectors[4]=new Array(8),this.detectors[5]=new Array(8);let t=new Ut.collision.narrowphase.detector.GjkEpaDetector;this.detectors[0][0]=new Ut.collision.narrowphase.detector.SphereSphereDetector,this.detectors[0][1]=new Ut.collision.narrowphase.detector.SphereBoxDetector(!1),this.detectors[0][2]=t,this.detectors[0][3]=t,this.detectors[0][4]=new Ut.collision.narrowphase.detector.SphereCapsuleDetector(!1),this.detectors[0][5]=t,this.detectors[1][0]=new Ut.collision.narrowphase.detector.SphereBoxDetector(!0),this.detectors[1][1]=new Ut.collision.narrowphase.detector.BoxBoxDetector,this.detectors[1][2]=t,this.detectors[1][3]=t,this.detectors[1][4]=t,this.detectors[1][5]=t,this.detectors[2][0]=t,this.detectors[2][1]=t,this.detectors[2][2]=t,this.detectors[2][3]=t,this.detectors[2][4]=t,this.detectors[2][5]=t,this.detectors[3][0]=t,this.detectors[3][1]=t,this.detectors[3][2]=t,this.detectors[3][3]=t,this.detectors[3][4]=t,this.detectors[3][5]=t,this.detectors[4][0]=new Ut.collision.narrowphase.detector.SphereCapsuleDetector(!0),this.detectors[4][1]=t,this.detectors[4][2]=t,this.detectors[4][3]=t,this.detectors[4][4]=new Ut.collision.narrowphase.detector.CapsuleCapsuleDetector,this.detectors[4][5]=t,this.detectors[5][0]=t,this.detectors[5][1]=t,this.detectors[5][2]=t,this.detectors[5][3]=t,this.detectors[5][4]=t,this.detectors[5][5]=t}getDetector(t,i){return this.detectors[t][i]}},Ut.collision.narrowphase.DetectorResult=class{constructor(){this.numPoints=0,this.normal=new Ut.common.Vec3,this.points=new Array(Ut.common.Setting.maxManifoldPoints),this.incremental=!1;let t=0,i=Ut.common.Setting.maxManifoldPoints;for(;t<i;)this.points[t++]=new Ut.collision.narrowphase.DetectorResultPoint}getMaxDepth(){let t=0,i=0,s=this.numPoints;for(;i<s;){let s=i++;this.points[s].depth>t&&(t=this.points[s].depth)}return t}clear(){this.numPoints=0;let t=0,i=this.points;for(;t<i.length;){let s=i[t];++t,s.position1.zero(),s.position2.zero(),s.depth=0,s.id=0}this.normal.zero()}},Ut.collision.narrowphase.DetectorResultPoint=class{constructor(){this.position1=new Ut.common.Vec3,this.position2=new Ut.common.Vec3,this.depth=0,this.id=0}},Ut.collision.narrowphase.detector||(Ut.collision.narrowphase.detector={}),Ut.collision.narrowphase.detector.Detector=class{constructor(t){this.swapped=t}setNormal(t,i,s,n){let a=t.normal;if(a.x=i,a.y=s,a.z=n,this.swapped){let i=t.normal;i.x=-i.x,i.y=-i.y,i.z=-i.z}}addPoint(t,i,s,n,a,o,e,r,_){let h=t.points[t.numPoints++];if(h.depth=r,h.id=_,this.swapped){let t=h.position1;t.x=a,t.y=o,t.z=e;let r=h.position2;r.x=i,r.y=s,r.z=n}else{let t=h.position1;t.x=i,t.y=s,t.z=n;let r=h.position2;r.x=a,r.y=o,r.z=e}}detectImpl(t,i,s,n,a,o){}detect(t,i,s,n,a,o){t.numPoints=0;let e=0,r=t.points;for(;e<r.length;){let t=r[e];++e,t.position1.zero(),t.position2.zero(),t.depth=0,t.id=0}t.normal.zero(),this.swapped?this.detectImpl(t,s,i,a,n,o):this.detectImpl(t,i,s,n,a,o)}},Ut.collision.narrowphase.detector.BoxBoxDetector=class extends Ut.collision.narrowphase.detector.Detector{constructor(){super(!1),this.clipper=new Ut.collision.narrowphase.detector._BoxBoxDetector.FaceClipper}detectImpl(t,i,s,n,a,o){let e,r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S=i,B=s;t.incremental=!1,e=n._positionX,r=n._positionY,_=n._positionZ,h=a._positionX,l=a._positionY,c=a._positionZ,m=h-e,b=l-r,p=c-_,d=n._rotation00,u=n._rotation10,f=n._rotation20,x=n._rotation01,g=n._rotation11,v=n._rotation21,y=n._rotation02,X=n._rotation12,z=n._rotation22,M=a._rotation00,Y=a._rotation10,Z=a._rotation20,w=a._rotation01,I=a._rotation11,V=a._rotation21,L=a._rotation02,A=a._rotation12,k=a._rotation22;let P,C,T,j,E,R,D,F,q,N,H,O,W,G,U,J,$,K,Q=S._halfExtentsX,tt=S._halfExtentsY,it=S._halfExtentsZ,st=B._halfExtentsX,nt=B._halfExtentsY,at=B._halfExtentsZ;P=d*Q,C=u*Q,T=f*Q,j=x*tt,E=g*tt,R=v*tt,D=y*it,F=X*it,q=z*it,N=M*st,H=Y*st,O=Z*st,W=w*nt,G=I*nt,U=V*nt,J=L*at,$=A*at,K=k*at;let ot,et,rt,_t=1/0,ht=-1,lt=0;ot=0,et=0,rt=0;let ct=Q,mt=d*N+u*H+f*O,bt=d*W+u*G+f*U,pt=d*J+u*$+f*K;mt<0&&(mt=-mt),bt<0&&(bt=-bt),pt<0&&(pt=-pt);let dt=mt+bt+pt,ut=d*m+u*b+f*p,ft=ct+dt,xt=ut<0,gt=xt?-ut:ut;if(!(gt<ft))return;{let t=ft-gt;t<1/0&&(_t=t,ht=0,ot=d,et=u,rt=f,lt=xt?-1:1)}ct=tt;let vt=x*N+g*H+v*O,yt=x*W+g*G+v*U,Xt=x*J+g*$+v*K;vt<0&&(vt=-vt),yt<0&&(yt=-yt),Xt<0&&(Xt=-Xt),dt=vt+yt+Xt,ut=x*m+g*b+v*p;let zt=ct+dt,Mt=ut<0,Yt=Mt?-ut:ut;if(!(Yt<zt))return;{let t=zt-Yt;t<_t&&(_t=t,ht=1,ot=x,et=g,rt=v,lt=Mt?-1:1)}ct=it;let Zt=y*N+X*H+z*O,wt=y*W+X*G+z*U,It=y*J+X*$+z*K;Zt<0&&(Zt=-Zt),wt<0&&(wt=-wt),It<0&&(It=-It),dt=Zt+wt+It,ut=y*m+X*b+z*p;let Vt=ct+dt,Lt=ut<0,At=Lt?-ut:ut;if(!(At<Vt))return;{let t=Vt-At;t<_t&&(_t=t,ht=2,ot=y,et=X,rt=z,lt=Lt?-1:1)}_t>Ut.common.Setting.linearSlop?_t-=Ut.common.Setting.linearSlop:_t=0;let kt=M*P+Y*C+Z*T,St=M*j+Y*E+Z*R,Bt=M*D+Y*F+Z*q;kt<0&&(kt=-kt),St<0&&(St=-St),Bt<0&&(Bt=-Bt),ct=kt+St+Bt,dt=st,ut=M*m+Y*b+Z*p;let Pt=ct+dt,Ct=ut<0,Tt=Ct?-ut:ut;if(!(Tt<Pt))return;{let t=Pt-Tt;t<_t&&(_t=t,ht=3,ot=M,et=Y,rt=Z,lt=Ct?-1:1)}let jt=w*P+I*C+V*T,Et=w*j+I*E+V*R,Rt=w*D+I*F+V*q;jt<0&&(jt=-jt),Et<0&&(Et=-Et),Rt<0&&(Rt=-Rt),ct=jt+Et+Rt,dt=nt,ut=w*m+I*b+V*p;let Dt=ct+dt,Ft=ut<0,qt=Ft?-ut:ut;if(!(qt<Dt))return;{let t=Dt-qt;t<_t&&(_t=t,ht=4,ot=w,et=I,rt=V,lt=Ft?-1:1)}let Nt=L*P+A*C+k*T,Ht=L*j+A*E+k*R,Ot=L*D+A*F+k*q;Nt<0&&(Nt=-Nt),Ht<0&&(Ht=-Ht),Ot<0&&(Ot=-Ot),ct=Nt+Ht+Ot,dt=at,ut=L*m+A*b+k*p;let Wt,Gt,Jt,$t,Kt,Qt,ti,ii,si,ni,ai,oi,ei,ri,_i,hi,li,ci,mi,bi,pi,di=ct+dt,ui=ut<0,fi=ui?-ut:ut;if(!(fi<di))return;{let t=di-fi;t<_t&&(_t=t,ht=5,ot=L,et=A,rt=k,lt=ui?-1:1)}if(_t>Ut.common.Setting.linearSlop?_t-=Ut.common.Setting.linearSlop:_t=0,Wt=u*Z-f*Y,Gt=f*M-d*Z,Jt=d*Y-u*M,0!=Wt||0!=Gt||0!=Jt){let t=Wt*Wt+Gt*Gt+Jt*Jt;t>0&&(t=1/Math.sqrt(t)),Wt*=t,Gt*=t,Jt*=t;let i=Wt*j+Gt*E+Jt*R,s=Wt*D+Gt*F+Jt*q;i<0&&(i=-i),s<0&&(s=-s),ct=i+s;let n=Wt*W+Gt*G+Jt*U,a=Wt*J+Gt*$+Jt*K;n<0&&(n=-n),a<0&&(a=-a),dt=n+a,ut=Wt*m+Gt*b+Jt*p;let o=ct+dt,e=ut<0,r=e?-ut:ut;if(!(r<o))return;{let t=o-r;t<_t&&(_t=t,ht=6,ot=Wt,et=Gt,rt=Jt,lt=e?-1:1)}}if(Wt=u*V-f*I,Gt=f*w-d*V,Jt=d*I-u*w,0!=Wt||0!=Gt||0!=Jt){let t=Wt*Wt+Gt*Gt+Jt*Jt;t>0&&(t=1/Math.sqrt(t)),Wt*=t,Gt*=t,Jt*=t;let i=Wt*j+Gt*E+Jt*R,s=Wt*D+Gt*F+Jt*q;i<0&&(i=-i),s<0&&(s=-s),ct=i+s;let n=Wt*N+Gt*H+Jt*O,a=Wt*J+Gt*$+Jt*K;n<0&&(n=-n),a<0&&(a=-a),dt=n+a,ut=Wt*m+Gt*b+Jt*p;let o=ct+dt,e=ut<0,r=e?-ut:ut;if(!(r<o))return;{let t=o-r;t<_t&&(_t=t,ht=7,ot=Wt,et=Gt,rt=Jt,lt=e?-1:1)}}if(Wt=u*k-f*A,Gt=f*L-d*k,Jt=d*A-u*L,0!=Wt||0!=Gt||0!=Jt){let t=Wt*Wt+Gt*Gt+Jt*Jt;t>0&&(t=1/Math.sqrt(t)),Wt*=t,Gt*=t,Jt*=t;let i=Wt*j+Gt*E+Jt*R,s=Wt*D+Gt*F+Jt*q;i<0&&(i=-i),s<0&&(s=-s),ct=i+s;let n=Wt*N+Gt*H+Jt*O,a=Wt*W+Gt*G+Jt*U;n<0&&(n=-n),a<0&&(a=-a),dt=n+a,ut=Wt*m+Gt*b+Jt*p;let o=ct+dt,e=ut<0,r=e?-ut:ut;if(!(r<o))return;{let t=o-r;t<_t&&(_t=t,ht=8,ot=Wt,et=Gt,rt=Jt,lt=e?-1:1)}}if(Wt=g*Z-v*Y,Gt=v*M-x*Z,Jt=x*Y-g*M,0!=Wt||0!=Gt||0!=Jt){let t=Wt*Wt+Gt*Gt+Jt*Jt;t>0&&(t=1/Math.sqrt(t)),Wt*=t,Gt*=t,Jt*=t;let i=Wt*P+Gt*C+Jt*T,s=Wt*D+Gt*F+Jt*q;i<0&&(i=-i),s<0&&(s=-s),ct=i+s;let n=Wt*W+Gt*G+Jt*U,a=Wt*J+Gt*$+Jt*K;n<0&&(n=-n),a<0&&(a=-a),dt=n+a,ut=Wt*m+Gt*b+Jt*p;let o=ct+dt,e=ut<0,r=e?-ut:ut;if(!(r<o))return;{let t=o-r;t<_t&&(_t=t,ht=9,ot=Wt,et=Gt,rt=Jt,lt=e?-1:1)}}if(Wt=g*V-v*I,Gt=v*w-x*V,Jt=x*I-g*w,0!=Wt||0!=Gt||0!=Jt){let t=Wt*Wt+Gt*Gt+Jt*Jt;t>0&&(t=1/Math.sqrt(t)),Wt*=t,Gt*=t,Jt*=t;let i=Wt*P+Gt*C+Jt*T,s=Wt*D+Gt*F+Jt*q;i<0&&(i=-i),s<0&&(s=-s),ct=i+s;let n=Wt*N+Gt*H+Jt*O,a=Wt*J+Gt*$+Jt*K;n<0&&(n=-n),a<0&&(a=-a),dt=n+a,ut=Wt*m+Gt*b+Jt*p;let o=ct+dt,e=ut<0,r=e?-ut:ut;if(!(r<o))return;{let t=o-r;t<_t&&(_t=t,ht=10,ot=Wt,et=Gt,rt=Jt,lt=e?-1:1)}}if(Wt=g*k-v*A,Gt=v*L-x*k,Jt=x*A-g*L,0!=Wt||0!=Gt||0!=Jt){let t=Wt*Wt+Gt*Gt+Jt*Jt;t>0&&(t=1/Math.sqrt(t)),Wt*=t,Gt*=t,Jt*=t;let i=Wt*P+Gt*C+Jt*T,s=Wt*D+Gt*F+Jt*q;i<0&&(i=-i),s<0&&(s=-s),ct=i+s;let n=Wt*N+Gt*H+Jt*O,a=Wt*W+Gt*G+Jt*U;n<0&&(n=-n),a<0&&(a=-a),dt=n+a,ut=Wt*m+Gt*b+Jt*p;let o=ct+dt,e=ut<0,r=e?-ut:ut;if(!(r<o))return;{let t=o-r;t<_t&&(_t=t,ht=11,ot=Wt,et=Gt,rt=Jt,lt=e?-1:1)}}if(Wt=X*Z-z*Y,Gt=z*M-y*Z,Jt=y*Y-X*M,0!=Wt||0!=Gt||0!=Jt){let t=Wt*Wt+Gt*Gt+Jt*Jt;t>0&&(t=1/Math.sqrt(t)),Wt*=t,Gt*=t,Jt*=t;let i=Wt*P+Gt*C+Jt*T,s=Wt*j+Gt*E+Jt*R;i<0&&(i=-i),s<0&&(s=-s),ct=i+s;let n=Wt*W+Gt*G+Jt*U,a=Wt*J+Gt*$+Jt*K;n<0&&(n=-n),a<0&&(a=-a),dt=n+a,ut=Wt*m+Gt*b+Jt*p;let o=ct+dt,e=ut<0,r=e?-ut:ut;if(!(r<o))return;{let t=o-r;t<_t&&(_t=t,ht=12,ot=Wt,et=Gt,rt=Jt,lt=e?-1:1)}}if(Wt=X*V-z*I,Gt=z*w-y*V,Jt=y*I-X*w,0!=Wt||0!=Gt||0!=Jt){let t=Wt*Wt+Gt*Gt+Jt*Jt;t>0&&(t=1/Math.sqrt(t)),Wt*=t,Gt*=t,Jt*=t;let i=Wt*P+Gt*C+Jt*T,s=Wt*j+Gt*E+Jt*R;i<0&&(i=-i),s<0&&(s=-s),ct=i+s;let n=Wt*N+Gt*H+Jt*O,a=Wt*J+Gt*$+Jt*K;n<0&&(n=-n),a<0&&(a=-a),dt=n+a,ut=Wt*m+Gt*b+Jt*p;let o=ct+dt,e=ut<0,r=e?-ut:ut;if(!(r<o))return;{let t=o-r;t<_t&&(_t=t,ht=13,ot=Wt,et=Gt,rt=Jt,lt=e?-1:1)}}if(Wt=X*k-z*A,Gt=z*L-y*k,Jt=y*A-X*L,0!=Wt||0!=Gt||0!=Jt){let t=Wt*Wt+Gt*Gt+Jt*Jt;t>0&&(t=1/Math.sqrt(t)),Wt*=t,Gt*=t,Jt*=t;let i=Wt*P+Gt*C+Jt*T,s=Wt*j+Gt*E+Jt*R;i<0&&(i=-i),s<0&&(s=-s),ct=i+s;let n=Wt*N+Gt*H+Jt*O,a=Wt*W+Gt*G+Jt*U;n<0&&(n=-n),a<0&&(a=-a),dt=n+a,ut=Wt*m+Gt*b+Jt*p;let o=ct+dt,e=ut<0,r=e?-ut:ut;if(!(r<o))return;{let t=o-r;t<_t&&(_t=t,ht=14,ot=Wt,et=Gt,rt=Jt,lt=e?-1:1)}}if(ht>=6){ot*=lt,et*=lt,rt*=lt;let i,s,n,a,o,m,b,p,S,B,Q,tt,it,st,nt,at=(ht-6)/3|0,ct=ht-6-3*at;switch(at){case 0:b=d,p=u,S=f;let t=D*ot+F*et+q*rt>0;j*ot+E*et+R*rt>0?t?(i=j+D,s=E+F,n=R+q):(i=j-D,s=E-F,n=R-q):t?(i=D-j,s=F-E,n=q-R):(i=j+D,s=E+F,n=R+q,i=-i,s=-s,n=-n);break;case 1:b=x,p=g,S=v;let a=D*ot+F*et+q*rt>0;P*ot+C*et+T*rt>0?a?(i=P+D,s=C+F,n=T+q):(i=P-D,s=C-F,n=T-q):a?(i=D-P,s=F-C,n=q-T):(i=P+D,s=C+F,n=T+q,i=-i,s=-s,n=-n);break;default:b=y,p=X,S=z;let o=j*ot+E*et+R*rt>0;P*ot+C*et+T*rt>0?o?(i=P+j,s=C+E,n=T+R):(i=P-j,s=C-E,n=T-R):o?(i=j-P,s=E-C,n=R-T):(i=P+j,s=C+E,n=T+R,i=-i,s=-s,n=-n)}switch(i=e+i,s=r+s,n=_+n,ct){case 0:B=M,Q=Y,tt=Z;let t=J*ot+$*et+K*rt>0;W*ot+G*et+U*rt>0?t?(a=W+J,o=G+$,m=U+K):(a=W-J,o=G-$,m=U-K):t?(a=J-W,o=$-G,m=K-U):(a=W+J,o=G+$,m=U+K,a=-a,o=-o,m=-m);break;case 1:B=w,Q=I,tt=V;let i=J*ot+$*et+K*rt>0;N*ot+H*et+O*rt>0?i?(a=N+J,o=H+$,m=O+K):(a=N-J,o=H-$,m=O-K):i?(a=J-N,o=$-H,m=K-O):(a=N+J,o=H+$,m=O+K,a=-a,o=-o,m=-m);break;default:B=L,Q=A,tt=k;let s=W*ot+G*et+U*rt>0;N*ot+H*et+O*rt>0?s?(a=N+W,o=H+G,m=O+U):(a=N-W,o=H-G,m=O-U):s?(a=W-N,o=G-H,m=U-O):(a=N+W,o=H+G,m=O+U,a=-a,o=-o,m=-m)}a=h-a,o=l-o,m=c-m,it=i-a,st=s-o,nt=n-m;let mt,bt,pt,dt,ut,ft,xt,gt,vt,yt=b*B+p*Q+S*tt,Xt=b*it+p*st+S*nt,zt=B*it+Q*st+tt*nt,Mt=1/(1-yt*yt),Yt=(yt*zt-Xt)*Mt,Zt=(zt-yt*Xt)*Mt;return mt=i+b*Yt,bt=s+p*Yt,pt=n+S*Yt,dt=a+B*Zt,ut=o+Q*Zt,ft=m+tt*Zt,xt=-ot,gt=-et,vt=-rt,this.setNormal(t,xt,gt,vt),void this.addPoint(t,mt,bt,pt,dt,ut,ft,_t,4)}switch(ht>=3?(lt=-lt,m=-m,b=-b,p=-p,Q=st,tt=nt,it=at,e=h,r=l,_=c,$t=d,Kt=u,Qt=f,d=M,u=Y,f=Z,M=$t,Y=Kt,Z=Qt,$t=x,Kt=g,Qt=v,x=w,g=I,v=V,w=$t,I=Kt,V=Qt,$t=y,Kt=X,Qt=z,y=L,X=A,z=k,L=$t,A=Kt,k=Qt,$t=P,Kt=C,Qt=T,P=N,C=H,T=O,N=$t,H=Kt,O=Qt,$t=j,Kt=E,Qt=R,j=W,E=G,R=U,W=$t,G=Kt,U=Qt,$t=D,Kt=F,Qt=q,D=J,F=$,q=K,J=$t,$=Kt,K=Qt,ht-=3,ti=!0):ti=!1,ht){case 0:ii=P,si=C,ni=T,ai=d,oi=u,ei=f,ri=x,_i=g,hi=v,li=y,ci=X,mi=z,bi=tt,pi=it;break;case 1:ii=j,si=E,ni=R,ai=x,oi=g,ei=v,ri=y,_i=X,hi=z,li=d,ci=u,mi=f,bi=it,pi=Q;break;default:ii=D,si=F,ni=q,ai=y,oi=X,ei=z,ri=d,_i=u,hi=f,li=x,ci=g,mi=v,bi=Q,pi=tt}if(lt<0){ii=-ii,si=-si,ni=-ni,ai=-ai,oi=-oi,ei=-ei,$t=ri,Kt=_i,Qt=hi,ri=li,_i=ci,hi=mi,li=$t,ci=Kt,mi=Qt;let t=bi;bi=pi,pi=t}ii+=e,si+=r,ni+=_;let xi,gi,vi,yi,Xi,zi,Mi,Yi,Zi,wi,Ii,Vi,Li=1,Ai=0,ki=ai*M+oi*Y+ei*Z;switch(ki<Li&&(Li=ki,Ai=0),-ki<Li&&(Li=-ki,Ai=1),ki=ai*w+oi*I+ei*V,ki<Li&&(Li=ki,Ai=2),-ki<Li&&(Li=-ki,Ai=3),ki=ai*L+oi*A+ei*k,ki<Li&&(Li=ki,Ai=4),-ki<Li&&(Ai=5),Ai){case 0:xi=N+W,gi=H+G,vi=O+U,xi+=J,gi+=$,vi+=K,yi=N-W,Xi=H-G,zi=O-U,yi+=J,Xi+=$,zi+=K,Mi=N-W,Yi=H-G,Zi=O-U,Mi-=J,Yi-=$,Zi-=K,wi=N+W,Ii=H+G,Vi=O+U,wi-=J,Ii-=$,Vi-=K;break;case 1:xi=W-N,gi=G-H,vi=U-O,xi+=J,gi+=$,vi+=K,yi=W-N,Xi=G-H,zi=U-O,yi-=J,Xi-=$,zi-=K,Mi=N+W,Yi=H+G,Zi=O+U,Mi=-Mi,Yi=-Yi,Zi=-Zi,Mi-=J,Yi-=$,Zi-=K,wi=N+W,Ii=H+G,Vi=O+U,wi=-wi,Ii=-Ii,Vi=-Vi,wi+=J,Ii+=$,Vi+=K;break;case 2:xi=N+W,gi=H+G,vi=O+U,xi+=J,gi+=$,vi+=K,yi=N+W,Xi=H+G,zi=O+U,yi-=J,Xi-=$,zi-=K,Mi=W-N,Yi=G-H,Zi=U-O,Mi-=J,Yi-=$,Zi-=K,wi=W-N,Ii=G-H,Vi=U-O,wi+=J,Ii+=$,Vi+=K;break;case 3:xi=N-W,gi=H-G,vi=O-U,xi+=J,gi+=$,vi+=K,yi=N+W,Xi=H+G,zi=O+U,yi=-yi,Xi=-Xi,zi=-zi,yi+=J,Xi+=$,zi+=K,Mi=N+W,Yi=H+G,Zi=O+U,Mi=-Mi,Yi=-Yi,Zi=-Zi,Mi-=J,Yi-=$,Zi-=K,wi=N-W,Ii=H-G,Vi=O-U,wi-=J,Ii-=$,Vi-=K;break;case 4:xi=N+W,gi=H+G,vi=O+U,xi+=J,gi+=$,vi+=K,yi=W-N,Xi=G-H,zi=U-O,yi+=J,Xi+=$,zi+=K,Mi=N+W,Yi=H+G,Zi=O+U,Mi=-Mi,Yi=-Yi,Zi=-Zi,Mi+=J,Yi+=$,Zi+=K,wi=N-W,Ii=H-G,Vi=O-U,wi+=J,Ii+=$,Vi+=K;break;default:xi=N+W,gi=H+G,vi=O+U,xi-=J,gi-=$,vi-=K,yi=N-W,Xi=H-G,zi=O-U,yi-=J,Xi-=$,zi-=K,Mi=N+W,Yi=H+G,Zi=O+U,Mi=-Mi,Yi=-Yi,Zi=-Zi,Mi-=J,Yi-=$,Zi-=K,wi=W-N,Ii=G-H,Vi=U-O,wi-=J,Ii-=$,Vi-=K}xi+=m,gi+=b,vi+=p,yi+=m,Xi+=b,zi+=p,Mi+=m,Yi+=b,Zi+=p,wi+=m,Ii+=b,Vi+=p;let Si=this.clipper;Si.w=bi,Si.h=pi,Si.numVertices=0,Si.numTmpVertices=0;let Bi=this.clipper,Pi=Bi.vertices[Bi.numVertices++];Pi.x=xi*ri+gi*_i+vi*hi,Pi.y=xi*li+gi*ci+vi*mi,Pi.wx=xi,Pi.wy=gi,Pi.wz=vi;let Ci=this.clipper,Ti=Ci.vertices[Ci.numVertices++];Ti.x=yi*ri+Xi*_i+zi*hi,Ti.y=yi*li+Xi*ci+zi*mi,Ti.wx=yi,Ti.wy=Xi,Ti.wz=zi;let ji=this.clipper,Ei=ji.vertices[ji.numVertices++];Ei.x=Mi*ri+Yi*_i+Zi*hi,Ei.y=Mi*li+Yi*ci+Zi*mi,Ei.wx=Mi,Ei.wy=Yi,Ei.wz=Zi;let Ri,Di,Fi,qi=this.clipper,Ni=qi.vertices[qi.numVertices++];Ni.x=wi*ri+Ii*_i+Vi*hi,Ni.y=wi*li+Ii*ci+Vi*mi,Ni.wx=wi,Ni.wy=Ii,Ni.wz=Vi,this.clipper.clip(),this.clipper.reduce(),ti?(Ri=ai,Di=oi,Fi=ei):(Ri=-ai,Di=-oi,Fi=-ei),this.setNormal(t,Ri,Di,Fi);let Hi=0,Oi=this.clipper.numVertices;for(;Hi<Oi;){let i,s,n,a,o,h,l=Hi++,c=this.clipper.vertices[l];i=c.wx,s=c.wy,n=c.wz,i+=e,s+=r,n+=_,a=ii-i,o=si-s,h=ni-n;let m,b,p,d=a*ai+o*oi+h*ei;m=i+ai*d,b=s+oi*d,p=n+ei*d,d>-Ut.common.Setting.contactPersistenceThreshold&&(ti?this.addPoint(t,i,s,n,m,b,p,d,l):this.addPoint(t,m,b,p,i,s,n,d,l))}}},Ut.collision.narrowphase.detector._BoxBoxDetector||(Ut.collision.narrowphase.detector._BoxBoxDetector={}),Ut.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex=class{constructor(){this.x=0,this.y=0,this.wx=0,this.wy=0,this.wz=0}},Ut.collision.narrowphase.detector._BoxBoxDetector.FaceClipper=class{constructor(){this.w=0,this.h=0,this.numVertices=0,this.numTmpVertices=0,this.vertices=new Array(8),this.tmpVertices=new Array(8),this.vertices[0]=new Ut.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[0]=new Ut.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[1]=new Ut.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[1]=new Ut.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[2]=new Ut.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[2]=new Ut.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[3]=new Ut.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[3]=new Ut.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[4]=new Ut.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[4]=new Ut.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[5]=new Ut.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[5]=new Ut.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[6]=new Ut.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[6]=new Ut.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[7]=new Ut.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[7]=new Ut.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex}clip(){let t=0,i=this.numVertices;for(;t<i;){let i=t++,s=this.vertices[i],n=this.vertices[(i+1)%this.numVertices],a=this.w+s.x,o=this.w+n.x;if(a>0&&o>0){let t=this.tmpVertices[this.numTmpVertices++];t.x=s.x,t.y=s.y,t.wx=s.wx,t.wy=s.wy,t.wz=s.wz}else if(a>0&&o<=0){let t=this.tmpVertices[this.numTmpVertices++];t.x=s.x,t.y=s.y,t.wx=s.wx,t.wy=s.wy,t.wz=s.wz;let i=a/(a-o),e=this.tmpVertices[this.numTmpVertices++];e.x=s.x+(n.x-s.x)*i,e.y=s.y+(n.y-s.y)*i,e.wx=s.wx+(n.wx-s.wx)*i,e.wy=s.wy+(n.wy-s.wy)*i,e.wz=s.wz+(n.wz-s.wz)*i}else if(a<=0&&o>0){let t=a/(a-o),i=this.tmpVertices[this.numTmpVertices++];i.x=s.x+(n.x-s.x)*t,i.y=s.y+(n.y-s.y)*t,i.wx=s.wx+(n.wx-s.wx)*t,i.wy=s.wy+(n.wy-s.wy)*t,i.wz=s.wz+(n.wz-s.wz)*t}}let s=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=s,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let n=0,a=this.numVertices;for(;n<a;){let t=n++,i=this.vertices[t],s=this.vertices[(t+1)%this.numVertices],a=this.w-i.x,o=this.w-s.x;if(a>0&&o>0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz}else if(a>0&&o<=0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz;let n=a/(a-o),e=this.tmpVertices[this.numTmpVertices++];e.x=i.x+(s.x-i.x)*n,e.y=i.y+(s.y-i.y)*n,e.wx=i.wx+(s.wx-i.wx)*n,e.wy=i.wy+(s.wy-i.wy)*n,e.wz=i.wz+(s.wz-i.wz)*n}else if(a<=0&&o>0){let t=a/(a-o),n=this.tmpVertices[this.numTmpVertices++];n.x=i.x+(s.x-i.x)*t,n.y=i.y+(s.y-i.y)*t,n.wx=i.wx+(s.wx-i.wx)*t,n.wy=i.wy+(s.wy-i.wy)*t,n.wz=i.wz+(s.wz-i.wz)*t}}let o=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=o,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let e=0,r=this.numVertices;for(;e<r;){let t=e++,i=this.vertices[t],s=this.vertices[(t+1)%this.numVertices],n=this.h+i.y,a=this.h+s.y;if(n>0&&a>0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz}else if(n>0&&a<=0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz;let o=n/(n-a),e=this.tmpVertices[this.numTmpVertices++];e.x=i.x+(s.x-i.x)*o,e.y=i.y+(s.y-i.y)*o,e.wx=i.wx+(s.wx-i.wx)*o,e.wy=i.wy+(s.wy-i.wy)*o,e.wz=i.wz+(s.wz-i.wz)*o}else if(n<=0&&a>0){let t=n/(n-a),o=this.tmpVertices[this.numTmpVertices++];o.x=i.x+(s.x-i.x)*t,o.y=i.y+(s.y-i.y)*t,o.wx=i.wx+(s.wx-i.wx)*t,o.wy=i.wy+(s.wy-i.wy)*t,o.wz=i.wz+(s.wz-i.wz)*t}}let _=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=_,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let h=0,l=this.numVertices;for(;h<l;){let t=h++,i=this.vertices[t],s=this.vertices[(t+1)%this.numVertices],n=this.h-i.y,a=this.h-s.y;if(n>0&&a>0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz}else if(n>0&&a<=0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz;let o=n/(n-a),e=this.tmpVertices[this.numTmpVertices++];e.x=i.x+(s.x-i.x)*o,e.y=i.y+(s.y-i.y)*o,e.wx=i.wx+(s.wx-i.wx)*o,e.wy=i.wy+(s.wy-i.wy)*o,e.wz=i.wz+(s.wz-i.wz)*o}else if(n<=0&&a>0){let t=n/(n-a),o=this.tmpVertices[this.numTmpVertices++];o.x=i.x+(s.x-i.x)*t,o.y=i.y+(s.y-i.y)*t,o.wx=i.wx+(s.wx-i.wx)*t,o.wy=i.wy+(s.wy-i.wy)*t,o.wz=i.wz+(s.wz-i.wz)*t}}let c=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=c,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}reduce(){if(this.numVertices<4)return;let t=-1/0,i=1/0,s=-1/0,n=1/0,a=null,o=null,e=null,r=null,_=0,h=this.numVertices;for(;_<h;){let h=this.vertices[_++],l=1*h.x+1*h.y,c=-1*h.x+1*h.y;l>t&&(t=l,a=h),l<i&&(i=l,o=h),c>s&&(s=c,e=h),c<n&&(n=c,r=h)}let l=this.tmpVertices[this.numTmpVertices++];l.x=a.x,l.y=a.y,l.wx=a.wx,l.wy=a.wy,l.wz=a.wz;let c=this.tmpVertices[this.numTmpVertices++];c.x=e.x,c.y=e.y,c.wx=e.wx,c.wy=e.wy,c.wz=e.wz;let m=this.tmpVertices[this.numTmpVertices++];m.x=o.x,m.y=o.y,m.wx=o.wx,m.wy=o.wy,m.wz=o.wz;let b=this.tmpVertices[this.numTmpVertices++];b.x=r.x,b.y=r.y,b.wx=r.wx,b.wy=r.wy,b.wz=r.wz;let p=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=p,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}},Ut.collision.narrowphase.detector.BoxBoxDetectorMacro=class{},Ut.collision.narrowphase.detector.CachedDetectorData=class{constructor(){}_clear(){null!=this._gjkCache&&this._gjkCache.clear()}},Ut.collision.narrowphase.detector.CapsuleCapsuleDetector=class extends Ut.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,i,s,n,a,o){let e,r,_,h,l,c,m=i,b=s;t.incremental=!1,e=n._rotation01,r=n._rotation11,_=n._rotation21,h=a._rotation01,l=a._rotation11,c=a._rotation21;let p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P=m._halfHeight,C=b._halfHeight,T=m._radius,j=b._radius;p=n._positionX+e*-P,d=n._positionY+r*-P,u=n._positionZ+_*-P,f=n._positionX+e*P,x=n._positionY+r*P,g=n._positionZ+_*P,v=a._positionX+h*-C,y=a._positionY+l*-C,X=a._positionZ+c*-C,z=a._positionX+h*C,M=a._positionY+l*C,Y=a._positionZ+c*C,Z=p-v,w=d-y,I=u-X,V=f-p,L=x-d,A=g-u,k=z-v,S=M-y,B=Y-X;let E,R,D,F,q,N,H,O,W,G,U,J=-(Z*V+w*L+I*A),$=Z*k+w*S+I*B,K=P*P*4,Q=V*k+L*S+A*B,tt=C*C*4;if(0==K&&0==tt)E=0,R=0;else if(0==K)E=0,R=$<0?0:$>tt?1:$/tt;else if(0==tt)R=0,E=J<0?0:J>K?1:J/K;else{let t=K*tt-Q*Q;0==t?E=0:(E=Q*$+tt*J,E<0?E=0:E>t?E=1:E/=t),R=E*Q+$,R<0?(R=0,E=J<0?0:J>K?1:J/K):R>tt?(R=1,E=Q+J,E<0?E=0:E>K?E=1:E/=K):R/=tt}D=p+V*E,F=d+L*E,q=u+A*E,N=v+k*R,H=y+S*R,O=X+B*R,W=D-N,G=F-H,U=q-O;let it=W*W+G*G+U*U;if(it>=(T+j)*(T+j))return;let st,nt,at,ot,et,rt,_t,ht,lt,ct=Math.sqrt(it);ct>0?(st=W*(1/ct),nt=G*(1/ct),at=U*(1/ct)):(st=1,nt=0,at=0),this.setNormal(t,st,nt,at),ot=D+st*-T,et=F+nt*-T,rt=q+at*-T,_t=N+st*j,ht=H+nt*j,lt=O+at*j,this.addPoint(t,ot,et,rt,_t,ht,lt,T+j-ct,0)}},Ut.collision.narrowphase.detector.GjkEpaDetector=class extends Ut.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,i,s,n,a,o){let e,r,_,h,l,c,m=Ut.collision.narrowphase.detector.gjkepa.GjkEpa.instance,b=i,p=s,d=m.computeClosestPointsImpl(b,p,n,a,Ut.common.Setting.enableGJKCaching?o:null,!0);if(t.incremental=!0,d!=Ut.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED)return void console.log("src/oimo/collision/narrowphase/detector/GjkEpaDetector.hx:28:","GJK/EPA failed: status="+d);if(m.distance>b._gjkMargin+p._gjkMargin)return;let u=m.closestPoint1;e=u.x,r=u.y,_=u.z;let f,x,g,v=m.closestPoint2;if(h=v.x,l=v.y,c=v.z,f=e-h,x=r-l,g=_-c,f*f+x*x+g*g==0)return;m.distance<0&&(f=-f,x=-x,g=-g);let y=f*f+x*x+g*g;y>0&&(y=1/Math.sqrt(y)),f*=y,x*=y,g*=y,this.setNormal(t,f,x,g),e+=f*-b._gjkMargin,r+=x*-b._gjkMargin,_+=g*-b._gjkMargin,h+=f*p._gjkMargin,l+=x*p._gjkMargin,c+=g*p._gjkMargin,this.addPoint(t,e,r,_,h,l,c,b._gjkMargin+p._gjkMargin-m.distance,0)}},Ut.collision.narrowphase.detector.SphereBoxDetector=class extends Ut.collision.narrowphase.detector.Detector{constructor(t){super(t)}detectImpl(t,i,s,n,a,o){let e,r,_,h,l,c,m=s;t.incremental=!1,e=m._halfExtentsX,r=m._halfExtentsY,_=m._halfExtentsZ,h=-e,l=-r,c=-_;let b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I=i._radius;if(b=n._positionX-a._positionX,p=n._positionY-a._positionY,d=n._positionZ-a._positionZ,g=a._rotation00*b+a._rotation10*p+a._rotation20*d,v=a._rotation01*b+a._rotation11*p+a._rotation21*d,y=a._rotation02*b+a._rotation12*p+a._rotation22*d,u=g,f=v,x=y,h<u&&e>u&&l<f&&r>f&&c<x&&_>x){let i,s,o,h,l,c;i=u<0?-u:u,s=f<0?-f:f,o=x<0?-x:x,i=e-i,s=r-s,o=_-o;let m,b,p,d,g,v,y,X,z,M,Y,Z,w,V,L,A,k,S,B,P,C,T,j,E,R,D,F,q,N=i,H=s,O=o;return N<H?N<O?(u>0?(h=1,l=0,c=0):(h=-1,l=0,c=0),b=0,p=1,d=1,m=N):(x>0?(h=0,l=0,c=1):(h=0,l=0,c=-1),b=1,p=1,d=0,m=O):H<O?(f>0?(h=0,l=1,c=0):(h=0,l=-1,c=0),b=1,p=0,d=1,m=H):(x>0?(h=0,l=0,c=1):(h=0,l=0,c=-1),b=1,p=1,d=0,m=O),g=b*u,v=p*f,y=d*x,X=h*e,z=l*r,M=c*_,X+=g,z+=v,M+=y,k=a._rotation00*X+a._rotation01*z+a._rotation02*M,S=a._rotation10*X+a._rotation11*z+a._rotation12*M,B=a._rotation20*X+a._rotation21*z+a._rotation22*M,Y=k,Z=S,w=B,P=a._rotation00*h+a._rotation01*l+a._rotation02*c,C=a._rotation10*h+a._rotation11*l+a._rotation12*c,T=a._rotation20*h+a._rotation21*l+a._rotation22*c,V=P,L=C,A=T,this.setNormal(t,V,L,A),j=n._positionX+V*-I,E=n._positionY+L*-I,R=n._positionZ+A*-I,D=a._positionX+Y,F=a._positionY+Z,q=a._positionZ+w,void this.addPoint(t,j,E,R,D,F,q,m,0)}e-=1e-9,r-=1e-9,_-=1e-9,h+=1e-9,l+=1e-9,c+=1e-9,X=u<e?u:e,z=f<r?f:r,M=x<_?x:_,X>h||(X=h),z>l||(z=l),M>c||(M=c),Y=u-X,Z=f-z,w=x-M;let V,L,A,k,S,B,P,C,T,j,E,R,D,F,q,N=Y*Y+Z*Z+w*w;if(N>=I*I)return;N=Math.sqrt(N),P=a._rotation00*X+a._rotation01*z+a._rotation02*M,C=a._rotation10*X+a._rotation11*z+a._rotation12*M,T=a._rotation20*X+a._rotation21*z+a._rotation22*M,V=P,L=C,A=T,j=a._rotation00*Y+a._rotation01*Z+a._rotation02*w,E=a._rotation10*Y+a._rotation11*Z+a._rotation12*w,R=a._rotation20*Y+a._rotation21*Z+a._rotation22*w,k=j,S=E,B=R;let H,O,W,G,U,J,$=k*k+S*S+B*B;$>0&&($=1/Math.sqrt($)),D=k*$,F=S*$,q=B*$,this.setNormal(t,D,F,q),H=n._positionX+D*-I,O=n._positionY+F*-I,W=n._positionZ+q*-I,G=a._positionX+V,U=a._positionY+L,J=a._positionZ+A,this.addPoint(t,H,O,W,G,U,J,I-N,0)}},Ut.collision.narrowphase.detector.SphereCapsuleDetector=class extends Ut.collision.narrowphase.detector.Detector{constructor(t){super(t)}detectImpl(t,i,s,n,a,o){let e=s;t.incremental=!1;let r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y=e._halfHeight,Z=i._radius,w=e._radius;r=a._rotation01,_=a._rotation11,h=a._rotation21,l=n._positionX,c=n._positionY,m=n._positionZ,b=a._positionX+r*-Y,p=a._positionY+_*-Y,d=a._positionZ+h*-Y,u=a._positionX+r*Y,f=a._positionY+_*Y,x=a._positionZ+h*Y,g=l-b,v=c-p,y=m-d,X=u-b,z=f-p,M=x-d;let I,V,L,A,k,S,B=Y*Y*4,P=g*X+v*z+y*M;P<0?P=0:P>B?P=1:P/=B,I=b+X*P,V=p+z*P,L=d+M*P,A=l-I,k=c-V,S=m-L;let C=A*A+k*k+S*S;if(C>=(Z+w)*(Z+w))return;let T,j,E,R,D,F,q,N,H,O=Math.sqrt(C);O>0?(T=A*(1/O),j=k*(1/O),E=S*(1/O)):(T=1,j=0,E=0),this.setNormal(t,T,j,E),R=l+T*-Z,D=c+j*-Z,F=m+E*-Z,q=I+T*w,N=V+j*w,H=L+E*w,this.addPoint(t,R,D,F,q,N,H,Z+w-O,0)}},Ut.collision.narrowphase.detector.SphereSphereDetector=class extends Ut.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,i,s,n,a,o){let e,r,_;t.incremental=!1,e=n._positionX-a._positionX,r=n._positionY-a._positionY,_=n._positionZ-a._positionZ;let h=i._radius,l=s._radius,c=e*e+r*r+_*_;if(c>=(h+l)*(h+l))return;let m,b,p,d,u,f,x,g,v,y=Math.sqrt(c);y>0?(m=e*(1/y),b=r*(1/y),p=_*(1/y)):(m=1,b=0,p=0),this.setNormal(t,m,b,p),d=n._positionX+m*-h,u=n._positionY+b*-h,f=n._positionZ+p*-h,x=a._positionX+m*l,g=a._positionY+b*l,v=a._positionZ+p*l,this.addPoint(t,d,u,f,x,g,v,h+l-y,0)}},Ut.collision.narrowphase.detector.gjkepa||(Ut.collision.narrowphase.detector.gjkepa={}),Ut.collision.narrowphase.detector.gjkepa.EpaPolyhedron=class{constructor(){this._vertices=new Array(Ut.common.Setting.maxEPAVertices),this._center=new Ut.common.Vec3,this._numVertices=0,this._triangleList=null,this._triangleListLast=null,this._numTriangles=0,this._trianglePool=null,this._vertexPool=null}dumpHoleEdge(t){}validate(){let t=this._triangleList;for(;null!=t;){if(t._vertices[0]._tmpEdgeLoopOuterTriangle=null,t._vertices[0]._tmpEdgeLoopNext=null,-1==t._adjacentPairIndex[0])return this._status=2,!1;if(null==t._adjacentTriangles[0])return this._status=3,!1;if(t._vertices[1]._tmpEdgeLoopOuterTriangle=null,t._vertices[1]._tmpEdgeLoopNext=null,-1==t._adjacentPairIndex[1])return this._status=2,!1;if(null==t._adjacentTriangles[1])return this._status=3,!1;if(t._vertices[2]._tmpEdgeLoopOuterTriangle=null,t._vertices[2]._tmpEdgeLoopNext=null,-1==t._adjacentPairIndex[2])return this._status=2,!1;if(null==t._adjacentTriangles[2])return this._status=3,!1;t=t._next}return!0}findEdgeLoop(t,i,s){if(i._tmpDfsId==t)return;i._tmpDfsId=t;let n=i.tmp;n.x=s.x,n.y=s.y,n.z=s.z;let a=i._vertices[0].v;n.x-=a.x,n.y-=a.y,n.z-=a.z;let o=i.tmp,e=i._normal;if(i._tmpDfsVisible=o.x*e.x+o.y*e.y+o.z*e.z>0,!i._tmpDfsVisible)return void(this._status=6);let r=0;for(;r<3;){let n=r++,a=i._adjacentTriangles[n];if(null==a)continue;let o=a.tmp;o.x=s.x,o.y=s.y,o.z=s.z;let e=a._vertices[0].v;o.x-=e.x,o.y-=e.y,o.z-=e.z;let _=a.tmp,h=a._normal;if(a._tmpDfsVisible=_.x*h.x+_.y*h.y+_.z*h.z>0,a._tmpDfsVisible)this.findEdgeLoop(t,a,s);else{let t=i._vertices[n];t._tmpEdgeLoopNext=i._vertices[i._nextIndex[n]],t._tmpEdgeLoopOuterTriangle=a}}let _=i._adjacentTriangles[0];if(null!=_){let t=i._adjacentPairIndex[0];_._adjacentTriangles[t]=null,_._adjacentPairIndex[t]=-1,i._adjacentTriangles[0]=null,i._adjacentPairIndex[0]=-1}let h=i._adjacentTriangles[1];if(null!=h){let t=i._adjacentPairIndex[1];h._adjacentTriangles[t]=null,h._adjacentPairIndex[t]=-1,i._adjacentTriangles[1]=null,i._adjacentPairIndex[1]=-1}let l=i._adjacentTriangles[2];if(null!=l){let t=i._adjacentPairIndex[2];l._adjacentTriangles[t]=null,l._adjacentPairIndex[t]=-1,i._adjacentTriangles[2]=null,i._adjacentPairIndex[2]=-1}this._numTriangles--;let c=i._prev,m=i._next;null!=c&&(c._next=m),null!=m&&(m._prev=c),i==this._triangleList&&(this._triangleList=this._triangleList._next),i==this._triangleListLast&&(this._triangleListLast=this._triangleListLast._prev),i._next=null,i._prev=null,i.removeReferences(),i._next=this._trianglePool,this._trianglePool=i}_init(t,i,s,n){this._status=0,this._numVertices=4,this._vertices[0]=t,this._vertices[1]=i,this._vertices[2]=s,this._vertices[3]=n;let a=this._center,o=t.v;a.x=o.x,a.y=o.y,a.z=o.z;let e=i.v;a.x+=e.x,a.y+=e.y,a.z+=e.z;let r=s.v;a.x+=r.x,a.y+=r.y,a.z+=r.z;let _=n.v;a.x+=_.x,a.y+=_.y,a.z+=_.z,a.x*=.25,a.y*=.25,a.z*=.25;let h=this._trianglePool;null!=h?(this._trianglePool=h._next,h._next=null):h=new Ut.collision.narrowphase.detector.gjkepa.EpaTriangle;let l=h,c=this._trianglePool;null!=c?(this._trianglePool=c._next,c._next=null):c=new Ut.collision.narrowphase.detector.gjkepa.EpaTriangle;let m=c,b=this._trianglePool;null!=b?(this._trianglePool=b._next,b._next=null):b=new Ut.collision.narrowphase.detector.gjkepa.EpaTriangle;let p=b,d=this._trianglePool;null!=d?(this._trianglePool=d._next,d._next=null):d=new Ut.collision.narrowphase.detector.gjkepa.EpaTriangle;let u=d;return l.init(t,i,s,this._center,!0)||(this._status=1),m.init(t,i,n,this._center,!0)||(this._status=1),p.init(t,s,n,this._center,!0)||(this._status=1),u.init(i,s,n,this._center,!0)||(this._status=1),l.setAdjacentTriangle(m)||(this._status=1),l.setAdjacentTriangle(p)||(this._status=1),l.setAdjacentTriangle(u)||(this._status=1),m.setAdjacentTriangle(p)||(this._status=1),m.setAdjacentTriangle(u)||(this._status=1),p.setAdjacentTriangle(u)||(this._status=1),this._numTriangles++,null==this._triangleList?(this._triangleList=l,this._triangleListLast=l):(this._triangleListLast._next=l,l._prev=this._triangleListLast,this._triangleListLast=l),this._numTriangles++,null==this._triangleList?(this._triangleList=m,this._triangleListLast=m):(this._triangleListLast._next=m,m._prev=this._triangleListLast,this._triangleListLast=m),this._numTriangles++,null==this._triangleList?(this._triangleList=p,this._triangleListLast=p):(this._triangleListLast._next=p,p._prev=this._triangleListLast,this._triangleListLast=p),this._numTriangles++,null==this._triangleList?(this._triangleList=u,this._triangleListLast=u):(this._triangleListLast._next=u,u._prev=this._triangleListLast,this._triangleListLast=u),0==this._status}_addVertex(t,i){this._vertices[this._numVertices++]=t;let s=i._vertices[0];if(this.findEdgeLoop(this._numVertices,i,t.v),0!=this._status)return!1;let n=s,a=null,o=null;for(;;){if(null==n._tmpEdgeLoopNext)return this._dumpAsObjModel(),this._status=4,!1;if(null==n._tmpEdgeLoopOuterTriangle)return this._status=5,!1;let i=this._trianglePool;null!=i?(this._trianglePool=i._next,i._next=null):i=new Ut.collision.narrowphase.detector.gjkepa.EpaTriangle;let e=i;if(null==o&&(o=e),e.init(n,n._tmpEdgeLoopNext,t,this._center,!1)||(this._status=1),0!=this._status)return!1;if(this._numTriangles++,null==this._triangleList?(this._triangleList=e,this._triangleListLast=e):(this._triangleListLast._next=e,e._prev=this._triangleListLast,this._triangleListLast=e),e.setAdjacentTriangle(n._tmpEdgeLoopOuterTriangle)||(this._status=1),null!=a&&(e.setAdjacentTriangle(a)||(this._status=1)),a=e,n=n._tmpEdgeLoopNext,n==s)break}return a.setAdjacentTriangle(o)||(this._status=1),0==this._status&&this.validate()}_dumpAsObjModel(){}},Ut.collision.narrowphase.detector.gjkepa.EpaPolyhedronState=class{},Ut.collision.narrowphase.detector.gjkepa.EpaTriangle=class{constructor(){this.id=++Ut.collision.narrowphase.detector.gjkepa.EpaTriangle.count,this._next=null,this._prev=null,this._normal=new Ut.common.Vec3,this._distanceSq=0,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._vertices=new Array(3),this._adjacentTriangles=new Array(3),this._adjacentPairIndex=new Array(3),this.tmp=new Ut.common.Vec3,this._nextIndex=new Array(3),this._nextIndex[0]=1,this._nextIndex[1]=2,this._nextIndex[2]=0}init(t,i,s,n,a){let o,e,r,_,h,l,c,m,b,p,d,u;null==a&&(a=!1);let f=t.v;o=f.x,e=f.y,r=f.z;let x=i.v;_=x.x,h=x.y,l=x.z;let g,v,y,X,z,M,Y,Z,w,I,V,L,A=s.v;c=A.x,m=A.y,b=A.z,p=n.x,d=n.y,u=n.z,g=_-o,v=h-e,y=l-r,X=c-o,z=m-e,M=b-r,Y=o-p,Z=e-d,w=r-u,I=v*M-y*z,V=y*X-g*M,L=g*z-v*X;let k=!1;if(Y*I+Z*V+w*L<0)if(a){let t=i;i=s,s=t,I*=-1,V*=-1,L*=-1}else k=!0;this._vertices[0]=t,this._vertices[1]=i,this._vertices[2]=s;let S=this._normal;S.x=I,S.y=V,S.z=L;let B,P,C,T,j,E,R,D,F,q,N,H,O,W,G,U,J,$,K,Q,tt,it,st,nt,at,ot,et,rt,_t,ht,lt=t.v,ct=i.v,mt=s.v,bt=this.tmp;B=lt.x,P=lt.y,C=lt.z,T=ct.x,j=ct.y,E=ct.z,R=mt.x,D=mt.y,F=mt.z,q=T-B,N=j-P,H=E-C,O=R-T,W=D-j,G=F-E,U=B-R,J=P-D,$=C-F,K=N*G-H*W,Q=H*O-q*G,tt=q*W-N*O,it=N*tt-H*Q,st=H*K-q*tt,nt=q*Q-N*K,at=W*tt-G*Q,ot=G*K-O*tt,et=O*Q-W*K,rt=J*tt-$*Q,_t=$*K-U*tt,ht=U*Q-J*K;let pt,dt,ut,ft=-1;if(pt=0,dt=0,ut=0,B*it+P*st+C*nt<0){let t,i,s,n,a,o,e,r,_;t=lt.x,i=lt.y,s=lt.z,n=ct.x,a=ct.y,o=ct.z,e=n-t,r=a-i,_=o-s;let h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)bt.x=t,bt.y=i,bt.z=s;else if(h>1)bt.x=n,bt.y=a,bt.z=o;else{let n,a,o;n=t+e*h,a=i+r*h,o=s+_*h,bt.x=n,bt.y=a,bt.z=o}ft=bt.x*bt.x+bt.y*bt.y+bt.z*bt.z,pt=bt.x,dt=bt.y,ut=bt.z}if(T*at+j*ot+E*et<0){let t,i,s,n,a,o,e,r,_;t=ct.x,i=ct.y,s=ct.z,n=mt.x,a=mt.y,o=mt.z,e=n-t,r=a-i,_=o-s;let h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)bt.x=t,bt.y=i,bt.z=s;else if(h>1)bt.x=n,bt.y=a,bt.z=o;else{let n,a,o;n=t+e*h,a=i+r*h,o=s+_*h,bt.x=n,bt.y=a,bt.z=o}let l=bt.x*bt.x+bt.y*bt.y+bt.z*bt.z;(ft<0||l<ft)&&(ft=l,pt=bt.x,dt=bt.y,ut=bt.z)}if(R*rt+D*_t+F*ht<0){let t,i,s,n,a,o,e,r,_;t=lt.x,i=lt.y,s=lt.z,n=mt.x,a=mt.y,o=mt.z,e=n-t,r=a-i,_=o-s;let h=e*t+r*i+_*s;if(h=-h/(e*e+r*r+_*_),h<0)bt.x=t,bt.y=i,bt.z=s;else if(h>1)bt.x=n,bt.y=a,bt.z=o;else{let n,a,o;n=t+e*h,a=i+r*h,o=s+_*h,bt.x=n,bt.y=a,bt.z=o}let l=bt.x*bt.x+bt.y*bt.y+bt.z*bt.z;(ft<0||l<ft)&&(ft=l,pt=bt.x,dt=bt.y,ut=bt.z)}if(ft>0)bt.x=pt,bt.y=dt,bt.z=ut;else{let t=K*K+Q*Q+tt*tt;t>0&&(t=1/Math.sqrt(t)),K*=t,Q*=t,tt*=t;let i=K*K+Q*Q+tt*tt;i=(B*K+P*Q+C*tt)/i,pt=K*i,dt=Q*i,ut=tt*i,bt.x=pt,bt.y=dt,bt.z=ut}let xt=this.tmp;return this._distanceSq=xt.x*xt.x+xt.y*xt.y+xt.z*xt.z,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=-1,this._adjacentPairIndex[1]=-1,this._adjacentPairIndex[2]=-1,!k}setAdjacentTriangle(t){let i=0;return this._vertices[0]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[0]]==t._vertices[0]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=0,i=1),this._vertices[0]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[0]]==t._vertices[1]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=0,++i),this._vertices[0]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[0]]==t._vertices[2]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=0,++i),this._vertices[1]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[1]]==t._vertices[0]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=1,++i),this._vertices[1]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[1]]==t._vertices[1]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=1,++i),this._vertices[1]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[1]]==t._vertices[2]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=1,++i),this._vertices[2]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[2]]==t._vertices[0]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=2,++i),this._vertices[2]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[2]]==t._vertices[1]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=2,++i),this._vertices[2]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[2]]==t._vertices[2]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=2,++i),1==i}removeAdjacentTriangles(){let t=this._adjacentTriangles[0];if(null!=t){let i=this._adjacentPairIndex[0];t._adjacentTriangles[i]=null,t._adjacentPairIndex[i]=-1,this._adjacentTriangles[0]=null,this._adjacentPairIndex[0]=-1}let i=this._adjacentTriangles[1];if(null!=i){let t=this._adjacentPairIndex[1];i._adjacentTriangles[t]=null,i._adjacentPairIndex[t]=-1,this._adjacentTriangles[1]=null,this._adjacentPairIndex[1]=-1}let s=this._adjacentTriangles[2];if(null!=s){let t=this._adjacentPairIndex[2];s._adjacentTriangles[t]=null,s._adjacentPairIndex[t]=-1,this._adjacentTriangles[2]=null,this._adjacentPairIndex[2]=-1}}removeReferences(){this._next=null,this._prev=null,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._distanceSq=0,this._vertices[0]=null,this._vertices[1]=null,this._vertices[2]=null,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=0,this._adjacentPairIndex[1]=0,this._adjacentPairIndex[2]=0}dump(){}},Ut.collision.narrowphase.detector.gjkepa.EpaVertex=class{constructor(){this.randId=1e5*Math.random()|0,this.v=new Ut.common.Vec3,this.w1=new Ut.common.Vec3,this.w2=new Ut.common.Vec3}init(t,i,s){let n=this.v;n.x=t.x,n.y=t.y,n.z=t.z;let a=this.w1;a.x=i.x,a.y=i.y,a.z=i.z;let o=this.w2;return o.x=s.x,o.y=s.y,o.z=s.z,this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null,this}removeReferences(){this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null}},Ut.collision.narrowphase.detector.gjkepa.GjkCache=class{constructor(){this.prevClosestDir=new Ut.common.Vec3}clear(){this.prevClosestDir.zero()}},Ut.common||(Ut.common={}),Ut.common.Vec3=class{constructor(t,i,s){null==s&&(s=0),null==i&&(i=0),null==t&&(t=0),this.x=t,this.y=i,this.z=s,Ut.common.Vec3.numCreations++}init(t,i,s){return this.x=t,this.y=i,this.z=s,this}zero(){return this.x=0,this.y=0,this.z=0,this}add(t){return new Ut.common.Vec3(this.x+t.x,this.y+t.y,this.z+t.z)}add3(t,i,s){return new Ut.common.Vec3(this.x+t,this.y+i,this.z+s)}addScaled(t,i){return new Ut.common.Vec3(this.x+t.x*i,this.y+t.y*i,this.z+t.z*i)}sub(t){return new Ut.common.Vec3(this.x-t.x,this.y-t.y,this.z-t.z)}sub3(t,i,s){return new Ut.common.Vec3(this.x-t,this.y-i,this.z-s)}scale(t){return new Ut.common.Vec3(this.x*t,this.y*t,this.z*t)}scale3(t,i,s){return new Ut.common.Vec3(this.x*t,this.y*i,this.z*s)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new Ut.common.Vec3(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}addEq(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}add3Eq(t,i,s){return this.x+=t,this.y+=i,this.z+=s,this}addScaledEq(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}subEq(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}sub3Eq(t,i,s){return this.x-=t,this.y-=i,this.z-=s,this}scaleEq(t){return this.x*=t,this.y*=t,this.z*=t,this}scale3Eq(t,i,s){return this.x*=t,this.y*=i,this.z*=s,this}crossEq(t){let i=this.z*t.x-this.x*t.z,s=this.x*t.y-this.y*t.x;return this.x=this.y*t.z-this.z*t.y,this.y=i,this.z=s,this}mulMat3(t){return new Ut.common.Vec3(this.x*t.e00+this.y*t.e01+this.z*t.e02,this.x*t.e10+this.y*t.e11+this.z*t.e12,this.x*t.e20+this.y*t.e21+this.z*t.e22)}mulMat4(t){return new Ut.common.Vec3(this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23)}mulTransform(t){let i,s,n,a,o,e;i=this.x,s=this.y,n=this.z,a=t._rotation00*i+t._rotation01*s+t._rotation02*n,o=t._rotation10*i+t._rotation11*s+t._rotation12*n,e=t._rotation20*i+t._rotation21*s+t._rotation22*n,i=a,s=o,n=e,i+=t._positionX,s+=t._positionY,n+=t._positionZ;let r=new Ut.common.Vec3;return r.x=i,r.y=s,r.z=n,r}mulMat3Eq(t){let i=this.x*t.e10+this.y*t.e11+this.z*t.e12,s=this.x*t.e20+this.y*t.e21+this.z*t.e22;return this.x=this.x*t.e00+this.y*t.e01+this.z*t.e02,this.y=i,this.z=s,this}mulMat4Eq(t){let i=this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,s=this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23;return this.x=this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.y=i,this.z=s,this}mulTransformEq(t){let i,s,n,a,o,e;return i=this.x,s=this.y,n=this.z,a=t._rotation00*i+t._rotation01*s+t._rotation02*n,o=t._rotation10*i+t._rotation11*s+t._rotation12*n,e=t._rotation20*i+t._rotation21*s+t._rotation22*n,i=a,s=o,n=e,i+=t._positionX,s+=t._positionY,n+=t._positionZ,this.x=i,this.y=s,this.z=n,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}normalized(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t),new Ut.common.Vec3(this.x*t,this.y*t,this.z*t)}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t),this.x*=t,this.y*=t,this.z*=t,this}negate(){return new Ut.common.Vec3(-this.x,-this.y,-this.z)}negateEq(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}clone(){return new Ut.common.Vec3(this.x,this.y,this.z)}toString(){return"Vec3["+(this.x>0?(1e7*this.x+.5|0)/1e7:(1e7*this.x-.5|0)/1e7)+", "+(this.y>0?(1e7*this.y+.5|0)/1e7:(1e7*this.y-.5|0)/1e7)+", "+(this.z>0?(1e7*this.z+.5|0)/1e7:(1e7*this.z-.5|0)/1e7)+"]"}},Ut.common.Transform=class{constructor(){this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1}identity(){return this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1,this}getPosition(){let t=new Ut.common.Vec3;return t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ,t}getPositionTo(t){t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ}setPosition(t){return this._positionX=t.x,this._positionY=t.y,this._positionZ=t.z,this}translate(t){let i,s,n;i=t.x,s=t.y,n=t.z,this._positionX+=i,this._positionY+=s,this._positionZ+=n}getRotation(){let t=new Ut.common.Mat3;return t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22,t}getRotationTo(t){t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22}setRotation(t){return this._rotation00=t.e00,this._rotation01=t.e01,this._rotation02=t.e02,this._rotation10=t.e10,this._rotation11=t.e11,this._rotation12=t.e12,this._rotation20=t.e20,this._rotation21=t.e21,this._rotation22=t.e22,this}setRotationXyz(t){let i,s,n;i=t.x,s=t.y,n=t.z;let a=Math.sin(i),o=Math.sin(s),e=Math.sin(n),r=Math.cos(i),_=Math.cos(s),h=Math.cos(n);this._rotation00=_*h,this._rotation01=-_*e,this._rotation02=o,this._rotation10=r*e+h*a*o,this._rotation11=r*h-a*o*e,this._rotation12=-_*a,this._rotation20=a*e-r*h*o,this._rotation21=h*a+r*o*e,this._rotation22=r*_}rotate(t){let i,s,n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x;i=t.e00,s=t.e01,n=t.e02,a=t.e10,o=t.e11,e=t.e12,r=t.e20,_=t.e21,h=t.e22,l=i*this._rotation00+s*this._rotation10+n*this._rotation20,c=i*this._rotation01+s*this._rotation11+n*this._rotation21,m=i*this._rotation02+s*this._rotation12+n*this._rotation22,b=a*this._rotation00+o*this._rotation10+e*this._rotation20,p=a*this._rotation01+o*this._rotation11+e*this._rotation21,d=a*this._rotation02+o*this._rotation12+e*this._rotation22,u=r*this._rotation00+_*this._rotation10+h*this._rotation20,f=r*this._rotation01+_*this._rotation11+h*this._rotation21,x=r*this._rotation02+_*this._rotation12+h*this._rotation22,this._rotation00=l,this._rotation01=c,this._rotation02=m,this._rotation10=b,this._rotation11=p,this._rotation12=d,this._rotation20=u,this._rotation21=f,this._rotation22=x}rotateXyz(t){let i,s,n,a,o,e,r,_,h,l,c,m;i=t.x,s=t.y,n=t.z;let b,p,d,u,f,x,g,v,y,X=Math.sin(i),z=Math.sin(s),M=Math.sin(n),Y=Math.cos(i),Z=Math.cos(s),w=Math.cos(n);a=Z*w,o=-Z*M,e=z,r=Y*M+w*X*z,_=Y*w-X*z*M,h=-Z*X,l=X*M-Y*w*z,c=w*X+Y*z*M,m=Y*Z,b=a*this._rotation00+o*this._rotation10+e*this._rotation20,p=a*this._rotation01+o*this._rotation11+e*this._rotation21,d=a*this._rotation02+o*this._rotation12+e*this._rotation22,u=r*this._rotation00+_*this._rotation10+h*this._rotation20,f=r*this._rotation01+_*this._rotation11+h*this._rotation21,x=r*this._rotation02+_*this._rotation12+h*this._rotation22,g=l*this._rotation00+c*this._rotation10+m*this._rotation20,v=l*this._rotation01+c*this._rotation11+m*this._rotation21,y=l*this._rotation02+c*this._rotation12+m*this._rotation22,this._rotation00=b,this._rotation01=p,this._rotation02=d,this._rotation10=u,this._rotation11=f,this._rotation12=x,this._rotation20=g,this._rotation21=v,this._rotation22=y}getOrientation(){let t,i,s,n,a,o=new Ut.common.Quat,e=this._rotation00,r=this._rotation11,_=this._rotation22,h=e+r+_;return h>0?(a=Math.sqrt(h+1),n=.5*a,a=.5/a,t=(this._rotation21-this._rotation12)*a,i=(this._rotation02-this._rotation20)*a,s=(this._rotation10-this._rotation01)*a):e>r?e>_?(a=Math.sqrt(e-r-_+1),t=.5*a,a=.5/a,i=(this._rotation01+this._rotation10)*a,s=(this._rotation02+this._rotation20)*a,n=(this._rotation21-this._rotation12)*a):(a=Math.sqrt(_-e-r+1),s=.5*a,a=.5/a,t=(this._rotation02+this._rotation20)*a,i=(this._rotation12+this._rotation21)*a,n=(this._rotation10-this._rotation01)*a):r>_?(a=Math.sqrt(r-_-e+1),i=.5*a,a=.5/a,t=(this._rotation01+this._rotation10)*a,s=(this._rotation12+this._rotation21)*a,n=(this._rotation02-this._rotation20)*a):(a=Math.sqrt(_-e-r+1),s=.5*a,a=.5/a,t=(this._rotation02+this._rotation20)*a,i=(this._rotation12+this._rotation21)*a,n=(this._rotation10-this._rotation01)*a),o.x=t,o.y=i,o.z=s,o.w=n,o}getOrientationTo(t){let i,s,n,a,o,e=this._rotation00,r=this._rotation11,_=this._rotation22,h=e+r+_;h>0?(o=Math.sqrt(h+1),a=.5*o,o=.5/o,i=(this._rotation21-this._rotation12)*o,s=(this._rotation02-this._rotation20)*o,n=(this._rotation10-this._rotation01)*o):e>r?e>_?(o=Math.sqrt(e-r-_+1),i=.5*o,o=.5/o,s=(this._rotation01+this._rotation10)*o,n=(this._rotation02+this._rotation20)*o,a=(this._rotation21-this._rotation12)*o):(o=Math.sqrt(_-e-r+1),n=.5*o,o=.5/o,i=(this._rotation02+this._rotation20)*o,s=(this._rotation12+this._rotation21)*o,a=(this._rotation10-this._rotation01)*o):r>_?(o=Math.sqrt(r-_-e+1),s=.5*o,o=.5/o,i=(this._rotation01+this._rotation10)*o,n=(this._rotation12+this._rotation21)*o,a=(this._rotation02-this._rotation20)*o):(o=Math.sqrt(_-e-r+1),n=.5*o,o=.5/o,i=(this._rotation02+this._rotation20)*o,s=(this._rotation12+this._rotation21)*o,a=(this._rotation10-this._rotation01)*o),t.x=i,t.y=s,t.z=n,t.w=a}setOrientation(t){let i,s,n,a;i=t.x,s=t.y,n=t.z,a=t.w;let o=2*i,e=2*s,r=2*n,_=i*o,h=s*e,l=n*r,c=i*e,m=s*r,b=i*r,p=a*o,d=a*e,u=a*r;return this._rotation00=1-h-l,this._rotation01=c-u,this._rotation02=b+d,this._rotation10=c+u,this._rotation11=1-_-l,this._rotation12=m-p,this._rotation20=b-d,this._rotation21=m+p,this._rotation22=1-_-h,this}clone(){let t=new Ut.common.Transform;return t._positionX=this._positionX,t._positionY=this._positionY,t._positionZ=this._positionZ,t._rotation00=this._rotation00,t._rotation01=this._rotation01,t._rotation02=this._rotation02,t._rotation10=this._rotation10,t._rotation11=this._rotation11,t._rotation12=this._rotation12,t._rotation20=this._rotation20,t._rotation21=this._rotation21,t._rotation22=this._rotation22,t}copyFrom(t){return this._positionX=t._positionX,this._positionY=t._positionY,this._positionZ=t._positionZ,this._rotation00=t._rotation00,this._rotation01=t._rotation01,this._rotation02=t._rotation02,this._rotation10=t._rotation10,this._rotation11=t._rotation11,this._rotation12=t._rotation12,this._rotation20=t._rotation20,this._rotation21=t._rotation21,this._rotation22=t._rotation22,this}},Ut.common.Setting=class{},Ut.collision.narrowphase.detector.gjkepa.GjkEpa=class{constructor(){this.s=new Array(4),this.w1=new Array(4),this.w2=new Array(4),this.baseDirs=new Array(3),this.baseDirs[0]=new Ut.common.Vec3(1,0,0),this.baseDirs[1]=new Ut.common.Vec3(0,1,0),this.baseDirs[2]=new Ut.common.Vec3(0,0,1),this.tl1=new Ut.common.Vec3,this.tl2=new Ut.common.Vec3,this.rayX=new Ut.common.Vec3,this.rayR=new Ut.common.Vec3,this.tempTransform=new Ut.common.Transform,this.s[0]=new Ut.common.Vec3,this.w1[0]=new Ut.common.Vec3,this.w2[0]=new Ut.common.Vec3,this.s[1]=new Ut.common.Vec3,this.w1[1]=new Ut.common.Vec3,this.w2[1]=new Ut.common.Vec3,this.s[2]=new Ut.common.Vec3,this.w1[2]=new Ut.common.Vec3,this.w2[2]=new Ut.common.Vec3,this.s[3]=new Ut.common.Vec3,this.w1[3]=new Ut.common.Vec3,this.w2[3]=new Ut.common.Vec3,this.dir=new Ut.common.Vec3,this.closest=new Ut.common.Vec3,this.closestPoint1=new Ut.common.Vec3,this.closestPoint2=new Ut.common.Vec3,this.polyhedron=new Ut.collision.narrowphase.detector.gjkepa.EpaPolyhedron}computeClosestPointsImpl(t,i,s,n,a,o){this.c1=t,this.c2=i,this.tf1=s,this.tf2=n;let e=this.s,r=this.w1,_=this.w2,h=this.closest,l=this.dir;if(null!=a?(null==a._gjkCache&&(a._gjkCache=new Ut.collision.narrowphase.detector.gjkepa.GjkCache),this.loadCache(a._gjkCache)):l.zero(),l.x*l.x+l.y*l.y+l.z*l.z==0){let t,i,a;t=n._positionX-s._positionX,i=n._positionY-s._positionY,a=n._positionZ-s._positionZ,l.x=t,l.y=i,l.z=a,l.x*l.x+l.y*l.y+l.z*l.z<1e-6&&l.init(1,0,0)}this.simplexSize=0,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let c=this.s[this.simplexSize],m=this.w1[this.simplexSize];c.x=m.x,c.y=m.y,c.z=m.z;let b=this.w2[this.simplexSize];c.x-=b.x,c.y-=b.y,c.z-=b.z,this.simplexSize=1;let p=0;for(;p<40;){let c=0;switch(this.simplexSize){case 1:let t=e[0];h.x=t.x,h.y=t.y,h.z=t.z,c=1;break;case 2:let i,s,n,a,o,r,_=e[0];i=_.x,s=_.y,n=_.z;let l,m,b,p=e[1];a=p.x,o=p.y,r=p.z,l=a-i,m=o-s,b=r-n;let d=l*i+m*s+b*n;if(d=-d/(l*l+m*m+b*b),d<0)h.x=i,h.y=s,h.z=n,c=1;else if(d>1)h.x=a,h.y=o,h.z=r,c=2;else{let t,a,o;t=i+l*d,a=s+m*d,o=n+b*d,h.x=t,h.y=a,h.z=o,c=3}break;case 3:let u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C,T,j,E,R,D,F,q,N,H,O=e[0],W=e[1],G=e[2];u=O.x,f=O.y,x=O.z,g=W.x,v=W.y,y=W.z,X=G.x,z=G.y,M=G.z,Y=g-u,Z=v-f,w=y-x,I=X-g,V=z-v,L=M-y,A=u-X,k=f-z,S=x-M,B=Z*L-w*V,P=w*I-Y*L,C=Y*V-Z*I,T=Z*C-w*P,j=w*B-Y*C,E=Y*P-Z*B,R=V*C-L*P,D=L*B-I*C,F=I*P-V*B,q=k*C-S*P,N=S*B-A*C,H=A*P-k*B;let U,J,$,K=-1,Q=0;if(U=0,J=0,$=0,u*T+f*j+x*E<0){let t,i,s,n,a,o,e,r,_;t=O.x,i=O.y,s=O.z,n=W.x,a=W.y,o=W.z,e=n-t,r=a-i,_=o-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=n,h.y=a,h.z=o,l=2;else{let n,a,o;n=t+e*c,a=i+r*c,o=s+_*c,h.x=n,h.y=a,h.z=o,l=3}Q=l,K=h.x*h.x+h.y*h.y+h.z*h.z,U=h.x,J=h.y,$=h.z}if(g*R+v*D+y*F<0){let t,i,s,n,a,o,e,r,_;t=W.x,i=W.y,s=W.z,n=G.x,a=G.y,o=G.z,e=n-t,r=a-i,_=o-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=n,h.y=a,h.z=o,l=2;else{let n,a,o;n=t+e*c,a=i+r*c,o=s+_*c,h.x=n,h.y=a,h.z=o,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(K<0||m<K)&&(Q=l<<1,K=m,U=h.x,J=h.y,$=h.z)}if(X*q+z*N+M*H<0){let t,i,s,n,a,o,e,r,_;t=O.x,i=O.y,s=O.z,n=G.x,a=G.y,o=G.z,e=n-t,r=a-i,_=o-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=n,h.y=a,h.z=o,l=2;else{let n,a,o;n=t+e*c,a=i+r*c,o=s+_*c,h.x=n,h.y=a,h.z=o,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(K<0||m<K)&&(Q=1&l|(2&l)<<1,K=m,U=h.x,J=h.y,$=h.z)}if(K>0)h.x=U,h.y=J,h.z=$,c=Q;else{let t=B*B+P*P+C*C;t>0&&(t=1/Math.sqrt(t)),B*=t,P*=t,C*=t;let i=B*B+P*P+C*C;i=(u*B+f*P+x*C)/i,U=B*i,J=P*i,$=C*i,h.x=U,h.y=J,h.z=$,c=7}break;case 4:let tt,it,st,nt,at,ot,et,rt,_t,ht,lt,ct,mt,bt,pt,dt,ut,ft,xt,gt,vt,yt,Xt,zt,Mt,Yt,Zt,wt,It,Vt,Lt,At,kt,St,Bt,Pt,Ct,Tt,jt,Et=e[0],Rt=e[1],Dt=e[2],Ft=e[3];tt=Et.x,it=Et.y,st=Et.z,nt=Rt.x,at=Rt.y,ot=Rt.z,et=Dt.x,rt=Dt.y,_t=Dt.z,ht=Ft.x,lt=Ft.y,ct=Ft.z,mt=nt-tt,bt=at-it,pt=ot-st,dt=et-tt,ut=rt-it,ft=_t-st,xt=ht-tt,gt=lt-it,vt=ct-st,yt=et-nt,Xt=rt-at,zt=_t-ot,Mt=ht-nt,Yt=lt-at,Zt=ct-ot,wt=bt*ft-pt*ut,It=pt*dt-mt*ft,Vt=mt*ut-bt*dt,Lt=ut*vt-ft*gt,At=ft*xt-dt*vt,kt=dt*gt-ut*xt,St=gt*pt-vt*bt,Bt=vt*mt-xt*pt,Pt=xt*bt-gt*mt,Ct=Yt*zt-Zt*Xt,Tt=Zt*yt-Mt*zt,jt=Mt*Xt-Yt*yt;let qt,Nt,Ht,Ot=mt*Ct+bt*Tt+pt*jt>0?1:-1,Wt=-1,Gt=0;if(qt=0,Nt=0,Ht=0,(tt*wt+it*It+st*Vt)*Ot<0){let t,i,s,n,a,o,e,r,_,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L;t=Et.x,i=Et.y,s=Et.z,n=Rt.x,a=Rt.y,o=Rt.z,e=Dt.x,r=Dt.y,_=Dt.z,l=n-t,c=a-i,m=o-s,b=e-n,p=r-a,d=_-o,u=t-e,f=i-r,x=s-_,g=c*d-m*p,v=m*b-l*d,y=l*p-c*b,X=c*y-m*v,z=m*g-l*y,M=l*v-c*g,Y=p*y-d*v,Z=d*g-b*y,w=b*v-p*g,I=f*y-x*v,V=x*g-u*y,L=u*v-f*g;let A,k,S,B,P=-1,C=0;if(A=0,k=0,S=0,t*X+i*z+s*M<0){let t,i,s,n,a,o,e,r,_;t=Et.x,i=Et.y,s=Et.z,n=Rt.x,a=Rt.y,o=Rt.z,e=n-t,r=a-i,_=o-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=n,h.y=a,h.z=o,l=2;else{let n,a,o;n=t+e*c,a=i+r*c,o=s+_*c,h.x=n,h.y=a,h.z=o,l=3}C=l,P=h.x*h.x+h.y*h.y+h.z*h.z,A=h.x,k=h.y,S=h.z}if(n*Y+a*Z+o*w<0){let t,i,s,n,a,o,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,n=Dt.x,a=Dt.y,o=Dt.z,e=n-t,r=a-i,_=o-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=n,h.y=a,h.z=o,l=2;else{let n,a,o;n=t+e*c,a=i+r*c,o=s+_*c,h.x=n,h.y=a,h.z=o,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(P<0||m<P)&&(C=l<<1,P=m,A=h.x,k=h.y,S=h.z)}if(e*I+r*V+_*L<0){let t,i,s,n,a,o,e,r,_;t=Et.x,i=Et.y,s=Et.z,n=Dt.x,a=Dt.y,o=Dt.z,e=n-t,r=a-i,_=o-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=n,h.y=a,h.z=o,l=2;else{let n,a,o;n=t+e*c,a=i+r*c,o=s+_*c,h.x=n,h.y=a,h.z=o,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(P<0||m<P)&&(C=1&l|(2&l)<<1,P=m,A=h.x,k=h.y,S=h.z)}if(P>0)h.x=A,h.y=k,h.z=S,B=C;else{let n=g*g+v*v+y*y;n>0&&(n=1/Math.sqrt(n)),g*=n,v*=n,y*=n;let a=g*g+v*v+y*y;a=(t*g+i*v+s*y)/a,A=g*a,k=v*a,S=y*a,h.x=A,h.y=k,h.z=S,B=7}Gt=B,Wt=h.x*h.x+h.y*h.y+h.z*h.z,qt=h.x,Nt=h.y,Ht=h.z}if((tt*Lt+it*At+st*kt)*Ot<0){let t,i,s,n,a,o,e,r,_,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L;t=Et.x,i=Et.y,s=Et.z,n=Dt.x,a=Dt.y,o=Dt.z,e=Ft.x,r=Ft.y,_=Ft.z,l=n-t,c=a-i,m=o-s,b=e-n,p=r-a,d=_-o,u=t-e,f=i-r,x=s-_,g=c*d-m*p,v=m*b-l*d,y=l*p-c*b,X=c*y-m*v,z=m*g-l*y,M=l*v-c*g,Y=p*y-d*v,Z=d*g-b*y,w=b*v-p*g,I=f*y-x*v,V=x*g-u*y,L=u*v-f*g;let A,k,S,B,P=-1,C=0;if(A=0,k=0,S=0,t*X+i*z+s*M<0){let t,i,s,n,a,o,e,r,_;t=Et.x,i=Et.y,s=Et.z,n=Dt.x,a=Dt.y,o=Dt.z,e=n-t,r=a-i,_=o-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=n,h.y=a,h.z=o,l=2;else{let n,a,o;n=t+e*c,a=i+r*c,o=s+_*c,h.x=n,h.y=a,h.z=o,l=3}C=l,P=h.x*h.x+h.y*h.y+h.z*h.z,A=h.x,k=h.y,S=h.z}if(n*Y+a*Z+o*w<0){let t,i,s,n,a,o,e,r,_;t=Dt.x,i=Dt.y,s=Dt.z,n=Ft.x,a=Ft.y,o=Ft.z,e=n-t,r=a-i,_=o-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=n,h.y=a,h.z=o,l=2;else{let n,a,o;n=t+e*c,a=i+r*c,o=s+_*c,h.x=n,h.y=a,h.z=o,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(P<0||m<P)&&(C=l<<1,P=m,A=h.x,k=h.y,S=h.z)}if(e*I+r*V+_*L<0){let t,i,s,n,a,o,e,r,_;t=Et.x,i=Et.y,s=Et.z,n=Ft.x,a=Ft.y,o=Ft.z,e=n-t,r=a-i,_=o-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=n,h.y=a,h.z=o,l=2;else{let n,a,o;n=t+e*c,a=i+r*c,o=s+_*c,h.x=n,h.y=a,h.z=o,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(P<0||m<P)&&(C=1&l|(2&l)<<1,P=m,A=h.x,k=h.y,S=h.z)}if(P>0)h.x=A,h.y=k,h.z=S,B=C;else{let n=g*g+v*v+y*y;n>0&&(n=1/Math.sqrt(n)),g*=n,v*=n,y*=n;let a=g*g+v*v+y*y;a=(t*g+i*v+s*y)/a,A=g*a,k=v*a,S=y*a,h.x=A,h.y=k,h.z=S,B=7}let T=h.x*h.x+h.y*h.y+h.z*h.z;(Wt<0||T<Wt)&&(Gt=1&B|(6&B)<<1,Wt=T,qt=h.x,Nt=h.y,Ht=h.z)}if((tt*St+it*Bt+st*Pt)*Ot<0){let t,i,s,n,a,o,e,r,_,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L;t=Et.x,i=Et.y,s=Et.z,n=Rt.x,a=Rt.y,o=Rt.z,e=Ft.x,r=Ft.y,_=Ft.z,l=n-t,c=a-i,m=o-s,b=e-n,p=r-a,d=_-o,u=t-e,f=i-r,x=s-_,g=c*d-m*p,v=m*b-l*d,y=l*p-c*b,X=c*y-m*v,z=m*g-l*y,M=l*v-c*g,Y=p*y-d*v,Z=d*g-b*y,w=b*v-p*g,I=f*y-x*v,V=x*g-u*y,L=u*v-f*g;let A,k,S,B,P=-1,C=0;if(A=0,k=0,S=0,t*X+i*z+s*M<0){let t,i,s,n,a,o,e,r,_;t=Et.x,i=Et.y,s=Et.z,n=Rt.x,a=Rt.y,o=Rt.z,e=n-t,r=a-i,_=o-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=n,h.y=a,h.z=o,l=2;else{let n,a,o;n=t+e*c,a=i+r*c,o=s+_*c,h.x=n,h.y=a,h.z=o,l=3}C=l,P=h.x*h.x+h.y*h.y+h.z*h.z,A=h.x,k=h.y,S=h.z}if(n*Y+a*Z+o*w<0){let t,i,s,n,a,o,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,n=Ft.x,a=Ft.y,o=Ft.z,e=n-t,r=a-i,_=o-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=n,h.y=a,h.z=o,l=2;else{let n,a,o;n=t+e*c,a=i+r*c,o=s+_*c,h.x=n,h.y=a,h.z=o,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(P<0||m<P)&&(C=l<<1,P=m,A=h.x,k=h.y,S=h.z)}if(e*I+r*V+_*L<0){let t,i,s,n,a,o,e,r,_;t=Et.x,i=Et.y,s=Et.z,n=Ft.x,a=Ft.y,o=Ft.z,e=n-t,r=a-i,_=o-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=n,h.y=a,h.z=o,l=2;else{let n,a,o;n=t+e*c,a=i+r*c,o=s+_*c,h.x=n,h.y=a,h.z=o,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(P<0||m<P)&&(C=1&l|(2&l)<<1,P=m,A=h.x,k=h.y,S=h.z)}if(P>0)h.x=A,h.y=k,h.z=S,B=C;else{let n=g*g+v*v+y*y;n>0&&(n=1/Math.sqrt(n)),g*=n,v*=n,y*=n;let a=g*g+v*v+y*y;a=(t*g+i*v+s*y)/a,A=g*a,k=v*a,S=y*a,h.x=A,h.y=k,h.z=S,B=7}let T=h.x*h.x+h.y*h.y+h.z*h.z;(Wt<0||T<Wt)&&(Gt=3&B|(4&B)<<1,Wt=T,qt=h.x,Nt=h.y,Ht=h.z)}if((nt*Ct+at*Tt+ot*jt)*Ot<0){let t,i,s,n,a,o,e,r,_,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L;t=Rt.x,i=Rt.y,s=Rt.z,n=Dt.x,a=Dt.y,o=Dt.z,e=Ft.x,r=Ft.y,_=Ft.z,l=n-t,c=a-i,m=o-s,b=e-n,p=r-a,d=_-o,u=t-e,f=i-r,x=s-_,g=c*d-m*p,v=m*b-l*d,y=l*p-c*b,X=c*y-m*v,z=m*g-l*y,M=l*v-c*g,Y=p*y-d*v,Z=d*g-b*y,w=b*v-p*g,I=f*y-x*v,V=x*g-u*y,L=u*v-f*g;let A,k,S,B,P=-1,C=0;if(A=0,k=0,S=0,t*X+i*z+s*M<0){let t,i,s,n,a,o,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,n=Dt.x,a=Dt.y,o=Dt.z,e=n-t,r=a-i,_=o-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=n,h.y=a,h.z=o,l=2;else{let n,a,o;n=t+e*c,a=i+r*c,o=s+_*c,h.x=n,h.y=a,h.z=o,l=3}C=l,P=h.x*h.x+h.y*h.y+h.z*h.z,A=h.x,k=h.y,S=h.z}if(n*Y+a*Z+o*w<0){let t,i,s,n,a,o,e,r,_;t=Dt.x,i=Dt.y,s=Dt.z,n=Ft.x,a=Ft.y,o=Ft.z,e=n-t,r=a-i,_=o-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=n,h.y=a,h.z=o,l=2;else{let n,a,o;n=t+e*c,a=i+r*c,o=s+_*c,h.x=n,h.y=a,h.z=o,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(P<0||m<P)&&(C=l<<1,P=m,A=h.x,k=h.y,S=h.z)}if(e*I+r*V+_*L<0){let t,i,s,n,a,o,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,n=Ft.x,a=Ft.y,o=Ft.z,e=n-t,r=a-i,_=o-s;let l,c=e*t+r*i+_*s;if(c=-c/(e*e+r*r+_*_),c<0)h.x=t,h.y=i,h.z=s,l=1;else if(c>1)h.x=n,h.y=a,h.z=o,l=2;else{let n,a,o;n=t+e*c,a=i+r*c,o=s+_*c,h.x=n,h.y=a,h.z=o,l=3}let m=h.x*h.x+h.y*h.y+h.z*h.z;(P<0||m<P)&&(C=1&l|(2&l)<<1,P=m,A=h.x,k=h.y,S=h.z)}if(P>0)h.x=A,h.y=k,h.z=S,B=C;else{let n=g*g+v*v+y*y;n>0&&(n=1/Math.sqrt(n)),g*=n,v*=n,y*=n;let a=g*g+v*v+y*y;a=(t*g+i*v+s*y)/a,A=g*a,k=v*a,S=y*a,h.x=A,h.y=k,h.z=S,B=7}let T=h.x*h.x+h.y*h.y+h.z*h.z;(Wt<0||T<Wt)&&(Gt=B<<1,Wt=T,qt=h.x,Nt=h.y,Ht=h.z)}Wt>0?(h.x=qt,h.y=Nt,h.z=Ht,c=Gt):(h.zero(),c=15)}if(h.x*h.x+h.y*h.y+h.z*h.z<1e-8){if(!o)return this.distance=0,0;switch(this.simplexSize){case 1:this.pointToTetrahedron();break;case 2:this.lineToTetrahedron();break;case 3:this.triangleToTetrahedron()}if(4==this.simplexSize){let a=this.computeDepth(t,i,s,n,e,r,_);return 0!=a?(this.distance=0,a):(this.distance=-this.depth,0)}return this.distance=0,1}this.shrinkSimplex(c),l.x=h.x,l.y=h.y,l.z=h.z,l.x=-l.x,l.y=-l.y,l.z=-l.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let m=this.s[this.simplexSize],b=this.w1[this.simplexSize];m.x=b.x,m.y=b.y,m.z=b.z;let d=this.w2[this.simplexSize];if(m.x-=d.x,m.y-=d.y,m.z-=d.z,l.x*l.x+l.y*l.y+l.z*l.z<1e-8)throw new Error("!?");let u=e[this.simplexSize];if(u.x*l.x+u.y*l.y+u.z*l.z-(h.x*l.x+h.y*l.y+h.z*l.z)<1e-8)return this.interpolateClosestPoints(),this.distance=Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z),null!=a&&null!=a._gjkCache&&this.saveCache(a._gjkCache),0;this.simplexSize++,++p}return 2}convexCastImpl(t,i,s,n,a,o,e){this.c1=t,this.c2=i,this.tf1=s,this.tf2=n;let r,_,h,l=this.s,c=this.closest,m=this.dir;if(r=n._positionX-s._positionX,_=n._positionY-s._positionY,h=n._positionZ-s._positionZ,m.x=r,m.y=_,m.z=h,m.x*m.x+m.y*m.y+m.z*m.z<1e-6&&m.init(1,0,0),this.simplexSize=0,null!=this.c1)this.computeWitnessPoint1(!0);else{let t=this.w1[this.simplexSize];t.x=this.tf1._positionX,t.y=this.tf1._positionY,t.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);let b=this.s[this.simplexSize],p=this.w1[this.simplexSize];b.x=p.x,b.y=p.y,b.z=p.z;let d=this.w2[this.simplexSize];b.x-=d.x,b.y-=d.y,b.z-=d.z,this.simplexSize=1;let u=0,f=0,x=this.rayX,g=this.rayR;for(x.zero(),g.x=o.x,g.y=o.y,g.z=o.z,g.x-=a.x,g.y-=a.y,g.z-=a.z;u<40;){let t=0;switch(this.simplexSize){case 1:let i=l[0];c.x=i.x,c.y=i.y,c.z=i.z,t=1;break;case 2:let s,n,a,o,e,r,_=l[0];s=_.x,n=_.y,a=_.z;let h,m,b,p=l[1];o=p.x,e=p.y,r=p.z,h=o-s,m=e-n,b=r-a;let d=h*s+m*n+b*a;if(d=-d/(h*h+m*m+b*b),d<0)c.x=s,c.y=n,c.z=a,t=1;else if(d>1)c.x=o,c.y=e,c.z=r,t=2;else{let i,o,e;i=s+h*d,o=n+m*d,e=a+b*d,c.x=i,c.y=o,c.z=e,t=3}break;case 3:let u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C,T,j,E,R,D,F,q,N,H,O=l[0],W=l[1],G=l[2];u=O.x,f=O.y,x=O.z,g=W.x,v=W.y,y=W.z,X=G.x,z=G.y,M=G.z,Y=g-u,Z=v-f,w=y-x,I=X-g,V=z-v,L=M-y,A=u-X,k=f-z,S=x-M,B=Z*L-w*V,P=w*I-Y*L,C=Y*V-Z*I,T=Z*C-w*P,j=w*B-Y*C,E=Y*P-Z*B,R=V*C-L*P,D=L*B-I*C,F=I*P-V*B,q=k*C-S*P,N=S*B-A*C,H=A*P-k*B;let U,J,$,K=-1,Q=0;if(U=0,J=0,$=0,u*T+f*j+x*E<0){let t,i,s,n,a,o,e,r,_;t=O.x,i=O.y,s=O.z,n=W.x,a=W.y,o=W.z,e=n-t,r=a-i,_=o-s;let h,l=e*t+r*i+_*s;if(l=-l/(e*e+r*r+_*_),l<0)c.x=t,c.y=i,c.z=s,h=1;else if(l>1)c.x=n,c.y=a,c.z=o,h=2;else{let n,a,o;n=t+e*l,a=i+r*l,o=s+_*l,c.x=n,c.y=a,c.z=o,h=3}Q=h,K=c.x*c.x+c.y*c.y+c.z*c.z,U=c.x,J=c.y,$=c.z}if(g*R+v*D+y*F<0){let t,i,s,n,a,o,e,r,_;t=W.x,i=W.y,s=W.z,n=G.x,a=G.y,o=G.z,e=n-t,r=a-i,_=o-s;let h,l=e*t+r*i+_*s;if(l=-l/(e*e+r*r+_*_),l<0)c.x=t,c.y=i,c.z=s,h=1;else if(l>1)c.x=n,c.y=a,c.z=o,h=2;else{let n,a,o;n=t+e*l,a=i+r*l,o=s+_*l,c.x=n,c.y=a,c.z=o,h=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(K<0||m<K)&&(Q=h<<1,K=m,U=c.x,J=c.y,$=c.z)}if(X*q+z*N+M*H<0){let t,i,s,n,a,o,e,r,_;t=O.x,i=O.y,s=O.z,n=G.x,a=G.y,o=G.z,e=n-t,r=a-i,_=o-s;let h,l=e*t+r*i+_*s;if(l=-l/(e*e+r*r+_*_),l<0)c.x=t,c.y=i,c.z=s,h=1;else if(l>1)c.x=n,c.y=a,c.z=o,h=2;else{let n,a,o;n=t+e*l,a=i+r*l,o=s+_*l,c.x=n,c.y=a,c.z=o,h=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(K<0||m<K)&&(Q=1&h|(2&h)<<1,K=m,U=c.x,J=c.y,$=c.z)}if(K>0)c.x=U,c.y=J,c.z=$,t=Q;else{let i=B*B+P*P+C*C;i>0&&(i=1/Math.sqrt(i)),B*=i,P*=i,C*=i;let s=B*B+P*P+C*C;s=(u*B+f*P+x*C)/s,U=B*s,J=P*s,$=C*s,c.x=U,c.y=J,c.z=$,t=7}break;case 4:let tt,it,st,nt,at,ot,et,rt,_t,ht,lt,ct,mt,bt,pt,dt,ut,ft,xt,gt,vt,yt,Xt,zt,Mt,Yt,Zt,wt,It,Vt,Lt,At,kt,St,Bt,Pt,Ct,Tt,jt,Et=l[0],Rt=l[1],Dt=l[2],Ft=l[3];tt=Et.x,it=Et.y,st=Et.z,nt=Rt.x,at=Rt.y,ot=Rt.z,et=Dt.x,rt=Dt.y,_t=Dt.z,ht=Ft.x,lt=Ft.y,ct=Ft.z,mt=nt-tt,bt=at-it,pt=ot-st,dt=et-tt,ut=rt-it,ft=_t-st,xt=ht-tt,gt=lt-it,vt=ct-st,yt=et-nt,Xt=rt-at,zt=_t-ot,Mt=ht-nt,Yt=lt-at,Zt=ct-ot,wt=bt*ft-pt*ut,It=pt*dt-mt*ft,Vt=mt*ut-bt*dt,Lt=ut*vt-ft*gt,At=ft*xt-dt*vt,kt=dt*gt-ut*xt,St=gt*pt-vt*bt,Bt=vt*mt-xt*pt,Pt=xt*bt-gt*mt,Ct=Yt*zt-Zt*Xt,Tt=Zt*yt-Mt*zt,jt=Mt*Xt-Yt*yt;let qt,Nt,Ht,Ot=mt*Ct+bt*Tt+pt*jt>0?1:-1,Wt=-1,Gt=0;if(qt=0,Nt=0,Ht=0,(tt*wt+it*It+st*Vt)*Ot<0){let t,i,s,n,a,o,e,r,_,h,l,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L;t=Et.x,i=Et.y,s=Et.z,n=Rt.x,a=Rt.y,o=Rt.z,e=Dt.x,r=Dt.y,_=Dt.z,h=n-t,l=a-i,m=o-s,b=e-n,p=r-a,d=_-o,u=t-e,f=i-r,x=s-_,g=l*d-m*p,v=m*b-h*d,y=h*p-l*b,X=l*y-m*v,z=m*g-h*y,M=h*v-l*g,Y=p*y-d*v,Z=d*g-b*y,w=b*v-p*g,I=f*y-x*v,V=x*g-u*y,L=u*v-f*g;let A,k,S,B,P=-1,C=0;if(A=0,k=0,S=0,t*X+i*z+s*M<0){let t,i,s,n,a,o,e,r,_;t=Et.x,i=Et.y,s=Et.z,n=Rt.x,a=Rt.y,o=Rt.z,e=n-t,r=a-i,_=o-s;let h,l=e*t+r*i+_*s;if(l=-l/(e*e+r*r+_*_),l<0)c.x=t,c.y=i,c.z=s,h=1;else if(l>1)c.x=n,c.y=a,c.z=o,h=2;else{let n,a,o;n=t+e*l,a=i+r*l,o=s+_*l,c.x=n,c.y=a,c.z=o,h=3}C=h,P=c.x*c.x+c.y*c.y+c.z*c.z,A=c.x,k=c.y,S=c.z}if(n*Y+a*Z+o*w<0){let t,i,s,n,a,o,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,n=Dt.x,a=Dt.y,o=Dt.z,e=n-t,r=a-i,_=o-s;let h,l=e*t+r*i+_*s;if(l=-l/(e*e+r*r+_*_),l<0)c.x=t,c.y=i,c.z=s,h=1;else if(l>1)c.x=n,c.y=a,c.z=o,h=2;else{let n,a,o;n=t+e*l,a=i+r*l,o=s+_*l,c.x=n,c.y=a,c.z=o,h=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(P<0||m<P)&&(C=h<<1,P=m,A=c.x,k=c.y,S=c.z)}if(e*I+r*V+_*L<0){let t,i,s,n,a,o,e,r,_;t=Et.x,i=Et.y,s=Et.z,n=Dt.x,a=Dt.y,o=Dt.z,e=n-t,r=a-i,_=o-s;let h,l=e*t+r*i+_*s;if(l=-l/(e*e+r*r+_*_),l<0)c.x=t,c.y=i,c.z=s,h=1;else if(l>1)c.x=n,c.y=a,c.z=o,h=2;else{let n,a,o;n=t+e*l,a=i+r*l,o=s+_*l,c.x=n,c.y=a,c.z=o,h=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(P<0||m<P)&&(C=1&h|(2&h)<<1,P=m,A=c.x,k=c.y,S=c.z)}if(P>0)c.x=A,c.y=k,c.z=S,B=C;else{let n=g*g+v*v+y*y;n>0&&(n=1/Math.sqrt(n)),g*=n,v*=n,y*=n;let a=g*g+v*v+y*y;a=(t*g+i*v+s*y)/a,A=g*a,k=v*a,S=y*a,c.x=A,c.y=k,c.z=S,B=7}Gt=B,Wt=c.x*c.x+c.y*c.y+c.z*c.z,qt=c.x,Nt=c.y,Ht=c.z}if((tt*Lt+it*At+st*kt)*Ot<0){let t,i,s,n,a,o,e,r,_,h,l,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L;t=Et.x,i=Et.y,s=Et.z,n=Dt.x,a=Dt.y,o=Dt.z,e=Ft.x,r=Ft.y,_=Ft.z,h=n-t,l=a-i,m=o-s,b=e-n,p=r-a,d=_-o,u=t-e,f=i-r,x=s-_,g=l*d-m*p,v=m*b-h*d,y=h*p-l*b,X=l*y-m*v,z=m*g-h*y,M=h*v-l*g,Y=p*y-d*v,Z=d*g-b*y,w=b*v-p*g,I=f*y-x*v,V=x*g-u*y,L=u*v-f*g;let A,k,S,B,P=-1,C=0;if(A=0,k=0,S=0,t*X+i*z+s*M<0){let t,i,s,n,a,o,e,r,_;t=Et.x,i=Et.y,s=Et.z,n=Dt.x,a=Dt.y,o=Dt.z,e=n-t,r=a-i,_=o-s;let h,l=e*t+r*i+_*s;if(l=-l/(e*e+r*r+_*_),l<0)c.x=t,c.y=i,c.z=s,h=1;else if(l>1)c.x=n,c.y=a,c.z=o,h=2;else{let n,a,o;n=t+e*l,a=i+r*l,o=s+_*l,c.x=n,c.y=a,c.z=o,h=3}C=h,P=c.x*c.x+c.y*c.y+c.z*c.z,A=c.x,k=c.y,S=c.z}if(n*Y+a*Z+o*w<0){let t,i,s,n,a,o,e,r,_;t=Dt.x,i=Dt.y,s=Dt.z,n=Ft.x,a=Ft.y,o=Ft.z,e=n-t,r=a-i,_=o-s;let h,l=e*t+r*i+_*s;if(l=-l/(e*e+r*r+_*_),l<0)c.x=t,c.y=i,c.z=s,h=1;else if(l>1)c.x=n,c.y=a,c.z=o,h=2;else{let n,a,o;n=t+e*l,a=i+r*l,o=s+_*l,c.x=n,c.y=a,c.z=o,h=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(P<0||m<P)&&(C=h<<1,P=m,A=c.x,k=c.y,S=c.z)}if(e*I+r*V+_*L<0){let t,i,s,n,a,o,e,r,_;t=Et.x,i=Et.y,s=Et.z,n=Ft.x,a=Ft.y,o=Ft.z,e=n-t,r=a-i,_=o-s;let h,l=e*t+r*i+_*s;if(l=-l/(e*e+r*r+_*_),l<0)c.x=t,c.y=i,c.z=s,h=1;else if(l>1)c.x=n,c.y=a,c.z=o,h=2;else{let n,a,o;n=t+e*l,a=i+r*l,o=s+_*l,c.x=n,c.y=a,c.z=o,h=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(P<0||m<P)&&(C=1&h|(2&h)<<1,P=m,A=c.x,k=c.y,S=c.z)}if(P>0)c.x=A,c.y=k,c.z=S,B=C;else{let n=g*g+v*v+y*y;n>0&&(n=1/Math.sqrt(n)),g*=n,v*=n,y*=n;let a=g*g+v*v+y*y;a=(t*g+i*v+s*y)/a,A=g*a,k=v*a,S=y*a,c.x=A,c.y=k,c.z=S,B=7}let T=c.x*c.x+c.y*c.y+c.z*c.z;(Wt<0||T<Wt)&&(Gt=1&B|(6&B)<<1,Wt=T,qt=c.x,Nt=c.y,Ht=c.z)}if((tt*St+it*Bt+st*Pt)*Ot<0){let t,i,s,n,a,o,e,r,_,h,l,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L;t=Et.x,i=Et.y,s=Et.z,n=Rt.x,a=Rt.y,o=Rt.z,e=Ft.x,r=Ft.y,_=Ft.z,h=n-t,l=a-i,m=o-s,b=e-n,p=r-a,d=_-o,u=t-e,f=i-r,x=s-_,g=l*d-m*p,v=m*b-h*d,y=h*p-l*b,X=l*y-m*v,z=m*g-h*y,M=h*v-l*g,Y=p*y-d*v,Z=d*g-b*y,w=b*v-p*g,I=f*y-x*v,V=x*g-u*y,L=u*v-f*g;let A,k,S,B,P=-1,C=0;if(A=0,k=0,S=0,t*X+i*z+s*M<0){let t,i,s,n,a,o,e,r,_;t=Et.x,i=Et.y,s=Et.z,n=Rt.x,a=Rt.y,o=Rt.z,e=n-t,r=a-i,_=o-s;let h,l=e*t+r*i+_*s;if(l=-l/(e*e+r*r+_*_),l<0)c.x=t,c.y=i,c.z=s,h=1;else if(l>1)c.x=n,c.y=a,c.z=o,h=2;else{let n,a,o;n=t+e*l,a=i+r*l,o=s+_*l,c.x=n,c.y=a,c.z=o,h=3}C=h,P=c.x*c.x+c.y*c.y+c.z*c.z,A=c.x,k=c.y,S=c.z}if(n*Y+a*Z+o*w<0){let t,i,s,n,a,o,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,n=Ft.x,a=Ft.y,o=Ft.z,e=n-t,r=a-i,_=o-s;let h,l=e*t+r*i+_*s;if(l=-l/(e*e+r*r+_*_),l<0)c.x=t,c.y=i,c.z=s,h=1;else if(l>1)c.x=n,c.y=a,c.z=o,h=2;else{let n,a,o;n=t+e*l,a=i+r*l,o=s+_*l,c.x=n,c.y=a,c.z=o,h=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(P<0||m<P)&&(C=h<<1,P=m,A=c.x,k=c.y,S=c.z)}if(e*I+r*V+_*L<0){let t,i,s,n,a,o,e,r,_;t=Et.x,i=Et.y,s=Et.z,n=Ft.x,a=Ft.y,o=Ft.z,e=n-t,r=a-i,_=o-s;let h,l=e*t+r*i+_*s;if(l=-l/(e*e+r*r+_*_),l<0)c.x=t,c.y=i,c.z=s,h=1;else if(l>1)c.x=n,c.y=a,c.z=o,h=2;else{let n,a,o;n=t+e*l,a=i+r*l,o=s+_*l,c.x=n,c.y=a,c.z=o,h=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(P<0||m<P)&&(C=1&h|(2&h)<<1,P=m,A=c.x,k=c.y,S=c.z)}if(P>0)c.x=A,c.y=k,c.z=S,B=C;else{let n=g*g+v*v+y*y;n>0&&(n=1/Math.sqrt(n)),g*=n,v*=n,y*=n;let a=g*g+v*v+y*y;a=(t*g+i*v+s*y)/a,A=g*a,k=v*a,S=y*a,c.x=A,c.y=k,c.z=S,B=7}let T=c.x*c.x+c.y*c.y+c.z*c.z;(Wt<0||T<Wt)&&(Gt=3&B|(4&B)<<1,Wt=T,qt=c.x,Nt=c.y,Ht=c.z)}if((nt*Ct+at*Tt+ot*jt)*Ot<0){let t,i,s,n,a,o,e,r,_,h,l,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L;t=Rt.x,i=Rt.y,s=Rt.z,n=Dt.x,a=Dt.y,o=Dt.z,e=Ft.x,r=Ft.y,_=Ft.z,h=n-t,l=a-i,m=o-s,b=e-n,p=r-a,d=_-o,u=t-e,f=i-r,x=s-_,g=l*d-m*p,v=m*b-h*d,y=h*p-l*b,X=l*y-m*v,z=m*g-h*y,M=h*v-l*g,Y=p*y-d*v,Z=d*g-b*y,w=b*v-p*g,I=f*y-x*v,V=x*g-u*y,L=u*v-f*g;let A,k,S,B,P=-1,C=0;if(A=0,k=0,S=0,t*X+i*z+s*M<0){let t,i,s,n,a,o,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,n=Dt.x,a=Dt.y,o=Dt.z,e=n-t,r=a-i,_=o-s;let h,l=e*t+r*i+_*s;if(l=-l/(e*e+r*r+_*_),l<0)c.x=t,c.y=i,c.z=s,h=1;else if(l>1)c.x=n,c.y=a,c.z=o,h=2;else{let n,a,o;n=t+e*l,a=i+r*l,o=s+_*l,c.x=n,c.y=a,c.z=o,h=3}C=h,P=c.x*c.x+c.y*c.y+c.z*c.z,A=c.x,k=c.y,S=c.z}if(n*Y+a*Z+o*w<0){let t,i,s,n,a,o,e,r,_;t=Dt.x,i=Dt.y,s=Dt.z,n=Ft.x,a=Ft.y,o=Ft.z,e=n-t,r=a-i,_=o-s;let h,l=e*t+r*i+_*s;if(l=-l/(e*e+r*r+_*_),l<0)c.x=t,c.y=i,c.z=s,h=1;else if(l>1)c.x=n,c.y=a,c.z=o,h=2;else{let n,a,o;n=t+e*l,a=i+r*l,o=s+_*l,c.x=n,c.y=a,c.z=o,h=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(P<0||m<P)&&(C=h<<1,P=m,A=c.x,k=c.y,S=c.z)}if(e*I+r*V+_*L<0){let t,i,s,n,a,o,e,r,_;t=Rt.x,i=Rt.y,s=Rt.z,n=Ft.x,a=Ft.y,o=Ft.z,e=n-t,r=a-i,_=o-s;let h,l=e*t+r*i+_*s;if(l=-l/(e*e+r*r+_*_),l<0)c.x=t,c.y=i,c.z=s,h=1;else if(l>1)c.x=n,c.y=a,c.z=o,h=2;else{let n,a,o;n=t+e*l,a=i+r*l,o=s+_*l,c.x=n,c.y=a,c.z=o,h=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(P<0||m<P)&&(C=1&h|(2&h)<<1,P=m,A=c.x,k=c.y,S=c.z)}if(P>0)c.x=A,c.y=k,c.z=S,B=C;else{let n=g*g+v*v+y*y;n>0&&(n=1/Math.sqrt(n)),g*=n,v*=n,y*=n;let a=g*g+v*v+y*y;a=(t*g+i*v+s*y)/a,A=g*a,k=v*a,S=y*a,c.x=A,c.y=k,c.z=S,B=7}let T=c.x*c.x+c.y*c.y+c.z*c.z;(Wt<0||T<Wt)&&(Gt=B<<1,Wt=T,qt=c.x,Nt=c.y,Ht=c.z)}Wt>0?(c.x=qt,c.y=Nt,c.z=Ht,t=Gt):(c.zero(),t=15)}if(this.shrinkSimplex(t),c.x*c.x+c.y*c.y+c.z*c.z<1e-8){if(0==f||4==this.simplexSize)return e.fraction=f,!1;this.interpolateClosestPoints(),e.fraction=f;let t=e.normal;t.x=m.x,t.y=m.y,t.z=m.z;let i=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);i>0&&(i=1/i),t.x*=i,t.y*=i,t.z*=i;let s=e.position,n=this.closestPoint1;return s.x=n.x,s.y=n.y,s.z=n.z,s.x+=a.x*f,s.y+=a.y*f,s.z+=a.z*f,!0}if(m.x=c.x,m.y=c.y,m.z=c.z,m.x=-m.x,m.y=-m.y,m.z=-m.z,null!=this.c1)this.computeWitnessPoint1(!0);else{let t=this.w1[this.simplexSize];t.x=this.tf1._positionX,t.y=this.tf1._positionY,t.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);let i=this.s[this.simplexSize],s=this.w1[this.simplexSize];i.x=s.x,i.y=s.y,i.z=s.z;let n=this.w2[this.simplexSize];i.x-=n.x,i.y-=n.y,i.z-=n.z;let o=l[this.simplexSize];if(o.x-=x.x,o.y-=x.y,o.z-=x.z,m.x*m.x+m.y*m.y+m.z*m.z<1e-8)throw new Error("!?");let r=l[this.simplexSize],_=r.x*m.x+r.y*m.y+r.z*m.z;if(_<0){if(g.x*m.x+g.y*m.y+g.z*m.z>=0)return!1;let t=_/(g.x*m.x+g.y*m.y+g.z*m.z);if(f+=t,f>=1)return!1;x.x+=g.x*t,x.y+=g.y*t,x.z+=g.z*t;let i=0,s=this.simplexSize+1;for(;i<s;){let s=l[i++],n=-t;s.x+=g.x*n,s.y+=g.y*n,s.z+=g.z*n}}let h=!1,b=0,p=this.simplexSize;for(;b<p;){let t=b++,i=l[t].x-l[this.simplexSize].x,s=l[t].y-l[this.simplexSize].y,n=l[t].z-l[this.simplexSize].z;if(i*i+s*s+n*n<1e-8){h=!0;break}}h||this.simplexSize++,++u}return!1}interpolateClosestPoints(){switch(this.simplexSize){case 1:let t=this.closestPoint1,i=this.w1[0];t.x=i.x,t.y=i.y,t.z=i.z;let s=this.closestPoint2,n=this.w2[0];s.x=n.x,s.y=n.y,s.z=n.z;break;case 2:let a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y=this.closest;a=Y.x,o=Y.y,e=Y.z;let Z=this.s[0];r=Z.x,_=Z.y,h=Z.z;let w=this.w1[0];l=w.x,c=w.y,m=w.z;let I=this.w2[0];b=I.x,p=I.y,d=I.z;let V=this.s[1];u=V.x,f=V.y,x=V.z;let L=this.w1[1];g=L.x,v=L.y,y=L.z;let A,k,S,B=this.w2[1];X=B.x,z=B.y,M=B.z,A=u-r,k=f-_,S=x-h;let P,C,T,j=A*A+k*k+S*S;0!=j&&(j=1/j),P=a-r,C=o-_,T=e-h;let E,R,D,F,q,N,H,O,W,G=(P*A+C*k+T*S)*j;E=g-l,R=v-c,D=y-m,F=l+E*G,q=c+R*G,N=m+D*G,E=X-b,R=z-p,D=M-d,H=b+E*G,O=p+R*G,W=d+D*G;let U=this.closestPoint1;U.x=F,U.y=q,U.z=N;let J=this.closestPoint2;J.x=H,J.y=O,J.z=W;break;case 3:let $,K,Q,tt,it,st,nt,at,ot,et,rt,_t,ht,lt,ct,mt,bt,pt,dt,ut,ft,xt,gt,vt,yt,Xt,zt,Mt,Yt,Zt,wt=this.closest;$=wt.x,K=wt.y,Q=wt.z;let It=this.s[0];tt=It.x,it=It.y,st=It.z;let Vt=this.w1[0];nt=Vt.x,at=Vt.y,ot=Vt.z;let Lt=this.w2[0];et=Lt.x,rt=Lt.y,_t=Lt.z;let At=this.s[1];ht=At.x,lt=At.y,ct=At.z;let kt=this.w1[1];mt=kt.x,bt=kt.y,pt=kt.z;let St=this.w2[1];dt=St.x,ut=St.y,ft=St.z;let Bt=this.s[2];xt=Bt.x,gt=Bt.y,vt=Bt.z;let Pt=this.w1[2];yt=Pt.x,Xt=Pt.y,zt=Pt.z;let Ct,Tt,jt,Et,Rt,Dt,Ft,qt,Nt,Ht=this.w2[2];Mt=Ht.x,Yt=Ht.y,Zt=Ht.z,Ct=ht-tt,Tt=lt-it,jt=ct-st,Et=xt-tt,Rt=gt-it,Dt=vt-st,Ft=$-tt,qt=K-it,Nt=Q-st;let Ot=Ct*Ct+Tt*Tt+jt*jt,Wt=Ct*Et+Tt*Rt+jt*Dt,Gt=Et*Et+Rt*Rt+Dt*Dt,Ut=Ct*Ft+Tt*qt+jt*Nt,Jt=Et*Ft+Rt*qt+Dt*Nt,$t=Ot*Gt-Wt*Wt;0!=$t&&($t=1/$t);let Kt,Qt,ti,ii,si,ni,ai,oi,ei,ri=(Ut*Gt-Jt*Wt)*$t,_i=(-Ut*Wt+Jt*Ot)*$t;Kt=mt-nt,Qt=bt-at,ti=pt-ot,ii=nt+Kt*ri,si=at+Qt*ri,ni=ot+ti*ri,Kt=yt-nt,Qt=Xt-at,ti=zt-ot,ii+=Kt*_i,si+=Qt*_i,ni+=ti*_i,Kt=dt-et,Qt=ut-rt,ti=ft-_t,ai=et+Kt*ri,oi=rt+Qt*ri,ei=_t+ti*ri,Kt=Mt-et,Qt=Yt-rt,ti=Zt-_t,ai+=Kt*_i,oi+=Qt*_i,ei+=ti*_i;let hi=this.closestPoint1;hi.x=ii,hi.y=si,hi.z=ni;let li=this.closestPoint2;li.x=ai,li.y=oi,li.z=ei;break;default:throw new Error("!?")}}loadCache(t){let i=this.dir,s=t.prevClosestDir;i.x=s.x,i.y=s.y,i.z=s.z}saveCache(t){let i=t.prevClosestDir,s=this.closest;i.x=s.x,i.y=s.y,i.z=s.z,i.x=-i.x,i.y=-i.y,i.z=-i.z}shrinkSimplex(t){switch(this.simplexSize=t,this.simplexSize=(5&this.simplexSize)+(this.simplexSize>>1&5),this.simplexSize=(3&this.simplexSize)+(this.simplexSize>>2&3),t){case 2:let t=this.s[0],i=this.s[1];t.x=i.x,t.y=i.y,t.z=i.z;let s=this.w1[0],n=this.w1[1];s.x=n.x,s.y=n.y,s.z=n.z;let a=this.w2[0],o=this.w2[1];a.x=o.x,a.y=o.y,a.z=o.z;break;case 4:let e=this.s[0],r=this.s[2];e.x=r.x,e.y=r.y,e.z=r.z;let _=this.w1[0],h=this.w1[2];_.x=h.x,_.y=h.y,_.z=h.z;let l=this.w2[0],c=this.w2[2];l.x=c.x,l.y=c.y,l.z=c.z;break;case 5:let m=this.s[1],b=this.s[2];m.x=b.x,m.y=b.y,m.z=b.z;let p=this.w1[1],d=this.w1[2];p.x=d.x,p.y=d.y,p.z=d.z;let u=this.w2[1],f=this.w2[2];u.x=f.x,u.y=f.y,u.z=f.z;break;case 6:let x=this.s[0],g=this.s[2];x.x=g.x,x.y=g.y,x.z=g.z;let v=this.w1[0],y=this.w1[2];v.x=y.x,v.y=y.y,v.z=y.z;let X=this.w2[0],z=this.w2[2];X.x=z.x,X.y=z.y,X.z=z.z;break;case 8:let M=this.s[0],Y=this.s[3];M.x=Y.x,M.y=Y.y,M.z=Y.z;let Z=this.w1[0],w=this.w1[3];Z.x=w.x,Z.y=w.y,Z.z=w.z;let I=this.w2[0],V=this.w2[3];I.x=V.x,I.y=V.y,I.z=V.z;break;case 9:let L=this.s[1],A=this.s[3];L.x=A.x,L.y=A.y,L.z=A.z;let k=this.w1[1],S=this.w1[3];k.x=S.x,k.y=S.y,k.z=S.z;let B=this.w2[1],P=this.w2[3];B.x=P.x,B.y=P.y,B.z=P.z;break;case 10:let C=this.s[0],T=this.s[3];C.x=T.x,C.y=T.y,C.z=T.z;let j=this.w1[0],E=this.w1[3];j.x=E.x,j.y=E.y,j.z=E.z;let R=this.w2[0],D=this.w2[3];R.x=D.x,R.y=D.y,R.z=D.z;break;case 11:let F=this.s[2],q=this.s[3];F.x=q.x,F.y=q.y,F.z=q.z;let N=this.w1[2],H=this.w1[3];N.x=H.x,N.y=H.y,N.z=H.z;let O=this.w2[2],W=this.w2[3];O.x=W.x,O.y=W.y,O.z=W.z;break;case 12:let G=this.s[0],U=this.s[2];G.x=U.x,G.y=U.y,G.z=U.z;let J=this.w1[0],$=this.w1[2];J.x=$.x,J.y=$.y,J.z=$.z;let K=this.w2[0],Q=this.w2[2];K.x=Q.x,K.y=Q.y,K.z=Q.z;let tt=this.s[1],it=this.s[3];tt.x=it.x,tt.y=it.y,tt.z=it.z;let st=this.w1[1],nt=this.w1[3];st.x=nt.x,st.y=nt.y,st.z=nt.z;let at=this.w2[1],ot=this.w2[3];at.x=ot.x,at.y=ot.y,at.z=ot.z;break;case 13:let et=this.s[1],rt=this.s[3];et.x=rt.x,et.y=rt.y,et.z=rt.z;let _t=this.w1[1],ht=this.w1[3];_t.x=ht.x,_t.y=ht.y,_t.z=ht.z;let lt=this.w2[1],ct=this.w2[3];lt.x=ct.x,lt.y=ct.y,lt.z=ct.z;break;case 14:let mt=this.s[0],bt=this.s[3];mt.x=bt.x,mt.y=bt.y,mt.z=bt.z;let pt=this.w1[0],dt=this.w1[3];pt.x=dt.x,pt.y=dt.y,pt.z=dt.z;let ut=this.w2[0],ft=this.w2[3];ut.x=ft.x,ut.y=ft.y,ut.z=ft.z}}computeWitnessPoint1(t){let i,s,n,a,o,e,r,_,h,l,c,m,b,p,d,u=this.dir;a=u.x,o=u.y,e=u.z,l=this.tf1._rotation00*a+this.tf1._rotation10*o+this.tf1._rotation20*e,c=this.tf1._rotation01*a+this.tf1._rotation11*o+this.tf1._rotation21*e,m=this.tf1._rotation02*a+this.tf1._rotation12*o+this.tf1._rotation22*e,r=l,_=c,h=m;let f=this.dir;if(f.x=r,f.y=_,f.z=h,this.c1.computeLocalSupportingVertex(this.dir,this.w1[this.simplexSize]),t){let t=this.dir,i=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);i>0&&(i=1/i),t.x*=i,t.y*=i,t.z*=i;let s=this.w1[this.simplexSize],n=this.dir,a=this.c1._gjkMargin;s.x+=n.x*a,s.y+=n.y*a,s.z+=n.z*a}let x,g,v,y=this.w1[this.simplexSize];i=y.x,s=y.y,n=y.z,x=this.tf1._rotation00*i+this.tf1._rotation01*s+this.tf1._rotation02*n,g=this.tf1._rotation10*i+this.tf1._rotation11*s+this.tf1._rotation12*n,v=this.tf1._rotation20*i+this.tf1._rotation21*s+this.tf1._rotation22*n,b=x,p=g,d=v,b+=this.tf1._positionX,p+=this.tf1._positionY,d+=this.tf1._positionZ;let X=this.w1[this.simplexSize];X.x=b,X.y=p,X.z=d;let z=this.dir;z.x=a,z.y=o,z.z=e}computeWitnessPoint2(t){let i,s,n,a,o,e,r,_,h,l,c,m,b,p,d,u=this.dir;a=u.x,o=u.y,e=u.z,l=this.tf2._rotation00*a+this.tf2._rotation10*o+this.tf2._rotation20*e,c=this.tf2._rotation01*a+this.tf2._rotation11*o+this.tf2._rotation21*e,m=this.tf2._rotation02*a+this.tf2._rotation12*o+this.tf2._rotation22*e,r=l,_=c,h=m,r=-r,_=-_,h=-h;let f=this.dir;if(f.x=r,f.y=_,f.z=h,this.c2.computeLocalSupportingVertex(this.dir,this.w2[this.simplexSize]),t){let t=this.dir,i=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);i>0&&(i=1/i),t.x*=i,t.y*=i,t.z*=i;let s=this.w2[this.simplexSize],n=this.dir,a=this.c2._gjkMargin;s.x+=n.x*a,s.y+=n.y*a,s.z+=n.z*a}let x,g,v,y=this.w2[this.simplexSize];i=y.x,s=y.y,n=y.z,x=this.tf2._rotation00*i+this.tf2._rotation01*s+this.tf2._rotation02*n,g=this.tf2._rotation10*i+this.tf2._rotation11*s+this.tf2._rotation12*n,v=this.tf2._rotation20*i+this.tf2._rotation21*s+this.tf2._rotation22*n,b=x,p=g,d=v,b+=this.tf2._positionX,p+=this.tf2._positionY,d+=this.tf2._positionZ;let X=this.w2[this.simplexSize];X.x=b,X.y=p,X.z=d;let z=this.dir;z.x=a,z.y=o,z.z=e}pointToTetrahedron(){let t=0;for(;t<3;){let i=this.dir,s=this.baseDirs[t++];i.x=s.x,i.y=s.y,i.z=s.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let n=this.s[this.simplexSize],a=this.w1[this.simplexSize];n.x=a.x,n.y=a.y,n.z=a.z;let o=this.w2[this.simplexSize];if(n.x-=o.x,n.y-=o.y,n.z-=o.z,this.simplexSize++,this.lineToTetrahedron(),4==this.simplexSize)break;this.simplexSize--;let e=this.dir;e.x=-e.x,e.y=-e.y,e.z=-e.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let r=this.s[this.simplexSize],_=this.w1[this.simplexSize];r.x=_.x,r.y=_.y,r.z=_.z;let h=this.w2[this.simplexSize];if(r.x-=h.x,r.y-=h.y,r.z-=h.z,this.simplexSize++,this.lineToTetrahedron(),4==this.simplexSize)break;this.simplexSize--}}lineToTetrahedron(){let t,i,s,n,a,o,e,r,_,h,l,c,m=this.dir;t=m.x,i=m.y,s=m.z;let b=this.s[0];n=b.x,a=b.y,o=b.z;let p=this.s[1];e=p.x,r=p.y,_=p.z,h=n-e,l=a-r,c=o-_;let d=0;for(;d<3;){let t,i,s,n,a,o,e=this.baseDirs[d++];t=e.x,i=e.y,s=e.z,n=l*s-c*i,a=c*t-h*s,o=h*i-l*t;let r=this.dir;r.x=n,r.y=a,r.z=o,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let _=this.s[this.simplexSize],m=this.w1[this.simplexSize];_.x=m.x,_.y=m.y,_.z=m.z;let b=this.w2[this.simplexSize];if(_.x-=b.x,_.y-=b.y,_.z-=b.z,this.simplexSize++,this.triangleToTetrahedron(),4==this.simplexSize)break;this.simplexSize--;let p=this.dir;p.x=-p.x,p.y=-p.y,p.z=-p.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let u=this.s[this.simplexSize],f=this.w1[this.simplexSize];u.x=f.x,u.y=f.y,u.z=f.z;let x=this.w2[this.simplexSize];if(u.x-=x.x,u.y-=x.y,u.z-=x.z,this.simplexSize++,this.triangleToTetrahedron(),4==this.simplexSize)break;this.simplexSize--}let u=this.dir;u.x=t,u.y=i,u.z=s}triangleToTetrahedron(){let t,i,s,n=this.dir;for(t=n.x,i=n.y,s=n.z;;){let t,i,s,n,a,o,e,r,_,h,l,c,m,b,p,d=this.s[0];t=d.x,i=d.y,s=d.z;let u=this.s[1];n=u.x,a=u.y,o=u.z;let f,x,g,v=this.s[2];e=v.x,r=v.y,_=v.z,h=n-t,l=a-i,c=o-s,m=e-t,b=r-i,p=_-s,f=l*p-c*b,x=c*m-h*p,g=h*b-l*m;let y=this.dir;y.x=f,y.y=x,y.z=g,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let X=this.s[this.simplexSize],z=this.w1[this.simplexSize];X.x=z.x,X.y=z.y,X.z=z.z;let M=this.w2[this.simplexSize];if(X.x-=M.x,X.y-=M.y,X.z-=M.z,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;let Y=this.dir;Y.x=-Y.x,Y.y=-Y.y,Y.z=-Y.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let Z=this.s[this.simplexSize],w=this.w1[this.simplexSize];Z.x=w.x,Z.y=w.y,Z.z=w.z;let I=this.w2[this.simplexSize];if(Z.x-=I.x,Z.y-=I.y,Z.z-=I.z,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;break}let a=this.dir;a.x=t,a.y=i,a.z=s}isValidTetrahedron(){let t=this.s[2].x-this.s[0].x,i=this.s[2].y-this.s[0].y,s=this.s[2].z-this.s[0].z,n=this.s[3].x-this.s[0].x,a=this.s[3].y-this.s[0].y,o=this.s[3].z-this.s[0].z,e=(this.s[1].x-this.s[0].x)*(i*o-s*a)-(this.s[1].y-this.s[0].y)*(t*o-s*n)+(this.s[1].z-this.s[0].z)*(t*a-i*n);return e>1e-12||e<-1e-12}computeDepth(t,i,s,n,a,o,e){let r=this.polyhedron;for(;r._numTriangles>0;){let t=r._triangleList;r._numTriangles--;let i=t._prev,s=t._next;null!=i&&(i._next=s),null!=s&&(s._prev=i),t==r._triangleList&&(r._triangleList=r._triangleList._next),t==r._triangleListLast&&(r._triangleListLast=r._triangleListLast._prev),t._next=null,t._prev=null,t.removeReferences(),t._next=r._trianglePool,r._trianglePool=t}for(;r._numVertices>0;){let t=r._vertices[--r._numVertices];t.removeReferences(),t._next=r._vertexPool,r._vertexPool=t}let _=this.polyhedron,h=this.polyhedron,l=h._vertexPool;null!=l?(h._vertexPool=l._next,l._next=null):l=new Ut.collision.narrowphase.detector.gjkepa.EpaVertex;let c=l.init(a[0],o[0],e[0]),m=this.polyhedron,b=m._vertexPool;null!=b?(m._vertexPool=b._next,b._next=null):b=new Ut.collision.narrowphase.detector.gjkepa.EpaVertex;let p=b.init(a[1],o[1],e[1]),d=this.polyhedron,u=d._vertexPool;null!=u?(d._vertexPool=u._next,u._next=null):u=new Ut.collision.narrowphase.detector.gjkepa.EpaVertex;let f=u.init(a[2],o[2],e[2]),x=this.polyhedron,g=x._vertexPool;if(null!=g?(x._vertexPool=g._next,g._next=null):g=new Ut.collision.narrowphase.detector.gjkepa.EpaVertex,!_._init(c,p,f,g.init(a[3],o[3],e[3])))return Ut.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT;this.simplexSize=0;let v=this.s[0],y=this.w1[0],X=this.w2[0],z=0;for(;z<40;){let t=this.polyhedron._triangleList,i=1/0,s=null;for(;null!=t;)t._distanceSq<i&&(i=t._distanceSq,s=t),t=t._next;let n=s,a=this.dir,o=n._normal;a.x=o.x,a.y=o.y,a.z=o.z;let e=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z);e>0&&(e=1/e),a.x*=e,a.y*=e,a.z*=e,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let r=this.s[this.simplexSize],_=this.w1[this.simplexSize];r.x=_.x,r.y=_.y,r.z=_.z;let h=this.w2[this.simplexSize];r.x-=h.x,r.y-=h.y,r.z-=h.z;let l=n._vertices[0],c=n._vertices[1],m=n._vertices[2],b=l.v,p=this.dir,d=this.dir;if(v.x*d.x+v.y*d.y+v.z*d.z-(b.x*p.x+b.y*p.y+b.z*p.z)<1e-6||39==z){let t=this.closest,i=this.dir;t.x=i.x,t.y=i.y,t.z=i.z;let s,n,a,o=this.dir,e=l.v,r=this.dir,_=(o.x*e.x+o.y*e.y+o.z*e.z)/(r.x*r.x+r.y*r.y+r.z*r.z);t.x*=_,t.y*=_,t.z*=_;let h,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C,T,j,E=this.closest;s=E.x,n=E.y,a=E.z;let R=l.v;h=R.x,b=R.y,p=R.z;let D=l.w1;d=D.x,u=D.y,f=D.z;let F=l.w2;x=F.x,g=F.y,v=F.z;let q=c.v;y=q.x,X=q.y,z=q.z;let N=c.w1;M=N.x,Y=N.y,Z=N.z;let H=c.w2;w=H.x,I=H.y,V=H.z;let O=m.v;L=O.x,A=O.y,k=O.z;let W=m.w1;S=W.x,B=W.y,P=W.z;let G,U,J,$,K,Q,tt,it,st,nt=m.w2;C=nt.x,T=nt.y,j=nt.z,G=y-h,U=X-b,J=z-p,$=L-h,K=A-b,Q=k-p,tt=s-h,it=n-b,st=a-p;let at=G*G+U*U+J*J,ot=G*$+U*K+J*Q,et=$*$+K*K+Q*Q,rt=G*tt+U*it+J*st,_t=$*tt+K*it+Q*st,ht=at*et-ot*ot;0!=ht&&(ht=1/ht);let lt,ct,mt,bt,pt,dt,ut,ft,xt,gt=(rt*et-_t*ot)*ht,vt=(-rt*ot+_t*at)*ht;lt=M-d,ct=Y-u,mt=Z-f,bt=d+lt*gt,pt=u+ct*gt,dt=f+mt*gt,lt=S-d,ct=B-u,mt=P-f,bt+=lt*vt,pt+=ct*vt,dt+=mt*vt,lt=w-x,ct=I-g,mt=V-v,ut=x+lt*gt,ft=g+ct*gt,xt=v+mt*gt,lt=C-x,ct=T-g,mt=j-v,ut+=lt*vt,ft+=ct*vt,xt+=mt*vt;let yt=this.closestPoint1;yt.x=bt,yt.y=pt,yt.z=dt;let Xt=this.closestPoint2;Xt.x=ut,Xt.y=ft,Xt.z=xt;let zt=this.closest;return this.depth=Math.sqrt(zt.x*zt.x+zt.y*zt.y+zt.z*zt.z),Ut.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED}let u=this.polyhedron,f=u._vertexPool;null!=f?(u._vertexPool=f._next,f._next=null):f=new Ut.collision.narrowphase.detector.gjkepa.EpaVertex;let x=f.init(v,y,X);if(!this.polyhedron._addVertex(x,n))return Ut.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX;++z}return Ut.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE}computeClosestPoints(t,i,s,n,a){return this.computeClosestPointsImpl(t,i,s,n,a,!0)}computeDistance(t,i,s,n,a){return this.computeClosestPointsImpl(t,i,s,n,a,!1)}convexCast(t,i,s,n,a,o,e){return this.convexCastImpl(t,i,s,n,a,o,e)}rayCast(t,i,s,n,a){let o=this.tempTransform;o._positionX=s.x,o._positionY=s.y,o._positionZ=s.z;let e=this.tl1,r=this.tl2;return e.x=n.x,e.y=n.y,e.z=n.z,e.x-=s.x,e.y-=s.y,e.z-=s.z,r.zero(),this.convexCastImpl(null,t,o,i,e,r,a)}static getInstance(){return Ut.collision.narrowphase.detector.gjkepa.GjkEpa.instance}},Ut.collision.narrowphase.detector.gjkepa.GjkEpaLog=class{},Ut.collision.narrowphase.detector.gjkepa.GjkEpaResultState=class{},Ut.collision.narrowphase.detector.gjkepa.SimplexUtil=class{static projectOrigin2(t,i,s){let n,a,o,e,r,_,h,l,c;n=t.x,a=t.y,o=t.z,e=i.x,r=i.y,_=i.z,h=e-n,l=r-a,c=_-o;let m,b,p,d=h*n+l*a+c*o;return d=-d/(h*h+l*l+c*c),d<0?(s.x=n,s.y=a,s.z=o,1):d>1?(s.x=e,s.y=r,s.z=_,2):(m=n+h*d,b=a+l*d,p=o+c*d,s.x=m,s.y=b,s.z=p,3)}static projectOrigin3(t,i,s,n){let a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S;a=t.x,o=t.y,e=t.z,r=i.x,_=i.y,h=i.z,l=s.x,c=s.y,m=s.z,b=r-a,p=_-o,d=h-e,u=l-r,f=c-_,x=m-h,g=a-l,v=o-c,y=e-m,X=p*x-d*f,z=d*u-b*x,M=b*f-p*u,Y=p*M-d*z,Z=d*X-b*M,w=b*z-p*X,I=f*M-x*z,V=x*X-u*M,L=u*z-f*X,A=v*M-y*z,k=y*X-g*M,S=g*z-v*X;let B,P,C,T=-1,j=0;if(B=0,P=0,C=0,a*Y+o*Z+e*w<0){let s,a,o,e,r,_,h,l,c;s=t.x,a=t.y,o=t.z,e=i.x,r=i.y,_=i.z,h=e-s,l=r-a,c=_-o;let m,b=h*s+l*a+c*o;if(b=-b/(h*h+l*l+c*c),b<0)n.x=s,n.y=a,n.z=o,m=1;else if(b>1)n.x=e,n.y=r,n.z=_,m=2;else{let t,i,e;t=s+h*b,i=a+l*b,e=o+c*b,n.x=t,n.y=i,n.z=e,m=3}j=m,T=n.x*n.x+n.y*n.y+n.z*n.z,B=n.x,P=n.y,C=n.z}if(r*I+_*V+h*L<0){let t,a,o,e,r,_,h,l,c;t=i.x,a=i.y,o=i.z,e=s.x,r=s.y,_=s.z,h=e-t,l=r-a,c=_-o;let m,b=h*t+l*a+c*o;if(b=-b/(h*h+l*l+c*c),b<0)n.x=t,n.y=a,n.z=o,m=1;else if(b>1)n.x=e,n.y=r,n.z=_,m=2;else{let i,s,e;i=t+h*b,s=a+l*b,e=o+c*b,n.x=i,n.y=s,n.z=e,m=3}let p=n.x*n.x+n.y*n.y+n.z*n.z;(T<0||p<T)&&(j=m<<1,T=p,B=n.x,P=n.y,C=n.z)}if(l*A+c*k+m*S<0){let i,a,o,e,r,_,h,l,c;i=t.x,a=t.y,o=t.z,e=s.x,r=s.y,_=s.z,h=e-i,l=r-a,c=_-o;let m,b=h*i+l*a+c*o;if(b=-b/(h*h+l*l+c*c),b<0)n.x=i,n.y=a,n.z=o,m=1;else if(b>1)n.x=e,n.y=r,n.z=_,m=2;else{let t,s,e;t=i+h*b,s=a+l*b,e=o+c*b,n.x=t,n.y=s,n.z=e,m=3}let p=n.x*n.x+n.y*n.y+n.z*n.z;(T<0||p<T)&&(j=1&m|(2&m)<<1,T=p,B=n.x,P=n.y,C=n.z)}if(T>0)return n.x=B,n.y=P,n.z=C,j;let E=X*X+z*z+M*M;E>0&&(E=1/Math.sqrt(E)),X*=E,z*=E,M*=E;let R=X*X+z*z+M*M;return R=(a*X+o*z+e*M)/R,B=X*R,P=z*R,C=M*R,n.x=B,n.y=P,n.z=C,7}static projectOrigin4(t,i,s,n,a){let o,e,r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C,T,j,E,R,D,F,q;o=t.x,e=t.y,r=t.z,_=i.x,h=i.y,l=i.z,c=s.x,m=s.y,b=s.z,p=n.x,d=n.y,u=n.z,f=_-o,x=h-e,g=l-r,v=c-o,y=m-e,X=b-r,z=p-o,M=d-e,Y=u-r,Z=c-_,w=m-h,I=b-l,V=p-_,L=d-h,A=u-l,k=x*X-g*y,S=g*v-f*X,B=f*y-x*v,P=y*Y-X*M,C=X*z-v*Y,T=v*M-y*z,j=M*g-Y*x,E=Y*f-z*g,R=z*x-M*f,D=L*I-A*w,F=A*Z-V*I,q=V*w-L*Z;let N,H,O,W=f*D+x*F+g*q>0?1:-1,G=-1,U=0;if(N=0,H=0,O=0,(o*k+e*S+r*B)*W<0){let n,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S;n=t.x,o=t.y,e=t.z,r=i.x,_=i.y,h=i.z,l=s.x,c=s.y,m=s.z,b=r-n,p=_-o,d=h-e,u=l-r,f=c-_,x=m-h,g=n-l,v=o-c,y=e-m,X=p*x-d*f,z=d*u-b*x,M=b*f-p*u,Y=p*M-d*z,Z=d*X-b*M,w=b*z-p*X,I=f*M-x*z,V=x*X-u*M,L=u*z-f*X,A=v*M-y*z,k=y*X-g*M,S=g*z-v*X;let B,P,C,T,j=-1,E=0;if(B=0,P=0,C=0,n*Y+o*Z+e*w<0){let s,n,o,e,r,_,h,l,c;s=t.x,n=t.y,o=t.z,e=i.x,r=i.y,_=i.z,h=e-s,l=r-n,c=_-o;let m,b=h*s+l*n+c*o;if(b=-b/(h*h+l*l+c*c),b<0)a.x=s,a.y=n,a.z=o,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let t,i,e;t=s+h*b,i=n+l*b,e=o+c*b,a.x=t,a.y=i,a.z=e,m=3}E=m,j=a.x*a.x+a.y*a.y+a.z*a.z,B=a.x,P=a.y,C=a.z}if(r*I+_*V+h*L<0){let t,n,o,e,r,_,h,l,c;t=i.x,n=i.y,o=i.z,e=s.x,r=s.y,_=s.z,h=e-t,l=r-n,c=_-o;let m,b=h*t+l*n+c*o;if(b=-b/(h*h+l*l+c*c),b<0)a.x=t,a.y=n,a.z=o,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let i,s,e;i=t+h*b,s=n+l*b,e=o+c*b,a.x=i,a.y=s,a.z=e,m=3}let p=a.x*a.x+a.y*a.y+a.z*a.z;(j<0||p<j)&&(E=m<<1,j=p,B=a.x,P=a.y,C=a.z)}if(l*A+c*k+m*S<0){let i,n,o,e,r,_,h,l,c;i=t.x,n=t.y,o=t.z,e=s.x,r=s.y,_=s.z,h=e-i,l=r-n,c=_-o;let m,b=h*i+l*n+c*o;if(b=-b/(h*h+l*l+c*c),b<0)a.x=i,a.y=n,a.z=o,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let t,s,e;t=i+h*b,s=n+l*b,e=o+c*b,a.x=t,a.y=s,a.z=e,m=3}let p=a.x*a.x+a.y*a.y+a.z*a.z;(j<0||p<j)&&(E=1&m|(2&m)<<1,j=p,B=a.x,P=a.y,C=a.z)}if(j>0)a.x=B,a.y=P,a.z=C,T=E;else{let t=X*X+z*z+M*M;t>0&&(t=1/Math.sqrt(t)),X*=t,z*=t,M*=t;let i=X*X+z*z+M*M;i=(n*X+o*z+e*M)/i,B=X*i,P=z*i,C=M*i,a.x=B,a.y=P,a.z=C,T=7}U=T,G=a.x*a.x+a.y*a.y+a.z*a.z,N=a.x,H=a.y,O=a.z}if((o*P+e*C+r*T)*W<0){let i,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S;i=t.x,o=t.y,e=t.z,r=s.x,_=s.y,h=s.z,l=n.x,c=n.y,m=n.z,b=r-i,p=_-o,d=h-e,u=l-r,f=c-_,x=m-h,g=i-l,v=o-c,y=e-m,X=p*x-d*f,z=d*u-b*x,M=b*f-p*u,Y=p*M-d*z,Z=d*X-b*M,w=b*z-p*X,I=f*M-x*z,V=x*X-u*M,L=u*z-f*X,A=v*M-y*z,k=y*X-g*M,S=g*z-v*X;let B,P,C,T,j=-1,E=0;if(B=0,P=0,C=0,i*Y+o*Z+e*w<0){let i,n,o,e,r,_,h,l,c;i=t.x,n=t.y,o=t.z,e=s.x,r=s.y,_=s.z,h=e-i,l=r-n,c=_-o;let m,b=h*i+l*n+c*o;if(b=-b/(h*h+l*l+c*c),b<0)a.x=i,a.y=n,a.z=o,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let t,s,e;t=i+h*b,s=n+l*b,e=o+c*b,a.x=t,a.y=s,a.z=e,m=3}E=m,j=a.x*a.x+a.y*a.y+a.z*a.z,B=a.x,P=a.y,C=a.z}if(r*I+_*V+h*L<0){let t,i,o,e,r,_,h,l,c;t=s.x,i=s.y,o=s.z,e=n.x,r=n.y,_=n.z,h=e-t,l=r-i,c=_-o;let m,b=h*t+l*i+c*o;if(b=-b/(h*h+l*l+c*c),b<0)a.x=t,a.y=i,a.z=o,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let s,n,e;s=t+h*b,n=i+l*b,e=o+c*b,a.x=s,a.y=n,a.z=e,m=3}let p=a.x*a.x+a.y*a.y+a.z*a.z;(j<0||p<j)&&(E=m<<1,j=p,B=a.x,P=a.y,C=a.z)}if(l*A+c*k+m*S<0){let i,s,o,e,r,_,h,l,c;i=t.x,s=t.y,o=t.z,e=n.x,r=n.y,_=n.z,h=e-i,l=r-s,c=_-o;let m,b=h*i+l*s+c*o;if(b=-b/(h*h+l*l+c*c),b<0)a.x=i,a.y=s,a.z=o,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let t,n,e;t=i+h*b,n=s+l*b,e=o+c*b,a.x=t,a.y=n,a.z=e,m=3}let p=a.x*a.x+a.y*a.y+a.z*a.z;(j<0||p<j)&&(E=1&m|(2&m)<<1,j=p,B=a.x,P=a.y,C=a.z)}if(j>0)a.x=B,a.y=P,a.z=C,T=E;else{let t=X*X+z*z+M*M;t>0&&(t=1/Math.sqrt(t)),X*=t,z*=t,M*=t;let s=X*X+z*z+M*M;s=(i*X+o*z+e*M)/s,B=X*s,P=z*s,C=M*s,a.x=B,a.y=P,a.z=C,T=7}let R=a.x*a.x+a.y*a.y+a.z*a.z;(G<0||R<G)&&(U=1&T|(6&T)<<1,G=R,N=a.x,H=a.y,O=a.z)}if((o*j+e*E+r*R)*W<0){let s,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S;s=t.x,o=t.y,e=t.z,r=i.x,_=i.y,h=i.z,l=n.x,c=n.y,m=n.z,b=r-s,p=_-o,d=h-e,u=l-r,f=c-_,x=m-h,g=s-l,v=o-c,y=e-m,X=p*x-d*f,z=d*u-b*x,M=b*f-p*u,Y=p*M-d*z,Z=d*X-b*M,w=b*z-p*X,I=f*M-x*z,V=x*X-u*M,L=u*z-f*X,A=v*M-y*z,k=y*X-g*M,S=g*z-v*X;let B,P,C,T,j=-1,E=0;if(B=0,P=0,C=0,s*Y+o*Z+e*w<0){let s,n,o,e,r,_,h,l,c;s=t.x,n=t.y,o=t.z,e=i.x,r=i.y,_=i.z,h=e-s,l=r-n,c=_-o;let m,b=h*s+l*n+c*o;if(b=-b/(h*h+l*l+c*c),b<0)a.x=s,a.y=n,a.z=o,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let t,i,e;t=s+h*b,i=n+l*b,e=o+c*b,a.x=t,a.y=i,a.z=e,m=3}E=m,j=a.x*a.x+a.y*a.y+a.z*a.z,B=a.x,P=a.y,C=a.z}if(r*I+_*V+h*L<0){let t,s,o,e,r,_,h,l,c;t=i.x,s=i.y,o=i.z,e=n.x,r=n.y,_=n.z,h=e-t,l=r-s,c=_-o;let m,b=h*t+l*s+c*o;if(b=-b/(h*h+l*l+c*c),b<0)a.x=t,a.y=s,a.z=o,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let i,n,e;i=t+h*b,n=s+l*b,e=o+c*b,a.x=i,a.y=n,a.z=e,m=3}let p=a.x*a.x+a.y*a.y+a.z*a.z;(j<0||p<j)&&(E=m<<1,j=p,B=a.x,P=a.y,C=a.z)}if(l*A+c*k+m*S<0){let i,s,o,e,r,_,h,l,c;i=t.x,s=t.y,o=t.z,e=n.x,r=n.y,_=n.z,h=e-i,l=r-s,c=_-o;let m,b=h*i+l*s+c*o;if(b=-b/(h*h+l*l+c*c),b<0)a.x=i,a.y=s,a.z=o,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let t,n,e;t=i+h*b,n=s+l*b,e=o+c*b,a.x=t,a.y=n,a.z=e,m=3}let p=a.x*a.x+a.y*a.y+a.z*a.z;(j<0||p<j)&&(E=1&m|(2&m)<<1,j=p,B=a.x,P=a.y,C=a.z)}if(j>0)a.x=B,a.y=P,a.z=C,T=E;else{let t=X*X+z*z+M*M;t>0&&(t=1/Math.sqrt(t)),X*=t,z*=t,M*=t;let i=X*X+z*z+M*M;i=(s*X+o*z+e*M)/i,B=X*i,P=z*i,C=M*i,a.x=B,a.y=P,a.z=C,T=7}let R=a.x*a.x+a.y*a.y+a.z*a.z;(G<0||R<G)&&(U=3&T|(4&T)<<1,G=R,N=a.x,H=a.y,O=a.z)}if((_*D+h*F+l*q)*W<0){let t,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S;t=i.x,o=i.y,e=i.z,r=s.x,_=s.y,h=s.z,l=n.x,c=n.y,m=n.z,b=r-t,p=_-o,d=h-e,u=l-r,f=c-_,x=m-h,g=t-l,v=o-c,y=e-m,X=p*x-d*f,z=d*u-b*x,M=b*f-p*u,Y=p*M-d*z,Z=d*X-b*M,w=b*z-p*X,I=f*M-x*z,V=x*X-u*M,L=u*z-f*X,A=v*M-y*z,k=y*X-g*M,S=g*z-v*X;let B,P,C,T,j=-1,E=0;if(B=0,P=0,C=0,t*Y+o*Z+e*w<0){let t,n,o,e,r,_,h,l,c;t=i.x,n=i.y,o=i.z,e=s.x,r=s.y,_=s.z,h=e-t,l=r-n,c=_-o;let m,b=h*t+l*n+c*o;if(b=-b/(h*h+l*l+c*c),b<0)a.x=t,a.y=n,a.z=o,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let i,s,e;i=t+h*b,s=n+l*b,e=o+c*b,a.x=i,a.y=s,a.z=e,m=3}E=m,j=a.x*a.x+a.y*a.y+a.z*a.z,B=a.x,P=a.y,C=a.z}if(r*I+_*V+h*L<0){let t,i,o,e,r,_,h,l,c;t=s.x,i=s.y,o=s.z,e=n.x,r=n.y,_=n.z,h=e-t,l=r-i,c=_-o;let m,b=h*t+l*i+c*o;if(b=-b/(h*h+l*l+c*c),b<0)a.x=t,a.y=i,a.z=o,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let s,n,e;s=t+h*b,n=i+l*b,e=o+c*b,a.x=s,a.y=n,a.z=e,m=3}let p=a.x*a.x+a.y*a.y+a.z*a.z;(j<0||p<j)&&(E=m<<1,j=p,B=a.x,P=a.y,C=a.z)}if(l*A+c*k+m*S<0){let t,s,o,e,r,_,h,l,c;t=i.x,s=i.y,o=i.z,e=n.x,r=n.y,_=n.z,h=e-t,l=r-s,c=_-o;let m,b=h*t+l*s+c*o;if(b=-b/(h*h+l*l+c*c),b<0)a.x=t,a.y=s,a.z=o,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let i,n,e;i=t+h*b,n=s+l*b,e=o+c*b,a.x=i,a.y=n,a.z=e,m=3}let p=a.x*a.x+a.y*a.y+a.z*a.z;(j<0||p<j)&&(E=1&m|(2&m)<<1,j=p,B=a.x,P=a.y,C=a.z)}if(j>0)a.x=B,a.y=P,a.z=C,T=E;else{let i=X*X+z*z+M*M;i>0&&(i=1/Math.sqrt(i)),X*=i,z*=i,M*=i;let s=X*X+z*z+M*M;s=(t*X+o*z+e*M)/s,B=X*s,P=z*s,C=M*s,a.x=B,a.y=P,a.z=C,T=7}let R=a.x*a.x+a.y*a.y+a.z*a.z;(G<0||R<G)&&(U=T<<1,G=R,N=a.x,H=a.y,O=a.z)}return G>0?(a.x=N,a.y=H,a.z=O,U):(a.zero(),15)}},Ut.common.Mat3=class{constructor(t,i,s,n,a,o,e,r,_){null==_&&(_=1),null==r&&(r=0),null==e&&(e=0),null==o&&(o=0),null==a&&(a=1),null==n&&(n=0),null==s&&(s=0),null==i&&(i=0),null==t&&(t=1),this.e00=t,this.e01=i,this.e02=s,this.e10=n,this.e11=a,this.e12=o,this.e20=e,this.e21=r,this.e22=_,Ut.common.Mat3.numCreations++}init(t,i,s,n,a,o,e,r,_){return this.e00=t,this.e01=i,this.e02=s,this.e10=n,this.e11=a,this.e12=o,this.e20=e,this.e21=r,this.e22=_,this}identity(){return this.e00=1,this.e01=0,this.e02=0,this.e10=0,this.e11=1,this.e12=0,this.e20=0,this.e21=0,this.e22=1,this}add(t){return new Ut.common.Mat3(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22)}sub(t){return new Ut.common.Mat3(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22)}scale(t){return new Ut.common.Mat3(this.e00*t,this.e01*t,this.e02*t,this.e10*t,this.e11*t,this.e12*t,this.e20*t,this.e21*t,this.e22*t)}mul(t){return new Ut.common.Mat3(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22)}addEq(t){return this.e00+=t.e00,this.e01+=t.e01,this.e02+=t.e02,this.e10+=t.e10,this.e11+=t.e11,this.e12+=t.e12,this.e20+=t.e20,this.e21+=t.e21,this.e22+=t.e22,this}subEq(t){return this.e00-=t.e00,this.e01-=t.e01,this.e02-=t.e02,this.e10-=t.e10,this.e11-=t.e11,this.e12-=t.e12,this.e20-=t.e20,this.e21-=t.e21,this.e22-=t.e22,this}scaleEq(t){return this.e00*=t,this.e01*=t,this.e02*=t,this.e10*=t,this.e11*=t,this.e12*=t,this.e20*=t,this.e21*=t,this.e22*=t,this}mulEq(t){let i=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,s=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,n=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,a=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,o=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,e=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,r=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,_=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22;return this.e00=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e01=i,this.e02=s,this.e10=n,this.e11=a,this.e12=o,this.e20=e,this.e21=r,this.e22=_,this}prependScale(t,i,s){return new Ut.common.Mat3(this.e00*t,this.e01*t,this.e02*t,this.e10*i,this.e11*i,this.e12*i,this.e20*s,this.e21*s,this.e22*s)}appendScale(t,i,s){return new Ut.common.Mat3(this.e00*t,this.e01*i,this.e02*s,this.e10*t,this.e11*i,this.e12*s,this.e20*t,this.e21*i,this.e22*s)}prependRotation(t,i,s,n){let a=Math.sin(t),o=Math.cos(t),e=1-o,r=i*i*e+o,_=i*s*e-n*a,h=i*n*e+s*a,l=s*i*e+n*a,c=s*s*e+o,m=s*n*e-i*a,b=n*i*e-s*a,p=n*s*e+i*a,d=n*n*e+o;return new Ut.common.Mat3(r*this.e00+_*this.e10+h*this.e20,r*this.e01+_*this.e11+h*this.e21,r*this.e02+_*this.e12+h*this.e22,l*this.e00+c*this.e10+m*this.e20,l*this.e01+c*this.e11+m*this.e21,l*this.e02+c*this.e12+m*this.e22,b*this.e00+p*this.e10+d*this.e20,b*this.e01+p*this.e11+d*this.e21,b*this.e02+p*this.e12+d*this.e22)}appendRotation(t,i,s,n){let a=Math.sin(t),o=Math.cos(t),e=1-o,r=i*i*e+o,_=i*s*e-n*a,h=i*n*e+s*a,l=s*i*e+n*a,c=s*s*e+o,m=s*n*e-i*a,b=n*i*e-s*a,p=n*s*e+i*a,d=n*n*e+o;return new Ut.common.Mat3(this.e00*r+this.e01*l+this.e02*b,this.e00*_+this.e01*c+this.e02*p,this.e00*h+this.e01*m+this.e02*d,this.e10*r+this.e11*l+this.e12*b,this.e10*_+this.e11*c+this.e12*p,this.e10*h+this.e11*m+this.e12*d,this.e20*r+this.e21*l+this.e22*b,this.e20*_+this.e21*c+this.e22*p,this.e20*h+this.e21*m+this.e22*d)}prependScaleEq(t,i,s){return this.e00*=t,this.e01*=t,this.e02*=t,this.e10*=i,this.e11*=i,this.e12*=i,this.e20*=s,this.e21*=s,this.e22*=s,this}appendScaleEq(t,i,s){return this.e00*=t,this.e01*=i,this.e02*=s,this.e10*=t,this.e11*=i,this.e12*=s,this.e20*=t,this.e21*=i,this.e22*=s,this}prependRotationEq(t,i,s,n){let a=Math.sin(t),o=Math.cos(t),e=1-o,r=i*i*e+o,_=i*s*e-n*a,h=i*n*e+s*a,l=s*i*e+n*a,c=s*s*e+o,m=s*n*e-i*a,b=n*i*e-s*a,p=n*s*e+i*a,d=n*n*e+o,u=l*this.e00+c*this.e10+m*this.e20,f=l*this.e01+c*this.e11+m*this.e21,x=l*this.e02+c*this.e12+m*this.e22,g=b*this.e00+p*this.e10+d*this.e20,v=b*this.e01+p*this.e11+d*this.e21,y=b*this.e02+p*this.e12+d*this.e22;return this.e00=r*this.e00+_*this.e10+h*this.e20,this.e01=r*this.e01+_*this.e11+h*this.e21,this.e02=r*this.e02+_*this.e12+h*this.e22,this.e10=u,this.e11=f,this.e12=x,this.e20=g,this.e21=v,this.e22=y,this}appendRotationEq(t,i,s,n){let a=Math.sin(t),o=Math.cos(t),e=1-o,r=i*i*e+o,_=i*s*e-n*a,h=i*n*e+s*a,l=s*i*e+n*a,c=s*s*e+o,m=s*n*e-i*a,b=n*i*e-s*a,p=n*s*e+i*a,d=n*n*e+o,u=this.e00*_+this.e01*c+this.e02*p,f=this.e00*h+this.e01*m+this.e02*d,x=this.e10*_+this.e11*c+this.e12*p,g=this.e10*h+this.e11*m+this.e12*d,v=this.e20*_+this.e21*c+this.e22*p,y=this.e20*h+this.e21*m+this.e22*d;return this.e00=this.e00*r+this.e01*l+this.e02*b,this.e01=u,this.e02=f,this.e10=this.e10*r+this.e11*l+this.e12*b,this.e11=x,this.e12=g,this.e20=this.e20*r+this.e21*l+this.e22*b,this.e21=v,this.e22=y,this}transpose(){return new Ut.common.Mat3(this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22)}transposeEq(){let t=this.e01,i=this.e02,s=this.e12;return this.e01=this.e10,this.e02=this.e20,this.e10=t,this.e12=this.e21,this.e20=i,this.e21=s,this}determinant(){return this.e00*(this.e11*this.e22-this.e12*this.e21)-this.e01*(this.e10*this.e22-this.e12*this.e20)+this.e02*(this.e10*this.e21-this.e11*this.e20)}trace(){return this.e00+this.e11+this.e22}inverse(){let t=this.e11*this.e22-this.e12*this.e21,i=this.e10*this.e22-this.e12*this.e20,s=this.e10*this.e21-this.e11*this.e20,n=this.e00*t-this.e01*i+this.e02*s;return 0!=n&&(n=1/n),new Ut.common.Mat3(t*n,-(this.e01*this.e22-this.e02*this.e21)*n,(this.e01*this.e12-this.e02*this.e11)*n,-i*n,(this.e00*this.e22-this.e02*this.e20)*n,-(this.e00*this.e12-this.e02*this.e10)*n,s*n,-(this.e00*this.e21-this.e01*this.e20)*n,(this.e00*this.e11-this.e01*this.e10)*n)}inverseEq(){let t=this.e11*this.e22-this.e12*this.e21,i=this.e10*this.e22-this.e12*this.e20,s=this.e10*this.e21-this.e11*this.e20,n=this.e00*t-this.e01*i+this.e02*s;0!=n&&(n=1/n);let a=(this.e01*this.e12-this.e02*this.e11)*n,o=(this.e00*this.e22-this.e02*this.e20)*n,e=-(this.e00*this.e12-this.e02*this.e10)*n,r=-(this.e00*this.e21-this.e01*this.e20)*n,_=(this.e00*this.e11-this.e01*this.e10)*n;return this.e00=t*n,this.e01=-(this.e01*this.e22-this.e02*this.e21)*n,this.e02=a,this.e10=-i*n,this.e11=o,this.e12=e,this.e20=s*n,this.e21=r,this.e22=_,this}toArray(t){return null==t&&(t=!1),t?[this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22]:[this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22]}copyFrom(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this}clone(){return new Ut.common.Mat3(this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22)}fromQuat(t){let i=t.x,s=t.y,n=t.z,a=t.w,o=2*i,e=2*s,r=2*n,_=i*o,h=s*e,l=n*r,c=i*e,m=s*r,b=i*r,p=a*o,d=a*e,u=a*r;return this.e00=1-h-l,this.e01=c-u,this.e02=b+d,this.e10=c+u,this.e11=1-_-l,this.e12=m-p,this.e20=b-d,this.e21=m+p,this.e22=1-_-h,this}toQuat(){let t,i=new Ut.common.Quat,s=this.e00,n=this.e11,a=this.e22,o=s+n+a;return o>0?(t=Math.sqrt(o+1),i.w=.5*t,t=.5/t,i.x=(this.e21-this.e12)*t,i.y=(this.e02-this.e20)*t,i.z=(this.e10-this.e01)*t):s>n?s>a?(t=Math.sqrt(s-n-a+1),i.x=.5*t,t=.5/t,i.y=(this.e01+this.e10)*t,i.z=(this.e02+this.e20)*t,i.w=(this.e21-this.e12)*t):(t=Math.sqrt(a-s-n+1),i.z=.5*t,t=.5/t,i.x=(this.e02+this.e20)*t,i.y=(this.e12+this.e21)*t,i.w=(this.e10-this.e01)*t):n>a?(t=Math.sqrt(n-a-s+1),i.y=.5*t,t=.5/t,i.x=(this.e01+this.e10)*t,i.z=(this.e12+this.e21)*t,i.w=(this.e02-this.e20)*t):(t=Math.sqrt(a-s-n+1),i.z=.5*t,t=.5/t,i.x=(this.e02+this.e20)*t,i.y=(this.e12+this.e21)*t,i.w=(this.e10-this.e01)*t),i}fromEulerXyz(t){let i=Math.sin(t.x),s=Math.sin(t.y),n=Math.sin(t.z),a=Math.cos(t.x),o=Math.cos(t.y),e=Math.cos(t.z);return this.e00=o*e,this.e01=-o*n,this.e02=s,this.e10=a*n+e*i*s,this.e11=a*e-i*s*n,this.e12=-o*i,this.e20=i*n-a*e*s,this.e21=e*i+a*s*n,this.e22=a*o,this}toEulerXyz(){let t=this.e02;if(t<=-1){let t=Math.atan2(this.e21,this.e11);return new Ut.common.Vec3(.5*t,-1.570796326794895,.5*-t)}if(t>=1){let t=Math.atan2(this.e21,this.e11);return new Ut.common.Vec3(.5*t,1.570796326794895,.5*t)}return new Ut.common.Vec3(Math.atan2(-this.e12,this.e22),Math.asin(t),Math.atan2(-this.e01,this.e00))}getRow(t){return 0==t?new Ut.common.Vec3(this.e00,this.e01,this.e02):1==t?new Ut.common.Vec3(this.e10,this.e11,this.e12):2==t?new Ut.common.Vec3(this.e20,this.e21,this.e22):null}getCol(t){return 0==t?new Ut.common.Vec3(this.e00,this.e10,this.e20):1==t?new Ut.common.Vec3(this.e01,this.e11,this.e21):2==t?new Ut.common.Vec3(this.e02,this.e12,this.e22):null}getRowTo(t,i){0==t?i.init(this.e00,this.e01,this.e02):1==t?i.init(this.e10,this.e11,this.e12):2==t?i.init(this.e20,this.e21,this.e22):i.zero()}getColTo(t,i){0==t?i.init(this.e00,this.e10,this.e20):1==t?i.init(this.e01,this.e11,this.e21):2==t?i.init(this.e02,this.e12,this.e22):i.zero()}fromRows(t,i,s){return this.e00=t.x,this.e01=t.y,this.e02=t.z,this.e10=i.x,this.e11=i.y,this.e12=i.z,this.e20=s.x,this.e21=s.y,this.e22=s.z,this}fromCols(t,i,s){return this.e00=t.x,this.e01=i.x,this.e02=s.x,this.e10=t.y,this.e11=i.y,this.e12=s.y,this.e20=t.z,this.e21=i.z,this.e22=s.z,this}toString(){return"Mat3["+(this.e00>0?(1e7*this.e00+.5|0)/1e7:(1e7*this.e00-.5|0)/1e7)+", "+(this.e01>0?(1e7*this.e01+.5|0)/1e7:(1e7*this.e01-.5|0)/1e7)+", "+(this.e02>0?(1e7*this.e02+.5|0)/1e7:(1e7*this.e02-.5|0)/1e7)+",\n     "+(this.e10>0?(1e7*this.e10+.5|0)/1e7:(1e7*this.e10-.5|0)/1e7)+", "+(this.e11>0?(1e7*this.e11+.5|0)/1e7:(1e7*this.e11-.5|0)/1e7)+", "+(this.e12>0?(1e7*this.e12+.5|0)/1e7:(1e7*this.e12-.5|0)/1e7)+",\n     "+(this.e20>0?(1e7*this.e20+.5|0)/1e7:(1e7*this.e20-.5|0)/1e7)+", "+(this.e21>0?(1e7*this.e21+.5|0)/1e7:(1e7*this.e21-.5|0)/1e7)+", "+(this.e22>0?(1e7*this.e22+.5|0)/1e7:(1e7*this.e22-.5|0)/1e7)+"]"}},Ut.common.Mat4=class{constructor(t,i,s,n,a,o,e,r,_,h,l,c,m,b,p,d){null==d&&(d=1),null==p&&(p=0),null==b&&(b=0),null==m&&(m=0),null==c&&(c=0),null==l&&(l=1),null==h&&(h=0),null==_&&(_=0),null==r&&(r=0),null==e&&(e=0),null==o&&(o=1),null==a&&(a=0),null==n&&(n=0),null==s&&(s=0),null==i&&(i=0),null==t&&(t=1),this.e00=t,this.e01=i,this.e02=s,this.e03=n,this.e10=a,this.e11=o,this.e12=e,this.e13=r,this.e20=_,this.e21=h,this.e22=l,this.e23=c,this.e30=m,this.e31=b,this.e32=p,this.e33=d,Ut.common.Mat4.numCreations++}init(t,i,s,n,a,o,e,r,_,h,l,c,m,b,p,d){return this.e00=t,this.e01=i,this.e02=s,this.e03=n,this.e10=a,this.e11=o,this.e12=e,this.e13=r,this.e20=_,this.e21=h,this.e22=l,this.e23=c,this.e30=m,this.e31=b,this.e32=p,this.e33=d,this}identity(){return this.e00=1,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=1,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=1,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}add(t){return new Ut.common.Mat4(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e03+t.e03,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e13+t.e13,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22,this.e23+t.e23,this.e30+t.e30,this.e31+t.e31,this.e32+t.e32,this.e33+t.e33)}sub(t){return new Ut.common.Mat4(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e03-t.e03,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e13-t.e13,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22,this.e23-t.e23,this.e30-t.e30,this.e31-t.e31,this.e32-t.e32,this.e33-t.e33)}scale(t){return new Ut.common.Mat4(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*t,this.e11*t,this.e12*t,this.e13*t,this.e20*t,this.e21*t,this.e22*t,this.e23*t,this.e30*t,this.e31*t,this.e32*t,this.e33*t)}mul(t){return new Ut.common.Mat4(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33)}addEq(t){return this.e00+=t.e00,this.e01+=t.e01,this.e02+=t.e02,this.e03+=t.e03,this.e10+=t.e10,this.e11+=t.e11,this.e12+=t.e12,this.e13+=t.e13,this.e20+=t.e20,this.e21+=t.e21,this.e22+=t.e22,this.e23+=t.e23,this.e30+=t.e30,this.e31+=t.e31,this.e32+=t.e32,this.e33+=t.e33,this}subEq(t){return this.e00-=t.e00,this.e01-=t.e01,this.e02-=t.e02,this.e03-=t.e03,this.e10-=t.e10,this.e11-=t.e11,this.e12-=t.e12,this.e13-=t.e13,this.e20-=t.e20,this.e21-=t.e21,this.e22-=t.e22,this.e23-=t.e23,this.e30-=t.e30,this.e31-=t.e31,this.e32-=t.e32,this.e33-=t.e33,this}scaleEq(t){return this.e00*=t,this.e01*=t,this.e02*=t,this.e03*=t,this.e10*=t,this.e11*=t,this.e12*=t,this.e13*=t,this.e20*=t,this.e21*=t,this.e22*=t,this.e23*=t,this.e30*=t,this.e31*=t,this.e32*=t,this.e33*=t,this}mulEq(t){let i=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,s=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,n=this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,a=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,o=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,e=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,r=this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,_=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,h=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,l=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,c=this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,m=this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,b=this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,p=this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,d=this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33;return this.e00=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e01=i,this.e02=s,this.e03=n,this.e10=a,this.e11=o,this.e12=e,this.e13=r,this.e20=_,this.e21=h,this.e22=l,this.e23=c,this.e30=m,this.e31=b,this.e32=p,this.e33=d,this}prependScale(t,i,s){return new Ut.common.Mat4(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*i,this.e11*i,this.e12*i,this.e13*i,this.e20*s,this.e21*s,this.e22*s,this.e23*s,this.e30,this.e31,this.e32,this.e33)}appendScale(t,i,s){return new Ut.common.Mat4(this.e00*t,this.e01*i,this.e02*s,this.e03,this.e10*t,this.e11*i,this.e12*s,this.e13,this.e20*t,this.e21*i,this.e22*s,this.e23,this.e30*t,this.e31*i,this.e32*s,this.e33)}prependRotation(t,i,s,n){let a=Math.sin(t),o=Math.cos(t),e=1-o,r=i*i*e+o,_=i*s*e-n*a,h=i*n*e+s*a,l=s*i*e+n*a,c=s*s*e+o,m=s*n*e-i*a,b=n*i*e-s*a,p=n*s*e+i*a,d=n*n*e+o;return new Ut.common.Mat4(r*this.e00+_*this.e10+h*this.e20,r*this.e01+_*this.e11+h*this.e21,r*this.e02+_*this.e12+h*this.e22,r*this.e03+_*this.e13+h*this.e23,l*this.e00+c*this.e10+m*this.e20,l*this.e01+c*this.e11+m*this.e21,l*this.e02+c*this.e12+m*this.e22,l*this.e03+c*this.e13+m*this.e23,b*this.e00+p*this.e10+d*this.e20,b*this.e01+p*this.e11+d*this.e21,b*this.e02+p*this.e12+d*this.e22,b*this.e03+p*this.e13+d*this.e23,this.e30,this.e31,this.e32,this.e33)}appendRotation(t,i,s,n){let a=Math.sin(t),o=Math.cos(t),e=1-o,r=i*i*e+o,_=i*s*e-n*a,h=i*n*e+s*a,l=s*i*e+n*a,c=s*s*e+o,m=s*n*e-i*a,b=n*i*e-s*a,p=n*s*e+i*a,d=n*n*e+o;return new Ut.common.Mat4(this.e00*r+this.e01*l+this.e02*b,this.e00*_+this.e01*c+this.e02*p,this.e00*h+this.e01*m+this.e02*d,this.e03,this.e10*r+this.e11*l+this.e12*b,this.e10*_+this.e11*c+this.e12*p,this.e10*h+this.e11*m+this.e12*d,this.e13,this.e20*r+this.e21*l+this.e22*b,this.e20*_+this.e21*c+this.e22*p,this.e20*h+this.e21*m+this.e22*d,this.e23,this.e30*r+this.e31*l+this.e32*b,this.e30*_+this.e31*c+this.e32*p,this.e30*h+this.e31*m+this.e32*d,this.e33)}prependTranslation(t,i,s){return new Ut.common.Mat4(this.e00+t*this.e30,this.e01+t*this.e31,this.e02+t*this.e32,this.e03+t*this.e33,this.e10+i*this.e30,this.e11+i*this.e31,this.e12+i*this.e32,this.e13+i*this.e33,this.e20+s*this.e30,this.e21+s*this.e31,this.e22+s*this.e32,this.e23+s*this.e33,this.e30,this.e31,this.e32,this.e33)}appendTranslation(t,i,s){return new Ut.common.Mat4(this.e00,this.e01,this.e02,this.e00*t+this.e01*i+this.e02*s+this.e03,this.e10,this.e11,this.e12,this.e10*t+this.e11*i+this.e12*s+this.e13,this.e20,this.e21,this.e22,this.e20*t+this.e21*i+this.e22*s+this.e23,this.e30,this.e31,this.e32,this.e30*t+this.e31*i+this.e32*s+this.e33)}prependScaleEq(t,i,s){return this.e00*=t,this.e01*=t,this.e02*=t,this.e03*=t,this.e10*=i,this.e11*=i,this.e12*=i,this.e13*=i,this.e20*=s,this.e21*=s,this.e22*=s,this.e23*=s,this}appendScaleEq(t,i,s){return this.e00*=t,this.e01*=i,this.e02*=s,this.e10*=t,this.e11*=i,this.e12*=s,this.e20*=t,this.e21*=i,this.e22*=s,this.e30*=t,this.e31*=i,this.e32*=s,this}prependRotationEq(t,i,s,n){let a=Math.sin(t),o=Math.cos(t),e=1-o,r=i*i*e+o,_=i*s*e-n*a,h=i*n*e+s*a,l=s*i*e+n*a,c=s*s*e+o,m=s*n*e-i*a,b=n*i*e-s*a,p=n*s*e+i*a,d=n*n*e+o,u=l*this.e00+c*this.e10+m*this.e20,f=l*this.e01+c*this.e11+m*this.e21,x=l*this.e02+c*this.e12+m*this.e22,g=l*this.e03+c*this.e13+m*this.e23,v=b*this.e00+p*this.e10+d*this.e20,y=b*this.e01+p*this.e11+d*this.e21,X=b*this.e02+p*this.e12+d*this.e22,z=b*this.e03+p*this.e13+d*this.e23;return this.e00=r*this.e00+_*this.e10+h*this.e20,this.e01=r*this.e01+_*this.e11+h*this.e21,this.e02=r*this.e02+_*this.e12+h*this.e22,this.e03=r*this.e03+_*this.e13+h*this.e23,this.e10=u,this.e11=f,this.e12=x,this.e13=g,this.e20=v,this.e21=y,this.e22=X,this.e23=z,this}appendRotationEq(t,i,s,n){let a=Math.sin(t),o=Math.cos(t),e=1-o,r=i*i*e+o,_=i*s*e-n*a,h=i*n*e+s*a,l=s*i*e+n*a,c=s*s*e+o,m=s*n*e-i*a,b=n*i*e-s*a,p=n*s*e+i*a,d=n*n*e+o,u=this.e00*_+this.e01*c+this.e02*p,f=this.e00*h+this.e01*m+this.e02*d,x=this.e10*_+this.e11*c+this.e12*p,g=this.e10*h+this.e11*m+this.e12*d,v=this.e20*_+this.e21*c+this.e22*p,y=this.e20*h+this.e21*m+this.e22*d,X=this.e30*_+this.e31*c+this.e32*p,z=this.e30*h+this.e31*m+this.e32*d;return this.e00=this.e00*r+this.e01*l+this.e02*b,this.e01=u,this.e02=f,this.e10=this.e10*r+this.e11*l+this.e12*b,this.e11=x,this.e12=g,this.e20=this.e20*r+this.e21*l+this.e22*b,this.e21=v,this.e22=y,this.e30=this.e30*r+this.e31*l+this.e32*b,this.e31=X,this.e32=z,this}prependTranslationEq(t,i,s){return this.e00+=t*this.e30,this.e01+=t*this.e31,this.e02+=t*this.e32,this.e03+=t*this.e33,this.e10+=i*this.e30,this.e11+=i*this.e31,this.e12+=i*this.e32,this.e13+=i*this.e33,this.e20+=s*this.e30,this.e21+=s*this.e31,this.e22+=s*this.e32,this.e23+=s*this.e33,this}appendTranslationEq(t,i,s){let n=this.e00*t+this.e01*i+this.e02*s+this.e03,a=this.e10*t+this.e11*i+this.e12*s+this.e13,o=this.e20*t+this.e21*i+this.e22*s+this.e23,e=this.e30*t+this.e31*i+this.e32*s+this.e33;return this.e03=n,this.e13=a,this.e23=o,this.e33=e,this}transpose(){return new Ut.common.Mat4(this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33)}transposeEq(){let t=this.e01,i=this.e02,s=this.e12,n=this.e03,a=this.e13,o=this.e23;return this.e01=this.e10,this.e02=this.e20,this.e03=this.e30,this.e10=t,this.e12=this.e21,this.e13=this.e31,this.e20=i,this.e21=s,this.e23=this.e32,this.e30=n,this.e31=a,this.e32=o,this}determinant(){let t=this.e20*this.e31-this.e21*this.e30,i=this.e20*this.e32-this.e22*this.e30,s=this.e20*this.e33-this.e23*this.e30,n=this.e21*this.e32-this.e22*this.e31,a=this.e21*this.e33-this.e23*this.e31,o=this.e22*this.e33-this.e23*this.e32;return this.e00*(this.e11*o-this.e12*a+this.e13*n)-this.e01*(this.e10*o-this.e12*s+this.e13*i)+this.e02*(this.e10*a-this.e11*s+this.e13*t)-this.e03*(this.e10*n-this.e11*i+this.e12*t)}trace(){return this.e00+this.e11+this.e22+this.e33}inverse(){let t=this.e00*this.e11-this.e01*this.e10,i=this.e00*this.e12-this.e02*this.e10,s=this.e00*this.e13-this.e03*this.e10,n=this.e01*this.e12-this.e02*this.e11,a=this.e01*this.e13-this.e03*this.e11,o=this.e02*this.e13-this.e03*this.e12,e=this.e20*this.e31-this.e21*this.e30,r=this.e20*this.e32-this.e22*this.e30,_=this.e20*this.e33-this.e23*this.e30,h=this.e21*this.e32-this.e22*this.e31,l=this.e21*this.e33-this.e23*this.e31,c=this.e22*this.e33-this.e23*this.e32,m=this.e11*c-this.e12*l+this.e13*h,b=this.e10*c-this.e12*_+this.e13*r,p=this.e10*l-this.e11*_+this.e13*e,d=this.e10*h-this.e11*r+this.e12*e,u=this.e00*m-this.e01*b+this.e02*p-this.e03*d;return 0!=u&&(u=1/u),new Ut.common.Mat4(m*u,-(this.e01*c-this.e02*l+this.e03*h)*u,(this.e31*o-this.e32*a+this.e33*n)*u,-(this.e21*o-this.e22*a+this.e23*n)*u,-b*u,(this.e00*c-this.e02*_+this.e03*r)*u,-(this.e30*o-this.e32*s+this.e33*i)*u,(this.e20*o-this.e22*s+this.e23*i)*u,p*u,-(this.e00*l-this.e01*_+this.e03*e)*u,(this.e30*a-this.e31*s+this.e33*t)*u,-(this.e20*a-this.e21*s+this.e23*t)*u,-d*u,(this.e00*h-this.e01*r+this.e02*e)*u,-(this.e30*n-this.e31*i+this.e32*t)*u,(this.e20*n-this.e21*i+this.e22*t)*u)}inverseEq(){let t=this.e00*this.e11-this.e01*this.e10,i=this.e00*this.e12-this.e02*this.e10,s=this.e00*this.e13-this.e03*this.e10,n=this.e01*this.e12-this.e02*this.e11,a=this.e01*this.e13-this.e03*this.e11,o=this.e02*this.e13-this.e03*this.e12,e=this.e20*this.e31-this.e21*this.e30,r=this.e20*this.e32-this.e22*this.e30,_=this.e20*this.e33-this.e23*this.e30,h=this.e21*this.e32-this.e22*this.e31,l=this.e21*this.e33-this.e23*this.e31,c=this.e22*this.e33-this.e23*this.e32,m=this.e11*c-this.e12*l+this.e13*h,b=this.e10*c-this.e12*_+this.e13*r,p=this.e10*l-this.e11*_+this.e13*e,d=this.e10*h-this.e11*r+this.e12*e,u=this.e00*m-this.e01*b+this.e02*p-this.e03*d;0!=u&&(u=1/u);let f=(this.e00*c-this.e02*_+this.e03*r)*u,x=-(this.e00*l-this.e01*_+this.e03*e)*u,g=-(this.e20*a-this.e21*s+this.e23*t)*u,v=(this.e00*h-this.e01*r+this.e02*e)*u,y=-(this.e30*n-this.e31*i+this.e32*t)*u,X=(this.e20*n-this.e21*i+this.e22*t)*u;return this.e00=m*u,this.e01=-(this.e01*c-this.e02*l+this.e03*h)*u,this.e02=(this.e31*o-this.e32*a+this.e33*n)*u,this.e03=-(this.e21*o-this.e22*a+this.e23*n)*u,this.e10=-b*u,this.e11=f,this.e12=-(this.e30*o-this.e32*s+this.e33*i)*u,this.e13=(this.e20*o-this.e22*s+this.e23*i)*u,this.e20=p*u,this.e21=x,this.e22=(this.e30*a-this.e31*s+this.e33*t)*u,this.e23=g,this.e30=-d*u,this.e31=v,this.e32=y,this.e33=X,this}lookAt(t,i,s,n,a,o,e,r,_){let h=t-n,l=i-a,c=s-o,m=1/Math.sqrt(h*h+l*l+c*c);h*=m,l*=m,c*=m;let b=r*c-_*l,p=_*h-e*c,d=e*l-r*h;m=1/Math.sqrt(b*b+p*p+d*d),b*=m,p*=m,d*=m;let u=l*d-c*p,f=c*b-h*d,x=h*p-l*b;return this.e00=b,this.e01=p,this.e02=d,this.e03=-(b*t+p*i+d*s),this.e10=u,this.e11=f,this.e12=x,this.e13=-(u*t+f*i+x*s),this.e20=h,this.e21=l,this.e22=c,this.e23=-(h*t+l*i+c*s),this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}perspective(t,i,s,n){let a=1/Math.tan(.5*t),o=n/(s-n);return this.e00=a/i,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=a,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=o,this.e23=s*o,this.e30=0,this.e31=0,this.e32=-1,this.e33=0,this}ortho(t,i,s,n){let a=1/(s-n);return this.e00=2/t,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=2/i,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=a,this.e23=s*a,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}toArray(t){return null==t&&(t=!1),t?[this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33]:[this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33]}copyFrom(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e03=t.e03,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e13=t.e13,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this.e23=t.e23,this.e30=t.e30,this.e31=t.e31,this.e32=t.e32,this.e33=t.e33,this}fromMat3(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e03=0,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e13=0,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}fromTransform(t){return this.e00=t._rotation00,this.e01=t._rotation01,this.e02=t._rotation02,this.e10=t._rotation10,this.e11=t._rotation11,this.e12=t._rotation12,this.e20=t._rotation20,this.e21=t._rotation21,this.e22=t._rotation22,this.e03=t._positionX,this.e13=t._positionY,this.e23=t._positionZ,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}clone(){return new Ut.common.Mat4(this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33)}toString(){return"Mat4["+(this.e00>0?(1e7*this.e00+.5|0)/1e7:(1e7*this.e00-.5|0)/1e7)+", "+(this.e01>0?(1e7*this.e01+.5|0)/1e7:(1e7*this.e01-.5|0)/1e7)+", "+(this.e02>0?(1e7*this.e02+.5|0)/1e7:(1e7*this.e02-.5|0)/1e7)+", "+(this.e03>0?(1e7*this.e03+.5|0)/1e7:(1e7*this.e03-.5|0)/1e7)+",\n    "+(this.e10>0?(1e7*this.e10+.5|0)/1e7:(1e7*this.e10-.5|0)/1e7)+", "+(this.e11>0?(1e7*this.e11+.5|0)/1e7:(1e7*this.e11-.5|0)/1e7)+", "+(this.e12>0?(1e7*this.e12+.5|0)/1e7:(1e7*this.e12-.5|0)/1e7)+", "+(this.e13>0?(1e7*this.e13+.5|0)/1e7:(1e7*this.e13-.5|0)/1e7)+",\n    "+(this.e20>0?(1e7*this.e20+.5|0)/1e7:(1e7*this.e20-.5|0)/1e7)+", "+(this.e21>0?(1e7*this.e21+.5|0)/1e7:(1e7*this.e21-.5|0)/1e7)+", "+(this.e22>0?(1e7*this.e22+.5|0)/1e7:(1e7*this.e22-.5|0)/1e7)+", "+(this.e23>0?(1e7*this.e23+.5|0)/1e7:(1e7*this.e23-.5|0)/1e7)+",\n    "+(this.e30>0?(1e7*this.e30+.5|0)/1e7:(1e7*this.e30-.5|0)/1e7)+", "+(this.e31>0?(1e7*this.e31+.5|0)/1e7:(1e7*this.e31-.5|0)/1e7)+", "+(this.e32>0?(1e7*this.e32+.5|0)/1e7:(1e7*this.e32-.5|0)/1e7)+", "+(this.e33>0?(1e7*this.e33+.5|0)/1e7:(1e7*this.e33-.5|0)/1e7)+"]"}},Ut.common.MathUtil=class{static abs(t){return t>0?t:-t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static tan(t){return Math.tan(t)}static asin(t){return Math.asin(t)}static acos(t){return Math.acos(t)}static atan(t){return Math.atan(t)}static safeAsin(t){return t<=-1?-1.570796326794895:t>=1?1.570796326794895:Math.asin(t)}static safeAcos(t){return t<=-1?3.14159265358979:t>=1?0:Math.acos(t)}static atan2(t,i){return Math.atan2(t,i)}static sqrt(t){return Math.sqrt(t)}static clamp(t,i,s){return t<i?i:t>s?s:t}static rand(){return Math.random()}static randIn(t,i){return t+Math.random()*(i-t)}static randVec3In(t,i){return new Ut.common.Vec3(t+Math.random()*(i-t),t+Math.random()*(i-t),t+Math.random()*(i-t))}static randVec3(){return new Ut.common.Vec3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1)}},Ut.common.Pool=class{constructor(){this.stackVec3=new Array(256),this.sizeVec3=0,this.stackMat3=new Array(256),this.sizeMat3=0,this.stackMat4=new Array(256),this.sizeMat4=0,this.stackQuat=new Array(256),this.sizeQuat=0}vec3(){return 0==this.sizeVec3?new Ut.common.Vec3:this.stackVec3[--this.sizeVec3]}mat3(){return 0==this.sizeMat3?new Ut.common.Mat3:this.stackMat3[--this.sizeMat3]}mat4(){return 0==this.sizeMat4?new Ut.common.Mat4:this.stackMat4[--this.sizeMat4]}quat(){return 0==this.sizeQuat?new Ut.common.Quat:this.stackQuat[--this.sizeQuat]}dispose(t,i,s,n){if(null!=t){if(t.zero(),this.sizeVec3==this.stackVec3.length){let t=new Array(this.sizeVec3<<1),i=0,s=this.sizeVec3;for(;i<s;){let s=i++;t[s]=this.stackVec3[s],this.stackVec3[s]=null}this.stackVec3=t}this.stackVec3[this.sizeVec3++]=t}if(null!=i){if(i.e00=1,i.e01=0,i.e02=0,i.e10=0,i.e11=1,i.e12=0,i.e20=0,i.e21=0,i.e22=1,this.sizeMat3==this.stackMat3.length){let t=new Array(this.sizeMat3<<1),i=0,s=this.sizeMat3;for(;i<s;){let s=i++;t[s]=this.stackMat3[s],this.stackMat3[s]=null}this.stackMat3=t}this.stackMat3[this.sizeMat3++]=i}if(null!=s){if(s.e00=1,s.e01=0,s.e02=0,s.e03=0,s.e10=0,s.e11=1,s.e12=0,s.e13=0,s.e20=0,s.e21=0,s.e22=1,s.e23=0,s.e30=0,s.e31=0,s.e32=0,s.e33=1,this.sizeMat4==this.stackMat4.length){let t=new Array(this.sizeMat4<<1),i=0,s=this.sizeMat4;for(;i<s;){let s=i++;t[s]=this.stackMat4[s],this.stackMat4[s]=null}this.stackMat4=t}this.stackMat4[this.sizeMat4++]=s}if(null!=n){if(n.x=0,n.y=0,n.z=0,n.w=1,this.sizeQuat==this.stackQuat.length){let t=new Array(this.sizeQuat<<1),i=0,s=this.sizeQuat;for(;i<s;){let s=i++;t[s]=this.stackQuat[s],this.stackQuat[s]=null}this.stackQuat=t}this.stackQuat[this.sizeQuat++]=n}}disposeVec3(t){if(t.zero(),this.sizeVec3==this.stackVec3.length){let t=new Array(this.sizeVec3<<1),i=0,s=this.sizeVec3;for(;i<s;){let s=i++;t[s]=this.stackVec3[s],this.stackVec3[s]=null}this.stackVec3=t}this.stackVec3[this.sizeVec3++]=t}disposeMat3(t){if(t.e00=1,t.e01=0,t.e02=0,t.e10=0,t.e11=1,t.e12=0,t.e20=0,t.e21=0,t.e22=1,this.sizeMat3==this.stackMat3.length){let t=new Array(this.sizeMat3<<1),i=0,s=this.sizeMat3;for(;i<s;){let s=i++;t[s]=this.stackMat3[s],this.stackMat3[s]=null}this.stackMat3=t}this.stackMat3[this.sizeMat3++]=t}disposeMat4(t){if(t.e00=1,t.e01=0,t.e02=0,t.e03=0,t.e10=0,t.e11=1,t.e12=0,t.e13=0,t.e20=0,t.e21=0,t.e22=1,t.e23=0,t.e30=0,t.e31=0,t.e32=0,t.e33=1,this.sizeMat4==this.stackMat4.length){let t=new Array(this.sizeMat4<<1),i=0,s=this.sizeMat4;for(;i<s;){let s=i++;t[s]=this.stackMat4[s],this.stackMat4[s]=null}this.stackMat4=t}this.stackMat4[this.sizeMat4++]=t}disposeQuat(t){if(t.x=0,t.y=0,t.z=0,t.w=1,this.sizeQuat==this.stackQuat.length){let t=new Array(this.sizeQuat<<1),i=0,s=this.sizeQuat;for(;i<s;){let s=i++;t[s]=this.stackQuat[s],this.stackQuat[s]=null}this.stackQuat=t}this.stackQuat[this.sizeQuat++]=t}},Ut.common.Quat=class{constructor(t,i,s,n){null==n&&(n=1),null==s&&(s=0),null==i&&(i=0),null==t&&(t=0),this.x=t,this.y=i,this.z=s,this.w=n,Ut.common.Quat.numCreations++}identity(){return this.x=0,this.y=0,this.z=0,this.w=1,this}init(t,i,s,n){return this.x=t,this.y=i,this.z=s,this.w=n,this}add(t){return new Ut.common.Quat(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}sub(t){return new Ut.common.Quat(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}scale(t){return new Ut.common.Quat(this.x*t,this.y*t,this.z*t,this.w*t)}addEq(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}subEq(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}scaleEq(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}normalized(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t>0&&(t=1/t),new Ut.common.Quat(this.x*t,this.y*t,this.z*t,this.w*t)}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t>0&&(t=1/t),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}setArc(t,i){let s=t.x,n=t.y,a=t.z,o=i.x,e=i.y,r=i.z,_=s*o+n*e+a*r;return this.w=Math.sqrt(.5*(1+_)),0==this.w?(o=s*s,e=n*n,r=a*a,o<e?o<r?(_=1/Math.sqrt(e+r),this.x=0,this.y=a*_,this.z=-n*_):(_=1/Math.sqrt(o+e),this.z=0,this.x=n*_,this.y=-s*_):e<r?(_=1/Math.sqrt(r+o),this.y=0,this.z=s*_,this.x=-a*_):(_=1/Math.sqrt(o+e),this.z=0,this.x=n*_,this.y=-s*_),this):(_=.5/this.w,this.x=(n*r-a*e)*_,this.y=(a*o-s*r)*_,this.z=(s*e-n*o)*_,this)}slerp(t,i){let s,n,a,o,e=this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w;if(e<0?(e=-e,s=-t.x,n=-t.y,a=-t.z,o=-t.w):(s=t.x,n=t.y,a=t.z,o=t.w),e>.999999){let t=new Ut.common.Quat(this.x+(s-this.x)*i,this.y+(n-this.y)*i,this.z+(a-this.z)*i,this.w+(o-this.w)*i),e=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w);return e>0&&(e=1/e),t.x*=e,t.y*=e,t.z*=e,t.w*=e,t}let r=i*Math.acos(e);s-=this.x*e,n-=this.y*e,a-=this.z*e,o-=this.w*e;let _=1/Math.sqrt(s*s+n*n+a*a+o*o);s*=_,n*=_,a*=_,o*=_;let h=Math.sin(r),l=Math.cos(r);return new Ut.common.Quat(this.x*l+s*h,this.y*l+n*h,this.z*l+a*h,this.w*l+o*h)}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}clone(){return new Ut.common.Quat(this.x,this.y,this.z,this.w)}fromMat3(t){let i,s=t.e00,n=t.e11,a=t.e22,o=s+n+a;return o>0?(i=Math.sqrt(o+1),this.w=.5*i,i=.5/i,this.x=(t.e21-t.e12)*i,this.y=(t.e02-t.e20)*i,this.z=(t.e10-t.e01)*i):s>n?s>a?(i=Math.sqrt(s-n-a+1),this.x=.5*i,i=.5/i,this.y=(t.e01+t.e10)*i,this.z=(t.e02+t.e20)*i,this.w=(t.e21-t.e12)*i):(i=Math.sqrt(a-s-n+1),this.z=.5*i,i=.5/i,this.x=(t.e02+t.e20)*i,this.y=(t.e12+t.e21)*i,this.w=(t.e10-t.e01)*i):n>a?(i=Math.sqrt(n-a-s+1),this.y=.5*i,i=.5/i,this.x=(t.e01+t.e10)*i,this.z=(t.e12+t.e21)*i,this.w=(t.e02-t.e20)*i):(i=Math.sqrt(a-s-n+1),this.z=.5*i,i=.5/i,this.x=(t.e02+t.e20)*i,this.y=(t.e12+t.e21)*i,this.w=(t.e10-t.e01)*i),this}toMat3(){let t=new Ut.common.Mat3,i=this.x,s=this.y,n=this.z,a=this.w,o=2*i,e=2*s,r=2*n,_=i*o,h=s*e,l=n*r,c=i*e,m=s*r,b=i*r,p=a*o,d=a*e,u=a*r;return t.e00=1-h-l,t.e01=c-u,t.e02=b+d,t.e10=c+u,t.e11=1-_-l,t.e12=m-p,t.e20=b-d,t.e21=m+p,t.e22=1-_-h,t}toString(){return"Quat["+(this.x>0?(1e7*this.x+.5|0)/1e7:(1e7*this.x-.5|0)/1e7)+" i,\n    "+(this.y>0?(1e7*this.y+.5|0)/1e7:(1e7*this.y-.5|0)/1e7)+" j,\n    "+(this.z>0?(1e7*this.z+.5|0)/1e7:(1e7*this.z-.5|0)/1e7)+" k,\n    "+(this.w>0?(1e7*this.w+.5|0)/1e7:(1e7*this.w-.5|0)/1e7)+"]"}},Ut.dynamics||(Ut.dynamics={}),Ut.dynamics.Contact=class{constructor(){this._next=null,this._prev=null,this._link1=new Ut.dynamics.ContactLink,this._link2=new Ut.dynamics.ContactLink,this._s1=null,this._s2=null,this._b1=null,this._b2=null,this._detector=null,this._cachedDetectorData=new Ut.collision.narrowphase.detector.CachedDetectorData,this._detectorResult=new Ut.collision.narrowphase.DetectorResult,this._latest=!1,this._shouldBeSkipped=!1,this._manifold=new Ut.dynamics.constraint.contact.Manifold,this._updater=new Ut.dynamics.constraint.contact.ManifoldUpdater(this._manifold),this._contactConstraint=new Ut.dynamics.constraint.contact.ContactConstraint(this._manifold),this._touching=!1}_updateManifold(){if(null==this._detector)return;let t=this._touching,i=this._detectorResult;if(this._detector.detect(i,this._s1._geom,this._s2._geom,this._s1._transform,this._s2._transform,this._cachedDetectorData),this._touching=i.numPoints>0,this._touching?(this._manifold._buildBasis(i.normal),i.getMaxDepth()>Ut.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold?this._contactConstraint._positionCorrectionAlgorithm=Ut.common.Setting.alternativeContactPositionCorrectionAlgorithm:this._contactConstraint._positionCorrectionAlgorithm=Ut.common.Setting.defaultContactPositionCorrectionAlgorithm,i.incremental?this._updater.incrementalUpdate(i,this._b1._transform,this._b2._transform):this._updater.totalUpdate(i,this._b1._transform,this._b2._transform)):this._manifold._clear(),this._touching&&!t){let t=this._s1._contactCallback,i=this._s2._contactCallback;t==i&&(i=null),null!=t&&t.beginContact(this),null!=i&&i.beginContact(this)}if(!this._touching&&t){let t=this._s1._contactCallback,i=this._s2._contactCallback;t==i&&(i=null),null!=t&&t.endContact(this),null!=i&&i.endContact(this)}if(this._touching){let t=this._s1._contactCallback,i=this._s2._contactCallback;t==i&&(i=null),null!=t&&t.preSolve(this),null!=i&&i.preSolve(this)}}_postSolve(){let t=this._s1._contactCallback,i=this._s2._contactCallback;t==i&&(i=null),null!=t&&t.postSolve(this),null!=i&&i.postSolve(this)}getShape1(){return this._s1}getShape2(){return this._s2}isTouching(){return this._touching}getManifold(){return this._manifold}getContactConstraint(){return this._contactConstraint}getPrev(){return this._prev}getNext(){return this._next}},Ut.dynamics.ContactLink=class{constructor(){this._prev=null,this._next=null,this._contact=null,this._other=null}getContact(){return this._contact}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}},Ut.dynamics.ContactManager=class{constructor(t){this._broadPhase=t,this._collisionMatrix=new Ut.collision.narrowphase.CollisionMatrix,this._numContacts=0}createContacts(){let t=this._broadPhase._proxyPairList;for(;null!=t;){let i=t._next;for(;;){let i,s;if(t._p1._id<t._p2._id?(i=t._p1.userData,s=t._p2.userData):(i=t._p2.userData,s=t._p1.userData),!this.shouldCollide(i,s))break;let n,a=i._rigidBody,o=s._rigidBody;n=a._numContactLinks<o._numContactLinks?a._contactLinkList:o._contactLinkList;let e=i._id,r=s._id,_=!1;for(;null!=n;){let t=n._contact;if(t._s1._id==e&&t._s2._id==r){t._latest=!0,_=!0;break}n=n._next}if(!_){let t=this._contactPool;null!=t?(this._contactPool=t._next,t._next=null):t=new Ut.dynamics.Contact;let n=t;null==this._contactList?(this._contactList=n,this._contactListLast=n):(this._contactListLast._next=n,n._prev=this._contactListLast,this._contactListLast=n),n._latest=!0;let a=this._collisionMatrix.detectors[i._geom._type][s._geom._type];n._s1=i,n._s2=s,n._b1=i._rigidBody,n._b2=s._rigidBody,n._touching=!1,null==n._b1._contactLinkList?(n._b1._contactLinkList=n._link1,n._b1._contactLinkListLast=n._link1):(n._b1._contactLinkListLast._next=n._link1,n._link1._prev=n._b1._contactLinkListLast,n._b1._contactLinkListLast=n._link1),null==n._b2._contactLinkList?(n._b2._contactLinkList=n._link2,n._b2._contactLinkListLast=n._link2):(n._b2._contactLinkListLast._next=n._link2,n._link2._prev=n._b2._contactLinkListLast,n._b2._contactLinkListLast=n._link2),n._b1._numContactLinks++,n._b2._numContactLinks++,n._link1._other=n._b2,n._link2._other=n._b1,n._link1._contact=n,n._link2._contact=n,n._detector=a;let o=n._contactConstraint;o._s1=i,o._s2=s,o._b1=o._s1._rigidBody,o._b2=o._s2._rigidBody,o._tf1=o._b1._transform,o._tf2=o._b2._transform,this._numContacts++}break}t=i}}destroyOutdatedContacts(){let t=this._broadPhase._incremental,i=this._contactList;for(;null!=i;){let s=i._next;for(;;){if(i._latest){i._latest=!1,i._shouldBeSkipped=!1;break}if(!t){let t=i._prev,s=i._next;if(null!=t&&(t._next=s),null!=s&&(s._prev=t),i==this._contactList&&(this._contactList=this._contactList._next),i==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),i._next=null,i._prev=null,i._touching){let t=i._s1._contactCallback,s=i._s2._contactCallback;t==s&&(s=null),null!=t&&t.endContact(i),null!=s&&s.endContact(i)}let n=i._link1._prev,a=i._link1._next;null!=n&&(n._next=a),null!=a&&(a._prev=n),i._link1==i._b1._contactLinkList&&(i._b1._contactLinkList=i._b1._contactLinkList._next),i._link1==i._b1._contactLinkListLast&&(i._b1._contactLinkListLast=i._b1._contactLinkListLast._prev),i._link1._next=null,i._link1._prev=null;let o=i._link2._prev,e=i._link2._next;null!=o&&(o._next=e),null!=e&&(e._prev=o),i._link2==i._b2._contactLinkList&&(i._b2._contactLinkList=i._b2._contactLinkList._next),i._link2==i._b2._contactLinkListLast&&(i._b2._contactLinkListLast=i._b2._contactLinkListLast._prev),i._link2._next=null,i._link2._prev=null,i._b1._numContactLinks--,i._b2._numContactLinks--,i._link1._other=null,i._link2._other=null,i._link1._contact=null,i._link2._contact=null,i._s1=null,i._s2=null,i._b1=null,i._b2=null,i._touching=!1,i._cachedDetectorData._clear(),i._manifold._clear(),i._detector=null;let r=i._contactConstraint;r._s1=null,r._s2=null,r._b1=null,r._b2=null,r._tf1=null,r._tf2=null,i._next=this._contactPool,this._contactPool=i,this._numContacts--;break}let s=i._s1,n=i._s2,a=s._rigidBody,o=n._rigidBody;if((a._sleeping||1==a._type)&&(o._sleeping||1==o._type)){i._shouldBeSkipped=!0;break}let e=s._aabb,r=n._aabb,_=s._proxy,h=n._proxy;if(!(_._aabbMinX<h._aabbMaxX&&_._aabbMaxX>h._aabbMinX&&_._aabbMinY<h._aabbMaxY&&_._aabbMaxY>h._aabbMinY&&_._aabbMinZ<h._aabbMaxZ&&_._aabbMaxZ>h._aabbMinZ&&this.shouldCollide(s,n))){let t=i._prev,s=i._next;if(null!=t&&(t._next=s),null!=s&&(s._prev=t),i==this._contactList&&(this._contactList=this._contactList._next),i==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),i._next=null,i._prev=null,i._touching){let t=i._s1._contactCallback,s=i._s2._contactCallback;t==s&&(s=null),null!=t&&t.endContact(i),null!=s&&s.endContact(i)}let n=i._link1._prev,a=i._link1._next;null!=n&&(n._next=a),null!=a&&(a._prev=n),i._link1==i._b1._contactLinkList&&(i._b1._contactLinkList=i._b1._contactLinkList._next),i._link1==i._b1._contactLinkListLast&&(i._b1._contactLinkListLast=i._b1._contactLinkListLast._prev),i._link1._next=null,i._link1._prev=null;let o=i._link2._prev,e=i._link2._next;null!=o&&(o._next=e),null!=e&&(e._prev=o),i._link2==i._b2._contactLinkList&&(i._b2._contactLinkList=i._b2._contactLinkList._next),i._link2==i._b2._contactLinkListLast&&(i._b2._contactLinkListLast=i._b2._contactLinkListLast._prev),i._link2._next=null,i._link2._prev=null,i._b1._numContactLinks--,i._b2._numContactLinks--,i._link1._other=null,i._link2._other=null,i._link1._contact=null,i._link2._contact=null,i._s1=null,i._s2=null,i._b1=null,i._b2=null,i._touching=!1,i._cachedDetectorData._clear(),i._manifold._clear(),i._detector=null;let r=i._contactConstraint;r._s1=null,r._s2=null,r._b1=null,r._b2=null,r._tf1=null,r._tf2=null,i._next=this._contactPool,this._contactPool=i,this._numContacts--;break}i._shouldBeSkipped=!(e._minX<r._maxX&&e._maxX>r._minX&&e._minY<r._maxY&&e._maxY>r._minY&&e._minZ<r._maxZ&&e._maxZ>r._minZ);break}i=s}}shouldCollide(t,i){let s,n,a=t._rigidBody,o=i._rigidBody;if(a==o)return!1;if(0!=a._type&&0!=o._type)return!1;if(0==(t._collisionGroup&i._collisionMask)||0==(i._collisionGroup&t._collisionMask))return!1;for(a._numJointLinks<o._numJointLinks?(s=a._jointLinkList,n=o):(s=o._jointLinkList,n=a);null!=s;){if(s._other==n&&!s._joint._allowCollision)return!1;s=s._next}return!0}_updateContacts(){this._broadPhase.collectPairs(),this.createContacts(),this.destroyOutdatedContacts()}_postSolve(){let t=this._contactList;for(;null!=t;){let i=t._next;t._touching&&t._postSolve(),t=i}}getNumContacts(){return this._numContacts}getContactList(){return this._contactList}},Ut.dynamics.Island=class{constructor(){this.rigidBodies=new Array(Ut.common.Setting.islandInitialRigidBodyArraySize),this.solvers=new Array(Ut.common.Setting.islandInitialConstraintArraySize),this.solversSi=new Array(Ut.common.Setting.islandInitialConstraintArraySize),this.solversNgs=new Array(Ut.common.Setting.islandInitialConstraintArraySize),this.numRigidBodies=0,this.numSolvers=0,this.numSolversSi=0,this.numSolversNgs=0}_clear(){for(;this.numRigidBodies>0;)this.rigidBodies[--this.numRigidBodies]=null;for(;this.numSolvers>0;)this.solvers[--this.numSolvers]=null;for(;this.numSolversSi>0;)this.solversSi[--this.numSolversSi]=null;for(;this.numSolversNgs>0;)this.solversNgs[--this.numSolversNgs]=null}_addRigidBody(t){if(this.numRigidBodies==this.rigidBodies.length){let t=new Array(this.numRigidBodies<<1),i=0,s=this.numRigidBodies;for(;i<s;){let s=i++;t[s]=this.rigidBodies[s],this.rigidBodies[s]=null}this.rigidBodies=t}t._addedToIsland=!0,this.rigidBodies[this.numRigidBodies++]=t}_addConstraintSolver(t,i){if(this.numSolvers==this.solvers.length){let t=new Array(this.numSolvers<<1),i=0,s=this.numSolvers;for(;i<s;){let s=i++;t[s]=this.solvers[s],this.solvers[s]=null}this.solvers=t}if(t._addedToIsland=!0,this.solvers[this.numSolvers++]=t,i==Ut.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE){if(this.numSolversSi==this.solversSi.length){let t=new Array(this.numSolversSi<<1),i=0,s=this.numSolversSi;for(;i<s;){let s=i++;t[s]=this.solversSi[s],this.solversSi[s]=null}this.solversSi=t}this.solversSi[this.numSolversSi++]=t}if(i==Ut.dynamics.constraint.PositionCorrectionAlgorithm.NGS){if(this.numSolversNgs==this.solversNgs.length){let t=new Array(this.numSolversNgs<<1),i=0,s=this.numSolversNgs;for(;i<s;){let s=i++;t[s]=this.solversNgs[s],this.solversNgs[s]=null}this.solversNgs=t}this.solversNgs[this.numSolversNgs++]=t}}_stepSingleRigidBody(t,i){let s=t.dt,n=i._ptransform,a=i._transform;if(n._positionX=a._positionX,n._positionY=a._positionY,n._positionZ=a._positionZ,n._rotation00=a._rotation00,n._rotation01=a._rotation01,n._rotation02=a._rotation02,n._rotation10=a._rotation10,n._rotation11=a._rotation11,n._rotation12=a._rotation12,n._rotation20=a._rotation20,n._rotation21=a._rotation21,n._rotation22=a._rotation22,i._linearContactImpulseX=0,i._linearContactImpulseY=0,i._linearContactImpulseZ=0,i._angularContactImpulseX=0,i._angularContactImpulseY=0,i._angularContactImpulseZ=0,i._autoSleep&&i._velX*i._velX+i._velY*i._velY+i._velZ*i._velZ<Ut.common.Setting.sleepingVelocityThreshold*Ut.common.Setting.sleepingVelocityThreshold&&i._angVelX*i._angVelX+i._angVelY*i._angVelY+i._angVelZ*i._angVelZ<Ut.common.Setting.sleepingAngularVelocityThreshold*Ut.common.Setting.sleepingAngularVelocityThreshold?(i._sleepTime+=s,i._sleepTime>Ut.common.Setting.sleepingTimeThreshold&&(i._sleeping=!0,i._sleepTime=0)):i._sleepTime=0,!i._sleeping){if(0==i._type){let t,n,a,o,e,r,_,h,l,c=s*i._linearDamping,m=c*c,b=1/(1+c+m*(.5+.16666666666666666*c+.041666666666666664*m)),p=s*i._angularDamping,d=p*p,u=1/(1+p+d*(.5+.16666666666666666*p+.041666666666666664*d));t=this.gravityX*i._gravityScale,n=this.gravityY*i._gravityScale,a=this.gravityZ*i._gravityScale,t+=i._forceX*i._invMass,n+=i._forceY*i._invMass,a+=i._forceZ*i._invMass,_=i._invInertia00*i._torqueX+i._invInertia01*i._torqueY+i._invInertia02*i._torqueZ,h=i._invInertia10*i._torqueX+i._invInertia11*i._torqueY+i._invInertia12*i._torqueZ,l=i._invInertia20*i._torqueX+i._invInertia21*i._torqueY+i._invInertia22*i._torqueZ,o=_,e=h,r=l,i._velX+=t*s,i._velY+=n*s,i._velZ+=a*s,i._velX*=b,i._velY*=b,i._velZ*=b,i._angVelX+=o*s,i._angVelY+=e*s,i._angVelZ+=r*s,i._angVelX*=u,i._angVelY*=u,i._angVelZ*=u}i._integrate(s);let t=i._shapeList;for(;null!=t;){let s,n,a,o,e,r,_,h,l,c,m,b,p=t._next,d=i._ptransform,u=i._transform,f=t._ptransform,x=t._localTransform;s=d._rotation00*x._rotation00+d._rotation01*x._rotation10+d._rotation02*x._rotation20,n=d._rotation00*x._rotation01+d._rotation01*x._rotation11+d._rotation02*x._rotation21,a=d._rotation00*x._rotation02+d._rotation01*x._rotation12+d._rotation02*x._rotation22,o=d._rotation10*x._rotation00+d._rotation11*x._rotation10+d._rotation12*x._rotation20,e=d._rotation10*x._rotation01+d._rotation11*x._rotation11+d._rotation12*x._rotation21,r=d._rotation10*x._rotation02+d._rotation11*x._rotation12+d._rotation12*x._rotation22,_=d._rotation20*x._rotation00+d._rotation21*x._rotation10+d._rotation22*x._rotation20,h=d._rotation20*x._rotation01+d._rotation21*x._rotation11+d._rotation22*x._rotation21,l=d._rotation20*x._rotation02+d._rotation21*x._rotation12+d._rotation22*x._rotation22,f._rotation00=s,f._rotation01=n,f._rotation02=a,f._rotation10=o,f._rotation11=e,f._rotation12=r,f._rotation20=_,f._rotation21=h,f._rotation22=l,c=d._rotation00*x._positionX+d._rotation01*x._positionY+d._rotation02*x._positionZ,m=d._rotation10*x._positionX+d._rotation11*x._positionY+d._rotation12*x._positionZ,b=d._rotation20*x._positionX+d._rotation21*x._positionY+d._rotation22*x._positionZ,f._positionX=c,f._positionY=m,f._positionZ=b,f._positionX+=d._positionX,f._positionY+=d._positionY,f._positionZ+=d._positionZ;let g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C,T=t._transform,j=t._localTransform;if(g=u._rotation00*j._rotation00+u._rotation01*j._rotation10+u._rotation02*j._rotation20,v=u._rotation00*j._rotation01+u._rotation01*j._rotation11+u._rotation02*j._rotation21,y=u._rotation00*j._rotation02+u._rotation01*j._rotation12+u._rotation02*j._rotation22,X=u._rotation10*j._rotation00+u._rotation11*j._rotation10+u._rotation12*j._rotation20,z=u._rotation10*j._rotation01+u._rotation11*j._rotation11+u._rotation12*j._rotation21,M=u._rotation10*j._rotation02+u._rotation11*j._rotation12+u._rotation12*j._rotation22,Y=u._rotation20*j._rotation00+u._rotation21*j._rotation10+u._rotation22*j._rotation20,Z=u._rotation20*j._rotation01+u._rotation21*j._rotation11+u._rotation22*j._rotation21,w=u._rotation20*j._rotation02+u._rotation21*j._rotation12+u._rotation22*j._rotation22,T._rotation00=g,T._rotation01=v,T._rotation02=y,T._rotation10=X,T._rotation11=z,T._rotation12=M,T._rotation20=Y,T._rotation21=Z,T._rotation22=w,I=u._rotation00*j._positionX+u._rotation01*j._positionY+u._rotation02*j._positionZ,V=u._rotation10*j._positionX+u._rotation11*j._positionY+u._rotation12*j._positionZ,L=u._rotation20*j._positionX+u._rotation21*j._positionY+u._rotation22*j._positionZ,T._positionX=I,T._positionY=V,T._positionZ=L,T._positionX+=u._positionX,T._positionY+=u._positionY,T._positionZ+=u._positionZ,t._geom._computeAabb(t._aabb,t._ptransform),A=t._aabb._minX,k=t._aabb._minY,S=t._aabb._minZ,B=t._aabb._maxX,P=t._aabb._maxY,C=t._aabb._maxZ,t._geom._computeAabb(t._aabb,t._transform),t._aabb._minX=A<t._aabb._minX?A:t._aabb._minX,t._aabb._minY=k<t._aabb._minY?k:t._aabb._minY,t._aabb._minZ=S<t._aabb._minZ?S:t._aabb._minZ,t._aabb._maxX=B>t._aabb._maxX?B:t._aabb._maxX,t._aabb._maxY=P>t._aabb._maxY?P:t._aabb._maxY,t._aabb._maxZ=C>t._aabb._maxZ?C:t._aabb._maxZ,null!=t._proxy){let i,s,n;i=t._transform._positionX-t._ptransform._positionX,s=t._transform._positionY-t._ptransform._positionY,n=t._transform._positionZ-t._ptransform._positionZ;let a=t.displacement;a.x=i,a.y=s,a.z=n,t._rigidBody._world._broadPhase.moveProxy(t._proxy,t._aabb,t.displacement)}t=p}}}_step(t,i,s){let n=t.dt,a=!0,o=0,e=this.numRigidBodies;for(;o<e;){let t=this.rigidBodies[o++],i=t._ptransform,s=t._transform;if(i._positionX=s._positionX,i._positionY=s._positionY,i._positionZ=s._positionZ,i._rotation00=s._rotation00,i._rotation01=s._rotation01,i._rotation02=s._rotation02,i._rotation10=s._rotation10,i._rotation11=s._rotation11,i._rotation12=s._rotation12,i._rotation20=s._rotation20,i._rotation21=s._rotation21,i._rotation22=s._rotation22,t._linearContactImpulseX=0,t._linearContactImpulseY=0,t._linearContactImpulseZ=0,t._angularContactImpulseX=0,t._angularContactImpulseY=0,t._angularContactImpulseZ=0,t._sleeping=!1,t._autoSleep&&t._velX*t._velX+t._velY*t._velY+t._velZ*t._velZ<Ut.common.Setting.sleepingVelocityThreshold*Ut.common.Setting.sleepingVelocityThreshold&&t._angVelX*t._angVelX+t._angVelY*t._angVelY+t._angVelZ*t._angVelZ<Ut.common.Setting.sleepingAngularVelocityThreshold*Ut.common.Setting.sleepingAngularVelocityThreshold?t._sleepTime+=n:t._sleepTime=0,t._sleepTime<Ut.common.Setting.sleepingTimeThreshold&&(a=!1),0==t._type){let i,s,a,o,e,r,_,h,l,c=n*t._linearDamping,m=c*c,b=1/(1+c+m*(.5+.16666666666666666*c+.041666666666666664*m)),p=n*t._angularDamping,d=p*p,u=1/(1+p+d*(.5+.16666666666666666*p+.041666666666666664*d));i=this.gravityX*t._gravityScale,s=this.gravityY*t._gravityScale,a=this.gravityZ*t._gravityScale,i+=t._forceX*t._invMass,s+=t._forceY*t._invMass,a+=t._forceZ*t._invMass,_=t._invInertia00*t._torqueX+t._invInertia01*t._torqueY+t._invInertia02*t._torqueZ,h=t._invInertia10*t._torqueX+t._invInertia11*t._torqueY+t._invInertia12*t._torqueZ,l=t._invInertia20*t._torqueX+t._invInertia21*t._torqueY+t._invInertia22*t._torqueZ,o=_,e=h,r=l,t._velX+=i*n,t._velY+=s*n,t._velZ+=a*n,t._velX*=b,t._velY*=b,t._velZ*=b,t._angVelX+=o*n,t._angVelY+=e*n,t._angVelZ+=r*n,t._angVelX*=u,t._angVelY*=u,t._angVelZ*=u}}if(a){let t=0,i=this.numRigidBodies;for(;t<i;){let i=this.rigidBodies[t++];i._sleeping=!0,i._sleepTime=0}return}let r=0,_=this.numSolvers;for(;r<_;)this.solvers[r++].preSolveVelocity(t);let h=0,l=this.numSolvers;for(;h<l;)this.solvers[h++].warmStart(t);let c=0;for(;c<i;){++c;let t=0,i=this.numSolvers;for(;t<i;)this.solvers[t++].solveVelocity()}let m=0,b=this.numSolvers;for(;m<b;)this.solvers[m++].postSolveVelocity(t);let p=0,d=this.numRigidBodies;for(;p<d;)this.rigidBodies[p++]._integrate(n);let u=0,f=this.numSolversSi;for(;u<f;)this.solversSi[u++].preSolvePosition(t);let x=0;for(;x<s;){++x;let t=0,i=this.numSolversSi;for(;t<i;)this.solversSi[t++].solvePositionSplitImpulse()}let g=0,v=this.numRigidBodies;for(;g<v;)this.rigidBodies[g++]._integratePseudoVelocity();let y=0,X=this.numSolversNgs;for(;y<X;)this.solversNgs[y++].preSolvePosition(t);let z=0;for(;z<s;){++z;let i=0,s=this.numSolversNgs;for(;i<s;)this.solversNgs[i++].solvePositionNgs(t)}let M=0,Y=this.numSolvers;for(;M<Y;)this.solvers[M++].postSolve();let Z=0,w=this.numRigidBodies;for(;Z<w;){let t=this.rigidBodies[Z++],i=t._shapeList;for(;null!=i;){let s,n,a,o,e,r,_,h,l,c,m,b,p=i._next,d=t._ptransform,u=t._transform,f=i._ptransform,x=i._localTransform;s=d._rotation00*x._rotation00+d._rotation01*x._rotation10+d._rotation02*x._rotation20,n=d._rotation00*x._rotation01+d._rotation01*x._rotation11+d._rotation02*x._rotation21,a=d._rotation00*x._rotation02+d._rotation01*x._rotation12+d._rotation02*x._rotation22,o=d._rotation10*x._rotation00+d._rotation11*x._rotation10+d._rotation12*x._rotation20,e=d._rotation10*x._rotation01+d._rotation11*x._rotation11+d._rotation12*x._rotation21,r=d._rotation10*x._rotation02+d._rotation11*x._rotation12+d._rotation12*x._rotation22,_=d._rotation20*x._rotation00+d._rotation21*x._rotation10+d._rotation22*x._rotation20,h=d._rotation20*x._rotation01+d._rotation21*x._rotation11+d._rotation22*x._rotation21,l=d._rotation20*x._rotation02+d._rotation21*x._rotation12+d._rotation22*x._rotation22,f._rotation00=s,f._rotation01=n,f._rotation02=a,f._rotation10=o,f._rotation11=e,f._rotation12=r,f._rotation20=_,f._rotation21=h,f._rotation22=l,c=d._rotation00*x._positionX+d._rotation01*x._positionY+d._rotation02*x._positionZ,m=d._rotation10*x._positionX+d._rotation11*x._positionY+d._rotation12*x._positionZ,b=d._rotation20*x._positionX+d._rotation21*x._positionY+d._rotation22*x._positionZ,f._positionX=c,f._positionY=m,f._positionZ=b,f._positionX+=d._positionX,f._positionY+=d._positionY,f._positionZ+=d._positionZ;let g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C,T=i._transform,j=i._localTransform;if(g=u._rotation00*j._rotation00+u._rotation01*j._rotation10+u._rotation02*j._rotation20,v=u._rotation00*j._rotation01+u._rotation01*j._rotation11+u._rotation02*j._rotation21,y=u._rotation00*j._rotation02+u._rotation01*j._rotation12+u._rotation02*j._rotation22,X=u._rotation10*j._rotation00+u._rotation11*j._rotation10+u._rotation12*j._rotation20,z=u._rotation10*j._rotation01+u._rotation11*j._rotation11+u._rotation12*j._rotation21,M=u._rotation10*j._rotation02+u._rotation11*j._rotation12+u._rotation12*j._rotation22,Y=u._rotation20*j._rotation00+u._rotation21*j._rotation10+u._rotation22*j._rotation20,Z=u._rotation20*j._rotation01+u._rotation21*j._rotation11+u._rotation22*j._rotation21,w=u._rotation20*j._rotation02+u._rotation21*j._rotation12+u._rotation22*j._rotation22,T._rotation00=g,T._rotation01=v,T._rotation02=y,T._rotation10=X,T._rotation11=z,T._rotation12=M,T._rotation20=Y,T._rotation21=Z,T._rotation22=w,I=u._rotation00*j._positionX+u._rotation01*j._positionY+u._rotation02*j._positionZ,V=u._rotation10*j._positionX+u._rotation11*j._positionY+u._rotation12*j._positionZ,L=u._rotation20*j._positionX+u._rotation21*j._positionY+u._rotation22*j._positionZ,T._positionX=I,T._positionY=V,T._positionZ=L,T._positionX+=u._positionX,T._positionY+=u._positionY,T._positionZ+=u._positionZ,i._geom._computeAabb(i._aabb,i._ptransform),A=i._aabb._minX,k=i._aabb._minY,S=i._aabb._minZ,B=i._aabb._maxX,P=i._aabb._maxY,C=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=A<i._aabb._minX?A:i._aabb._minX,i._aabb._minY=k<i._aabb._minY?k:i._aabb._minY,i._aabb._minZ=S<i._aabb._minZ?S:i._aabb._minZ,i._aabb._maxX=B>i._aabb._maxX?B:i._aabb._maxX,i._aabb._maxY=P>i._aabb._maxY?P:i._aabb._maxY,i._aabb._maxZ=C>i._aabb._maxZ?C:i._aabb._maxZ,null!=i._proxy){let t,s,n;t=i._transform._positionX-i._ptransform._positionX,s=i._transform._positionY-i._ptransform._positionY,n=i._transform._positionZ-i._ptransform._positionZ;let a=i.displacement;a.x=t,a.y=s,a.z=n,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=p}}}},Ut.dynamics.TimeStep=class{constructor(){this.dt=0,this.invDt=0,this.dtRatio=1}},Ut.dynamics.World=class{constructor(t,i){switch(null==t&&(t=2),t){case 1:this._broadPhase=new Ut.collision.broadphase.bruteforce.BruteForceBroadPhase;break;case 2:this._broadPhase=new Ut.collision.broadphase.bvh.BvhBroadPhase}this._contactManager=new Ut.dynamics.ContactManager(this._broadPhase),null==i&&(i=new Ut.common.Vec3(0,-9.80665,0)),this._gravity=new Ut.common.Vec3(i.x,i.y,i.z),this._rigidBodyList=null,this._rigidBodyListLast=null,this._jointList=null,this._jointListLast=null,this._numRigidBodies=0,this._numShapes=0,this._numJoints=0,this._numIslands=0,this._numVelocityIterations=10,this._numPositionIterations=5,this._rayCastWrapper=new Ut.dynamics._World.RayCastWrapper,this._convexCastWrapper=new Ut.dynamics._World.ConvexCastWrapper,this._aabbTestWrapper=new Ut.dynamics._World.AabbTestWrapper,this._island=new Ut.dynamics.Island,this._solversInIslands=new Array(Ut.common.Setting.islandInitialConstraintArraySize),this._rigidBodyStack=new Array(Ut.common.Setting.islandInitialRigidBodyArraySize),this._timeStep=new Ut.dynamics.TimeStep,this._pool=new Ut.common.Pool,this._shapeIdCount=0}_updateContacts(){let t=Date.now()/1e3;this._contactManager._updateContacts(),Ut.dynamics.common.Performance.broadPhaseCollisionTime=1e3*(Date.now()/1e3-t);let i=Date.now()/1e3,s=this._contactManager._contactList;for(;null!=s;){let t=s._next;s._shouldBeSkipped||s._updateManifold(),s=t}Ut.dynamics.common.Performance.narrowPhaseCollisionTime=1e3*(Date.now()/1e3-i)}_solveIslands(){let t=Date.now()/1e3;if(Ut.common.Setting.disableSleeping){let t=this._rigidBodyList;for(;null!=t;)t._sleeping=!1,t._sleepTime=0,t=t._next}if(this._rigidBodyStack.length<this._numRigidBodies){let t=this._rigidBodyStack.length<<1;for(;t<this._numRigidBodies;)t<<=1;this._rigidBodyStack=new Array(t)}this._numIslands=0;let i=this._island,s=this._gravity;i.gravityX=s.x,i.gravityY=s.y,i.gravityZ=s.z;let n=this._rigidBodyList;for(this._numSolversInIslands=0;null!=n;){let t=n._next;for(;!n._addedToIsland&&!n._sleeping&&1!=n._type;){if(0==n._numContactLinks&&0==n._numJointLinks){this._island._stepSingleRigidBody(this._timeStep,n),this._numIslands++;break}this.buildIsland(n),this._island._step(this._timeStep,this._numVelocityIterations,this._numPositionIterations),this._island._clear(),this._numIslands++;break}n=t}for(this._contactManager._postSolve(),n=this._rigidBodyList;null!=n;)n._addedToIsland=!1,n=n._next;for(n=this._rigidBodyList;null!=n;)n._forceX=0,n._forceY=0,n._forceZ=0,n._torqueX=0,n._torqueY=0,n._torqueZ=0,n=n._next;for(;this._numSolversInIslands>0;)this._solversInIslands[--this._numSolversInIslands]._addedToIsland=!1,this._solversInIslands[this._numSolversInIslands]=null;Ut.dynamics.common.Performance.dynamicsTime=1e3*(Date.now()/1e3-t)}buildIsland(t){let i=1;for(this._island._addRigidBody(t),this._rigidBodyStack[0]=t;i>0;){let t=this._rigidBodyStack[--i];if(this._rigidBodyStack[i]=null,1==t._type)continue;let s=t._contactLinkList;for(;null!=s;){let t=s._next,n=s._contact._contactConstraint,a=s._contact._contactConstraint._solver;if(n.isTouching()&&!a._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){let t=new Array(this._numSolversInIslands<<1),i=0,s=this._numSolversInIslands;for(;i<s;){let s=i++;t[s]=this._solversInIslands[s],this._solversInIslands[s]=null}this._solversInIslands=t}this._solversInIslands[this._numSolversInIslands++]=a,this._island._addConstraintSolver(a,n._positionCorrectionAlgorithm);let t=s._other;t._addedToIsland||(this._island._addRigidBody(t),this._rigidBodyStack[i++]=t)}s=t}let n=t._jointLinkList;for(;null!=n;){let t=n._next,s=n._joint,a=s._solver;if(!a._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){let t=new Array(this._numSolversInIslands<<1),i=0,s=this._numSolversInIslands;for(;i<s;){let s=i++;t[s]=this._solversInIslands[s],this._solversInIslands[s]=null}this._solversInIslands=t}this._solversInIslands[this._numSolversInIslands++]=a,this._island._addConstraintSolver(a,s._positionCorrectionAlgorithm);let t=n._other;t._addedToIsland||(this._island._addRigidBody(t),this._rigidBodyStack[i++]=t)}n=t}}}_drawBvh(t,i){t.drawBvh&&this._drawBvhNode(t,i._root,0,t.style.bvhNodeColor)}_drawBvhNode(t,i,s,n){if(null!=i){if(s>=t.drawBvhMinLevel&&s<=t.drawBvhMaxLevel){let s=this._pool,a=0==s.sizeVec3?new Ut.common.Vec3:s.stackVec3[--s.sizeVec3],o=this._pool,e=0==o.sizeVec3?new Ut.common.Vec3:o.stackVec3[--o.sizeVec3],r=a;r.x=i._aabbMinX,r.y=i._aabbMinY,r.z=i._aabbMinZ;let _=e;_.x=i._aabbMaxX,_.y=i._aabbMaxY,_.z=i._aabbMaxZ,t.aabb(a,e,n);let h=this._pool;if(null!=a){if(a.zero(),h.sizeVec3==h.stackVec3.length){let t=new Array(h.sizeVec3<<1),i=0,s=h.sizeVec3;for(;i<s;){let s=i++;t[s]=h.stackVec3[s],h.stackVec3[s]=null}h.stackVec3=t}h.stackVec3[h.sizeVec3++]=a}let l=this._pool;if(null!=e){if(e.zero(),l.sizeVec3==l.stackVec3.length){let t=new Array(l.sizeVec3<<1),i=0,s=l.sizeVec3;for(;i<s;){let s=i++;t[s]=l.stackVec3[s],l.stackVec3[s]=null}l.stackVec3=t}l.stackVec3[l.sizeVec3++]=e}}this._drawBvhNode(t,i._children[0],s+1,n),this._drawBvhNode(t,i._children[1],s+1,n)}}_drawRigidBodies(t){let i=t.style,s=this._rigidBodyList;for(;null!=s;){let n=s._next;if(t.drawBases){let i=t.style;t.basis(s._transform,i.basisLength,i.basisColorX,i.basisColorY,i.basisColorZ)}let a=null,o=0==s._type;o||(a=2==s._type?i.kinematicShapeColor:i.staticShapeColor);let e=s._shapeList;for(;null!=e;){let n=e._next;if(o&&(a=0==(1&e._id)?s._sleeping?i.sleepingShapeColor1:s._sleepTime>Ut.common.Setting.sleepingTimeThreshold?i.sleepyShapeColor1:i.shapeColor1:s._sleeping?i.sleepingShapeColor2:s._sleepTime>Ut.common.Setting.sleepingTimeThreshold?i.sleepyShapeColor2:i.shapeColor2),t.drawShapes){let i=e._geom,s=e._transform;switch(i._type){case 0:t.sphere(s,i._radius,a);break;case 1:let n=i,o=this._pool,e=0==o.sizeVec3?new Ut.common.Vec3:o.stackVec3[--o.sizeVec3],r=e;r.x=n._halfExtentsX,r.y=n._halfExtentsY,r.z=n._halfExtentsZ,t.box(s,e,a);let _=this._pool;if(null!=e){if(e.zero(),_.sizeVec3==_.stackVec3.length){let t=new Array(_.sizeVec3<<1),i=0,s=_.sizeVec3;for(;i<s;){let s=i++;t[s]=_.stackVec3[s],_.stackVec3[s]=null}_.stackVec3=t}_.stackVec3[_.sizeVec3++]=e}break;case 2:let h=i;t.cylinder(s,h._radius,h._halfHeight,a);break;case 3:let l=i;t.cone(s,l._radius,l._halfHeight,a);break;case 4:let c=i;t.capsule(s,c._radius,c._halfHeight,a);break;case 5:let m=i,b=m._numVertices,p=this._pool,d=0==p.sizeVec3?new Ut.common.Vec3:p.stackVec3[--p.sizeVec3],u=this._pool,f=0==u.sizeVec3?new Ut.common.Vec3:u.stackVec3[--u.sizeVec3],x=this._pool,g=0==x.sizeVec3?new Ut.common.Vec3:x.stackVec3[--x.sizeVec3],v=this._pool,y=0==v.sizeVec3?new Ut.common.Vec3:v.stackVec3[--v.sizeVec3],X=this._pool,z=0==X.sizeVec3?new Ut.common.Vec3:X.stackVec3[--X.sizeVec3],M=this._pool,Y=0==M.sizeVec3?new Ut.common.Vec3:M.stackVec3[--M.sizeVec3],Z=this._pool,w=0==Z.sizeMat3?new Ut.common.Mat3:Z.stackMat3[--Z.sizeMat3],I=this._pool,V=0==I.sizeVec3?new Ut.common.Vec3:I.stackVec3[--I.sizeVec3],L=w;L.e00=s._rotation00,L.e01=s._rotation01,L.e02=s._rotation02,L.e10=s._rotation10,L.e11=s._rotation11,L.e12=s._rotation12,L.e20=s._rotation20,L.e21=s._rotation21,L.e22=s._rotation22;let A=V;A.x=s._positionX,A.y=s._positionY,A.z=s._positionZ;let k=0;for(;k<b;){let t=k++,i=m._tmpVertices[t],s=m._vertices[t];i.x=s.x,i.y=s.y,i.z=s.z;let n=i.x*w.e10+i.y*w.e11+i.z*w.e12,a=i.x*w.e20+i.y*w.e21+i.z*w.e22;i.x=i.x*w.e00+i.y*w.e01+i.z*w.e02,i.y=n,i.z=a,i.x+=V.x,i.y+=V.y,i.z+=V.z}if(b>30){let i=0;for(;i<b;){let s=i++,n=m._tmpVertices[s];d.x=n.x,d.y=n.y,d.z=n.z;let o=m._tmpVertices[(s+1)%b];f.x=o.x,f.y=o.y,f.z=o.z,t.line(d,f,a)}}else if(this._debugDraw.wireframe||b>10){let i=0;for(;i<b;){let s=i++,n=m._tmpVertices[s];d.x=n.x,d.y=n.y,d.z=n.z;let o=0;for(;o<s;){let i=m._tmpVertices[o++];f.x=i.x,f.y=i.y,f.z=i.z,t.line(d,f,a)}}}else{let i=0;for(;i<b;){let s=i++,n=m._tmpVertices[s];d.x=n.x,d.y=n.y,d.z=n.z;let o=0;for(;o<s;){let i=o++,s=m._tmpVertices[i];f.x=s.x,f.y=s.y,f.z=s.z;let n=0;for(;n<i;){let i=m._tmpVertices[n++];g.x=i.x,g.y=i.y,g.z=i.z,y.x=f.x,y.y=f.y,y.z=f.z;let s=y;s.x-=d.x,s.y-=d.y,s.z-=d.z,z.x=g.x,z.y=g.y,z.z=g.z;let o=z;o.x-=d.x,o.y-=d.y,o.z-=d.z,Y.x=y.x,Y.y=y.y,Y.z=y.z;let e=Y,r=e.z*z.x-e.x*z.z,_=e.x*z.y-e.y*z.x;e.x=e.y*z.z-e.z*z.y,e.y=r,e.z=_;let h=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);h>0&&(h=1/h),e.x*=h,e.y*=h,e.z*=h,t.triangle(d,f,g,Y,Y,Y,a),Y.x=-Y.x,Y.y=-Y.y,Y.z=-Y.z,t.triangle(d,g,f,Y,Y,Y,a)}}}}let S=this._pool;if(null!=d){if(d.zero(),S.sizeVec3==S.stackVec3.length){let t=new Array(S.sizeVec3<<1),i=0,s=S.sizeVec3;for(;i<s;){let s=i++;t[s]=S.stackVec3[s],S.stackVec3[s]=null}S.stackVec3=t}S.stackVec3[S.sizeVec3++]=d}let B=this._pool;if(null!=f){if(f.zero(),B.sizeVec3==B.stackVec3.length){let t=new Array(B.sizeVec3<<1),i=0,s=B.sizeVec3;for(;i<s;){let s=i++;t[s]=B.stackVec3[s],B.stackVec3[s]=null}B.stackVec3=t}B.stackVec3[B.sizeVec3++]=f}let P=this._pool;if(null!=g){if(g.zero(),P.sizeVec3==P.stackVec3.length){let t=new Array(P.sizeVec3<<1),i=0,s=P.sizeVec3;for(;i<s;){let s=i++;t[s]=P.stackVec3[s],P.stackVec3[s]=null}P.stackVec3=t}P.stackVec3[P.sizeVec3++]=g}let C=this._pool;if(null!=y){if(y.zero(),C.sizeVec3==C.stackVec3.length){let t=new Array(C.sizeVec3<<1),i=0,s=C.sizeVec3;for(;i<s;){let s=i++;t[s]=C.stackVec3[s],C.stackVec3[s]=null}C.stackVec3=t}C.stackVec3[C.sizeVec3++]=y}let T=this._pool;if(null!=z){if(z.zero(),T.sizeVec3==T.stackVec3.length){let t=new Array(T.sizeVec3<<1),i=0,s=T.sizeVec3;for(;i<s;){let s=i++;t[s]=T.stackVec3[s],T.stackVec3[s]=null}T.stackVec3=t}T.stackVec3[T.sizeVec3++]=z}let j=this._pool;if(null!=Y){if(Y.zero(),j.sizeVec3==j.stackVec3.length){let t=new Array(j.sizeVec3<<1),i=0,s=j.sizeVec3;for(;i<s;){let s=i++;t[s]=j.stackVec3[s],j.stackVec3[s]=null}j.stackVec3=t}j.stackVec3[j.sizeVec3++]=Y}let E=this._pool;if(null!=w){if(w.e00=1,w.e01=0,w.e02=0,w.e10=0,w.e11=1,w.e12=0,w.e20=0,w.e21=0,w.e22=1,E.sizeMat3==E.stackMat3.length){let t=new Array(E.sizeMat3<<1),i=0,s=E.sizeMat3;for(;i<s;){let s=i++;t[s]=E.stackMat3[s],E.stackMat3[s]=null}E.stackMat3=t}E.stackMat3[E.sizeMat3++]=w}let R=this._pool;if(null!=V){if(V.zero(),R.sizeVec3==R.stackVec3.length){let t=new Array(R.sizeVec3<<1),i=0,s=R.sizeVec3;for(;i<s;){let s=i++;t[s]=R.stackVec3[s],R.stackVec3[s]=null}R.stackVec3=t}R.stackVec3[R.sizeVec3++]=V}}}if(t.drawAabbs){let s=e._aabb,n=i.aabbColor,a=this._pool,o=0==a.sizeVec3?new Ut.common.Vec3:a.stackVec3[--a.sizeVec3],r=this._pool,_=0==r.sizeVec3?new Ut.common.Vec3:r.stackVec3[--r.sizeVec3],h=o;h.x=s._minX,h.y=s._minY,h.z=s._minZ;let l=_;l.x=s._maxX,l.y=s._maxY,l.z=s._maxZ,t.aabb(o,_,n);let c=this._pool;if(null!=o){if(o.zero(),c.sizeVec3==c.stackVec3.length){let t=new Array(c.sizeVec3<<1),i=0,s=c.sizeVec3;for(;i<s;){let s=i++;t[s]=c.stackVec3[s],c.stackVec3[s]=null}c.stackVec3=t}c.stackVec3[c.sizeVec3++]=o}let m=this._pool;if(null!=_){if(_.zero(),m.sizeVec3==m.stackVec3.length){let t=new Array(m.sizeVec3<<1),i=0,s=m.sizeVec3;for(;i<s;){let s=i++;t[s]=m.stackVec3[s],m.stackVec3[s]=null}m.stackVec3=t}m.stackVec3[m.sizeVec3++]=_}}e=n}s=n}}_drawConstraints(t){let i=t.style;if(t.drawPairs||t.drawContacts){let s=this._contactManager._contactList;for(;null!=s;){let n=s._next;if(t.drawPairs){let n=i.pairColor,a=this._pool,o=0==a.sizeVec3?new Ut.common.Vec3:a.stackVec3[--a.sizeVec3],e=this._pool,r=0==e.sizeVec3?new Ut.common.Vec3:e.stackVec3[--e.sizeVec3],_=o;_.x=s._s1._transform._positionX,_.y=s._s1._transform._positionY,_.z=s._s1._transform._positionZ;let h=r;h.x=s._s2._transform._positionX,h.y=s._s2._transform._positionY,h.z=s._s2._transform._positionZ,t.line(o,r,n);let l=this._pool;if(null!=o){if(o.zero(),l.sizeVec3==l.stackVec3.length){let t=new Array(l.sizeVec3<<1),i=0,s=l.sizeVec3;for(;i<s;){let s=i++;t[s]=l.stackVec3[s],l.stackVec3[s]=null}l.stackVec3=t}l.stackVec3[l.sizeVec3++]=o}let c=this._pool;if(null!=r){if(r.zero(),c.sizeVec3==c.stackVec3.length){let t=new Array(c.sizeVec3<<1),i=0,s=c.sizeVec3;for(;i<s;){let s=i++;t[s]=c.stackVec3[s],c.stackVec3[s]=null}c.stackVec3=t}c.stackVec3[c.sizeVec3++]=r}}if(t.drawContacts){let i=s._contactConstraint,n=s._contactConstraint._manifold._points,a=0,o=s._contactConstraint._manifold._numPoints;for(;a<o;){let s=n[a++],o=t.style,e=this._pool,r=0==e.sizeVec3?new Ut.common.Vec3:e.stackVec3[--e.sizeVec3],_=this._pool,h=0==_.sizeVec3?new Ut.common.Vec3:_.stackVec3[--_.sizeVec3],l=this._pool,c=0==l.sizeVec3?new Ut.common.Vec3:l.stackVec3[--l.sizeVec3],m=this._pool,b=0==m.sizeVec3?new Ut.common.Vec3:m.stackVec3[--m.sizeVec3],p=this._pool,d=0==p.sizeVec3?new Ut.common.Vec3:p.stackVec3[--p.sizeVec3],u=r;u.x=s._pos1X,u.y=s._pos1Y,u.z=s._pos1Z;let f=h;f.x=s._pos2X,f.y=s._pos2Y,f.z=s._pos2Z;let x=c;x.x=i._manifold._normalX,x.y=i._manifold._normalY,x.z=i._manifold._normalZ;let g=b;g.x=i._manifold._tangentX,g.y=i._manifold._tangentY,g.z=i._manifold._tangentZ;let v=d;if(v.x=i._manifold._binormalX,v.y=i._manifold._binormalY,v.z=i._manifold._binormalZ,s._disabled)t.point(r,o.disabledContactColor),t.point(h,o.disabledContactColor),t.line(r,h,o.disabledContactColor);else if(s._warmStarted){let i;switch(3&s._id){case 0:i=o.contactColor;break;case 1:i=o.contactColor2;break;case 2:i=o.contactColor3;break;default:i=o.contactColor4}t.point(r,i),t.point(h,i),t.line(r,h,o.contactColor)}else t.point(r,o.newContactColor),t.point(h,o.newContactColor),t.line(r,h,o.newContactColor);h.x=r.x,h.y=r.y,h.z=r.z;let y=h,X=o.contactNormalLength;if(y.x+=c.x*X,y.y+=c.y*X,y.z+=c.z*X,t.line(r,h,o.contactNormalColor),t.drawContactBases){h.x=r.x,h.y=r.y,h.z=r.z;let i=h,s=o.contactTangentLength;i.x+=b.x*s,i.y+=b.y*s,i.z+=b.z*s,t.line(r,h,o.contactTangentColor),h.x=r.x,h.y=r.y,h.z=r.z;let n=h,a=o.contactBinormalLength;n.x+=d.x*a,n.y+=d.y*a,n.z+=d.z*a,t.line(r,h,o.contactBinormalColor)}let z=this._pool;if(null!=r){if(r.zero(),z.sizeVec3==z.stackVec3.length){let t=new Array(z.sizeVec3<<1),i=0,s=z.sizeVec3;for(;i<s;){let s=i++;t[s]=z.stackVec3[s],z.stackVec3[s]=null}z.stackVec3=t}z.stackVec3[z.sizeVec3++]=r}let M=this._pool;if(null!=h){if(h.zero(),M.sizeVec3==M.stackVec3.length){let t=new Array(M.sizeVec3<<1),i=0,s=M.sizeVec3;for(;i<s;){let s=i++;t[s]=M.stackVec3[s],M.stackVec3[s]=null}M.stackVec3=t}M.stackVec3[M.sizeVec3++]=h}let Y=this._pool;if(null!=c){if(c.zero(),Y.sizeVec3==Y.stackVec3.length){let t=new Array(Y.sizeVec3<<1),i=0,s=Y.sizeVec3;for(;i<s;){let s=i++;t[s]=Y.stackVec3[s],Y.stackVec3[s]=null}Y.stackVec3=t}Y.stackVec3[Y.sizeVec3++]=c}let Z=this._pool;if(null!=b){if(b.zero(),Z.sizeVec3==Z.stackVec3.length){let t=new Array(Z.sizeVec3<<1),i=0,s=Z.sizeVec3;for(;i<s;){let s=i++;t[s]=Z.stackVec3[s],Z.stackVec3[s]=null}Z.stackVec3=t}Z.stackVec3[Z.sizeVec3++]=b}let w=this._pool;if(null!=d){if(d.zero(),w.sizeVec3==w.stackVec3.length){let t=new Array(w.sizeVec3<<1),i=0,s=w.sizeVec3;for(;i<s;){let s=i++;t[s]=w.stackVec3[s],w.stackVec3[s]=null}w.stackVec3=t}w.stackVec3[w.sizeVec3++]=d}}}s=n}}if(t.drawJoints){let i=this._jointList;for(;null!=i;){let s=i._next,n=this._pool,a=0==n.sizeVec3?new Ut.common.Vec3:n.stackVec3[--n.sizeVec3],o=this._pool,e=0==o.sizeVec3?new Ut.common.Vec3:o.stackVec3[--o.sizeVec3],r=a;r.x=i._b1._transform._positionX,r.y=i._b1._transform._positionY,r.z=i._b1._transform._positionZ;let _=e;_.x=i._b2._transform._positionX,_.y=i._b2._transform._positionY,_.z=i._b2._transform._positionZ;let h=this._pool,l=0==h.sizeVec3?new Ut.common.Vec3:h.stackVec3[--h.sizeVec3],c=this._pool,m=0==c.sizeVec3?new Ut.common.Vec3:c.stackVec3[--c.sizeVec3],b=this._pool,p=0==b.sizeVec3?new Ut.common.Vec3:b.stackVec3[--b.sizeVec3],d=this._pool,u=0==d.sizeVec3?new Ut.common.Vec3:d.stackVec3[--d.sizeVec3],f=this._pool,x=0==f.sizeVec3?new Ut.common.Vec3:f.stackVec3[--f.sizeVec3],g=this._pool,v=0==g.sizeVec3?new Ut.common.Vec3:g.stackVec3[--g.sizeVec3],y=this._pool,X=0==y.sizeVec3?new Ut.common.Vec3:y.stackVec3[--y.sizeVec3],z=this._pool,M=0==z.sizeVec3?new Ut.common.Vec3:z.stackVec3[--z.sizeVec3],Y=l;Y.x=i._anchor1X,Y.y=i._anchor1Y,Y.z=i._anchor1Z;let Z=m;Z.x=i._anchor2X,Z.y=i._anchor2Y,Z.z=i._anchor2Z;let w=p;w.x=i._basisX1X,w.y=i._basisX1Y,w.z=i._basisX1Z;let I=u;I.x=i._basisY1X,I.y=i._basisY1Y,I.z=i._basisY1Z;let V=x;V.x=i._basisZ1X,V.y=i._basisZ1Y,V.z=i._basisZ1Z;let L=v;L.x=i._basisX2X,L.y=i._basisX2Y,L.z=i._basisX2Z;let A=X;A.x=i._basisY2X,A.y=i._basisY2Y,A.z=i._basisY2Z;let k=M;if(k.x=i._basisZ2X,k.y=i._basisZ2Y,k.z=i._basisZ2Z,t.line(a,l,t.style.jointLineColor),t.line(e,m,t.style.jointLineColor),t.drawJointLimits)switch(i._type){case 0:break;case 1:let s=i._lm;this._drawRotationalLimit(t,l,u,x,X,t.style.jointRotationalConstraintRadius,s.lowerLimit,s.upperLimit,t.style.jointLineColor);break;case 2:let n=i,a=t.style.jointLineColor,o=n._rotLm,e=n._translLm;this._drawRotationalLimit(t,m,u,x,X,t.style.jointRotationalConstraintRadius,o.lowerLimit,o.upperLimit,a),this._drawTranslationalLimit(t,l,p,e.lowerLimit,e.upperLimit,a);break;case 3:let r=i._lm;this._drawTranslationalLimit(t,l,p,r.lowerLimit,r.upperLimit,t.style.jointLineColor);break;case 4:let _=i,h=t.style.jointRotationalConstraintRadius,c=t.style.jointLineColor,b=_._lm1,d=_._lm2;this._drawRotationalLimit(t,l,u,x,u,h,_._angleX-b.upperLimit,_._angleX-b.lowerLimit,c),this._drawRotationalLimit(t,m,v,X,v,h,d.lowerLimit-_._angleZ,d.upperLimit-_._angleZ,c);break;case 5:let f=i,g=t.style.jointRotationalConstraintRadius,y=t.style.jointLineColor,z=f._twistLm;this._drawRotationalLimit(t,m,X,M,X,g,z.lowerLimit-f._twistAngle,z.upperLimit-f._twistAngle,y),this._drawEllipseOnSphere(t,l,p,u,x,f._maxSwingAngle1,f._maxSwingAngle2,g,y);let Y=this._pool,Z=0==Y.sizeVec3?new Ut.common.Vec3:Y.stackVec3[--Y.sizeVec3];Z.x=m.x,Z.y=m.y,Z.z=m.z;let w=Z;w.x+=v.x*g,w.y+=v.y*g,w.z+=v.z*g,t.line(m,w,y);let I=this._pool;if(null!=w){if(w.zero(),I.sizeVec3==I.stackVec3.length){let t=new Array(I.sizeVec3<<1),i=0,s=I.sizeVec3;for(;i<s;){let s=i++;t[s]=I.stackVec3[s],I.stackVec3[s]=null}I.stackVec3=t}I.stackVec3[I.sizeVec3++]=w}break;case 6:let V=i,L=t.style.jointRotationalConstraintRadius,A=t.style.jointLineColor,k=V._rotLms[0],S=V._rotLms[1],B=V._rotLms[2];this._drawTranslationalLimit3D(t,l,p,u,x,V._translLms[0],V._translLms[1],V._translLms[2],A);let P=this._pool,C=0==P.sizeVec3?new Ut.common.Vec3:P.stackVec3[--P.sizeVec3],T=C;T.x=V._axisYX,T.y=V._axisYY,T.z=V._axisYZ;let j=this._pool,E=0==j.sizeVec3?new Ut.common.Vec3:j.stackVec3[--j.sizeVec3];E.x=p.x,E.y=p.y,E.z=p.z;let R=E,D=this._pool,F=0==D.sizeVec3?new Ut.common.Vec3:D.stackVec3[--D.sizeVec3];F.x=p.x,F.y=p.y,F.z=p.z;let q=F,N=q.z*C.x-q.x*C.z,H=q.x*C.y-q.y*C.x;q.x=q.y*C.z-q.z*C.y,q.y=N,q.z=H,this._drawRotationalLimit(t,m,u,x,u,L,V._angleX-k.upperLimit,V._angleX-k.lowerLimit,A),this._drawRotationalLimit(t,m,R,q,R,L,S.lowerLimit-V._angleY,S.upperLimit-V._angleY,A),this._drawRotationalLimit(t,m,v,X,v,L,B.lowerLimit-V._angleZ,B.upperLimit-V._angleZ,A)}t.line(l,m,t.style.jointErrorColor);let S=this._pool;if(null!=a){if(a.zero(),S.sizeVec3==S.stackVec3.length){let t=new Array(S.sizeVec3<<1),i=0,s=S.sizeVec3;for(;i<s;){let s=i++;t[s]=S.stackVec3[s],S.stackVec3[s]=null}S.stackVec3=t}S.stackVec3[S.sizeVec3++]=a}let B=this._pool;if(null!=e){if(e.zero(),B.sizeVec3==B.stackVec3.length){let t=new Array(B.sizeVec3<<1),i=0,s=B.sizeVec3;for(;i<s;){let s=i++;t[s]=B.stackVec3[s],B.stackVec3[s]=null}B.stackVec3=t}B.stackVec3[B.sizeVec3++]=e}let P=this._pool;if(null!=l){if(l.zero(),P.sizeVec3==P.stackVec3.length){let t=new Array(P.sizeVec3<<1),i=0,s=P.sizeVec3;for(;i<s;){let s=i++;t[s]=P.stackVec3[s],P.stackVec3[s]=null}P.stackVec3=t}P.stackVec3[P.sizeVec3++]=l}let C=this._pool;if(null!=m){if(m.zero(),C.sizeVec3==C.stackVec3.length){let t=new Array(C.sizeVec3<<1),i=0,s=C.sizeVec3;for(;i<s;){let s=i++;t[s]=C.stackVec3[s],C.stackVec3[s]=null}C.stackVec3=t}C.stackVec3[C.sizeVec3++]=m}let T=this._pool;if(null!=p){if(p.zero(),T.sizeVec3==T.stackVec3.length){let t=new Array(T.sizeVec3<<1),i=0,s=T.sizeVec3;for(;i<s;){let s=i++;t[s]=T.stackVec3[s],T.stackVec3[s]=null}T.stackVec3=t}T.stackVec3[T.sizeVec3++]=p}let j=this._pool;if(null!=u){if(u.zero(),j.sizeVec3==j.stackVec3.length){let t=new Array(j.sizeVec3<<1),i=0,s=j.sizeVec3;for(;i<s;){let s=i++;t[s]=j.stackVec3[s],j.stackVec3[s]=null}j.stackVec3=t}j.stackVec3[j.sizeVec3++]=u}let E=this._pool;if(null!=x){if(x.zero(),E.sizeVec3==E.stackVec3.length){let t=new Array(E.sizeVec3<<1),i=0,s=E.sizeVec3;for(;i<s;){let s=i++;t[s]=E.stackVec3[s],E.stackVec3[s]=null}E.stackVec3=t}E.stackVec3[E.sizeVec3++]=x}let R=this._pool;if(null!=v){if(v.zero(),R.sizeVec3==R.stackVec3.length){let t=new Array(R.sizeVec3<<1),i=0,s=R.sizeVec3;for(;i<s;){let s=i++;t[s]=R.stackVec3[s],R.stackVec3[s]=null}R.stackVec3=t}R.stackVec3[R.sizeVec3++]=v}let D=this._pool;if(null!=X){if(X.zero(),D.sizeVec3==D.stackVec3.length){let t=new Array(D.sizeVec3<<1),i=0,s=D.sizeVec3;for(;i<s;){let s=i++;t[s]=D.stackVec3[s],D.stackVec3[s]=null}D.stackVec3=t}D.stackVec3[D.sizeVec3++]=X}let F=this._pool;if(null!=M){if(M.zero(),F.sizeVec3==F.stackVec3.length){let t=new Array(F.sizeVec3<<1),i=0,s=F.sizeVec3;for(;i<s;){let s=i++;t[s]=F.stackVec3[s],F.stackVec3[s]=null}F.stackVec3=t}F.stackVec3[F.sizeVec3++]=M}i=s}}}_drawRotationalLimit(t,i,s,n,a,o,e,r,_){if(e!=r){let h=this._pool,l=0==h.sizeVec3?new Ut.common.Vec3:h.stackVec3[--h.sizeVec3];l.x=i.x,l.y=i.y,l.z=i.z;let c=l;c.x+=a.x*o,c.y+=a.y*o,c.z+=a.z*o,t.line(i,c,_);let m=this._pool;if(null!=c){if(c.zero(),m.sizeVec3==m.stackVec3.length){let t=new Array(m.sizeVec3<<1),i=0,s=m.sizeVec3;for(;i<s;){let s=i++;t[s]=m.stackVec3[s],m.stackVec3[s]=null}m.stackVec3=t}m.stackVec3[m.sizeVec3++]=c}e>r?t.ellipse(i,s,n,o,o,_):t.arc(i,s,n,o,o,e,r,!0,_)}}_drawTranslationalLimit(t,i,s,n,a,o){if(n<a){let e=this._pool,r=0==e.sizeVec3?new Ut.common.Vec3:e.stackVec3[--e.sizeVec3];r.x=i.x,r.y=i.y,r.z=i.z;let _=r;_.x+=s.x*n,_.y+=s.y*n,_.z+=s.z*n;let h=this._pool,l=0==h.sizeVec3?new Ut.common.Vec3:h.stackVec3[--h.sizeVec3];l.x=i.x,l.y=i.y,l.z=i.z;let c=l;c.x+=s.x*a,c.y+=s.y*a,c.z+=s.z*a,t.line(_,c,o);let m=this._pool;if(null!=_){if(_.zero(),m.sizeVec3==m.stackVec3.length){let t=new Array(m.sizeVec3<<1),i=0,s=m.sizeVec3;for(;i<s;){let s=i++;t[s]=m.stackVec3[s],m.stackVec3[s]=null}m.stackVec3=t}m.stackVec3[m.sizeVec3++]=_}let b=this._pool;if(null!=c){if(c.zero(),b.sizeVec3==b.stackVec3.length){let t=new Array(b.sizeVec3<<1),i=0,s=b.sizeVec3;for(;i<s;){let s=i++;t[s]=b.stackVec3[s],b.stackVec3[s]=null}b.stackVec3=t}b.stackVec3[b.sizeVec3++]=c}}}_drawTranslationalLimit3D(t,i,s,n,a,o,e,r,_){let h=o.lowerLimit,l=o.upperLimit,c=e.lowerLimit,m=e.upperLimit,b=r.lowerLimit,p=r.upperLimit,d=this._pool;0==d.sizeVec3?new Ut.common.Vec3:--d.sizeVec3;let u=this._pool;0==u.sizeVec3?new Ut.common.Vec3:--u.sizeVec3;let f=this._pool,x=0==f.sizeVec3?new Ut.common.Vec3:f.stackVec3[--f.sizeVec3];x.x=i.x,x.y=i.y,x.z=i.z;let g=x;g.x+=s.x*h,g.y+=s.y*h,g.z+=s.z*h,g.x+=n.x*c,g.y+=n.y*c,g.z+=n.z*c,g.x+=a.x*b,g.y+=a.y*b,g.z+=a.z*b;let v=this._pool,y=0==v.sizeVec3?new Ut.common.Vec3:v.stackVec3[--v.sizeVec3];y.x=i.x,y.y=i.y,y.z=i.z;let X=y;X.x+=s.x*h,X.y+=s.y*h,X.z+=s.z*h,X.x+=n.x*c,X.y+=n.y*c,X.z+=n.z*c,X.x+=a.x*p,X.y+=a.y*p,X.z+=a.z*p;let z=this._pool,M=0==z.sizeVec3?new Ut.common.Vec3:z.stackVec3[--z.sizeVec3];M.x=i.x,M.y=i.y,M.z=i.z;let Y=M;Y.x+=s.x*h,Y.y+=s.y*h,Y.z+=s.z*h,Y.x+=n.x*m,Y.y+=n.y*m,Y.z+=n.z*m,Y.x+=a.x*b,Y.y+=a.y*b,Y.z+=a.z*b;let Z=this._pool,w=0==Z.sizeVec3?new Ut.common.Vec3:Z.stackVec3[--Z.sizeVec3];w.x=i.x,w.y=i.y,w.z=i.z;let I=w;I.x+=s.x*h,I.y+=s.y*h,I.z+=s.z*h,I.x+=n.x*m,I.y+=n.y*m,I.z+=n.z*m,I.x+=a.x*p,I.y+=a.y*p,I.z+=a.z*p;let V=this._pool,L=0==V.sizeVec3?new Ut.common.Vec3:V.stackVec3[--V.sizeVec3];L.x=i.x,L.y=i.y,L.z=i.z;let A=L;A.x+=s.x*l,A.y+=s.y*l,A.z+=s.z*l,A.x+=n.x*c,A.y+=n.y*c,A.z+=n.z*c,A.x+=a.x*b,A.y+=a.y*b,A.z+=a.z*b;let k=this._pool,S=0==k.sizeVec3?new Ut.common.Vec3:k.stackVec3[--k.sizeVec3];S.x=i.x,S.y=i.y,S.z=i.z;let B=S;B.x+=s.x*l,B.y+=s.y*l,B.z+=s.z*l,B.x+=n.x*c,B.y+=n.y*c,B.z+=n.z*c,B.x+=a.x*p,B.y+=a.y*p,B.z+=a.z*p;let P=this._pool,C=0==P.sizeVec3?new Ut.common.Vec3:P.stackVec3[--P.sizeVec3];C.x=i.x,C.y=i.y,C.z=i.z;let T=C;T.x+=s.x*l,T.y+=s.y*l,T.z+=s.z*l,T.x+=n.x*m,T.y+=n.y*m,T.z+=n.z*m,T.x+=a.x*b,T.y+=a.y*b,T.z+=a.z*b;let j=this._pool,E=0==j.sizeVec3?new Ut.common.Vec3:j.stackVec3[--j.sizeVec3];E.x=i.x,E.y=i.y,E.z=i.z;let R=E;R.x+=s.x*l,R.y+=s.y*l,R.z+=s.z*l,R.x+=n.x*m,R.y+=n.y*m,R.z+=n.z*m,R.x+=a.x*p,R.y+=a.y*p,R.z+=a.z*p,t.line(g,A,_),t.line(Y,T,_),t.line(X,B,_),t.line(I,R,_),t.line(g,Y,_),t.line(A,T,_),t.line(X,I,_),t.line(B,R,_),t.line(g,X,_),t.line(A,B,_),t.line(Y,I,_),t.line(T,R,_);let D=this._pool;if(null!=g){if(g.zero(),D.sizeVec3==D.stackVec3.length){let t=new Array(D.sizeVec3<<1),i=0,s=D.sizeVec3;for(;i<s;){let s=i++;t[s]=D.stackVec3[s],D.stackVec3[s]=null}D.stackVec3=t}D.stackVec3[D.sizeVec3++]=g}let F=this._pool;if(null!=X){if(X.zero(),F.sizeVec3==F.stackVec3.length){let t=new Array(F.sizeVec3<<1),i=0,s=F.sizeVec3;for(;i<s;){let s=i++;t[s]=F.stackVec3[s],F.stackVec3[s]=null}F.stackVec3=t}F.stackVec3[F.sizeVec3++]=X}let q=this._pool;if(null!=Y){if(Y.zero(),q.sizeVec3==q.stackVec3.length){let t=new Array(q.sizeVec3<<1),i=0,s=q.sizeVec3;for(;i<s;){let s=i++;t[s]=q.stackVec3[s],q.stackVec3[s]=null}q.stackVec3=t}q.stackVec3[q.sizeVec3++]=Y}let N=this._pool;if(null!=I){if(I.zero(),N.sizeVec3==N.stackVec3.length){let t=new Array(N.sizeVec3<<1),i=0,s=N.sizeVec3;for(;i<s;){let s=i++;t[s]=N.stackVec3[s],N.stackVec3[s]=null}N.stackVec3=t}N.stackVec3[N.sizeVec3++]=I}let H=this._pool;if(null!=A){if(A.zero(),H.sizeVec3==H.stackVec3.length){let t=new Array(H.sizeVec3<<1),i=0,s=H.sizeVec3;for(;i<s;){let s=i++;t[s]=H.stackVec3[s],H.stackVec3[s]=null}H.stackVec3=t}H.stackVec3[H.sizeVec3++]=A}let O=this._pool;if(null!=B){if(B.zero(),O.sizeVec3==O.stackVec3.length){let t=new Array(O.sizeVec3<<1),i=0,s=O.sizeVec3;for(;i<s;){let s=i++;t[s]=O.stackVec3[s],O.stackVec3[s]=null}O.stackVec3=t}O.stackVec3[O.sizeVec3++]=B}let W=this._pool;if(null!=T){if(T.zero(),W.sizeVec3==W.stackVec3.length){let t=new Array(W.sizeVec3<<1),i=0,s=W.sizeVec3;for(;i<s;){let s=i++;t[s]=W.stackVec3[s],W.stackVec3[s]=null}W.stackVec3=t}W.stackVec3[W.sizeVec3++]=T}let G=this._pool;if(null!=R){if(R.zero(),G.sizeVec3==G.stackVec3.length){let t=new Array(G.sizeVec3<<1),i=0,s=G.sizeVec3;for(;i<s;){let s=i++;t[s]=G.stackVec3[s],G.stackVec3[s]=null}G.stackVec3=t}G.stackVec3[G.sizeVec3++]=R}}_drawEllipseOnSphere(t,i,s,n,a,o,e,r,_){let h=0,l=this._pool,c=0==l.sizeVec3?new Ut.common.Vec3:l.stackVec3[--l.sizeVec3],m=this._pool,b=0==m.sizeQuat?new Ut.common.Quat:m.stackQuat[--m.sizeQuat],p=this._pool,d=0==p.sizeMat3?new Ut.common.Mat3:p.stackMat3[--p.sizeMat3],u=this._pool,f=0==u.sizeVec3?new Ut.common.Vec3:u.stackVec3[--u.sizeVec3],x=0;for(;x<17;){let l=x++,m=Math.cos(h)*o,p=Math.sin(h)*e,u=Math.sqrt(m*m+p*p),g=Math.sin(.5*u),v=Math.cos(.5*u),y=c.zero();y.x+=n.x*m,y.y+=n.y*m,y.z+=n.z*m,y.x+=a.x*p,y.y+=a.y*p,y.z+=a.z*p;let X=1/u*g;c.x*=X,c.y*=X,c.z*=X,b.x=c.x,b.y=c.y,b.z=c.z,b.w=v;let z=b.x,M=b.y,Y=b.z,Z=b.w,w=2*z,I=2*M,V=2*Y,L=z*w,A=M*I,k=Y*V,S=z*I,B=M*V,P=z*V,C=Z*w,T=Z*I,j=Z*V;d.e00=1-A-k,d.e01=S-j,d.e02=P+T,d.e10=S+j,d.e11=1-L-k,d.e12=B-C,d.e20=P-T,d.e21=B+C,d.e22=1-L-A;let E=this._pool,R=0==E.sizeVec3?new Ut.common.Vec3:E.stackVec3[--E.sizeVec3];R.x+=s.x*r,R.y+=s.y*r,R.z+=s.z*r;let D=R,F=D.x*d.e10+D.y*d.e11+D.z*d.e12,q=D.x*d.e20+D.y*d.e21+D.z*d.e22;D.x=D.x*d.e00+D.y*d.e01+D.z*d.e02,D.y=F,D.z=q,D.x+=i.x,D.y+=i.y,D.z+=i.z,l>=1&&t.line(f,D,_);let N=this._pool;if(null!=f){if(f.zero(),N.sizeVec3==N.stackVec3.length){let t=new Array(N.sizeVec3<<1),i=0,s=N.sizeVec3;for(;i<s;){let s=i++;t[s]=N.stackVec3[s],N.stackVec3[s]=null}N.stackVec3=t}N.stackVec3[N.sizeVec3++]=f}f=D,h+=.39269908169872375}let g=this._pool;if(null!=c){if(c.zero(),g.sizeVec3==g.stackVec3.length){let t=new Array(g.sizeVec3<<1),i=0,s=g.sizeVec3;for(;i<s;){let s=i++;t[s]=g.stackVec3[s],g.stackVec3[s]=null}g.stackVec3=t}g.stackVec3[g.sizeVec3++]=c}let v=this._pool;if(null!=b){if(b.x=0,b.y=0,b.z=0,b.w=1,v.sizeQuat==v.stackQuat.length){let t=new Array(v.sizeQuat<<1),i=0,s=v.sizeQuat;for(;i<s;){let s=i++;t[s]=v.stackQuat[s],v.stackQuat[s]=null}v.stackQuat=t}v.stackQuat[v.sizeQuat++]=b}let y=this._pool;if(null!=d){if(d.e00=1,d.e01=0,d.e02=0,d.e10=0,d.e11=1,d.e12=0,d.e20=0,d.e21=0,d.e22=1,y.sizeMat3==y.stackMat3.length){let t=new Array(y.sizeMat3<<1),i=0,s=y.sizeMat3;for(;i<s;){let s=i++;t[s]=y.stackMat3[s],y.stackMat3[s]=null}y.stackMat3=t}y.stackMat3[y.sizeMat3++]=d}let X=this._pool;if(null!=f){if(f.zero(),X.sizeVec3==X.stackVec3.length){let t=new Array(X.sizeVec3<<1),i=0,s=X.sizeVec3;for(;i<s;){let s=i++;t[s]=X.stackVec3[s],X.stackVec3[s]=null}X.stackVec3=t}X.stackVec3[X.sizeVec3++]=f}}step(t){this._timeStep.dt>0&&(this._timeStep.dtRatio=t/this._timeStep.dt),this._timeStep.dt=t,this._timeStep.invDt=1/t;let i=Date.now()/1e3;this._updateContacts(),this._solveIslands(),Ut.dynamics.common.Performance.totalTime=1e3*(Date.now()/1e3-i)}addRigidBody(t){if(null!=t._world)throw new Error("A rigid body cannot belong to multiple worlds.");null==this._rigidBodyList?(this._rigidBodyList=t,this._rigidBodyListLast=t):(this._rigidBodyListLast._next=t,t._prev=this._rigidBodyListLast,this._rigidBodyListLast=t),t._world=this;let i=t._shapeList;for(;null!=i;){let t=i._next;i._proxy=this._broadPhase.createProxy(i,i._aabb),i._id=this._shapeIdCount++,this._numShapes++,i=t}this._numRigidBodies++}removeRigidBody(t){if(t._world!=this)throw new Error("The rigid body doesn't belong to the world.");let i=t._prev,s=t._next;null!=i&&(i._next=s),null!=s&&(s._prev=i),t==this._rigidBodyList&&(this._rigidBodyList=this._rigidBodyList._next),t==this._rigidBodyListLast&&(this._rigidBodyListLast=this._rigidBodyListLast._prev),t._next=null,t._prev=null,t._world=null;let n=t._shapeList;for(;null!=n;){let t=n._next;this._broadPhase.destroyProxy(n._proxy),n._proxy=null,n._id=-1;let i=n._rigidBody._contactLinkList;for(;null!=i;){let t=i._next,s=i._contact;if(s._s1==n||s._s2==n){let t=i._other;t._sleeping=!1,t._sleepTime=0;let n=this._contactManager,a=s._prev,o=s._next;if(null!=a&&(a._next=o),null!=o&&(o._prev=a),s==n._contactList&&(n._contactList=n._contactList._next),s==n._contactListLast&&(n._contactListLast=n._contactListLast._prev),s._next=null,s._prev=null,s._touching){let t=s._s1._contactCallback,i=s._s2._contactCallback;t==i&&(i=null),null!=t&&t.endContact(s),null!=i&&i.endContact(s)}let e=s._link1._prev,r=s._link1._next;null!=e&&(e._next=r),null!=r&&(r._prev=e),s._link1==s._b1._contactLinkList&&(s._b1._contactLinkList=s._b1._contactLinkList._next),s._link1==s._b1._contactLinkListLast&&(s._b1._contactLinkListLast=s._b1._contactLinkListLast._prev),s._link1._next=null,s._link1._prev=null;let _=s._link2._prev,h=s._link2._next;null!=_&&(_._next=h),null!=h&&(h._prev=_),s._link2==s._b2._contactLinkList&&(s._b2._contactLinkList=s._b2._contactLinkList._next),s._link2==s._b2._contactLinkListLast&&(s._b2._contactLinkListLast=s._b2._contactLinkListLast._prev),s._link2._next=null,s._link2._prev=null,s._b1._numContactLinks--,s._b2._numContactLinks--,s._link1._other=null,s._link2._other=null,s._link1._contact=null,s._link2._contact=null,s._s1=null,s._s2=null,s._b1=null,s._b2=null,s._touching=!1,s._cachedDetectorData._clear(),s._manifold._clear(),s._detector=null;let l=s._contactConstraint;l._s1=null,l._s2=null,l._b1=null,l._b2=null,l._tf1=null,l._tf2=null,s._next=n._contactPool,n._contactPool=s,n._numContacts--}i=t}this._numShapes--,n=t}this._numRigidBodies--}addJoint(t){if(null!=t._world)throw new Error("A joint cannot belong to multiple worlds.");null==this._jointList?(this._jointList=t,this._jointListLast=t):(this._jointListLast._next=t,t._prev=this._jointListLast,this._jointListLast=t),t._world=this,t._link1._other=t._b2,t._link2._other=t._b1,null==t._b1._jointLinkList?(t._b1._jointLinkList=t._link1,t._b1._jointLinkListLast=t._link1):(t._b1._jointLinkListLast._next=t._link1,t._link1._prev=t._b1._jointLinkListLast,t._b1._jointLinkListLast=t._link1),null==t._b2._jointLinkList?(t._b2._jointLinkList=t._link2,t._b2._jointLinkListLast=t._link2):(t._b2._jointLinkListLast._next=t._link2,t._link2._prev=t._b2._jointLinkListLast,t._b2._jointLinkListLast=t._link2),t._b1._numJointLinks++,t._b2._numJointLinks++;let i=t._b1;i._sleeping=!1,i._sleepTime=0;let s=t._b2;s._sleeping=!1,s._sleepTime=0,t._syncAnchors(),this._numJoints++}removeJoint(t){if(t._world!=this)throw new Error("The joint doesn't belong to the world.");let i=t._prev,s=t._next;null!=i&&(i._next=s),null!=s&&(s._prev=i),t==this._jointList&&(this._jointList=this._jointList._next),t==this._jointListLast&&(this._jointListLast=this._jointListLast._prev),t._next=null,t._prev=null,t._world=null;let n=t._link1._prev,a=t._link1._next;null!=n&&(n._next=a),null!=a&&(a._prev=n),t._link1==t._b1._jointLinkList&&(t._b1._jointLinkList=t._b1._jointLinkList._next),t._link1==t._b1._jointLinkListLast&&(t._b1._jointLinkListLast=t._b1._jointLinkListLast._prev),t._link1._next=null,t._link1._prev=null;let o=t._link2._prev,e=t._link2._next;null!=o&&(o._next=e),null!=e&&(e._prev=o),t._link2==t._b2._jointLinkList&&(t._b2._jointLinkList=t._b2._jointLinkList._next),t._link2==t._b2._jointLinkListLast&&(t._b2._jointLinkListLast=t._b2._jointLinkListLast._prev),t._link2._next=null,t._link2._prev=null,t._link1._other=null,t._link2._other=null,t._b1._numJointLinks--,t._b2._numJointLinks--;let r=t._b1;r._sleeping=!1,r._sleepTime=0;let _=t._b2;_._sleeping=!1,_._sleepTime=0,this._numJoints--}setDebugDraw(t){this._debugDraw=t}getDebugDraw(){return this._debugDraw}debugDraw(){null!=this._debugDraw&&(2==this._broadPhase._type&&this._drawBvh(this._debugDraw,this._broadPhase._tree),this._drawRigidBodies(this._debugDraw),this._drawConstraints(this._debugDraw))}rayCast(t,i,s){let n=this._rayCastWrapper.begin;n.x=t.x,n.y=t.y,n.z=t.z;let a=this._rayCastWrapper.end;a.x=i.x,a.y=i.y,a.z=i.z,this._rayCastWrapper.callback=s,this._broadPhase.rayCast(t,i,this._rayCastWrapper)}convexCast(t,i,s,n){this._convexCastWrapper.convex=t;let a=this._convexCastWrapper.begin;a._positionX=i._positionX,a._positionY=i._positionY,a._positionZ=i._positionZ,a._rotation00=i._rotation00,a._rotation01=i._rotation01,a._rotation02=i._rotation02,a._rotation10=i._rotation10,a._rotation11=i._rotation11,a._rotation12=i._rotation12,a._rotation20=i._rotation20,a._rotation21=i._rotation21,a._rotation22=i._rotation22;let o=this._convexCastWrapper.translation;o.x=s.x,o.y=s.y,o.z=s.z,this._convexCastWrapper.callback=n,this._broadPhase.convexCast(t,i,s,this._convexCastWrapper)}aabbTest(t,i){this._aabbTestWrapper._aabb.copyFrom(t),this._aabbTestWrapper._callback=i,this._broadPhase.aabbTest(t,this._aabbTestWrapper)}getRigidBodyList(){return this._rigidBodyList}getJointList(){return this._jointList}getBroadPhase(){return this._broadPhase}getContactManager(){return this._contactManager}getNumRigidBodies(){return this._numRigidBodies}getNumJoints(){return this._numJoints}getNumShapes(){return this._numShapes}getNumIslands(){return this._numIslands}getNumVelocityIterations(){return this._numVelocityIterations}setNumVelocityIterations(t){this._numVelocityIterations=t}getNumPositionIterations(){return this._numPositionIterations}setNumPositionIterations(t){this._numPositionIterations=t}getGravity(){return this._gravity}setGravity(t){let i=this._gravity;i.x=t.x,i.y=t.y,i.z=t.z}},Ut.dynamics._World||(Ut.dynamics._World={}),Ut.dynamics._World.RayCastWrapper=class extends Ut.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new Ut.collision.geometry.RayCastHit,this.begin=new Ut.common.Vec3,this.end=new Ut.common.Vec3,this.callback=null}process(t){let i=t.userData;i._geom.rayCast(this.begin,this.end,i._transform,this.rayCastHit)&&this.callback.process(i,this.rayCastHit)}},Ut.dynamics._World.ConvexCastWrapper=class extends Ut.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new Ut.collision.geometry.RayCastHit,this.begin=new Ut.common.Transform,this.translation=new Ut.common.Vec3,this.zero=new Ut.common.Vec3,this.callback=null,this.convex=null}process(t){let i=t.userData,s=i._geom._type;s<0||s>5||Ut.collision.narrowphase.detector.gjkepa.GjkEpa.instance.convexCast(this.convex,i._geom,this.begin,i._transform,this.translation,this.zero,this.rayCastHit)&&this.callback.process(i,this.rayCastHit)}},Ut.dynamics._World.AabbTestWrapper=class extends Ut.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this._aabb=new Ut.collision.geometry.Aabb,this._callback=null}process(t){let i=t.userData,s=i._aabb;s._minX<this._aabb._maxX&&s._maxX>this._aabb._minX&&s._minY<this._aabb._maxY&&s._maxY>this._aabb._minY&&s._minZ<this._aabb._maxZ&&s._maxZ>this._aabb._minZ&&this._callback.process(i)}},Ut.dynamics.callback||(Ut.dynamics.callback={}),Ut.dynamics.callback.AabbTestCallback=class{constructor(){}process(t){}},Ut.dynamics.callback.ContactCallback=class{constructor(){}beginContact(t){}preSolve(t){}postSolve(t){}endContact(t){}},Ut.dynamics.callback.RayCastCallback=class{constructor(){}process(t,i){}},Ut.dynamics.callback.RayCastClosest=class extends Ut.dynamics.callback.RayCastCallback{constructor(){super(),this.position=new Ut.common.Vec3,this.normal=new Ut.common.Vec3,this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}clear(){this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}process(t,i){if(i.fraction<this.fraction){this.shape=t,this.hit=!0,this.fraction=i.fraction;let s=this.position,n=i.position;s.x=n.x,s.y=n.y,s.z=n.z;let a=this.normal,o=i.normal;a.x=o.x,a.y=o.y,a.z=o.z}}},Ut.dynamics.common||(Ut.dynamics.common={}),Ut.dynamics.common.DebugDraw=class{constructor(){this.p=new Ut.common.Pool,this.wireframe=!1,this.drawShapes=!0,this.drawBvh=!1,this.drawBvhMinLevel=0,this.drawBvhMaxLevel=65536,this.drawAabbs=!1,this.drawBases=!1,this.drawPairs=!1,this.drawContacts=!1,this.drawJoints=!0,this.drawJointLimits=!1,this.sphereCoords=new Array(5),this.tmpSphereVerts=new Array(5),this.tmpSphereNorms=new Array(5);let t=0;for(;t<5;){let i=t++,s=0==i||4==i?1:8;this.sphereCoords[i]=new Array(s),this.tmpSphereVerts[i]=new Array(s),this.tmpSphereNorms[i]=new Array(s);let n=0;for(;n<8;){let t=n++,s=.7853981633974475*i,a=.7853981633974475*t;this.sphereCoords[i][t]=new Ut.common.Vec3(Math.sin(s)*Math.cos(a),Math.cos(s),-Math.sin(s)*Math.sin(a)),this.tmpSphereVerts[i][t]=new Ut.common.Vec3,this.tmpSphereNorms[i][t]=new Ut.common.Vec3}}this.circleCoords=new Array(8),this.circleCoordsShift=new Array(8),this.tmpCircleVerts1=new Array(8),this.tmpCircleVerts2=new Array(8),this.tmpCircleNorms=new Array(8);let i=0;for(;i<8;){let t=i++;this.circleCoords[t]=new Ut.common.Vec3(Math.cos(.7853981633974475*t),0,-Math.sin(.7853981633974475*t)),this.circleCoordsShift[t]=new Ut.common.Vec3(Math.cos(.7853981633974475*(t+.5)),0,-Math.sin(.7853981633974475*(t+.5))),this.tmpCircleVerts1[t]=new Ut.common.Vec3,this.tmpCircleVerts2[t]=new Ut.common.Vec3,this.tmpCircleNorms[t]=new Ut.common.Vec3}this.style=new Ut.dynamics.common.DebugDrawStyle}aabb(t,i,s){let n=this.p,a=(0==n.sizeVec3?new Ut.common.Vec3:n.stackVec3[--n.sizeVec3]).init(t.x,t.y,t.z),o=this.p,e=(0==o.sizeVec3?new Ut.common.Vec3:o.stackVec3[--o.sizeVec3]).init(t.x,t.y,i.z),r=this.p,_=(0==r.sizeVec3?new Ut.common.Vec3:r.stackVec3[--r.sizeVec3]).init(t.x,i.y,t.z),h=this.p,l=(0==h.sizeVec3?new Ut.common.Vec3:h.stackVec3[--h.sizeVec3]).init(t.x,i.y,i.z),c=this.p,m=(0==c.sizeVec3?new Ut.common.Vec3:c.stackVec3[--c.sizeVec3]).init(i.x,t.y,t.z),b=this.p,p=(0==b.sizeVec3?new Ut.common.Vec3:b.stackVec3[--b.sizeVec3]).init(i.x,t.y,i.z),d=this.p,u=(0==d.sizeVec3?new Ut.common.Vec3:d.stackVec3[--d.sizeVec3]).init(i.x,i.y,t.z),f=this.p,x=(0==f.sizeVec3?new Ut.common.Vec3:f.stackVec3[--f.sizeVec3]).init(i.x,i.y,i.z);this.line(a,e,s),this.line(_,l,s),this.line(m,p,s),this.line(u,x,s),this.line(a,_,s),this.line(e,l,s),this.line(m,u,s),this.line(p,x,s),this.line(a,m,s),this.line(e,p,s),this.line(_,u,s),this.line(l,x,s);let g=this.p;if(null!=a){if(a.zero(),g.sizeVec3==g.stackVec3.length){let t=new Array(g.sizeVec3<<1),i=0,s=g.sizeVec3;for(;i<s;){let s=i++;t[s]=g.stackVec3[s],g.stackVec3[s]=null}g.stackVec3=t}g.stackVec3[g.sizeVec3++]=a}let v=this.p;if(null!=e){if(e.zero(),v.sizeVec3==v.stackVec3.length){let t=new Array(v.sizeVec3<<1),i=0,s=v.sizeVec3;for(;i<s;){let s=i++;t[s]=v.stackVec3[s],v.stackVec3[s]=null}v.stackVec3=t}v.stackVec3[v.sizeVec3++]=e}let y=this.p;if(null!=_){if(_.zero(),y.sizeVec3==y.stackVec3.length){let t=new Array(y.sizeVec3<<1),i=0,s=y.sizeVec3;for(;i<s;){let s=i++;t[s]=y.stackVec3[s],y.stackVec3[s]=null}y.stackVec3=t}y.stackVec3[y.sizeVec3++]=_}let X=this.p;if(null!=l){if(l.zero(),X.sizeVec3==X.stackVec3.length){let t=new Array(X.sizeVec3<<1),i=0,s=X.sizeVec3;for(;i<s;){let s=i++;t[s]=X.stackVec3[s],X.stackVec3[s]=null}X.stackVec3=t}X.stackVec3[X.sizeVec3++]=l}let z=this.p;if(null!=m){if(m.zero(),z.sizeVec3==z.stackVec3.length){let t=new Array(z.sizeVec3<<1),i=0,s=z.sizeVec3;for(;i<s;){let s=i++;t[s]=z.stackVec3[s],z.stackVec3[s]=null}z.stackVec3=t}z.stackVec3[z.sizeVec3++]=m}let M=this.p;if(null!=p){if(p.zero(),M.sizeVec3==M.stackVec3.length){let t=new Array(M.sizeVec3<<1),i=0,s=M.sizeVec3;for(;i<s;){let s=i++;t[s]=M.stackVec3[s],M.stackVec3[s]=null}M.stackVec3=t}M.stackVec3[M.sizeVec3++]=p}let Y=this.p;if(null!=u){if(u.zero(),Y.sizeVec3==Y.stackVec3.length){let t=new Array(Y.sizeVec3<<1),i=0,s=Y.sizeVec3;for(;i<s;){let s=i++;t[s]=Y.stackVec3[s],Y.stackVec3[s]=null}Y.stackVec3=t}Y.stackVec3[Y.sizeVec3++]=u}let Z=this.p;if(null!=x){if(x.zero(),Z.sizeVec3==Z.stackVec3.length){let t=new Array(Z.sizeVec3<<1),i=0,s=Z.sizeVec3;for(;i<s;){let s=i++;t[s]=Z.stackVec3[s],Z.stackVec3[s]=null}Z.stackVec3=t}Z.stackVec3[Z.sizeVec3++]=x}}basis(t,i,s,n,a){let o=this.p,e=0==o.sizeVec3?new Ut.common.Vec3:o.stackVec3[--o.sizeVec3],r=this.p,_=0==r.sizeMat3?new Ut.common.Mat3:r.stackMat3[--r.sizeMat3],h=this.p,l=0==h.sizeVec3?new Ut.common.Vec3:h.stackVec3[--h.sizeVec3],c=this.p,m=0==c.sizeVec3?new Ut.common.Vec3:c.stackVec3[--c.sizeVec3],b=this.p,p=0==b.sizeVec3?new Ut.common.Vec3:b.stackVec3[--b.sizeVec3],d=e;d.x=t._positionX,d.y=t._positionY,d.z=t._positionZ;let u=_;u.e00=t._rotation00,u.e01=t._rotation01,u.e02=t._rotation02,u.e10=t._rotation10,u.e11=t._rotation11,u.e12=t._rotation12,u.e20=t._rotation20,u.e21=t._rotation21,u.e22=t._rotation22,l.init(_.e00,_.e10,_.e20),m.init(_.e01,_.e11,_.e21),p.init(_.e02,_.e12,_.e22),l.x*=i,l.y*=i,l.z*=i;let f=l;f.x+=e.x,f.y+=e.y,f.z+=e.z,m.x*=i,m.y*=i,m.z*=i;let x=m;x.x+=e.x,x.y+=e.y,x.z+=e.z,p.x*=i,p.y*=i,p.z*=i;let g=p;g.x+=e.x,g.y+=e.y,g.z+=e.z,this.line(e,l,s),this.line(e,m,n),this.line(e,p,a);let v=this.p;if(null!=e){if(e.zero(),v.sizeVec3==v.stackVec3.length){let t=new Array(v.sizeVec3<<1),i=0,s=v.sizeVec3;for(;i<s;){let s=i++;t[s]=v.stackVec3[s],v.stackVec3[s]=null}v.stackVec3=t}v.stackVec3[v.sizeVec3++]=e}let y=this.p;if(null!=_){if(_.e00=1,_.e01=0,_.e02=0,_.e10=0,_.e11=1,_.e12=0,_.e20=0,_.e21=0,_.e22=1,y.sizeMat3==y.stackMat3.length){let t=new Array(y.sizeMat3<<1),i=0,s=y.sizeMat3;for(;i<s;){let s=i++;t[s]=y.stackMat3[s],y.stackMat3[s]=null}y.stackMat3=t}y.stackMat3[y.sizeMat3++]=_}let X=this.p;if(null!=l){if(l.zero(),X.sizeVec3==X.stackVec3.length){let t=new Array(X.sizeVec3<<1),i=0,s=X.sizeVec3;for(;i<s;){let s=i++;t[s]=X.stackVec3[s],X.stackVec3[s]=null}X.stackVec3=t}X.stackVec3[X.sizeVec3++]=l}let z=this.p;if(null!=m){if(m.zero(),z.sizeVec3==z.stackVec3.length){let t=new Array(z.sizeVec3<<1),i=0,s=z.sizeVec3;for(;i<s;){let s=i++;t[s]=z.stackVec3[s],z.stackVec3[s]=null}z.stackVec3=t}z.stackVec3[z.sizeVec3++]=m}let M=this.p;if(null!=p){if(p.zero(),M.sizeVec3==M.stackVec3.length){let t=new Array(M.sizeVec3<<1),i=0,s=M.sizeVec3;for(;i<s;){let s=i++;t[s]=M.stackVec3[s],M.stackVec3[s]=null}M.stackVec3=t}M.stackVec3[M.sizeVec3++]=p}}ellipse(t,i,s,n,a,o){this.arc(t,i,s,n,a,0,6.28318530717958,!1,o)}arc(t,i,s,n,a,o,e,r,_){let h=this.p,l=0==h.sizeVec3?new Ut.common.Vec3:h.stackVec3[--h.sizeVec3];l.x=i.x,l.y=i.y,l.z=i.z;let c=l;c.x*=n,c.y*=n,c.z*=n;let m=this.p,b=0==m.sizeVec3?new Ut.common.Vec3:m.stackVec3[--m.sizeVec3];b.x=s.x,b.y=s.y,b.z=s.z;let p=b;p.x*=a,p.y*=a,p.z*=a;let d=e-o;d<0&&(d=-d);let u=d/.5235987755982984+.5|0;0==u&&(u=1);let f=o,x=(e-o)/u,g=this.p,v=0==g.sizeVec3?new Ut.common.Vec3:g.stackVec3[--g.sizeVec3];v.x=t.x,v.y=t.y,v.z=t.z;let y=v,X=Math.cos(o);y.x+=c.x*X,y.y+=c.y*X,y.z+=c.z*X;let z=Math.sin(o);y.x+=p.x*z,y.y+=p.y*z,y.z+=p.z*z;let M=y;r&&this.line(t,y,_);let Y=0,Z=u;for(;Y<Z;){++Y,f+=x;let i=this.p,s=0==i.sizeVec3?new Ut.common.Vec3:i.stackVec3[--i.sizeVec3];s.x=t.x,s.y=t.y,s.z=t.z;let n=s,a=Math.cos(f);n.x+=c.x*a,n.y+=c.y*a,n.z+=c.z*a;let o=Math.sin(f);n.x+=p.x*o,n.y+=p.y*o,n.z+=p.z*o,this.line(M,n,_);let e=this.p;if(null!=M){if(M.zero(),e.sizeVec3==e.stackVec3.length){let t=new Array(e.sizeVec3<<1),i=0,s=e.sizeVec3;for(;i<s;){let s=i++;t[s]=e.stackVec3[s],e.stackVec3[s]=null}e.stackVec3=t}e.stackVec3[e.sizeVec3++]=M}M=n}r&&this.line(t,M,_);let w=this.p;if(null!=M){if(M.zero(),w.sizeVec3==w.stackVec3.length){let t=new Array(w.sizeVec3<<1),i=0,s=w.sizeVec3;for(;i<s;){let s=i++;t[s]=w.stackVec3[s],w.stackVec3[s]=null}w.stackVec3=t}w.stackVec3[w.sizeVec3++]=M}let I=this.p;if(null!=c){if(c.zero(),I.sizeVec3==I.stackVec3.length){let t=new Array(I.sizeVec3<<1),i=0,s=I.sizeVec3;for(;i<s;){let s=i++;t[s]=I.stackVec3[s],I.stackVec3[s]=null}I.stackVec3=t}I.stackVec3[I.sizeVec3++]=c}let V=this.p;if(null!=p){if(p.zero(),V.sizeVec3==V.stackVec3.length){let t=new Array(V.sizeVec3<<1),i=0,s=V.sizeVec3;for(;i<s;){let s=i++;t[s]=V.stackVec3[s],V.stackVec3[s]=null}V.stackVec3=t}V.stackVec3[V.sizeVec3++]=p}}cone(t,i,s,n){let a=this.p,o=0==a.sizeVec3?new Ut.common.Vec3:a.stackVec3[--a.sizeVec3],e=this.p,r=0==e.sizeVec3?new Ut.common.Vec3:e.stackVec3[--e.sizeVec3],_=this.p,h=0==_.sizeVec3?new Ut.common.Vec3:_.stackVec3[--_.sizeVec3],l=this.p,c=0==l.sizeVec3?new Ut.common.Vec3:l.stackVec3[--l.sizeVec3],m=this.p,b=0==m.sizeMat3?new Ut.common.Mat3:m.stackMat3[--m.sizeMat3],p=c;p.x=t._positionX,p.y=t._positionY,p.z=t._positionZ;let d=b;d.e00=t._rotation00,d.e01=t._rotation01,d.e02=t._rotation02,d.e10=t._rotation10,d.e11=t._rotation11,d.e12=t._rotation12,d.e20=t._rotation20,d.e21=t._rotation21,d.e22=t._rotation22,o.init(b.e00,b.e10,b.e20),r.init(b.e01,b.e11,b.e21),h.init(b.e02,b.e12,b.e22);let u=this.p,f=0==u.sizeVec3?new Ut.common.Vec3:u.stackVec3[--u.sizeVec3];f.x=c.x,f.y=c.y,f.z=c.z;let x=f;x.x+=r.x*s,x.y+=r.y*s,x.z+=r.z*s;let g=this.p,v=0==g.sizeVec3?new Ut.common.Vec3:g.stackVec3[--g.sizeVec3];v.x=c.x,v.y=c.y,v.z=c.z;let y=v,X=-s;if(y.x+=r.x*X,y.y+=r.y*X,y.z+=r.z*X,this.wireframe){let t=this.p,s=0==t.sizeVec3?new Ut.common.Vec3:t.stackVec3[--t.sizeVec3];s.x=y.x,s.y=y.y,s.z=y.z;let a=s,e=-i;a.x+=o.x*e,a.y+=o.y*e,a.z+=o.z*e,a.x+=0*h.x,a.y+=0*h.y,a.z+=0*h.z;let r=this.p,_=0==r.sizeVec3?new Ut.common.Vec3:r.stackVec3[--r.sizeVec3];_.x=y.x,_.y=y.y,_.z=y.z;let l=_;l.x+=o.x*i,l.y+=o.y*i,l.z+=o.z*i,l.x+=0*h.x,l.y+=0*h.y,l.z+=0*h.z;let c=this.p,m=0==c.sizeVec3?new Ut.common.Vec3:c.stackVec3[--c.sizeVec3];m.x=y.x,m.y=y.y,m.z=y.z;let b=m;b.x+=0*o.x,b.y+=0*o.y,b.z+=0*o.z;let p=-i;b.x+=h.x*p,b.y+=h.y*p,b.z+=h.z*p;let d=this.p,u=0==d.sizeVec3?new Ut.common.Vec3:d.stackVec3[--d.sizeVec3];u.x=y.x,u.y=y.y,u.z=y.z;let f=u;f.x+=0*o.x,f.y+=0*o.y,f.z+=0*o.z,f.x+=h.x*i,f.y+=h.y*i,f.z+=h.z*i,this.ellipse(y,o,h,i,i,n),this.line(x,a,n),this.line(x,l,n),this.line(x,b,n),this.line(x,f,n);let g=this.p;if(null!=a){if(a.zero(),g.sizeVec3==g.stackVec3.length){let t=new Array(g.sizeVec3<<1),i=0,s=g.sizeVec3;for(;i<s;){let s=i++;t[s]=g.stackVec3[s],g.stackVec3[s]=null}g.stackVec3=t}g.stackVec3[g.sizeVec3++]=a}let v=this.p;if(null!=l){if(l.zero(),v.sizeVec3==v.stackVec3.length){let t=new Array(v.sizeVec3<<1),i=0,s=v.sizeVec3;for(;i<s;){let s=i++;t[s]=v.stackVec3[s],v.stackVec3[s]=null}v.stackVec3=t}v.stackVec3[v.sizeVec3++]=l}let X=this.p;if(null!=b){if(b.zero(),X.sizeVec3==X.stackVec3.length){let t=new Array(X.sizeVec3<<1),i=0,s=X.sizeVec3;for(;i<s;){let s=i++;t[s]=X.stackVec3[s],X.stackVec3[s]=null}X.stackVec3=t}X.stackVec3[X.sizeVec3++]=b}let z=this.p;if(null!=f){if(f.zero(),z.sizeVec3==z.stackVec3.length){let t=new Array(z.sizeVec3<<1),i=0,s=z.sizeVec3;for(;i<s;){let s=i++;t[s]=z.stackVec3[s],z.stackVec3[s]=null}z.stackVec3=t}z.stackVec3[z.sizeVec3++]=f}}else{let t=1/Math.sqrt(i*i+4*s*s),a=2*s*t,o=i*t,e=0;for(;e<8;){let t=e++,n=this.tmpCircleNorms[t],_=this.circleCoords[t];n.x=_.x,n.y=_.y,n.z=_.z,n.x*=a,n.y*=a,n.z*=a,n.y+=o;let h=this.tmpCircleNorms[t],l=h.x*b.e10+h.y*b.e11+h.z*b.e12,m=h.x*b.e20+h.y*b.e21+h.z*b.e22;h.x=h.x*b.e00+h.y*b.e01+h.z*b.e02,h.y=l,h.z=m;let p=this.tmpCircleVerts1[t],d=this.circleCoordsShift[t];p.x=d.x,p.y=d.y,p.z=d.z,p.x*=a,p.y*=a,p.z*=a,p.y+=o;let u=this.tmpCircleVerts1[t],f=u.x*b.e10+u.y*b.e11+u.z*b.e12,x=u.x*b.e20+u.y*b.e21+u.z*b.e22;u.x=u.x*b.e00+u.y*b.e01+u.z*b.e02,u.y=f,u.z=x;let g=this.tmpCircleVerts2[t],v=this.circleCoords[t];g.x=v.x,g.y=v.y,g.z=v.z;let y=g.x*b.e10+g.y*b.e11+g.z*b.e12,X=g.x*b.e20+g.y*b.e21+g.z*b.e22;g.x=g.x*b.e00+g.y*b.e01+g.z*b.e02,g.y=y,g.z=X,g.x*=i,g.y*=i,g.z*=i,g.x+=c.x,g.y+=c.y,g.z+=c.z;let z=this.tmpCircleVerts2[t],M=-s;z.x+=r.x*M,z.y+=r.y*M,z.z+=r.z*M}let _=0;for(;_<8;){let t=_++,i=this.tmpCircleVerts2[t],s=this.tmpCircleVerts2[(t+1)%8],a=this.tmpCircleVerts1[t];this.triangle(x,i,s,a,this.tmpCircleNorms[t],this.tmpCircleNorms[(t+1)%8],n),i=this.tmpCircleVerts2[(t+1)%8],s=this.tmpCircleVerts2[t];let o=this.p,e=0==o.sizeVec3?new Ut.common.Vec3:o.stackVec3[--o.sizeVec3];e.x=r.x,e.y=r.y,e.z=r.z;let h=e;h.x=-h.x,h.y=-h.y,h.z=-h.z,this.triangle(y,i,s,h,h,h,n);let l=this.p;if(null!=h){if(h.zero(),l.sizeVec3==l.stackVec3.length){let t=new Array(l.sizeVec3<<1),i=0,s=l.sizeVec3;for(;i<s;){let s=i++;t[s]=l.stackVec3[s],l.stackVec3[s]=null}l.stackVec3=t}l.stackVec3[l.sizeVec3++]=h}}}let z=this.p;if(null!=x){if(x.zero(),z.sizeVec3==z.stackVec3.length){let t=new Array(z.sizeVec3<<1),i=0,s=z.sizeVec3;for(;i<s;){let s=i++;t[s]=z.stackVec3[s],z.stackVec3[s]=null}z.stackVec3=t}z.stackVec3[z.sizeVec3++]=x}let M=this.p;if(null!=y){if(y.zero(),M.sizeVec3==M.stackVec3.length){let t=new Array(M.sizeVec3<<1),i=0,s=M.sizeVec3;for(;i<s;){let s=i++;t[s]=M.stackVec3[s],M.stackVec3[s]=null}M.stackVec3=t}M.stackVec3[M.sizeVec3++]=y}let Y=this.p;if(null!=c){if(c.zero(),Y.sizeVec3==Y.stackVec3.length){let t=new Array(Y.sizeVec3<<1),i=0,s=Y.sizeVec3;for(;i<s;){let s=i++;t[s]=Y.stackVec3[s],Y.stackVec3[s]=null}Y.stackVec3=t}Y.stackVec3[Y.sizeVec3++]=c}let Z=this.p;if(null!=b){if(b.e00=1,b.e01=0,b.e02=0,b.e10=0,b.e11=1,b.e12=0,b.e20=0,b.e21=0,b.e22=1,Z.sizeMat3==Z.stackMat3.length){let t=new Array(Z.sizeMat3<<1),i=0,s=Z.sizeMat3;for(;i<s;){let s=i++;t[s]=Z.stackMat3[s],Z.stackMat3[s]=null}Z.stackMat3=t}Z.stackMat3[Z.sizeMat3++]=b}let w=this.p;if(null!=o){if(o.zero(),w.sizeVec3==w.stackVec3.length){let t=new Array(w.sizeVec3<<1),i=0,s=w.sizeVec3;for(;i<s;){let s=i++;t[s]=w.stackVec3[s],w.stackVec3[s]=null}w.stackVec3=t}w.stackVec3[w.sizeVec3++]=o}let I=this.p;if(null!=r){if(r.zero(),I.sizeVec3==I.stackVec3.length){let t=new Array(I.sizeVec3<<1),i=0,s=I.sizeVec3;for(;i<s;){let s=i++;t[s]=I.stackVec3[s],I.stackVec3[s]=null}I.stackVec3=t}I.stackVec3[I.sizeVec3++]=r}let V=this.p;if(null!=h){if(h.zero(),V.sizeVec3==V.stackVec3.length){let t=new Array(V.sizeVec3<<1),i=0,s=V.sizeVec3;for(;i<s;){let s=i++;t[s]=V.stackVec3[s],V.stackVec3[s]=null}V.stackVec3=t}V.stackVec3[V.sizeVec3++]=h}}cylinder(t,i,s,n){let a=this.p,o=0==a.sizeVec3?new Ut.common.Vec3:a.stackVec3[--a.sizeVec3],e=this.p,r=0==e.sizeVec3?new Ut.common.Vec3:e.stackVec3[--e.sizeVec3],_=this.p,h=0==_.sizeVec3?new Ut.common.Vec3:_.stackVec3[--_.sizeVec3],l=this.p,c=0==l.sizeVec3?new Ut.common.Vec3:l.stackVec3[--l.sizeVec3],m=this.p,b=0==m.sizeMat3?new Ut.common.Mat3:m.stackMat3[--m.sizeMat3],p=c;p.x=t._positionX,p.y=t._positionY,p.z=t._positionZ;let d=b;d.e00=t._rotation00,d.e01=t._rotation01,d.e02=t._rotation02,d.e10=t._rotation10,d.e11=t._rotation11,d.e12=t._rotation12,d.e20=t._rotation20,d.e21=t._rotation21,d.e22=t._rotation22,o.init(b.e00,b.e10,b.e20),r.init(b.e01,b.e11,b.e21),h.init(b.e02,b.e12,b.e22);let u=this.p,f=0==u.sizeVec3?new Ut.common.Vec3:u.stackVec3[--u.sizeVec3];f.x=c.x,f.y=c.y,f.z=c.z;let x=f;x.x+=r.x*s,x.y+=r.y*s,x.z+=r.z*s;let g=this.p,v=0==g.sizeVec3?new Ut.common.Vec3:g.stackVec3[--g.sizeVec3];v.x=c.x,v.y=c.y,v.z=c.z;let y=v,X=-s;if(y.x+=r.x*X,y.y+=r.y*X,y.z+=r.z*X,this.wireframe){let t=this.p,s=0==t.sizeVec3?new Ut.common.Vec3:t.stackVec3[--t.sizeVec3];s.x=x.x,s.y=x.y,s.z=x.z;let a=s,e=-i;a.x+=o.x*e,a.y+=o.y*e,a.z+=o.z*e,a.x+=0*h.x,a.y+=0*h.y,a.z+=0*h.z;let r=this.p,_=0==r.sizeVec3?new Ut.common.Vec3:r.stackVec3[--r.sizeVec3];_.x=x.x,_.y=x.y,_.z=x.z;let l=_;l.x+=o.x*i,l.y+=o.y*i,l.z+=o.z*i,l.x+=0*h.x,l.y+=0*h.y,l.z+=0*h.z;let c=this.p,m=0==c.sizeVec3?new Ut.common.Vec3:c.stackVec3[--c.sizeVec3];m.x=x.x,m.y=x.y,m.z=x.z;let b=m;b.x+=0*o.x,b.y+=0*o.y,b.z+=0*o.z;let p=-i;b.x+=h.x*p,b.y+=h.y*p,b.z+=h.z*p;let d=this.p,u=0==d.sizeVec3?new Ut.common.Vec3:d.stackVec3[--d.sizeVec3];u.x=x.x,u.y=x.y,u.z=x.z;let f=u;f.x+=0*o.x,f.y+=0*o.y,f.z+=0*o.z,f.x+=h.x*i,f.y+=h.y*i,f.z+=h.z*i;let g=this.p,v=0==g.sizeVec3?new Ut.common.Vec3:g.stackVec3[--g.sizeVec3];v.x=y.x,v.y=y.y,v.z=y.z;let X=v,z=-i;X.x+=o.x*z,X.y+=o.y*z,X.z+=o.z*z,X.x+=0*h.x,X.y+=0*h.y,X.z+=0*h.z;let M=this.p,Y=0==M.sizeVec3?new Ut.common.Vec3:M.stackVec3[--M.sizeVec3];Y.x=y.x,Y.y=y.y,Y.z=y.z;let Z=Y;Z.x+=o.x*i,Z.y+=o.y*i,Z.z+=o.z*i,Z.x+=0*h.x,Z.y+=0*h.y,Z.z+=0*h.z;let w=this.p,I=0==w.sizeVec3?new Ut.common.Vec3:w.stackVec3[--w.sizeVec3];I.x=y.x,I.y=y.y,I.z=y.z;let V=I;V.x+=0*o.x,V.y+=0*o.y,V.z+=0*o.z;let L=-i;V.x+=h.x*L,V.y+=h.y*L,V.z+=h.z*L;let A=this.p,k=0==A.sizeVec3?new Ut.common.Vec3:A.stackVec3[--A.sizeVec3];k.x=y.x,k.y=y.y,k.z=y.z;let S=k;S.x+=0*o.x,S.y+=0*o.y,S.z+=0*o.z,S.x+=h.x*i,S.y+=h.y*i,S.z+=h.z*i,this.ellipse(x,o,h,i,i,n),this.ellipse(y,o,h,i,i,n),this.line(a,X,n),this.line(l,Z,n),this.line(b,V,n),this.line(f,S,n);let B=this.p;if(null!=a){if(a.zero(),B.sizeVec3==B.stackVec3.length){let t=new Array(B.sizeVec3<<1),i=0,s=B.sizeVec3;for(;i<s;){let s=i++;t[s]=B.stackVec3[s],B.stackVec3[s]=null}B.stackVec3=t}B.stackVec3[B.sizeVec3++]=a}let P=this.p;if(null!=l){if(l.zero(),P.sizeVec3==P.stackVec3.length){let t=new Array(P.sizeVec3<<1),i=0,s=P.sizeVec3;for(;i<s;){let s=i++;t[s]=P.stackVec3[s],P.stackVec3[s]=null}P.stackVec3=t}P.stackVec3[P.sizeVec3++]=l}let C=this.p;if(null!=b){if(b.zero(),C.sizeVec3==C.stackVec3.length){let t=new Array(C.sizeVec3<<1),i=0,s=C.sizeVec3;for(;i<s;){let s=i++;t[s]=C.stackVec3[s],C.stackVec3[s]=null}C.stackVec3=t}C.stackVec3[C.sizeVec3++]=b}let T=this.p;if(null!=f){if(f.zero(),T.sizeVec3==T.stackVec3.length){let t=new Array(T.sizeVec3<<1),i=0,s=T.sizeVec3;for(;i<s;){let s=i++;t[s]=T.stackVec3[s],T.stackVec3[s]=null}T.stackVec3=t}T.stackVec3[T.sizeVec3++]=f}let j=this.p;if(null!=X){if(X.zero(),j.sizeVec3==j.stackVec3.length){let t=new Array(j.sizeVec3<<1),i=0,s=j.sizeVec3;for(;i<s;){let s=i++;t[s]=j.stackVec3[s],j.stackVec3[s]=null}j.stackVec3=t}j.stackVec3[j.sizeVec3++]=X}let E=this.p;if(null!=Z){if(Z.zero(),E.sizeVec3==E.stackVec3.length){let t=new Array(E.sizeVec3<<1),i=0,s=E.sizeVec3;for(;i<s;){let s=i++;t[s]=E.stackVec3[s],E.stackVec3[s]=null}E.stackVec3=t}E.stackVec3[E.sizeVec3++]=Z}let R=this.p;if(null!=V){if(V.zero(),R.sizeVec3==R.stackVec3.length){let t=new Array(R.sizeVec3<<1),i=0,s=R.sizeVec3;for(;i<s;){let s=i++;t[s]=R.stackVec3[s],R.stackVec3[s]=null}R.stackVec3=t}R.stackVec3[R.sizeVec3++]=V}let D=this.p;if(null!=S){if(S.zero(),D.sizeVec3==D.stackVec3.length){let t=new Array(D.sizeVec3<<1),i=0,s=D.sizeVec3;for(;i<s;){let s=i++;t[s]=D.stackVec3[s],D.stackVec3[s]=null}D.stackVec3=t}D.stackVec3[D.sizeVec3++]=S}}else{let t=0;for(;t<8;){let n=t++,a=this.tmpCircleNorms[n],o=this.circleCoords[n];a.x=o.x,a.y=o.y,a.z=o.z;let e=a.x*b.e10+a.y*b.e11+a.z*b.e12,_=a.x*b.e20+a.y*b.e21+a.z*b.e22;a.x=a.x*b.e00+a.y*b.e01+a.z*b.e02,a.y=e,a.z=_;let h=this.tmpCircleVerts1[n],l=this.tmpCircleNorms[n];h.x=l.x,h.y=l.y,h.z=l.z,h.x*=i,h.y*=i,h.z*=i,h.x+=c.x,h.y+=c.y,h.z+=c.z;let m=this.tmpCircleVerts2[n],p=this.tmpCircleVerts1[n];m.x=p.x,m.y=p.y,m.z=p.z;let d=this.tmpCircleVerts1[n];d.x+=r.x*s,d.y+=r.y*s,d.z+=r.z*s;let u=this.tmpCircleVerts2[n],f=-s;u.x+=r.x*f,u.y+=r.y*f,u.z+=r.z*f}let a=0;for(;a<8;){let t,i=a++,s=this.tmpCircleVerts1[i],o=this.tmpCircleVerts1[(i+1)%8],e=r;this.triangle(x,s,o,e,e,e,n),s=this.tmpCircleVerts2[(i+1)%8],o=this.tmpCircleVerts2[i];let _=this.p,h=0==_.sizeVec3?new Ut.common.Vec3:_.stackVec3[--_.sizeVec3];h.x=r.x,h.y=r.y,h.z=r.z;let l=h;l.x=-l.x,l.y=-l.y,l.z=-l.z,this.triangle(y,s,o,l,l,l,n);let c=this.p;if(null!=l){if(l.zero(),c.sizeVec3==c.stackVec3.length){let t=new Array(c.sizeVec3<<1),i=0,s=c.sizeVec3;for(;i<s;){let s=i++;t[s]=c.stackVec3[s],c.stackVec3[s]=null}c.stackVec3=t}c.stackVec3[c.sizeVec3++]=l}t=this.tmpCircleVerts1[i],s=this.tmpCircleVerts2[i],o=this.tmpCircleVerts2[(i+1)%8],e=this.tmpCircleNorms[i];let m=this.tmpCircleNorms[(i+1)%8];this.rect(t,s,o,this.tmpCircleVerts1[(i+1)%8],e,e,m,m,n)}}let z=this.p;if(null!=x){if(x.zero(),z.sizeVec3==z.stackVec3.length){let t=new Array(z.sizeVec3<<1),i=0,s=z.sizeVec3;for(;i<s;){let s=i++;t[s]=z.stackVec3[s],z.stackVec3[s]=null}z.stackVec3=t}z.stackVec3[z.sizeVec3++]=x}let M=this.p;if(null!=y){if(y.zero(),M.sizeVec3==M.stackVec3.length){let t=new Array(M.sizeVec3<<1),i=0,s=M.sizeVec3;for(;i<s;){let s=i++;t[s]=M.stackVec3[s],M.stackVec3[s]=null}M.stackVec3=t}M.stackVec3[M.sizeVec3++]=y}let Y=this.p;if(null!=c){if(c.zero(),Y.sizeVec3==Y.stackVec3.length){let t=new Array(Y.sizeVec3<<1),i=0,s=Y.sizeVec3;for(;i<s;){let s=i++;t[s]=Y.stackVec3[s],Y.stackVec3[s]=null}Y.stackVec3=t}Y.stackVec3[Y.sizeVec3++]=c}let Z=this.p;if(null!=b){if(b.e00=1,b.e01=0,b.e02=0,b.e10=0,b.e11=1,b.e12=0,b.e20=0,b.e21=0,b.e22=1,Z.sizeMat3==Z.stackMat3.length){let t=new Array(Z.sizeMat3<<1),i=0,s=Z.sizeMat3;for(;i<s;){let s=i++;t[s]=Z.stackMat3[s],Z.stackMat3[s]=null}Z.stackMat3=t}Z.stackMat3[Z.sizeMat3++]=b}let w=this.p;if(null!=o){if(o.zero(),w.sizeVec3==w.stackVec3.length){let t=new Array(w.sizeVec3<<1),i=0,s=w.sizeVec3;for(;i<s;){let s=i++;t[s]=w.stackVec3[s],w.stackVec3[s]=null}w.stackVec3=t}w.stackVec3[w.sizeVec3++]=o}let I=this.p;if(null!=r){if(r.zero(),I.sizeVec3==I.stackVec3.length){let t=new Array(I.sizeVec3<<1),i=0,s=I.sizeVec3;for(;i<s;){let s=i++;t[s]=I.stackVec3[s],I.stackVec3[s]=null}I.stackVec3=t}I.stackVec3[I.sizeVec3++]=r}let V=this.p;if(null!=h){if(h.zero(),V.sizeVec3==V.stackVec3.length){let t=new Array(V.sizeVec3<<1),i=0,s=V.sizeVec3;for(;i<s;){let s=i++;t[s]=V.stackVec3[s],V.stackVec3[s]=null}V.stackVec3=t}V.stackVec3[V.sizeVec3++]=h}}capsule(t,i,s,n){let a=this.p,o=0==a.sizeVec3?new Ut.common.Vec3:a.stackVec3[--a.sizeVec3],e=this.p,r=0==e.sizeVec3?new Ut.common.Vec3:e.stackVec3[--e.sizeVec3],_=this.p,h=0==_.sizeVec3?new Ut.common.Vec3:_.stackVec3[--_.sizeVec3],l=this.p,c=0==l.sizeVec3?new Ut.common.Vec3:l.stackVec3[--l.sizeVec3],m=this.p,b=0==m.sizeMat3?new Ut.common.Mat3:m.stackMat3[--m.sizeMat3],p=c;p.x=t._positionX,p.y=t._positionY,p.z=t._positionZ;let d=b;d.e00=t._rotation00,d.e01=t._rotation01,d.e02=t._rotation02,d.e10=t._rotation10,d.e11=t._rotation11,d.e12=t._rotation12,d.e20=t._rotation20,d.e21=t._rotation21,d.e22=t._rotation22,o.init(b.e00,b.e10,b.e20),r.init(b.e01,b.e11,b.e21),h.init(b.e02,b.e12,b.e22);let u=this.tmpSphereVerts,f=this.tmpSphereNorms,x=0;for(;x<5;){let t=x++,i=this.tmpSphereVerts[t].length,s=0;for(;s<i;){let i=s++,n=f[t][i],a=this.sphereCoords[t][i];n.x=a.x,n.y=a.y,n.z=a.z;let o=n.x*b.e10+n.y*b.e11+n.z*b.e12,e=n.x*b.e20+n.y*b.e21+n.z*b.e22;n.x=n.x*b.e00+n.y*b.e01+n.z*b.e02,n.y=o,n.z=e}}let g=0;for(;g<4;){let t=g++;if(0==t){let t=0;for(;t<3;){let n=t++,a=this.tmpSphereVerts[n].length,o=0;for(;o<a;){let t=o++,a=u[n][t],e=f[n][t];a.x=e.x,a.y=e.y,a.z=e.z,a.x*=i,a.y*=i,a.z*=i,a.x+=c.x,a.y+=c.y,a.z+=c.z,a.x+=r.x*s,a.y+=r.y*s,a.z+=r.z*s}}}if(2==t){let t=2;for(;t<5;){let n=t++,a=this.tmpSphereVerts[n].length,o=0;for(;o<a;){let t=o++,a=u[n][t],e=f[n][t];a.x=e.x,a.y=e.y,a.z=e.z,a.x*=i,a.y*=i,a.z*=i,a.x+=c.x,a.y+=c.y,a.z+=c.z;let _=-s;a.x+=r.x*_,a.y+=r.y*_,a.z+=r.z*_}}}let a=0;for(;a<8;){let i,s,o,e,r,_,h,l,c=a++;0==t?this.wireframe?(i=u[0][0],s=u[1][c],this.line(i,s,n)):(i=u[0][0],s=u[1][c],o=u[1][(c+1)%8],r=f[0][0],_=f[1][c],h=f[1][(c+1)%8],this.triangle(i,s,o,r,_,h,n)):3==t?this.wireframe?(i=u[4][0],s=u[t][(c+1)%8],o=u[t][c],this.line(i,s,n),this.line(s,o,n)):(i=u[4][0],s=u[t][(c+1)%8],o=u[t][c],r=f[4][0],_=f[t][(c+1)%8],h=f[t][c],this.triangle(i,s,o,r,_,h,n)):this.wireframe?(i=u[t][c],s=u[t][(c+1)%8],o=u[t+1][c],this.line(i,s,n),this.line(i,o,n)):(i=u[t][c],s=u[t][(c+1)%8],o=u[t+1][c],e=u[t+1][(c+1)%8],r=f[t][c],_=f[t][(c+1)%8],h=f[t+1][c],l=f[t+1][(c+1)%8],this.rect(i,o,e,s,r,h,l,_,n))}}let v=this.p,y=0==v.sizeVec3?new Ut.common.Vec3:v.stackVec3[--v.sizeVec3];y.x=c.x,y.y=c.y,y.z=c.z;let X=y;X.x+=r.x*s,X.y+=r.y*s,X.z+=r.z*s;let z=this.p,M=0==z.sizeVec3?new Ut.common.Vec3:z.stackVec3[--z.sizeVec3];M.x=c.x,M.y=c.y,M.z=c.z;let Y=M,Z=-s;if(Y.x+=r.x*Z,Y.y+=r.y*Z,Y.z+=r.z*Z,this.wireframe){let t=this.p,s=0==t.sizeVec3?new Ut.common.Vec3:t.stackVec3[--t.sizeVec3];s.x=X.x,s.y=X.y,s.z=X.z;let a=s,e=-i;a.x+=o.x*e,a.y+=o.y*e,a.z+=o.z*e,a.x+=0*h.x,a.y+=0*h.y,a.z+=0*h.z;let r=this.p,_=0==r.sizeVec3?new Ut.common.Vec3:r.stackVec3[--r.sizeVec3];_.x=X.x,_.y=X.y,_.z=X.z;let l=_;l.x+=o.x*i,l.y+=o.y*i,l.z+=o.z*i,l.x+=0*h.x,l.y+=0*h.y,l.z+=0*h.z;let c=this.p,m=0==c.sizeVec3?new Ut.common.Vec3:c.stackVec3[--c.sizeVec3];m.x=X.x,m.y=X.y,m.z=X.z;let b=m;b.x+=0*o.x,b.y+=0*o.y,b.z+=0*o.z;let p=-i;b.x+=h.x*p,b.y+=h.y*p,b.z+=h.z*p;let d=this.p,u=0==d.sizeVec3?new Ut.common.Vec3:d.stackVec3[--d.sizeVec3];u.x=X.x,u.y=X.y,u.z=X.z;let f=u;f.x+=0*o.x,f.y+=0*o.y,f.z+=0*o.z,f.x+=h.x*i,f.y+=h.y*i,f.z+=h.z*i;let x=this.p,g=0==x.sizeVec3?new Ut.common.Vec3:x.stackVec3[--x.sizeVec3];g.x=Y.x,g.y=Y.y,g.z=Y.z;let v=g,y=-i;v.x+=o.x*y,v.y+=o.y*y,v.z+=o.z*y,v.x+=0*h.x,v.y+=0*h.y,v.z+=0*h.z;let z=this.p,M=0==z.sizeVec3?new Ut.common.Vec3:z.stackVec3[--z.sizeVec3];M.x=Y.x,M.y=Y.y,M.z=Y.z;let Z=M;Z.x+=o.x*i,Z.y+=o.y*i,Z.z+=o.z*i,Z.x+=0*h.x,Z.y+=0*h.y,Z.z+=0*h.z;let w=this.p,I=0==w.sizeVec3?new Ut.common.Vec3:w.stackVec3[--w.sizeVec3];I.x=Y.x,I.y=Y.y,I.z=Y.z;let V=I;V.x+=0*o.x,V.y+=0*o.y,V.z+=0*o.z;let L=-i;V.x+=h.x*L,V.y+=h.y*L,V.z+=h.z*L;let A=this.p,k=0==A.sizeVec3?new Ut.common.Vec3:A.stackVec3[--A.sizeVec3];k.x=Y.x,k.y=Y.y,k.z=Y.z;let S=k;S.x+=0*o.x,S.y+=0*o.y,S.z+=0*o.z,S.x+=h.x*i,S.y+=h.y*i,S.z+=h.z*i,this.ellipse(X,o,h,i,i,n),this.ellipse(Y,o,h,i,i,n),this.line(a,v,n),this.line(l,Z,n),this.line(b,V,n),this.line(f,S,n);let B=this.p;if(null!=a){if(a.zero(),B.sizeVec3==B.stackVec3.length){let t=new Array(B.sizeVec3<<1),i=0,s=B.sizeVec3;for(;i<s;){let s=i++;t[s]=B.stackVec3[s],B.stackVec3[s]=null}B.stackVec3=t}B.stackVec3[B.sizeVec3++]=a}let P=this.p;if(null!=l){if(l.zero(),P.sizeVec3==P.stackVec3.length){let t=new Array(P.sizeVec3<<1),i=0,s=P.sizeVec3;for(;i<s;){let s=i++;t[s]=P.stackVec3[s],P.stackVec3[s]=null}P.stackVec3=t}P.stackVec3[P.sizeVec3++]=l}let C=this.p;if(null!=b){if(b.zero(),C.sizeVec3==C.stackVec3.length){let t=new Array(C.sizeVec3<<1),i=0,s=C.sizeVec3;for(;i<s;){let s=i++;t[s]=C.stackVec3[s],C.stackVec3[s]=null}C.stackVec3=t}C.stackVec3[C.sizeVec3++]=b}let T=this.p;if(null!=f){if(f.zero(),T.sizeVec3==T.stackVec3.length){let t=new Array(T.sizeVec3<<1),i=0,s=T.sizeVec3;for(;i<s;){let s=i++;t[s]=T.stackVec3[s],T.stackVec3[s]=null}T.stackVec3=t}T.stackVec3[T.sizeVec3++]=f}let j=this.p;if(null!=v){if(v.zero(),j.sizeVec3==j.stackVec3.length){let t=new Array(j.sizeVec3<<1),i=0,s=j.sizeVec3;for(;i<s;){let s=i++;t[s]=j.stackVec3[s],j.stackVec3[s]=null}j.stackVec3=t}j.stackVec3[j.sizeVec3++]=v}let E=this.p;if(null!=Z){if(Z.zero(),E.sizeVec3==E.stackVec3.length){let t=new Array(E.sizeVec3<<1),i=0,s=E.sizeVec3;for(;i<s;){let s=i++;t[s]=E.stackVec3[s],E.stackVec3[s]=null}E.stackVec3=t}E.stackVec3[E.sizeVec3++]=Z}let R=this.p;if(null!=V){if(V.zero(),R.sizeVec3==R.stackVec3.length){let t=new Array(R.sizeVec3<<1),i=0,s=R.sizeVec3;for(;i<s;){let s=i++;t[s]=R.stackVec3[s],R.stackVec3[s]=null}R.stackVec3=t}R.stackVec3[R.sizeVec3++]=V}let D=this.p;if(null!=S){if(S.zero(),D.sizeVec3==D.stackVec3.length){let t=new Array(D.sizeVec3<<1),i=0,s=D.sizeVec3;for(;i<s;){let s=i++;t[s]=D.stackVec3[s],D.stackVec3[s]=null}D.stackVec3=t}D.stackVec3[D.sizeVec3++]=S}}else{let t=0;for(;t<8;){let n=t++,a=this.tmpCircleNorms[n],o=this.circleCoords[n];a.x=o.x,a.y=o.y,a.z=o.z;let e=a.x*b.e10+a.y*b.e11+a.z*b.e12,_=a.x*b.e20+a.y*b.e21+a.z*b.e22;a.x=a.x*b.e00+a.y*b.e01+a.z*b.e02,a.y=e,a.z=_;let h=this.tmpCircleVerts1[n],l=this.tmpCircleNorms[n];h.x=l.x,h.y=l.y,h.z=l.z,h.x*=i,h.y*=i,h.z*=i,h.x+=c.x,h.y+=c.y,h.z+=c.z;let m=this.tmpCircleVerts2[n],p=this.tmpCircleVerts1[n];m.x=p.x,m.y=p.y,m.z=p.z;let d=this.tmpCircleVerts1[n];d.x+=r.x*s,d.y+=r.y*s,d.z+=r.z*s;let u=this.tmpCircleVerts2[n],f=-s;u.x+=r.x*f,u.y+=r.y*f,u.z+=r.z*f}let a=0;for(;a<8;){let t=a++,i=this.tmpCircleNorms[t],s=this.tmpCircleNorms[(t+1)%8];this.rect(this.tmpCircleVerts1[t],this.tmpCircleVerts2[t],this.tmpCircleVerts2[(t+1)%8],this.tmpCircleVerts1[(t+1)%8],i,i,s,s,n)}}let w=this.p;if(null!=X){if(X.zero(),w.sizeVec3==w.stackVec3.length){let t=new Array(w.sizeVec3<<1),i=0,s=w.sizeVec3;for(;i<s;){let s=i++;t[s]=w.stackVec3[s],w.stackVec3[s]=null}w.stackVec3=t}w.stackVec3[w.sizeVec3++]=X}let I=this.p;if(null!=Y){if(Y.zero(),I.sizeVec3==I.stackVec3.length){let t=new Array(I.sizeVec3<<1),i=0,s=I.sizeVec3;for(;i<s;){let s=i++;t[s]=I.stackVec3[s],I.stackVec3[s]=null}I.stackVec3=t}I.stackVec3[I.sizeVec3++]=Y}let V=this.p;if(null!=c){if(c.zero(),V.sizeVec3==V.stackVec3.length){let t=new Array(V.sizeVec3<<1),i=0,s=V.sizeVec3;for(;i<s;){let s=i++;t[s]=V.stackVec3[s],V.stackVec3[s]=null}V.stackVec3=t}V.stackVec3[V.sizeVec3++]=c}let L=this.p;if(null!=b){if(b.e00=1,b.e01=0,b.e02=0,b.e10=0,b.e11=1,b.e12=0,b.e20=0,b.e21=0,b.e22=1,L.sizeMat3==L.stackMat3.length){let t=new Array(L.sizeMat3<<1),i=0,s=L.sizeMat3;for(;i<s;){let s=i++;t[s]=L.stackMat3[s],L.stackMat3[s]=null}L.stackMat3=t}L.stackMat3[L.sizeMat3++]=b}let A=this.p;if(null!=o){if(o.zero(),A.sizeVec3==A.stackVec3.length){let t=new Array(A.sizeVec3<<1),i=0,s=A.sizeVec3;for(;i<s;){let s=i++;t[s]=A.stackVec3[s],A.stackVec3[s]=null}A.stackVec3=t}A.stackVec3[A.sizeVec3++]=o}let k=this.p;if(null!=r){if(r.zero(),k.sizeVec3==k.stackVec3.length){let t=new Array(k.sizeVec3<<1),i=0,s=k.sizeVec3;for(;i<s;){let s=i++;t[s]=k.stackVec3[s],k.stackVec3[s]=null}k.stackVec3=t}k.stackVec3[k.sizeVec3++]=r}let S=this.p;if(null!=h){if(h.zero(),S.sizeVec3==S.stackVec3.length){let t=new Array(S.sizeVec3<<1),i=0,s=S.sizeVec3;for(;i<s;){let s=i++;t[s]=S.stackVec3[s],S.stackVec3[s]=null}S.stackVec3=t}S.stackVec3[S.sizeVec3++]=h}}sphere(t,i,s){let n=this.p,a=0==n.sizeVec3?new Ut.common.Vec3:n.stackVec3[--n.sizeVec3],o=this.p,e=0==o.sizeMat3?new Ut.common.Mat3:o.stackMat3[--o.sizeMat3],r=a;r.x=t._positionX,r.y=t._positionY,r.z=t._positionZ;let _=e;_.e00=t._rotation00,_.e01=t._rotation01,_.e02=t._rotation02,_.e10=t._rotation10,_.e11=t._rotation11,_.e12=t._rotation12,_.e20=t._rotation20,_.e21=t._rotation21,_.e22=t._rotation22;let h=this.tmpSphereVerts,l=this.tmpSphereNorms,c=0;for(;c<5;){let t=c++,s=this.tmpSphereVerts[t].length,n=0;for(;n<s;){let s=n++,o=l[t][s],r=this.sphereCoords[t][s];o.x=r.x,o.y=r.y,o.z=r.z;let _=o.x*e.e10+o.y*e.e11+o.z*e.e12,c=o.x*e.e20+o.y*e.e21+o.z*e.e22;o.x=o.x*e.e00+o.y*e.e01+o.z*e.e02,o.y=_,o.z=c;let m=h[t][s],b=l[t][s];m.x=b.x,m.y=b.y,m.z=b.z,m.x*=i,m.y*=i,m.z*=i,m.x+=a.x,m.y+=a.y,m.z+=a.z}}let m=0;for(;m<4;){let t=m++,i=0;for(;i<8;){let n,a,o,e,r,_,c,m,b=i++;0==t?this.wireframe?(n=h[0][0],a=h[1][b],this.line(n,a,s)):(n=h[0][0],a=h[1][b],o=h[1][(b+1)%8],r=l[0][0],_=l[1][b],c=l[1][(b+1)%8],this.triangle(n,a,o,r,_,c,s)):3==t?this.wireframe?(n=h[4][0],a=h[t][(b+1)%8],o=h[t][b],this.line(n,a,s),this.line(a,o,s)):(n=h[4][0],a=h[t][(b+1)%8],o=h[t][b],r=l[4][0],_=l[t][(b+1)%8],c=l[t][b],this.triangle(n,a,o,r,_,c,s)):this.wireframe?(n=h[t][b],a=h[t][(b+1)%8],o=h[t+1][b],this.line(n,a,s),this.line(n,o,s)):(n=h[t][b],a=h[t][(b+1)%8],o=h[t+1][b],e=h[t+1][(b+1)%8],r=l[t][b],_=l[t][(b+1)%8],c=l[t+1][b],m=l[t+1][(b+1)%8],this.rect(n,o,e,a,r,c,m,_,s))}}let b=this.p;if(null!=a){if(a.zero(),b.sizeVec3==b.stackVec3.length){let t=new Array(b.sizeVec3<<1),i=0,s=b.sizeVec3;for(;i<s;){let s=i++;t[s]=b.stackVec3[s],b.stackVec3[s]=null}b.stackVec3=t}b.stackVec3[b.sizeVec3++]=a}let p=this.p;if(null!=e){if(e.e00=1,e.e01=0,e.e02=0,e.e10=0,e.e11=1,e.e12=0,e.e20=0,e.e21=0,e.e22=1,p.sizeMat3==p.stackMat3.length){let t=new Array(p.sizeMat3<<1),i=0,s=p.sizeMat3;for(;i<s;){let s=i++;t[s]=p.stackMat3[s],p.stackMat3[s]=null}p.stackMat3=t}p.stackMat3[p.sizeMat3++]=e}}box(t,i,s){let n=this.p,a=0==n.sizeVec3?new Ut.common.Vec3:n.stackVec3[--n.sizeVec3],o=this.p,e=0==o.sizeVec3?new Ut.common.Vec3:o.stackVec3[--o.sizeVec3],r=this.p,_=0==r.sizeVec3?new Ut.common.Vec3:r.stackVec3[--r.sizeVec3],h=this.p,l=0==h.sizeVec3?new Ut.common.Vec3:h.stackVec3[--h.sizeVec3],c=this.p,m=0==c.sizeMat3?new Ut.common.Mat3:c.stackMat3[--c.sizeMat3],b=l;b.x=t._positionX,b.y=t._positionY,b.z=t._positionZ;let p=m;p.e00=t._rotation00,p.e01=t._rotation01,p.e02=t._rotation02,p.e10=t._rotation10,p.e11=t._rotation11,p.e12=t._rotation12,p.e20=t._rotation20,p.e21=t._rotation21,p.e22=t._rotation22,a.init(m.e00,m.e10,m.e20),e.init(m.e01,m.e11,m.e21),_.init(m.e02,m.e12,m.e22);let d=i.x,u=i.y,f=i.z,x=this.p,g=0==x.sizeVec3?new Ut.common.Vec3:x.stackVec3[--x.sizeVec3];g.x=l.x,g.y=l.y,g.z=l.z;let v=g,y=-d;v.x+=a.x*y,v.y+=a.y*y,v.z+=a.z*y;let X=-u;v.x+=e.x*X,v.y+=e.y*X,v.z+=e.z*X;let z=-f;v.x+=_.x*z,v.y+=_.y*z,v.z+=_.z*z;let M=this.p,Y=0==M.sizeVec3?new Ut.common.Vec3:M.stackVec3[--M.sizeVec3];Y.x=l.x,Y.y=l.y,Y.z=l.z;let Z=Y,w=-d;Z.x+=a.x*w,Z.y+=a.y*w,Z.z+=a.z*w;let I=-u;Z.x+=e.x*I,Z.y+=e.y*I,Z.z+=e.z*I,Z.x+=_.x*f,Z.y+=_.y*f,Z.z+=_.z*f;let V=this.p,L=0==V.sizeVec3?new Ut.common.Vec3:V.stackVec3[--V.sizeVec3];L.x=l.x,L.y=l.y,L.z=l.z;let A=L,k=-d;A.x+=a.x*k,A.y+=a.y*k,A.z+=a.z*k,A.x+=e.x*u,A.y+=e.y*u,A.z+=e.z*u;let S=-f;A.x+=_.x*S,A.y+=_.y*S,A.z+=_.z*S;let B=this.p,P=0==B.sizeVec3?new Ut.common.Vec3:B.stackVec3[--B.sizeVec3];P.x=l.x,P.y=l.y,P.z=l.z;let C=P,T=-d;C.x+=a.x*T,C.y+=a.y*T,C.z+=a.z*T,C.x+=e.x*u,C.y+=e.y*u,C.z+=e.z*u,C.x+=_.x*f,C.y+=_.y*f,C.z+=_.z*f;let j=this.p,E=0==j.sizeVec3?new Ut.common.Vec3:j.stackVec3[--j.sizeVec3];E.x=l.x,E.y=l.y,E.z=l.z;let R=E;R.x+=a.x*d,R.y+=a.y*d,R.z+=a.z*d;let D=-u;R.x+=e.x*D,R.y+=e.y*D,R.z+=e.z*D;let F=-f;R.x+=_.x*F,R.y+=_.y*F,R.z+=_.z*F;let q=this.p,N=0==q.sizeVec3?new Ut.common.Vec3:q.stackVec3[--q.sizeVec3];N.x=l.x,N.y=l.y,N.z=l.z;let H=N;H.x+=a.x*d,H.y+=a.y*d,H.z+=a.z*d;let O=-u;H.x+=e.x*O,H.y+=e.y*O,H.z+=e.z*O,H.x+=_.x*f,H.y+=_.y*f,H.z+=_.z*f;let W=this.p,G=0==W.sizeVec3?new Ut.common.Vec3:W.stackVec3[--W.sizeVec3];G.x=l.x,G.y=l.y,G.z=l.z;let U=G;U.x+=a.x*d,U.y+=a.y*d,U.z+=a.z*d,U.x+=e.x*u,U.y+=e.y*u,U.z+=e.z*u;let J=-f;U.x+=_.x*J,U.y+=_.y*J,U.z+=_.z*J;let $=this.p,K=0==$.sizeVec3?new Ut.common.Vec3:$.stackVec3[--$.sizeVec3];K.x=l.x,K.y=l.y,K.z=l.z;let Q=K;if(Q.x+=a.x*d,Q.y+=a.y*d,Q.z+=a.z*d,Q.x+=e.x*u,Q.y+=e.y*u,Q.z+=e.z*u,Q.x+=_.x*f,Q.y+=_.y*f,Q.z+=_.z*f,this.wireframe)this.line(v,Z,s),this.line(A,C,s),this.line(R,H,s),this.line(U,Q,s),this.line(v,A,s),this.line(Z,C,s),this.line(R,U,s),this.line(H,Q,s),this.line(v,R,s),this.line(Z,H,s),this.line(A,U,s),this.line(C,Q,s);else{let t=this.p,i=0==t.sizeVec3?new Ut.common.Vec3:t.stackVec3[--t.sizeVec3];i.x=a.x,i.y=a.y,i.z=a.z;let n=i;n.x=-n.x,n.y=-n.y,n.z=-n.z;let o=this.p,r=0==o.sizeVec3?new Ut.common.Vec3:o.stackVec3[--o.sizeVec3];r.x=e.x,r.y=e.y,r.z=e.z;let h=r;h.x=-h.x,h.y=-h.y,h.z=-h.z;let l=this.p,c=0==l.sizeVec3?new Ut.common.Vec3:l.stackVec3[--l.sizeVec3];c.x=_.x,c.y=_.y,c.z=_.z;let m=c;m.x=-m.x,m.y=-m.y,m.z=-m.z,this.rect(v,Z,C,A,n,n,n,n,s),this.rect(R,U,Q,H,a,a,a,a,s),this.rect(v,R,H,Z,h,h,h,h,s),this.rect(A,C,Q,U,e,e,e,e,s),this.rect(v,A,U,R,m,m,m,m,s),this.rect(Z,H,Q,C,_,_,_,_,s);let b=this.p;if(null!=n){if(n.zero(),b.sizeVec3==b.stackVec3.length){let t=new Array(b.sizeVec3<<1),i=0,s=b.sizeVec3;for(;i<s;){let s=i++;t[s]=b.stackVec3[s],b.stackVec3[s]=null}b.stackVec3=t}b.stackVec3[b.sizeVec3++]=n}let p=this.p;if(null!=h){if(h.zero(),p.sizeVec3==p.stackVec3.length){let t=new Array(p.sizeVec3<<1),i=0,s=p.sizeVec3;for(;i<s;){let s=i++;t[s]=p.stackVec3[s],p.stackVec3[s]=null}p.stackVec3=t}p.stackVec3[p.sizeVec3++]=h}let d=this.p;if(null!=m){if(m.zero(),d.sizeVec3==d.stackVec3.length){let t=new Array(d.sizeVec3<<1),i=0,s=d.sizeVec3;for(;i<s;){let s=i++;t[s]=d.stackVec3[s],d.stackVec3[s]=null}d.stackVec3=t}d.stackVec3[d.sizeVec3++]=m}}let tt=this.p;if(null!=v){if(v.zero(),tt.sizeVec3==tt.stackVec3.length){let t=new Array(tt.sizeVec3<<1),i=0,s=tt.sizeVec3;for(;i<s;){let s=i++;t[s]=tt.stackVec3[s],tt.stackVec3[s]=null}tt.stackVec3=t}tt.stackVec3[tt.sizeVec3++]=v}let it=this.p;if(null!=Z){if(Z.zero(),it.sizeVec3==it.stackVec3.length){let t=new Array(it.sizeVec3<<1),i=0,s=it.sizeVec3;for(;i<s;){let s=i++;t[s]=it.stackVec3[s],it.stackVec3[s]=null}it.stackVec3=t}it.stackVec3[it.sizeVec3++]=Z}let st=this.p;if(null!=A){if(A.zero(),st.sizeVec3==st.stackVec3.length){let t=new Array(st.sizeVec3<<1),i=0,s=st.sizeVec3;for(;i<s;){let s=i++;t[s]=st.stackVec3[s],st.stackVec3[s]=null}st.stackVec3=t}st.stackVec3[st.sizeVec3++]=A}let nt=this.p;if(null!=C){if(C.zero(),nt.sizeVec3==nt.stackVec3.length){let t=new Array(nt.sizeVec3<<1),i=0,s=nt.sizeVec3;for(;i<s;){let s=i++;t[s]=nt.stackVec3[s],nt.stackVec3[s]=null}nt.stackVec3=t}nt.stackVec3[nt.sizeVec3++]=C}let at=this.p;if(null!=R){if(R.zero(),at.sizeVec3==at.stackVec3.length){let t=new Array(at.sizeVec3<<1),i=0,s=at.sizeVec3;for(;i<s;){let s=i++;t[s]=at.stackVec3[s],at.stackVec3[s]=null}at.stackVec3=t}at.stackVec3[at.sizeVec3++]=R}let ot=this.p;if(null!=H){if(H.zero(),ot.sizeVec3==ot.stackVec3.length){let t=new Array(ot.sizeVec3<<1),i=0,s=ot.sizeVec3;for(;i<s;){let s=i++;t[s]=ot.stackVec3[s],ot.stackVec3[s]=null}ot.stackVec3=t}ot.stackVec3[ot.sizeVec3++]=H}let et=this.p;if(null!=U){if(U.zero(),et.sizeVec3==et.stackVec3.length){let t=new Array(et.sizeVec3<<1),i=0,s=et.sizeVec3;for(;i<s;){let s=i++;t[s]=et.stackVec3[s],et.stackVec3[s]=null}et.stackVec3=t}et.stackVec3[et.sizeVec3++]=U}let rt=this.p;if(null!=Q){if(Q.zero(),rt.sizeVec3==rt.stackVec3.length){let t=new Array(rt.sizeVec3<<1),i=0,s=rt.sizeVec3;for(;i<s;){let s=i++;t[s]=rt.stackVec3[s],rt.stackVec3[s]=null}rt.stackVec3=t}rt.stackVec3[rt.sizeVec3++]=Q}let _t=this.p;if(null!=l){if(l.zero(),_t.sizeVec3==_t.stackVec3.length){let t=new Array(_t.sizeVec3<<1),i=0,s=_t.sizeVec3;for(;i<s;){let s=i++;t[s]=_t.stackVec3[s],_t.stackVec3[s]=null}_t.stackVec3=t}_t.stackVec3[_t.sizeVec3++]=l}let ht=this.p;if(null!=m){if(m.e00=1,m.e01=0,m.e02=0,m.e10=0,m.e11=1,m.e12=0,m.e20=0,m.e21=0,m.e22=1,ht.sizeMat3==ht.stackMat3.length){let t=new Array(ht.sizeMat3<<1),i=0,s=ht.sizeMat3;for(;i<s;){let s=i++;t[s]=ht.stackMat3[s],ht.stackMat3[s]=null}ht.stackMat3=t}ht.stackMat3[ht.sizeMat3++]=m}let lt=this.p;if(null!=a){if(a.zero(),lt.sizeVec3==lt.stackVec3.length){let t=new Array(lt.sizeVec3<<1),i=0,s=lt.sizeVec3;for(;i<s;){let s=i++;t[s]=lt.stackVec3[s],lt.stackVec3[s]=null}lt.stackVec3=t}lt.stackVec3[lt.sizeVec3++]=a}let ct=this.p;if(null!=e){if(e.zero(),ct.sizeVec3==ct.stackVec3.length){let t=new Array(ct.sizeVec3<<1),i=0,s=ct.sizeVec3;for(;i<s;){let s=i++;t[s]=ct.stackVec3[s],ct.stackVec3[s]=null}ct.stackVec3=t}ct.stackVec3[ct.sizeVec3++]=e}let mt=this.p;if(null!=_){if(_.zero(),mt.sizeVec3==mt.stackVec3.length){let t=new Array(mt.sizeVec3<<1),i=0,s=mt.sizeVec3;for(;i<s;){let s=i++;t[s]=mt.stackVec3[s],mt.stackVec3[s]=null}mt.stackVec3=t}mt.stackVec3[mt.sizeVec3++]=_}}rect(t,i,s,n,a,o,e,r,_){this.triangle(t,i,s,a,o,e,_),this.triangle(t,s,n,a,e,r,_)}point(t,i){}triangle(t,i,s,n,a,o,e){}line(t,i,s){}},Ut.dynamics.common.DebugDrawStyle=class{constructor(){this.basisColorZ=new Ut.common.Vec3(0,0,1),this.basisColorY=new Ut.common.Vec3(0,1,0),this.basisColorX=new Ut.common.Vec3(1,0,0),this.basisLength=.5,this.jointRotationalConstraintRadius=.3,this.jointErrorColor=new Ut.common.Vec3(1,.1,.1),this.jointLineColor=new Ut.common.Vec3(.8,.8,.8),this.contactBinormalLength=.5,this.contactTangentLength=.5,this.contactNormalLength=.5,this.contactBinormalColor=new Ut.common.Vec3(.2,.2,1),this.contactTangentColor=new Ut.common.Vec3(.1,.8,.1),this.contactNormalColor=new Ut.common.Vec3(1,.1,.1),this.disabledContactColor=new Ut.common.Vec3(.5,.1,.1),this.newContactColor=new Ut.common.Vec3(1,1,.1),this.contactColor4=new Ut.common.Vec3(.8,.1,1),this.contactColor3=new Ut.common.Vec3(.1,.8,.6),this.contactColor2=new Ut.common.Vec3(1,.6,.1),this.contactColor=new Ut.common.Vec3(1,.1,.1),this.pairColor=new Ut.common.Vec3(1,1,.1),this.bvhNodeColor=new Ut.common.Vec3(.4,.4,.4),this.aabbColor=new Ut.common.Vec3(1,.1,.1),this.kinematicShapeColor=new Ut.common.Vec3(1,.5,.1),this.staticShapeColor=new Ut.common.Vec3(.7,.7,.7),this.sleepingShapeColor2=new Ut.common.Vec3(.2,.8,.5),this.sleepingShapeColor1=new Ut.common.Vec3(.3,.3,.8),this.sleepyShapeColor2=new Ut.common.Vec3(.6,.8,.3),this.sleepyShapeColor1=new Ut.common.Vec3(.5,.25,.6),this.shapeColor2=new Ut.common.Vec3(1,.8,.1),this.shapeColor1=new Ut.common.Vec3(.7,.2,.4)}},Ut.dynamics.common.Performance=class{},Ut.dynamics.constraint||(Ut.dynamics.constraint={}),Ut.dynamics.constraint.ConstraintSolver=class{constructor(){this._b1=null,this._b2=null,this._addedToIsland=!1}preSolveVelocity(t){}warmStart(t){}solveVelocity(){}postSolveVelocity(t){}preSolvePosition(t){}solvePositionSplitImpulse(){}solvePositionNgs(t){}postSolve(){}},Ut.dynamics.constraint.PositionCorrectionAlgorithm=class{},Ut.dynamics.constraint.contact||(Ut.dynamics.constraint.contact={}),Ut.dynamics.constraint.contact.ContactConstraint=class{constructor(t){this._solver=new Ut.dynamics.constraint.solver.pgs.PgsContactConstraintSolver(this),this._manifold=t}_getVelocitySolverInfo(t,i){let s,n,a,o,e,r,_,h,l;i.b1=this._b1,i.b2=this._b2,s=this._manifold._normalX,n=this._manifold._normalY,a=this._manifold._normalZ,o=this._manifold._tangentX,e=this._manifold._tangentY,r=this._manifold._tangentZ,_=this._manifold._binormalX,h=this._manifold._binormalY,l=this._manifold._binormalZ;let c=Math.sqrt(this._s1._friction*this._s2._friction),m=Math.sqrt(this._s1._restitution*this._s2._restitution),b=this._manifold._numPoints;i.numRows=0;let p=0;for(;p<b;){let b=this._manifold._points[p++];if(b._depth<0){b._disabled=!0;let t=b._impulse;t.impulseN=0,t.impulseT=0,t.impulseB=0,t.impulseP=0,t.impulseLX=0,t.impulseLY=0,t.impulseLZ=0;continue}b._disabled=!1;let d=i.rows[i.numRows++];d.friction=c,d.cfm=0;let u=d.jacobianN;u.lin1X=s,u.lin1Y=n,u.lin1Z=a,u.lin2X=s,u.lin2Y=n,u.lin2Z=a,u.ang1X=b._relPos1Y*a-b._relPos1Z*n,u.ang1Y=b._relPos1Z*s-b._relPos1X*a,u.ang1Z=b._relPos1X*n-b._relPos1Y*s,u.ang2X=b._relPos2Y*a-b._relPos2Z*n,u.ang2Y=b._relPos2Z*s-b._relPos2X*a,u.ang2Z=b._relPos2X*n-b._relPos2Y*s,u=d.jacobianT,u.lin1X=o,u.lin1Y=e,u.lin1Z=r,u.lin2X=o,u.lin2Y=e,u.lin2Z=r,u.ang1X=b._relPos1Y*r-b._relPos1Z*e,u.ang1Y=b._relPos1Z*o-b._relPos1X*r,u.ang1Z=b._relPos1X*e-b._relPos1Y*o,u.ang2X=b._relPos2Y*r-b._relPos2Z*e,u.ang2Y=b._relPos2Z*o-b._relPos2X*r,u.ang2Z=b._relPos2X*e-b._relPos2Y*o,u=d.jacobianB,u.lin1X=_,u.lin1Y=h,u.lin1Z=l,u.lin2X=_,u.lin2Y=h,u.lin2Z=l,u.ang1X=b._relPos1Y*l-b._relPos1Z*h,u.ang1Y=b._relPos1Z*_-b._relPos1X*l,u.ang1Z=b._relPos1X*h-b._relPos1Y*_,u.ang2X=b._relPos2Y*l-b._relPos2Z*h,u.ang2Y=b._relPos2Z*_-b._relPos2X*l,u.ang2Z=b._relPos2X*h-b._relPos2Y*_,u=d.jacobianN;let f=u.lin1X*this._b1._velX+u.lin1Y*this._b1._velY+u.lin1Z*this._b1._velZ+(u.ang1X*this._b1._angVelX+u.ang1Y*this._b1._angVelY+u.ang1Z*this._b1._angVelZ)-(u.lin2X*this._b2._velX+u.lin2Y*this._b2._velY+u.lin2Z*this._b2._velZ+(u.ang2X*this._b2._angVelX+u.ang2Y*this._b2._angVelY+u.ang2Z*this._b2._angVelZ));if(f<-Ut.common.Setting.contactEnableBounceThreshold&&!b._warmStarted?d.rhs=-f*m:d.rhs=0,this._positionCorrectionAlgorithm==Ut.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE&&b._depth>Ut.common.Setting.linearSlop){let i=(b._depth-Ut.common.Setting.linearSlop)*Ut.common.Setting.velocityBaumgarte*t.invDt;d.rhs<i&&(d.rhs=i)}if(!b._warmStarted){let t=b._impulse;t.impulseN=0,t.impulseT=0,t.impulseB=0,t.impulseP=0,t.impulseLX=0,t.impulseLY=0,t.impulseLZ=0}d.impulse=b._impulse}}_getPositionSolverInfo(t){let i,s,n;t.b1=this._b1,t.b2=this._b2,i=this._manifold._normalX,s=this._manifold._normalY,n=this._manifold._normalZ;let a=this._manifold._numPoints;t.numRows=0;let o=0;for(;o<a;){let a=this._manifold._points[o++];if(a._disabled)continue;let e=t.rows[t.numRows++],r=e.jacobianN;r.lin1X=i,r.lin1Y=s,r.lin1Z=n,r.lin2X=i,r.lin2Y=s,r.lin2Z=n,r.ang1X=a._relPos1Y*n-a._relPos1Z*s,r.ang1Y=a._relPos1Z*i-a._relPos1X*n,r.ang1Z=a._relPos1X*s-a._relPos1Y*i,r.ang2X=a._relPos2Y*n-a._relPos2Z*s,r.ang2Y=a._relPos2Z*i-a._relPos2X*n,r.ang2Z=a._relPos2X*s-a._relPos2Y*i,e.rhs=a._depth-Ut.common.Setting.linearSlop,e.rhs<0&&(e.rhs=0),e.impulse=a._impulse}}_syncManifold(){this._manifold._updateDepthsAndPositions(this._tf1,this._tf2)}getShape1(){return this._s1}getShape2(){return this._s2}getManifold(){return this._manifold}isTouching(){let t=0,i=this._manifold._numPoints;for(;t<i;)if(this._manifold._points[t++]._depth>=0)return!0;return!1}},Ut.dynamics.constraint.contact.ContactImpulse=class{constructor(){this.impulseN=0,this.impulseT=0,this.impulseB=0,this.impulseP=0,this.impulseLX=0,this.impulseLY=0,this.impulseLZ=0}copyFrom(t){this.impulseN=t.impulseN,this.impulseT=t.impulseT,this.impulseB=t.impulseB,this.impulseLX=t.impulseLX,this.impulseLY=t.impulseLY,this.impulseLZ=t.impulseLZ}},Ut.dynamics.constraint.contact.Manifold=class{constructor(){this._normalX=0,this._normalY=0,this._normalZ=0,this._tangentX=0,this._tangentY=0,this._tangentZ=0,this._binormalX=0,this._binormalY=0,this._binormalZ=0,this._numPoints=0,this._points=new Array(Ut.common.Setting.maxManifoldPoints);let t=0,i=Ut.common.Setting.maxManifoldPoints;for(;t<i;)this._points[t++]=new Ut.dynamics.constraint.contact.ManifoldPoint}_clear(){let t=0,i=this._numPoints;for(;t<i;){let i=this._points[t++];i._localPos1X=0,i._localPos1Y=0,i._localPos1Z=0,i._localPos2X=0,i._localPos2Y=0,i._localPos2Z=0,i._relPos1X=0,i._relPos1Y=0,i._relPos1Z=0,i._relPos2X=0,i._relPos2Y=0,i._relPos2Z=0,i._pos1X=0,i._pos1Y=0,i._pos1Z=0,i._pos2X=0,i._pos2Y=0,i._pos2Z=0,i._depth=0;let s=i._impulse;s.impulseN=0,s.impulseT=0,s.impulseB=0,s.impulseP=0,s.impulseLX=0,s.impulseLY=0,s.impulseLZ=0,i._warmStarted=!1,i._disabled=!1,i._id=-1}this._numPoints=0}_buildBasis(t){this._normalX=t.x,this._normalY=t.y,this._normalZ=t.z;let i,s,n,a,o,e,r=t.x,_=t.y,h=t.z,l=r*r,c=_*_,m=h*h;if(l<c)if(l<m){let t=1/Math.sqrt(c+m);i=0,s=-h*t,n=_*t,a=_*n-h*s,o=-r*n,e=r*s}else{let t=1/Math.sqrt(l+c);i=-_*t,s=r*t,n=0,a=-h*s,o=h*i,e=r*s-_*i}else if(c<m){let t=1/Math.sqrt(l+m);i=h*t,s=0,n=-r*t,a=_*n,o=h*i-r*n,e=-_*i}else{let t=1/Math.sqrt(l+c);i=-_*t,s=r*t,n=0,a=-h*s,o=h*i,e=r*s-_*i}this._tangentX=i,this._tangentY=s,this._tangentZ=n,this._binormalX=a,this._binormalY=o,this._binormalZ=e}_updateDepthsAndPositions(t,i){let s=0,n=this._numPoints;for(;s<n;){let n,a,o,e,r,_,h,l,c,m=this._points[s++];n=t._rotation00*m._localPos1X+t._rotation01*m._localPos1Y+t._rotation02*m._localPos1Z,a=t._rotation10*m._localPos1X+t._rotation11*m._localPos1Y+t._rotation12*m._localPos1Z,o=t._rotation20*m._localPos1X+t._rotation21*m._localPos1Y+t._rotation22*m._localPos1Z,m._relPos1X=n,m._relPos1Y=a,m._relPos1Z=o,e=i._rotation00*m._localPos2X+i._rotation01*m._localPos2Y+i._rotation02*m._localPos2Z,r=i._rotation10*m._localPos2X+i._rotation11*m._localPos2Y+i._rotation12*m._localPos2Z,_=i._rotation20*m._localPos2X+i._rotation21*m._localPos2Y+i._rotation22*m._localPos2Z,m._relPos2X=e,m._relPos2Y=r,m._relPos2Z=_,m._pos1X=m._relPos1X+t._positionX,m._pos1Y=m._relPos1Y+t._positionY,m._pos1Z=m._relPos1Z+t._positionZ,m._pos2X=m._relPos2X+i._positionX,m._pos2Y=m._relPos2Y+i._positionY,m._pos2Z=m._relPos2Z+i._positionZ,h=m._pos1X-m._pos2X,l=m._pos1Y-m._pos2Y,c=m._pos1Z-m._pos2Z,m._depth=-(h*this._normalX+l*this._normalY+c*this._normalZ)}}getNormal(){let t=new Ut.common.Vec3;return t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ,t}getNormalTo(t){t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ}getTangent(){let t=new Ut.common.Vec3;return t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ,t}getTangentTo(t){t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ}getBinormal(){let t=new Ut.common.Vec3;return t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ,t}getBinormalTo(t){t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ}getPoints(){return this._points}getNumPoints(){return this._numPoints}},Ut.dynamics.constraint.contact.ManifoldPoint=class{constructor(){this._localPos1X=0,this._localPos1Y=0,this._localPos1Z=0,this._localPos2X=0,this._localPos2Y=0,this._localPos2Z=0,this._relPos1X=0,this._relPos1Y=0,this._relPos1Z=0,this._relPos2X=0,this._relPos2Y=0,this._relPos2Z=0,this._pos1X=0,this._pos1Y=0,this._pos1Z=0,this._pos2X=0,this._pos2Y=0,this._pos2Z=0,this._depth=0,this._impulse=new Ut.dynamics.constraint.contact.ContactImpulse,this._warmStarted=!1,this._disabled=!1,this._id=-1}getPosition1(){let t=new Ut.common.Vec3;return t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z,t}getPosition1To(t){t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z}getPosition2(){let t=new Ut.common.Vec3;return t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z,t}getPosition2To(t){t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z}getDepth(){return this._depth}isWarmStarted(){return this._warmStarted}getNormalImpulse(){return this._impulse.impulseN}getTangentImpulse(){return this._impulse.impulseT}getBinormalImpulse(){return this._impulse.impulseB}isEnabled(){return!this._disabled}},Ut.dynamics.constraint.contact.ManifoldUpdater=class{constructor(t){this._manifold=t,this.numOldPoints=0,this.oldPoints=new Array(Ut.common.Setting.maxManifoldPoints);let i=0,s=Ut.common.Setting.maxManifoldPoints;for(;i<s;)this.oldPoints[i++]=new Ut.dynamics.constraint.contact.ManifoldPoint}removeOutdatedPoints(){let t=this._manifold._numPoints;for(;--t>=0;){let i,s,n,a=this._manifold._points[t];i=a._pos1X-a._pos2X,s=a._pos1Y-a._pos2Y,n=a._pos1Z-a._pos2Z;let o=this._manifold._normalX*i+this._manifold._normalY*s+this._manifold._normalZ*n;o>Ut.common.Setting.contactPersistenceThreshold?this.removeManifoldPoint(t):(i+=this._manifold._normalX*-o,s+=this._manifold._normalY*-o,n+=this._manifold._normalZ*-o,i*i+s*s+n*n>Ut.common.Setting.contactPersistenceThreshold*Ut.common.Setting.contactPersistenceThreshold&&this.removeManifoldPoint(t))}}removeManifoldPoint(t){let i=--this._manifold._numPoints;if(t!=i){let s=this._manifold._points[t];this._manifold._points[t]=this._manifold._points[i],this._manifold._points[i]=s}let s=this._manifold._points[i];s._localPos1X=0,s._localPos1Y=0,s._localPos1Z=0,s._localPos2X=0,s._localPos2Y=0,s._localPos2Z=0,s._relPos1X=0,s._relPos1Y=0,s._relPos1Z=0,s._relPos2X=0,s._relPos2Y=0,s._relPos2Z=0,s._pos1X=0,s._pos1Y=0,s._pos1Z=0,s._pos2X=0,s._pos2Y=0,s._pos2Z=0,s._depth=0;let n=s._impulse;n.impulseN=0,n.impulseT=0,n.impulseB=0,n.impulseP=0,n.impulseLX=0,n.impulseLY=0,n.impulseLZ=0,s._warmStarted=!1,s._disabled=!1,s._id=-1}addManifoldPoint(t,i,s){let n=this._manifold._numPoints;if(n==Ut.common.Setting.maxManifoldPoints){let n=this.computeTargetIndex(t,i,s),a=this._manifold._points[n],o=t.position1;a._pos1X=o.x,a._pos1Y=o.y,a._pos1Z=o.z;let e,r,_,h,l,c,m=t.position2;a._pos2X=m.x,a._pos2Y=m.y,a._pos2Z=m.z,a._relPos1X=a._pos1X-i._positionX,a._relPos1Y=a._pos1Y-i._positionY,a._relPos1Z=a._pos1Z-i._positionZ,a._relPos2X=a._pos2X-s._positionX,a._relPos2Y=a._pos2Y-s._positionY,a._relPos2Z=a._pos2Z-s._positionZ,e=i._rotation00*a._relPos1X+i._rotation10*a._relPos1Y+i._rotation20*a._relPos1Z,r=i._rotation01*a._relPos1X+i._rotation11*a._relPos1Y+i._rotation21*a._relPos1Z,_=i._rotation02*a._relPos1X+i._rotation12*a._relPos1Y+i._rotation22*a._relPos1Z,a._localPos1X=e,a._localPos1Y=r,a._localPos1Z=_,h=s._rotation00*a._relPos2X+s._rotation10*a._relPos2Y+s._rotation20*a._relPos2Z,l=s._rotation01*a._relPos2X+s._rotation11*a._relPos2Y+s._rotation21*a._relPos2Z,c=s._rotation02*a._relPos2X+s._rotation12*a._relPos2Y+s._rotation22*a._relPos2Z,a._localPos2X=h,a._localPos2Y=l,a._localPos2Z=c,a._depth=t.depth;let b=a._impulse;return b.impulseN=0,b.impulseT=0,b.impulseB=0,b.impulseP=0,b.impulseLX=0,b.impulseLY=0,b.impulseLZ=0,a._id=t.id,a._warmStarted=!1,void(a._disabled=!1)}let a=this._manifold._points[n],o=t.position1;a._pos1X=o.x,a._pos1Y=o.y,a._pos1Z=o.z;let e,r,_,h,l,c,m=t.position2;a._pos2X=m.x,a._pos2Y=m.y,a._pos2Z=m.z,a._relPos1X=a._pos1X-i._positionX,a._relPos1Y=a._pos1Y-i._positionY,a._relPos1Z=a._pos1Z-i._positionZ,a._relPos2X=a._pos2X-s._positionX,a._relPos2Y=a._pos2Y-s._positionY,a._relPos2Z=a._pos2Z-s._positionZ,e=i._rotation00*a._relPos1X+i._rotation10*a._relPos1Y+i._rotation20*a._relPos1Z,r=i._rotation01*a._relPos1X+i._rotation11*a._relPos1Y+i._rotation21*a._relPos1Z,_=i._rotation02*a._relPos1X+i._rotation12*a._relPos1Y+i._rotation22*a._relPos1Z,a._localPos1X=e,a._localPos1Y=r,a._localPos1Z=_,h=s._rotation00*a._relPos2X+s._rotation10*a._relPos2Y+s._rotation20*a._relPos2Z,l=s._rotation01*a._relPos2X+s._rotation11*a._relPos2Y+s._rotation21*a._relPos2Z,c=s._rotation02*a._relPos2X+s._rotation12*a._relPos2Y+s._rotation22*a._relPos2Z,a._localPos2X=h,a._localPos2Y=l,a._localPos2Z=c,a._depth=t.depth;let b=a._impulse;b.impulseN=0,b.impulseT=0,b.impulseB=0,b.impulseP=0,b.impulseLX=0,b.impulseLY=0,b.impulseLZ=0,a._id=t.id,a._warmStarted=!1,a._disabled=!1,this._manifold._numPoints++}computeTargetIndex(t,i,s){let n,a,o,e=this._manifold._points[0],r=this._manifold._points[1],_=this._manifold._points[2],h=this._manifold._points[3],l=e._depth,c=0;r._depth>l&&(l=r._depth,c=1),_._depth>l&&(l=_._depth,c=2),h._depth>l&&(c=3);let m=t.position1;n=m.x,a=m.y,o=m.z,n-=i._positionX,a-=i._positionY,o-=i._positionZ;let b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C,T,j,E,R=r._relPos1X,D=r._relPos1Y,F=r._relPos1Z,q=_._relPos1X,N=_._relPos1Y,H=_._relPos1Z,O=h._relPos1X,W=h._relPos1Y,G=h._relPos1Z;b=q-R,p=N-D,d=H-F,u=n-O,f=a-W,x=o-G,g=O-R,v=W-D,y=G-F,X=n-q,z=a-N,M=o-H,Y=n-R,Z=a-D,w=o-F,I=O-q,V=W-N,L=G-H,A=p*x-d*f,k=d*u-b*x,S=b*f-p*u,B=v*M-y*z,P=y*X-g*M,C=g*z-v*X,T=Z*L-w*V,j=w*I-Y*L,E=Y*V-Z*I;let U,J,$,K,Q,tt,it,st,nt,at,ot,et,rt,_t,ht,lt,ct,mt,bt,pt,dt,ut,ft,xt,gt,vt,yt,Xt=A*A+k*k+S*S,zt=B*B+P*P+C*C,Mt=T*T+j*j+E*E,Yt=e._relPos1X,Zt=e._relPos1Y,wt=e._relPos1Z,It=_._relPos1X,Vt=_._relPos1Y,Lt=_._relPos1Z,At=h._relPos1X,kt=h._relPos1Y,St=h._relPos1Z;U=It-Yt,J=Vt-Zt,$=Lt-wt,K=n-At,Q=a-kt,tt=o-St,it=At-Yt,st=kt-Zt,nt=St-wt,at=n-It,ot=a-Vt,et=o-Lt,rt=n-Yt,_t=a-Zt,ht=o-wt,lt=At-It,ct=kt-Vt,mt=St-Lt,bt=J*tt-$*Q,pt=$*K-U*tt,dt=U*Q-J*K,ut=st*et-nt*ot,ft=nt*at-it*et,xt=it*ot-st*at,gt=_t*mt-ht*ct,vt=ht*lt-rt*mt,yt=rt*ct-_t*lt;let Bt,Pt,Ct,Tt,jt,Et,Rt,Dt,Ft,qt,Nt,Ht,Ot,Wt,Gt,Ut,Jt,$t,Kt,Qt,ti,ii,si,ni,ai,oi,ei,ri=bt*bt+pt*pt+dt*dt,_i=ut*ut+ft*ft+xt*xt,hi=gt*gt+vt*vt+yt*yt,li=ri>_i?ri>hi?ri:hi:_i>hi?_i:hi,ci=e._relPos1X,mi=e._relPos1Y,bi=e._relPos1Z,pi=r._relPos1X,di=r._relPos1Y,ui=r._relPos1Z,fi=h._relPos1X,xi=h._relPos1Y,gi=h._relPos1Z;Bt=pi-ci,Pt=di-mi,Ct=ui-bi,Tt=n-fi,jt=a-xi,Et=o-gi,Rt=fi-ci,Dt=xi-mi,Ft=gi-bi,qt=n-pi,Nt=a-di,Ht=o-ui,Ot=n-ci,Wt=a-mi,Gt=o-bi,Ut=fi-pi,Jt=xi-di,$t=gi-ui,Kt=Pt*Et-Ct*jt,Qt=Ct*Tt-Bt*Et,ti=Bt*jt-Pt*Tt,ii=Dt*Ht-Ft*Nt,si=Ft*qt-Rt*Ht,ni=Rt*Nt-Dt*qt,ai=Wt*$t-Gt*Jt,oi=Gt*Ut-Ot*$t,ei=Ot*Jt-Wt*Ut;let vi,yi,Xi,zi,Mi,Yi,Zi,wi,Ii,Vi,Li,Ai,ki,Si,Bi,Pi,Ci,Ti,ji,Ei,Ri,Di,Fi,qi,Ni,Hi,Oi,Wi=Kt*Kt+Qt*Qt+ti*ti,Gi=ii*ii+si*si+ni*ni,Ui=ai*ai+oi*oi+ei*ei,Ji=Wi>Gi?Wi>Ui?Wi:Ui:Gi>Ui?Gi:Ui,$i=e._relPos1X,Ki=e._relPos1Y,Qi=e._relPos1Z,ts=r._relPos1X,is=r._relPos1Y,ss=r._relPos1Z,ns=_._relPos1X,as=_._relPos1Y,os=_._relPos1Z;vi=ts-$i,yi=is-Ki,Xi=ss-Qi,zi=n-ns,Mi=a-as,Yi=o-os,Zi=ns-$i,wi=as-Ki,Ii=os-Qi,Vi=n-ts,Li=a-is,Ai=o-ss,ki=n-$i,Si=a-Ki,Bi=o-Qi,Pi=ns-ts,Ci=as-is,Ti=os-ss,ji=yi*Yi-Xi*Mi,Ei=Xi*zi-vi*Yi,Ri=vi*Mi-yi*zi,Di=wi*Ai-Ii*Li,Fi=Ii*Vi-Zi*Ai,qi=Zi*Li-wi*Vi,Ni=Si*Ti-Bi*Ci,Hi=Bi*Pi-ki*Ti,Oi=ki*Ci-Si*Pi;let es=ji*ji+Ei*Ei+Ri*Ri,rs=Di*Di+Fi*Fi+qi*qi,_s=Ni*Ni+Hi*Hi+Oi*Oi,hs=Xt>zt?Xt>Mt?Xt:Mt:zt>Mt?zt:Mt,ls=0;return(li>hs&&1!=c||0==c)&&(hs=li,ls=1),Ji>hs&&2!=c&&(hs=Ji,ls=2),(es>rs?es>_s?es:_s:rs>_s?rs:_s)>hs&&3!=c&&(ls=3),ls}computeRelativePositions(t,i){let s=this._manifold._numPoints,n=0;for(;n<s;){let s,a,o,e,r,_,h=this._manifold._points[n++];s=t._rotation00*h._localPos1X+t._rotation01*h._localPos1Y+t._rotation02*h._localPos1Z,a=t._rotation10*h._localPos1X+t._rotation11*h._localPos1Y+t._rotation12*h._localPos1Z,o=t._rotation20*h._localPos1X+t._rotation21*h._localPos1Y+t._rotation22*h._localPos1Z,h._relPos1X=s,h._relPos1Y=a,h._relPos1Z=o,e=i._rotation00*h._localPos2X+i._rotation01*h._localPos2Y+i._rotation02*h._localPos2Z,r=i._rotation10*h._localPos2X+i._rotation11*h._localPos2Y+i._rotation12*h._localPos2Z,_=i._rotation20*h._localPos2X+i._rotation21*h._localPos2Y+i._rotation22*h._localPos2Z,h._relPos2X=e,h._relPos2Y=r,h._relPos2Z=_,h._warmStarted=!0}}findNearestContactPointIndex(t,i,s){let n=Ut.common.Setting.contactPersistenceThreshold*Ut.common.Setting.contactPersistenceThreshold,a=-1,o=0,e=this._manifold._numPoints;for(;o<e;){let e,r,_,h,l,c,m=o++,b=this._manifold._points[m],p=t.position1;e=p.x,r=p.y,_=p.z;let d,u,f,x,g,v,y=t.position2;h=y.x,l=y.y,c=y.z,e-=i._positionX,r-=i._positionY,_-=i._positionZ,h-=s._positionX,l-=s._positionY,c-=s._positionZ,d=b._relPos1X-e,u=b._relPos1Y-r,f=b._relPos1Z-_,x=b._relPos2X-h,g=b._relPos2Y-l,v=b._relPos2Z-c;let X=d*d+u*u+f*f,z=x*x+g*g+v*v,M=X<z?X:z;M<n&&(n=M,a=m)}return a}totalUpdate(t,i,s){this.numOldPoints=this._manifold._numPoints;let n=0,a=this.numOldPoints;for(;n<a;){let t=n++,i=this.oldPoints[t],s=this._manifold._points[t];i._localPos1X=s._localPos1X,i._localPos1Y=s._localPos1Y,i._localPos1Z=s._localPos1Z,i._localPos2X=s._localPos2X,i._localPos2Y=s._localPos2Y,i._localPos2Z=s._localPos2Z,i._relPos1X=s._relPos1X,i._relPos1Y=s._relPos1Y,i._relPos1Z=s._relPos1Z,i._relPos2X=s._relPos2X,i._relPos2Y=s._relPos2Y,i._relPos2Z=s._relPos2Z,i._pos1X=s._pos1X,i._pos1Y=s._pos1Y,i._pos1Z=s._pos1Z,i._pos2X=s._pos2X,i._pos2Y=s._pos2Y,i._pos2Z=s._pos2Z,i._depth=s._depth,i._impulse.copyFrom(s._impulse),i._id=s._id,i._warmStarted=s._warmStarted,i._disabled=!1}let o=t.numPoints;this._manifold._numPoints=o;let e=0;for(;e<o;){let n=e++,a=this._manifold._points[n],o=t.points[n],r=o.position1;a._pos1X=r.x,a._pos1Y=r.y,a._pos1Z=r.z;let _,h,l,c,m,b,p=o.position2;a._pos2X=p.x,a._pos2Y=p.y,a._pos2Z=p.z,a._relPos1X=a._pos1X-i._positionX,a._relPos1Y=a._pos1Y-i._positionY,a._relPos1Z=a._pos1Z-i._positionZ,a._relPos2X=a._pos2X-s._positionX,a._relPos2Y=a._pos2Y-s._positionY,a._relPos2Z=a._pos2Z-s._positionZ,_=i._rotation00*a._relPos1X+i._rotation10*a._relPos1Y+i._rotation20*a._relPos1Z,h=i._rotation01*a._relPos1X+i._rotation11*a._relPos1Y+i._rotation21*a._relPos1Z,l=i._rotation02*a._relPos1X+i._rotation12*a._relPos1Y+i._rotation22*a._relPos1Z,a._localPos1X=_,a._localPos1Y=h,a._localPos1Z=l,c=s._rotation00*a._relPos2X+s._rotation10*a._relPos2Y+s._rotation20*a._relPos2Z,m=s._rotation01*a._relPos2X+s._rotation11*a._relPos2Y+s._rotation21*a._relPos2Z,b=s._rotation02*a._relPos2X+s._rotation12*a._relPos2Y+s._rotation22*a._relPos2Z,a._localPos2X=c,a._localPos2Y=m,a._localPos2Z=b,a._depth=o.depth;let d=a._impulse;d.impulseN=0,d.impulseT=0,d.impulseB=0,d.impulseP=0,d.impulseLX=0,d.impulseLY=0,d.impulseLZ=0,a._id=o.id,a._warmStarted=!1,a._disabled=!1;let u=0,f=this.numOldPoints;for(;u<f;){let t=this.oldPoints[u++];if(a._id==t._id){a._impulse.copyFrom(t._impulse),a._warmStarted=!0;break}}}}incrementalUpdate(t,i,s){this._manifold._updateDepthsAndPositions(i,s);let n=0,a=this._manifold._numPoints;for(;n<a;)this._manifold._points[n++]._warmStarted=!0;let o=t.points[0],e=this.findNearestContactPointIndex(o,i,s);if(-1==e)this.addManifoldPoint(o,i,s);else{let t=this._manifold._points[e],n=o.position1;t._pos1X=n.x,t._pos1Y=n.y,t._pos1Z=n.z;let a,r,_,h,l,c,m=o.position2;t._pos2X=m.x,t._pos2Y=m.y,t._pos2Z=m.z,t._relPos1X=t._pos1X-i._positionX,t._relPos1Y=t._pos1Y-i._positionY,t._relPos1Z=t._pos1Z-i._positionZ,t._relPos2X=t._pos2X-s._positionX,t._relPos2Y=t._pos2Y-s._positionY,t._relPos2Z=t._pos2Z-s._positionZ,a=i._rotation00*t._relPos1X+i._rotation10*t._relPos1Y+i._rotation20*t._relPos1Z,r=i._rotation01*t._relPos1X+i._rotation11*t._relPos1Y+i._rotation21*t._relPos1Z,_=i._rotation02*t._relPos1X+i._rotation12*t._relPos1Y+i._rotation22*t._relPos1Z,t._localPos1X=a,t._localPos1Y=r,t._localPos1Z=_,h=s._rotation00*t._relPos2X+s._rotation10*t._relPos2Y+s._rotation20*t._relPos2Z,l=s._rotation01*t._relPos2X+s._rotation11*t._relPos2Y+s._rotation21*t._relPos2Z,c=s._rotation02*t._relPos2X+s._rotation12*t._relPos2Y+s._rotation22*t._relPos2Z,t._localPos2X=h,t._localPos2Y=l,t._localPos2Z=c,t._depth=o.depth}this.removeOutdatedPoints()}},Ut.dynamics.constraint.info||(Ut.dynamics.constraint.info={}),Ut.dynamics.constraint.info.JacobianRow=class{constructor(){this.lin1X=0,this.lin1Y=0,this.lin1Z=0,this.lin2X=0,this.lin2Y=0,this.lin2Z=0,this.ang1X=0,this.ang1Y=0,this.ang1Z=0,this.ang2X=0,this.ang2Y=0,this.ang2Z=0,this.flag=0}updateSparsity(){this.flag=0,0==this.lin1X&&0==this.lin1Y&&0==this.lin1Z&&0==this.lin2X&&0==this.lin2Y&&0==this.lin2Z||(this.flag|=1),0==this.ang1X&&0==this.ang1Y&&0==this.ang1Z&&0==this.ang2X&&0==this.ang2Y&&0==this.ang2Z||(this.flag|=2)}},Ut.dynamics.constraint.info.contact||(Ut.dynamics.constraint.info.contact={}),Ut.dynamics.constraint.info.contact.ContactSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0,this.rows=new Array(Ut.common.Setting.maxManifoldPoints);let t=0,i=this.rows.length;for(;t<i;)this.rows[t++]=new Ut.dynamics.constraint.info.contact.ContactSolverInfoRow}},Ut.dynamics.constraint.info.contact.ContactSolverInfoRow=class{constructor(){this.jacobianN=new Ut.dynamics.constraint.info.JacobianRow,this.jacobianT=new Ut.dynamics.constraint.info.JacobianRow,this.jacobianB=new Ut.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.friction=0,this.impulse=null}},Ut.dynamics.constraint.info.joint||(Ut.dynamics.constraint.info.joint={}),Ut.dynamics.constraint.info.joint.JointSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0,this.rows=new Array(Ut.common.Setting.maxJacobianRows);let t=0,i=this.rows.length;for(;t<i;)this.rows[t++]=new Ut.dynamics.constraint.info.joint.JointSolverInfoRow}},Ut.dynamics.constraint.info.joint.JointSolverInfoRow=class{constructor(){this.jacobian=new Ut.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.minImpulse=0,this.maxImpulse=0,this.motorSpeed=0,this.motorMaxImpulse=0,this.impulse=null}},Ut.dynamics.constraint.joint||(Ut.dynamics.constraint.joint={}),Ut.dynamics.constraint.joint.BasisTracker=class{constructor(t){this.joint=t,this.xX=0,this.xY=0,this.xZ=0,this.yX=0,this.yY=0,this.yZ=0,this.zX=0,this.zY=0,this.zZ=0}},Ut.dynamics.constraint.joint.Joint=class{constructor(t,i){switch(this._link1=new Ut.dynamics.constraint.joint.JointLink(this),this._link2=new Ut.dynamics.constraint.joint.JointLink(this),this._positionCorrectionAlgorithm=Ut.common.Setting.defaultJointPositionCorrectionAlgorithm,this._type=i,this._world=null,this._b1=t.rigidBody1,this._b2=t.rigidBody2,this._allowCollision=t.allowCollision,this._breakForce=t.breakForce,this._breakTorque=t.breakTorque,t.solverType){case 0:this._solver=new Ut.dynamics.constraint.solver.pgs.PgsJointConstraintSolver(this);break;case 1:this._solver=new Ut.dynamics.constraint.solver.direct.DirectJointConstraintSolver(this)}let s=t.localAnchor1;this._localAnchor1X=s.x,this._localAnchor1Y=s.y,this._localAnchor1Z=s.z;let n=t.localAnchor2;this._localAnchor2X=n.x,this._localAnchor2Y=n.y,this._localAnchor2Z=n.z,this._relativeAnchor1X=0,this._relativeAnchor1Y=0,this._relativeAnchor1Z=0,this._relativeAnchor2X=0,this._relativeAnchor2Y=0,this._relativeAnchor2Z=0,this._anchor1X=0,this._anchor1Y=0,this._anchor1Z=0,this._anchor2X=0,this._anchor2Y=0,this._anchor2Z=0,this._localBasisX1X=0,this._localBasisX1Y=0,this._localBasisX1Z=0,this._localBasisY1X=0,this._localBasisY1Y=0,this._localBasisY1Z=0,this._localBasisZ1X=0,this._localBasisZ1Y=0,this._localBasisZ1Z=0,this._localBasisX2X=0,this._localBasisX2Y=0,this._localBasisX2Z=0,this._localBasisY2X=0,this._localBasisY2Y=0,this._localBasisY2Z=0,this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=0,this._impulses=new Array(Ut.common.Setting.maxJacobianRows);let a=0,o=Ut.common.Setting.maxJacobianRows;for(;a<o;)this._impulses[a++]=new Ut.dynamics.constraint.joint.JointImpulse}buildLocalBasesFromX(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{let t=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX2X*=t,this._localBasisX2Y*=t,this._localBasisX2Z*=t}let t,i,s,n,a,o,e,r,_,h,l,c,m,b=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(b<-.999999999){let a,o,e,r,_=this._localBasisX1X,h=this._localBasisX1Y,l=this._localBasisX1Z,c=_*_,m=h*h,b=l*l;c<m?c<b?(r=1/Math.sqrt(m+b),a=0,o=l*r,e=-h*r):(r=1/Math.sqrt(c+m),a=h*r,o=-_*r,e=0):m<b?(r=1/Math.sqrt(b+c),a=-l*r,o=0,e=_*r):(r=1/Math.sqrt(c+m),a=h*r,o=-_*r,e=0),t=a,i=o,s=e,n=0}else{let a,o,e;a=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,o=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,e=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;let r=Math.sqrt(.5*(1+b));b=.5/r,a*=b,o*=b,e*=b,t=a,i=o,s=e,n=r}let p=2*t,d=2*i,u=2*s,f=t*p,x=i*d,g=s*u,v=t*d,y=i*u,X=t*u,z=n*p,M=n*d,Y=n*u;a=1-x-g,o=v-Y,e=X+M,r=v+Y,_=1-f-g,h=y-z,l=X-M,c=y+z,m=1-f-x;let Z,w,I,V,L,A,k,S,B,P,C=this._localBasisX1X,T=this._localBasisX1Y,j=this._localBasisX1Z,E=C*C,R=T*T,D=j*j;E<R?E<D?(Z=1/Math.sqrt(R+D),this._localBasisY1X=0,this._localBasisY1Y=j*Z,this._localBasisY1Z=-T*Z):(Z=1/Math.sqrt(E+R),this._localBasisY1X=T*Z,this._localBasisY1Y=-C*Z,this._localBasisY1Z=0):R<D?(Z=1/Math.sqrt(D+E),this._localBasisY1X=-j*Z,this._localBasisY1Y=0,this._localBasisY1Z=C*Z):(Z=1/Math.sqrt(E+R),this._localBasisY1X=T*Z,this._localBasisY1Y=-C*Z,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,w=a*this._localBasisX1X+o*this._localBasisX1Y+e*this._localBasisX1Z,I=r*this._localBasisX1X+_*this._localBasisX1Y+h*this._localBasisX1Z,V=l*this._localBasisX1X+c*this._localBasisX1Y+m*this._localBasisX1Z,this._localBasisX2X=w,this._localBasisX2Y=I,this._localBasisX2Z=V,L=a*this._localBasisY1X+o*this._localBasisY1Y+e*this._localBasisY1Z,A=r*this._localBasisY1X+_*this._localBasisY1Y+h*this._localBasisY1Z,k=l*this._localBasisY1X+c*this._localBasisY1Y+m*this._localBasisY1Z,this._localBasisY2X=L,this._localBasisY2Y=A,this._localBasisY2Z=k,S=a*this._localBasisZ1X+o*this._localBasisZ1Y+e*this._localBasisZ1Z,B=r*this._localBasisZ1X+_*this._localBasisZ1Y+h*this._localBasisZ1Z,P=l*this._localBasisZ1X+c*this._localBasisZ1Y+m*this._localBasisZ1Z,this._localBasisZ2X=S,this._localBasisZ2Y=B,this._localBasisZ2Z=P}buildLocalBasesFromXY(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{let t=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX2X*=t,this._localBasisX2Y*=t,this._localBasisX2Z*=t}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){let t,i=this._localBasisX1X,s=this._localBasisX1Y,n=this._localBasisX1Z,a=i*i,o=s*s,e=n*n;a<o?a<e?(t=1/Math.sqrt(o+e),this._localBasisY1X=0,this._localBasisY1Y=n*t,this._localBasisY1Z=-s*t):(t=1/Math.sqrt(a+o),this._localBasisY1X=s*t,this._localBasisY1Y=-i*t,this._localBasisY1Z=0):o<e?(t=1/Math.sqrt(e+a),this._localBasisY1X=-n*t,this._localBasisY1Y=0,this._localBasisY1Z=i*t):(t=1/Math.sqrt(a+o),this._localBasisY1X=s*t,this._localBasisY1Y=-i*t,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{let t=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ1X*=t,this._localBasisZ1Y*=t,this._localBasisZ1Z*=t,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0){let t,i=this._localBasisX2X,s=this._localBasisX2Y,n=this._localBasisX2Z,a=i*i,o=s*s,e=n*n;a<o?a<e?(t=1/Math.sqrt(o+e),this._localBasisY2X=0,this._localBasisY2Y=n*t,this._localBasisY2Z=-s*t):(t=1/Math.sqrt(a+o),this._localBasisY2X=s*t,this._localBasisY2Y=-i*t,this._localBasisY2Z=0):o<e?(t=1/Math.sqrt(e+a),this._localBasisY2X=-n*t,this._localBasisY2Y=0,this._localBasisY2Z=i*t):(t=1/Math.sqrt(a+o),this._localBasisY2X=s*t,this._localBasisY2Y=-i*t,this._localBasisY2Z=0),this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X}else{let t=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ2X*=t,this._localBasisZ2Y*=t,this._localBasisZ2Z*=t,this._localBasisY2X=this._localBasisZ2Y*this._localBasisX2Z-this._localBasisZ2Z*this._localBasisX2Y,this._localBasisY2Y=this._localBasisZ2Z*this._localBasisX2X-this._localBasisZ2X*this._localBasisX2Z,this._localBasisY2Z=this._localBasisZ2X*this._localBasisX2Y-this._localBasisZ2Y*this._localBasisX2X}}buildLocalBasesFromX1Z2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0)this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=1;else{let t=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ2X*=t,this._localBasisZ2Y*=t,this._localBasisZ2Z*=t}let t,i,s,n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C,T,j,E=this._b1._transform,R=this._b2._transform;if(d=E._rotation00*this._localBasisX1X+E._rotation01*this._localBasisX1Y+E._rotation02*this._localBasisX1Z,u=E._rotation10*this._localBasisX1X+E._rotation11*this._localBasisX1Y+E._rotation12*this._localBasisX1Z,f=E._rotation20*this._localBasisX1X+E._rotation21*this._localBasisX1Y+E._rotation22*this._localBasisX1Z,t=d,i=u,s=f,x=R._rotation00*this._localBasisZ2X+R._rotation01*this._localBasisZ2Y+R._rotation02*this._localBasisZ2Z,g=R._rotation10*this._localBasisZ2X+R._rotation11*this._localBasisZ2Y+R._rotation12*this._localBasisZ2Z,v=R._rotation20*this._localBasisZ2X+R._rotation21*this._localBasisZ2Y+R._rotation22*this._localBasisZ2Z,m=x,b=g,p=v,e=b*s-p*i,r=p*t-m*s,_=m*i-b*t,e*e+r*r+_*_==0){let n,a=t,o=i,h=s,l=a*a,c=o*o,m=h*h;l<c?l<m?(n=1/Math.sqrt(c+m),e=0,r=h*n,_=-o*n):(n=1/Math.sqrt(l+c),e=o*n,r=-a*n,_=0):c<m?(n=1/Math.sqrt(m+l),e=-h*n,r=0,_=a*n):(n=1/Math.sqrt(l+c),e=o*n,r=-a*n,_=0)}n=i*_-s*r,a=s*e-t*_,o=t*r-i*e,h=r*p-_*b,l=_*m-e*p,c=e*b-r*m,y=E._rotation00*t+E._rotation10*i+E._rotation20*s,X=E._rotation01*t+E._rotation11*i+E._rotation21*s,z=E._rotation02*t+E._rotation12*i+E._rotation22*s,this._localBasisX1X=y,this._localBasisX1Y=X,this._localBasisX1Z=z,M=E._rotation00*e+E._rotation10*r+E._rotation20*_,Y=E._rotation01*e+E._rotation11*r+E._rotation21*_,Z=E._rotation02*e+E._rotation12*r+E._rotation22*_,this._localBasisY1X=M,this._localBasisY1Y=Y,this._localBasisY1Z=Z,w=E._rotation00*n+E._rotation10*a+E._rotation20*o,I=E._rotation01*n+E._rotation11*a+E._rotation21*o,V=E._rotation02*n+E._rotation12*a+E._rotation22*o,this._localBasisZ1X=w,this._localBasisZ1Y=I,this._localBasisZ1Z=V,L=R._rotation00*h+R._rotation10*l+R._rotation20*c,A=R._rotation01*h+R._rotation11*l+R._rotation21*c,k=R._rotation02*h+R._rotation12*l+R._rotation22*c,this._localBasisX2X=L,this._localBasisX2Y=A,this._localBasisX2Z=k,S=R._rotation00*e+R._rotation10*r+R._rotation20*_,B=R._rotation01*e+R._rotation11*r+R._rotation21*_,P=R._rotation02*e+R._rotation12*r+R._rotation22*_,this._localBasisY2X=S,this._localBasisY2Y=B,this._localBasisY2Z=P,C=R._rotation00*m+R._rotation10*b+R._rotation20*p,T=R._rotation01*m+R._rotation11*b+R._rotation21*p,j=R._rotation02*m+R._rotation12*b+R._rotation22*p,this._localBasisZ2X=C,this._localBasisZ2Y=T,this._localBasisZ2Z=j}buildLocalBasesFromXY1X2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){let t,i=this._localBasisX1X,s=this._localBasisX1Y,n=this._localBasisX1Z,a=i*i,o=s*s,e=n*n;a<o?a<e?(t=1/Math.sqrt(o+e),this._localBasisY1X=0,this._localBasisY1Y=n*t,this._localBasisY1Z=-s*t):(t=1/Math.sqrt(a+o),this._localBasisY1X=s*t,this._localBasisY1Y=-i*t,this._localBasisY1Z=0):o<e?(t=1/Math.sqrt(e+a),this._localBasisY1X=-n*t,this._localBasisY1Y=0,this._localBasisY1Z=i*t):(t=1/Math.sqrt(a+o),this._localBasisY1X=s*t,this._localBasisY1Y=-i*t,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{let t=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ1X*=t,this._localBasisZ1Y*=t,this._localBasisZ1Z*=t,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}let t,i,s,n,a,o,e,r,_,h,l,c,m,b=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(b<-.999999999){let a,o,e,r,_=this._localBasisX1X,h=this._localBasisX1Y,l=this._localBasisX1Z,c=_*_,m=h*h,b=l*l;c<m?c<b?(r=1/Math.sqrt(m+b),a=0,o=l*r,e=-h*r):(r=1/Math.sqrt(c+m),a=h*r,o=-_*r,e=0):m<b?(r=1/Math.sqrt(b+c),a=-l*r,o=0,e=_*r):(r=1/Math.sqrt(c+m),a=h*r,o=-_*r,e=0),t=a,i=o,s=e,n=0}else{let a,o,e;a=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,o=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,e=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;let r=Math.sqrt(.5*(1+b));b=.5/r,a*=b,o*=b,e*=b,t=a,i=o,s=e,n=r}let p,d,u,f,x,g,v,y,X,z=2*t,M=2*i,Y=2*s,Z=t*z,w=i*M,I=s*Y,V=t*M,L=i*Y,A=t*Y,k=n*z,S=n*M,B=n*Y;a=1-w-I,o=V-B,e=A+S,r=V+B,_=1-Z-I,h=L-k,l=A-S,c=L+k,m=1-Z-w,p=a*this._localBasisX1X+o*this._localBasisX1Y+e*this._localBasisX1Z,d=r*this._localBasisX1X+_*this._localBasisX1Y+h*this._localBasisX1Z,u=l*this._localBasisX1X+c*this._localBasisX1Y+m*this._localBasisX1Z,this._localBasisX2X=p,this._localBasisX2Y=d,this._localBasisX2Z=u,f=a*this._localBasisY1X+o*this._localBasisY1Y+e*this._localBasisY1Z,x=r*this._localBasisY1X+_*this._localBasisY1Y+h*this._localBasisY1Z,g=l*this._localBasisY1X+c*this._localBasisY1Y+m*this._localBasisY1Z,this._localBasisY2X=f,this._localBasisY2Y=x,this._localBasisY2Z=g,v=a*this._localBasisZ1X+o*this._localBasisZ1Y+e*this._localBasisZ1Z,y=r*this._localBasisZ1X+_*this._localBasisZ1Y+h*this._localBasisZ1Z,X=l*this._localBasisZ1X+c*this._localBasisZ1Y+m*this._localBasisZ1Z,this._localBasisZ2X=v,this._localBasisZ2Y=y,this._localBasisZ2Z=X}setSolverInfoRowLinear(t,i,s,n,a,o,e){let r,_,h=Ut.common.Setting.linearSlop;if(e)r=0,_=1;else{if(a.frequency>0){h=0;let t=6.28318530717958*a.frequency,i=a.dampingRatio;i<Ut.common.Setting.minSpringDamperDampingRatio&&(i=Ut.common.Setting.minSpringDamperDampingRatio);let s=o.dt,n=2*i*t,e=t*t;a.useSymplecticEuler?(r=1/(s*n),_=e/n):(r=1/(s*(s*e+n)),_=e/(s*e+n))}else r=0,_=this.getErp(o,!1);s.motorForce>0?(t.motorSpeed=s.motorSpeed,t.motorMaxImpulse=s.motorForce*o.dt):(t.motorSpeed=0,t.motorMaxImpulse=0)}let l,c,m,b=s.lowerLimit,p=s.upperLimit;b>p?(l=0,c=0,m=0):b==p?(l=-1/0,c=1/0,m=i-b):i<b?(l=-1/0,c=0,m=i-b+h,m>0&&(m=0)):i>p?(l=0,c=1/0,m=i-p-h,m<0&&(m=0)):(l=0,c=0,m=0),t.minImpulse=l,t.maxImpulse=c,t.cfm=r*(0==n?0:1/n),t.rhs=m*_}setSolverInfoRowAngular(t,i,s,n,a,o,e){let r,_,h=Ut.common.Setting.angularSlop;if(e)r=0,_=1;else{if(a.frequency>0){h=0;let t=6.28318530717958*a.frequency,i=a.dampingRatio;i<Ut.common.Setting.minSpringDamperDampingRatio&&(i=Ut.common.Setting.minSpringDamperDampingRatio);let s=o.dt,n=2*i*t,e=t*t;a.useSymplecticEuler?(r=1/(s*n),_=e/n):(r=1/(s*(s*e+n)),_=e/(s*e+n))}else r=0,_=this.getErp(o,!1);s.motorTorque>0?(t.motorSpeed=s.motorSpeed,t.motorMaxImpulse=s.motorTorque*o.dt):(t.motorSpeed=0,t.motorMaxImpulse=0)}let l,c,m,b=s.lowerLimit,p=s.upperLimit,d=.5*(b+p);i=(((i-=d)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,i+=d,b>p?(l=0,c=0,m=0):b==p?(l=-1/0,c=1/0,m=i-b):i<b?(l=-1/0,c=0,m=i-b+h,m>0&&(m=0)):i>p?(l=0,c=1/0,m=i-p-h,m<0&&(m=0)):(l=0,c=0,m=0),t.minImpulse=l,t.maxImpulse=c,t.cfm=r*(0==n?0:1/n),t.rhs=m*_}getErp(t,i){return i?1:this._positionCorrectionAlgorithm==Ut.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*Ut.common.Setting.velocityBaumgarte:0}computeEffectiveInertiaMoment(t,i,s){let n,a,o,e,r,_,h,l,c,m,b,p;h=this._b1._invInertia00*t+this._b1._invInertia01*i+this._b1._invInertia02*s,l=this._b1._invInertia10*t+this._b1._invInertia11*i+this._b1._invInertia12*s,c=this._b1._invInertia20*t+this._b1._invInertia21*i+this._b1._invInertia22*s,n=h,a=l,o=c,m=this._b2._invInertia00*t+this._b2._invInertia01*i+this._b2._invInertia02*s,b=this._b2._invInertia10*t+this._b2._invInertia11*i+this._b2._invInertia12*s,p=this._b2._invInertia20*t+this._b2._invInertia21*i+this._b2._invInertia22*s,e=m,r=b,_=p;let d=n*t+a*i+o*s,u=e*t+r*i+_*s;if(d>0){let n=t*this._relativeAnchor1X+i*this._relativeAnchor1Y+s*this._relativeAnchor1Z,a=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z-n*n;a>0&&(d=this._b1._invMass>0?1/(1/d+this._b1._mass*a):0)}if(u>0){let n=t*this._relativeAnchor2X+i*this._relativeAnchor2Y+s*this._relativeAnchor2Z,a=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z-n*n;a>0&&(u=this._b2._invMass>0?1/(1/u+this._b2._mass*a):0)}return d+u==0?0:1/(d+u)}computeEffectiveInertiaMoment2(t,i,s,n,a,o){let e,r,_,h,l,c,m,b,p,d,u,f;m=this._b1._invInertia00*t+this._b1._invInertia01*i+this._b1._invInertia02*s,b=this._b1._invInertia10*t+this._b1._invInertia11*i+this._b1._invInertia12*s,p=this._b1._invInertia20*t+this._b1._invInertia21*i+this._b1._invInertia22*s,e=m,r=b,_=p,d=this._b2._invInertia00*n+this._b2._invInertia01*a+this._b2._invInertia02*o,u=this._b2._invInertia10*n+this._b2._invInertia11*a+this._b2._invInertia12*o,f=this._b2._invInertia20*n+this._b2._invInertia21*a+this._b2._invInertia22*o,h=d,l=u,c=f;let x=e*t+r*i+_*s,g=h*n+l*a+c*o;if(x>0){let n=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,a=t*this._relativeAnchor1X+i*this._relativeAnchor1Y+s*this._relativeAnchor1Z,o=n*n-a*a;o>0&&(x=this._b1._invMass>0?1/(1/x+this._b1._mass*o):0)}if(g>0){let t=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,i=n*this._relativeAnchor2X+a*this._relativeAnchor2Y+o*this._relativeAnchor2Z,s=t*t-i*i;s>0&&(g=this._b2._invMass>0?1/(1/g+this._b2._mass*s):0)}return x+g==0?0:1/(x+g)}_syncAnchors(){let t,i,s,n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M=this._b1._transform,Y=this._b2._transform;t=M._rotation00*this._localAnchor1X+M._rotation01*this._localAnchor1Y+M._rotation02*this._localAnchor1Z,i=M._rotation10*this._localAnchor1X+M._rotation11*this._localAnchor1Y+M._rotation12*this._localAnchor1Z,s=M._rotation20*this._localAnchor1X+M._rotation21*this._localAnchor1Y+M._rotation22*this._localAnchor1Z,this._relativeAnchor1X=t,this._relativeAnchor1Y=i,this._relativeAnchor1Z=s,n=Y._rotation00*this._localAnchor2X+Y._rotation01*this._localAnchor2Y+Y._rotation02*this._localAnchor2Z,a=Y._rotation10*this._localAnchor2X+Y._rotation11*this._localAnchor2Y+Y._rotation12*this._localAnchor2Z,o=Y._rotation20*this._localAnchor2X+Y._rotation21*this._localAnchor2Y+Y._rotation22*this._localAnchor2Z,this._relativeAnchor2X=n,this._relativeAnchor2Y=a,this._relativeAnchor2Z=o,this._anchor1X=this._relativeAnchor1X+M._positionX,this._anchor1Y=this._relativeAnchor1Y+M._positionY,this._anchor1Z=this._relativeAnchor1Z+M._positionZ,this._anchor2X=this._relativeAnchor2X+Y._positionX,this._anchor2Y=this._relativeAnchor2Y+Y._positionY,this._anchor2Z=this._relativeAnchor2Z+Y._positionZ,e=M._rotation00*this._localBasisX1X+M._rotation01*this._localBasisX1Y+M._rotation02*this._localBasisX1Z,r=M._rotation10*this._localBasisX1X+M._rotation11*this._localBasisX1Y+M._rotation12*this._localBasisX1Z,_=M._rotation20*this._localBasisX1X+M._rotation21*this._localBasisX1Y+M._rotation22*this._localBasisX1Z,this._basisX1X=e,this._basisX1Y=r,this._basisX1Z=_,h=M._rotation00*this._localBasisY1X+M._rotation01*this._localBasisY1Y+M._rotation02*this._localBasisY1Z,l=M._rotation10*this._localBasisY1X+M._rotation11*this._localBasisY1Y+M._rotation12*this._localBasisY1Z,c=M._rotation20*this._localBasisY1X+M._rotation21*this._localBasisY1Y+M._rotation22*this._localBasisY1Z,this._basisY1X=h,this._basisY1Y=l,this._basisY1Z=c,m=M._rotation00*this._localBasisZ1X+M._rotation01*this._localBasisZ1Y+M._rotation02*this._localBasisZ1Z,b=M._rotation10*this._localBasisZ1X+M._rotation11*this._localBasisZ1Y+M._rotation12*this._localBasisZ1Z,p=M._rotation20*this._localBasisZ1X+M._rotation21*this._localBasisZ1Y+M._rotation22*this._localBasisZ1Z,this._basisZ1X=m,this._basisZ1Y=b,this._basisZ1Z=p,d=Y._rotation00*this._localBasisX2X+Y._rotation01*this._localBasisX2Y+Y._rotation02*this._localBasisX2Z,u=Y._rotation10*this._localBasisX2X+Y._rotation11*this._localBasisX2Y+Y._rotation12*this._localBasisX2Z,f=Y._rotation20*this._localBasisX2X+Y._rotation21*this._localBasisX2Y+Y._rotation22*this._localBasisX2Z,this._basisX2X=d,this._basisX2Y=u,this._basisX2Z=f,x=Y._rotation00*this._localBasisY2X+Y._rotation01*this._localBasisY2Y+Y._rotation02*this._localBasisY2Z,g=Y._rotation10*this._localBasisY2X+Y._rotation11*this._localBasisY2Y+Y._rotation12*this._localBasisY2Z,v=Y._rotation20*this._localBasisY2X+Y._rotation21*this._localBasisY2Y+Y._rotation22*this._localBasisY2Z,this._basisY2X=x,this._basisY2Y=g,this._basisY2Z=v,y=Y._rotation00*this._localBasisZ2X+Y._rotation01*this._localBasisZ2Y+Y._rotation02*this._localBasisZ2Z,X=Y._rotation10*this._localBasisZ2X+Y._rotation11*this._localBasisZ2Y+Y._rotation12*this._localBasisZ2Z,z=Y._rotation20*this._localBasisZ2X+Y._rotation21*this._localBasisZ2Y+Y._rotation22*this._localBasisZ2Z,this._basisZ2X=y,this._basisZ2Y=X,this._basisZ2Z=z}_getVelocitySolverInfo(t,i){i.b1=this._b1,i.b2=this._b2,i.numRows=0}_getPositionSolverInfo(t){t.b1=this._b1,t.b2=this._b2,t.numRows=0}_checkDestruction(){let t=this._appliedTorqueX*this._appliedTorqueX+this._appliedTorqueY*this._appliedTorqueY+this._appliedTorqueZ*this._appliedTorqueZ;(this._breakForce>0&&this._appliedForceX*this._appliedForceX+this._appliedForceY*this._appliedForceY+this._appliedForceZ*this._appliedForceZ>this._breakForce*this._breakForce||this._breakTorque>0&&t>this._breakTorque*this._breakTorque)&&this._world.removeJoint(this)}getRigidBody1(){return this._b1}getRigidBody2(){return this._b2}getType(){return this._type}getAnchor1(){let t=new Ut.common.Vec3;return t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z,t}getAnchor2(){let t=new Ut.common.Vec3;return t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z,t}getAnchor1To(t){t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z}getAnchor2To(t){t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z}getLocalAnchor1(){let t=new Ut.common.Vec3;return t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z,t}getLocalAnchor2(){let t=new Ut.common.Vec3;return t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z,t}getLocalAnchor1To(t){t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z}getLocalAnchor2To(t){t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z}getBasis1(){let t,i,s,n,a,o,e,r,_,h=new Ut.common.Mat3;return t=this._basisX1X,i=this._basisY1X,s=this._basisZ1X,n=this._basisX1Y,a=this._basisY1Y,o=this._basisZ1Y,e=this._basisX1Z,r=this._basisY1Z,_=this._basisZ1Z,h.e00=t,h.e01=i,h.e02=s,h.e10=n,h.e11=a,h.e12=o,h.e20=e,h.e21=r,h.e22=_,h}getBasis2(){let t,i,s,n,a,o,e,r,_,h=new Ut.common.Mat3;return t=this._basisX2X,i=this._basisY2X,s=this._basisZ2X,n=this._basisX2Y,a=this._basisY2Y,o=this._basisZ2Y,e=this._basisX2Z,r=this._basisY2Z,_=this._basisZ2Z,h.e00=t,h.e01=i,h.e02=s,h.e10=n,h.e11=a,h.e12=o,h.e20=e,h.e21=r,h.e22=_,h}getBasis1To(t){let i,s,n,a,o,e,r,_,h;i=this._basisX1X,s=this._basisY1X,n=this._basisZ1X,a=this._basisX1Y,o=this._basisY1Y,e=this._basisZ1Y,r=this._basisX1Z,_=this._basisY1Z,h=this._basisZ1Z,t.e00=i,t.e01=s,t.e02=n,t.e10=a,t.e11=o,t.e12=e,t.e20=r,t.e21=_,t.e22=h}getBasis2To(t){let i,s,n,a,o,e,r,_,h;i=this._basisX2X,s=this._basisY2X,n=this._basisZ2X,a=this._basisX2Y,o=this._basisY2Y,e=this._basisZ2Y,r=this._basisX2Z,_=this._basisY2Z,h=this._basisZ2Z,t.e00=i,t.e01=s,t.e02=n,t.e10=a,t.e11=o,t.e12=e,t.e20=r,t.e21=_,t.e22=h}getAllowCollision(){return this._allowCollision}setAllowCollision(t){this._allowCollision=t}getBreakForce(){return this._breakForce}setBreakForce(t){this._breakForce=t}getBreakTorque(){return this._breakTorque}setBreakTorque(t){this._breakTorque=t}getPositionCorrectionAlgorithm(){return this._positionCorrectionAlgorithm}setPositionCorrectionAlgorithm(t){switch(t){case 0:case 1:case 2:break;default:throw new Error("invalid position correction algorithm id: "+t)}this._positionCorrectionAlgorithm=t}getAppliedForce(){let t=new Ut.common.Vec3;return t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ,t}getAppliedForceTo(t){t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ}getAppliedTorque(){let t=new Ut.common.Vec3;return t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ,t}getAppliedTorqueTo(t){t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ}getPrev(){return this._prev}getNext(){return this._next}},Ut.dynamics.constraint.joint.CylindricalJoint=class extends Ut.dynamics.constraint.joint.Joint{constructor(t){super(t,2);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let s=t.localAxis2;this._localBasisX2X=s.x,this._localBasisX2Y=s.y,this._localBasisX2Z=s.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this._basis=new Ut.dynamics.constraint.joint.BasisTracker(this),this._translSd=t.translationalSpringDamper.clone(),this._translLm=t.translationalLimitMotor.clone(),this._rotSd=t.rotationalSpringDamper.clone(),this._rotLm=t.rotationalLimitMotor.clone()}getInfo(t,i,s){let n,a=this.getErp(i,s),o=this.linearErrorY*a,e=this.linearErrorZ*a,r=this.angularErrorY*a,_=this.angularErrorZ*a,h=1/(this._b1._invMass+this._b2._invMass),l=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ);if(this._translSd.frequency<=0||!s){let a=this._impulses[0],o=t.rows[t.numRows++],e=o.jacobian;e.lin1X=0,e.lin1Y=0,e.lin1Z=0,e.lin2X=0,e.lin2Y=0,e.lin2Z=0,e.ang1X=0,e.ang1Y=0,e.ang1Z=0,e.ang2X=0,e.ang2Y=0,e.ang2Z=0,o.rhs=0,o.cfm=0,o.minImpulse=0,o.maxImpulse=0,o.motorSpeed=0,o.motorMaxImpulse=0,o.impulse=null,o.impulse=a,this.setSolverInfoRowLinear(o,this.translation,this._translLm,h,this._translSd,i,s),n=o.jacobian,n.lin1X=this._basis.xX,n.lin1Y=this._basis.xY,n.lin1Z=this._basis.xZ,n.lin2X=this._basis.xX,n.lin2Y=this._basis.xY,n.lin2Z=this._basis.xZ,n.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,n.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,n.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,n.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,n.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,n.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}let c=this._impulses[1],m=t.rows[t.numRows++],b=m.jacobian;b.lin1X=0,b.lin1Y=0,b.lin1Z=0,b.lin2X=0,b.lin2Y=0,b.lin2Z=0,b.ang1X=0,b.ang1Y=0,b.ang1Z=0,b.ang2X=0,b.ang2Y=0,b.ang2Z=0,m.rhs=0,m.cfm=0,m.minImpulse=0,m.maxImpulse=0,m.motorSpeed=0,m.motorMaxImpulse=0,m.impulse=null,m.impulse=c,m.rhs=o,m.cfm=0,m.minImpulse=-1/0,m.maxImpulse=1/0,n=m.jacobian,n.lin1X=this._basis.yX,n.lin1Y=this._basis.yY,n.lin1Z=this._basis.yZ,n.lin2X=this._basis.yX,n.lin2Y=this._basis.yY,n.lin2Z=this._basis.yZ,n.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,n.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,n.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,n.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,n.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,n.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;let p=this._impulses[2],d=t.rows[t.numRows++],u=d.jacobian;if(u.lin1X=0,u.lin1Y=0,u.lin1Z=0,u.lin2X=0,u.lin2Y=0,u.lin2Z=0,u.ang1X=0,u.ang1Y=0,u.ang1Z=0,u.ang2X=0,u.ang2Y=0,u.ang2Z=0,d.rhs=0,d.cfm=0,d.minImpulse=0,d.maxImpulse=0,d.motorSpeed=0,d.motorMaxImpulse=0,d.impulse=null,d.impulse=p,d.rhs=e,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,n=d.jacobian,n.lin1X=this._basis.zX,n.lin1Y=this._basis.zY,n.lin1Z=this._basis.zZ,n.lin2X=this._basis.zX,n.lin2Y=this._basis.zY,n.lin2Z=this._basis.zZ,n.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,n.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,n.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,n.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,n.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,n.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX,this._rotSd.frequency<=0||!s){let a=this._impulses[3],o=t.rows[t.numRows++],e=o.jacobian;e.lin1X=0,e.lin1Y=0,e.lin1Z=0,e.lin2X=0,e.lin2Y=0,e.lin2Z=0,e.ang1X=0,e.ang1Y=0,e.ang1Z=0,e.ang2X=0,e.ang2Y=0,e.ang2Z=0,o.rhs=0,o.cfm=0,o.minImpulse=0,o.maxImpulse=0,o.motorSpeed=0,o.motorMaxImpulse=0,o.impulse=null,o.impulse=a,this.setSolverInfoRowAngular(o,this.angle,this._rotLm,l,this._rotSd,i,s),n=o.jacobian,n.ang1X=this._basis.xX,n.ang1Y=this._basis.xY,n.ang1Z=this._basis.xZ,n.ang2X=this._basis.xX,n.ang2Y=this._basis.xY,n.ang2Z=this._basis.xZ}let f=this._impulses[4],x=t.rows[t.numRows++],g=x.jacobian;g.lin1X=0,g.lin1Y=0,g.lin1Z=0,g.lin2X=0,g.lin2Y=0,g.lin2Z=0,g.ang1X=0,g.ang1Y=0,g.ang1Z=0,g.ang2X=0,g.ang2Y=0,g.ang2Z=0,x.rhs=0,x.cfm=0,x.minImpulse=0,x.maxImpulse=0,x.motorSpeed=0,x.motorMaxImpulse=0,x.impulse=null,x.impulse=f,x.rhs=r,x.cfm=0,x.minImpulse=-1/0,x.maxImpulse=1/0,n=x.jacobian,n.ang1X=this._basis.yX,n.ang1Y=this._basis.yY,n.ang1Z=this._basis.yZ,n.ang2X=this._basis.yX,n.ang2Y=this._basis.yY,n.ang2Z=this._basis.yZ;let v=this._impulses[5],y=t.rows[t.numRows++],X=y.jacobian;X.lin1X=0,X.lin1Y=0,X.lin1Z=0,X.lin2X=0,X.lin2Y=0,X.lin2Z=0,X.ang1X=0,X.ang1Y=0,X.ang1Z=0,X.ang2X=0,X.ang2Y=0,X.ang2Z=0,y.rhs=0,y.cfm=0,y.minImpulse=0,y.maxImpulse=0,y.motorSpeed=0,y.motorMaxImpulse=0,y.impulse=null,y.impulse=v,y.rhs=_,y.cfm=0,y.minImpulse=-1/0,y.maxImpulse=1/0,n=y.jacobian,n.ang1X=this._basis.zX,n.ang1Y=this._basis.zY,n.ang1Z=this._basis.zZ,n.ang2X=this._basis.zX,n.ang2Y=this._basis.zY,n.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();let t,i,s,n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C,T,j,E,R,D,F,q,N=this._basis,H=N.joint._b1._invMass,O=N.joint._b2._invMass,W=N.joint._basisX1X*N.joint._basisX2X+N.joint._basisX1Y*N.joint._basisX2Y+N.joint._basisX1Z*N.joint._basisX2Z;if(W<-.999999999){let a,o,e,r,_=N.joint._basisX1X,h=N.joint._basisX1Y,l=N.joint._basisX1Z,c=_*_,m=h*h,b=l*l;c<m?c<b?(r=1/Math.sqrt(m+b),a=0,o=l*r,e=-h*r):(r=1/Math.sqrt(c+m),a=h*r,o=-_*r,e=0):m<b?(r=1/Math.sqrt(b+c),a=-l*r,o=0,e=_*r):(r=1/Math.sqrt(c+m),a=h*r,o=-_*r,e=0),t=a,i=o,s=e,n=0}else{let a,o,e;a=N.joint._basisX1Y*N.joint._basisX2Z-N.joint._basisX1Z*N.joint._basisX2Y,o=N.joint._basisX1Z*N.joint._basisX2X-N.joint._basisX1X*N.joint._basisX2Z,e=N.joint._basisX1X*N.joint._basisX2Y-N.joint._basisX1Y*N.joint._basisX2X;let r=Math.sqrt(.5*(1+W));W=.5/r,a*=W,o*=W,e*=W,t=a,i=o,s=e,n=r}a=0,o=0,e=0,r=1,C=0,T=0,j=0,E=1,R=t,D=i,F=s,q=n;let G=C*R+T*D+j*F+E*q;if(G<0&&(G=-G,R=-R,D=-D,F=-F,q=-q),G>.999999){let t,i,s,n;t=R-C,i=D-T,s=F-j,n=q-E,R=C+t*(H/(H+O)),D=T+i*(H/(H+O)),F=j+s*(H/(H+O)),q=E+n*(H/(H+O));let a=R*R+D*D+F*F+q*q;a>1e-32&&(a=1/Math.sqrt(a)),_=R*a,h=D*a,l=F*a,c=q*a}else{let t=H/(H+O)*Math.acos(G);R+=C*-G,D+=T*-G,F+=j*-G,q+=E*-G;let i=R*R+D*D+F*F+q*q;i>1e-32&&(i=1/Math.sqrt(i)),R*=i,D*=i,F*=i,q*=i;let s=Math.sin(t),n=Math.cos(t);C*=n,T*=n,j*=n,E*=n,_=C+R*s,h=T+D*s,l=j+F*s,c=E+q*s}let U,J,$,K=2*_,Q=2*h,tt=2*l,it=_*K,st=h*Q,nt=l*tt,at=_*Q,ot=h*tt,et=_*tt,rt=c*K,_t=c*Q,ht=c*tt;m=1-st-nt,b=at-ht,p=et+_t,d=at+ht,u=1-it-nt,f=ot-rt,x=et-_t,g=ot+rt,v=1-it-st,U=m*N.joint._basisX1X+b*N.joint._basisX1Y+p*N.joint._basisX1Z,J=d*N.joint._basisX1X+u*N.joint._basisX1Y+f*N.joint._basisX1Z,$=x*N.joint._basisX1X+g*N.joint._basisX1Y+v*N.joint._basisX1Z,y=U,X=J,z=$,L=N.xX,A=N.xY,k=N.xZ,S=N.yX,B=N.yY,P=N.yZ;let lt=L*y+A*X+k*z;if(lt<-.999999999){let t,i,s,n,a=L,o=A,e=k,r=a*a,m=o*o,b=e*e;r<m?r<b?(n=1/Math.sqrt(m+b),t=0,i=e*n,s=-o*n):(n=1/Math.sqrt(r+m),t=o*n,i=-a*n,s=0):m<b?(n=1/Math.sqrt(b+r),t=-e*n,i=0,s=a*n):(n=1/Math.sqrt(r+m),t=o*n,i=-a*n,s=0),_=t,h=i,l=s,c=0}else{let t,i,s;t=A*z-k*X,i=k*y-L*z,s=L*X-A*y;let n=Math.sqrt(.5*(1+lt));lt=.5/n,t*=lt,i*=lt,s*=lt,_=t,h=i,l=s,c=n}let ct,mt,bt,pt,dt,ut,ft=2*_,xt=2*h,gt=2*l,vt=_*ft,yt=h*xt,Xt=l*gt,zt=_*xt,Mt=h*gt,Yt=_*gt,Zt=c*ft,wt=c*xt,It=c*gt;if(m=1-yt-Xt,b=zt-It,p=Yt+wt,d=zt+It,u=1-vt-Xt,f=Mt-Zt,x=Yt-wt,g=Mt+Zt,v=1-vt-yt,ct=m*S+b*B+p*P,mt=d*S+u*B+f*P,bt=x*S+g*B+v*P,M=ct,Y=mt,Z=bt,w=X*Z-z*Y,I=z*M-y*Z,V=y*Y-X*M,w*w+I*I+V*V>1e-6){let t=w*w+I*I+V*V;t>0&&(t=1/Math.sqrt(t)),w*=t,I*=t,V*=t}else{let t,i=y,s=X,n=z,a=i*i,o=s*s,e=n*n;a<o?a<e?(t=1/Math.sqrt(o+e),w=0,I=n*t,V=-s*t):(t=1/Math.sqrt(a+o),w=s*t,I=-i*t,V=0):o<e?(t=1/Math.sqrt(e+a),w=-n*t,I=0,V=i*t):(t=1/Math.sqrt(a+o),w=s*t,I=-i*t,V=0)}M=I*z-V*X,Y=V*y-w*z,Z=w*X-I*y,N.xX=y,N.xY=X,N.xZ=z,N.yX=M,N.yY=Y,N.yZ=Z,N.zX=w,N.zY=I,N.zZ=V,pt=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,dt=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,ut=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;let Vt,Lt,At,kt,St,Bt,Pt=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,Ct=Pt<=-1?3.14159265358979:Pt>=1?0:Math.acos(Pt),Tt=pt*pt+dt*dt+ut*ut;Tt>0&&(Tt=1/Math.sqrt(Tt)),pt*=Tt,dt*=Tt,ut*=Tt,pt*=Ct,dt*=Ct,ut*=Ct,this.angularErrorY=pt*this._basis.yX+dt*this._basis.yY+ut*this._basis.yZ,this.angularErrorZ=pt*this._basis.zX+dt*this._basis.zY+ut*this._basis.zZ,Vt=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,Lt=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,At=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,Pt=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=Pt<=-1?3.14159265358979:Pt>=1?0:Math.acos(Pt),Vt*this._basis.xX+Lt*this._basis.xY+At*this._basis.xZ<0&&(this.angle=-this.angle),kt=this._anchor2X-this._anchor1X,St=this._anchor2Y-this._anchor1Y,Bt=this._anchor2Z-this._anchor1Z,this.translation=kt*this._basis.xX+St*this._basis.xY+Bt*this._basis.xZ,this.linearErrorY=kt*this._basis.yX+St*this._basis.yY+Bt*this._basis.yZ,this.linearErrorZ=kt*this._basis.zX+St*this._basis.zY+Bt*this._basis.zZ}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new Ut.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new Ut.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new Ut.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new Ut.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTranslationalSpringDamper(){return this._translSd}getRotationalSpringDamper(){return this._rotSd}getTranslationalLimitMotor(){return this._translLm}getRotationalLimitMotor(){return this._rotLm}getAngle(){return this.angle}getTranslation(){return this.translation}},Ut.dynamics.constraint.joint.JointConfig=class{constructor(){this.rigidBody1=null,this.rigidBody2=null,this.localAnchor1=new Ut.common.Vec3,this.localAnchor2=new Ut.common.Vec3,this.allowCollision=!1,this.solverType=Ut.common.Setting.defaultJointConstraintSolverType,this.positionCorrectionAlgorithm=Ut.common.Setting.defaultJointPositionCorrectionAlgorithm,this.breakForce=0,this.breakTorque=0}_init(t,i,s){this.rigidBody1=t,this.rigidBody2=i;let n,a,o,e,r,_,h=this.rigidBody1,l=this.localAnchor1;n=s.x,a=s.y,o=s.z,n-=h._transform._positionX,a-=h._transform._positionY,o-=h._transform._positionZ,e=h._transform._rotation00*n+h._transform._rotation10*a+h._transform._rotation20*o,r=h._transform._rotation01*n+h._transform._rotation11*a+h._transform._rotation21*o,_=h._transform._rotation02*n+h._transform._rotation12*a+h._transform._rotation22*o,n=e,a=r,o=_,l.x=n,l.y=a,l.z=o;let c,m,b,p,d,u,f=this.rigidBody2,x=this.localAnchor2;c=s.x,m=s.y,b=s.z,c-=f._transform._positionX,m-=f._transform._positionY,b-=f._transform._positionZ,p=f._transform._rotation00*c+f._transform._rotation10*m+f._transform._rotation20*b,d=f._transform._rotation01*c+f._transform._rotation11*m+f._transform._rotation21*b,u=f._transform._rotation02*c+f._transform._rotation12*m+f._transform._rotation22*b,c=p,m=d,b=u,x.x=c,x.y=m,x.z=b}},Ut.dynamics.constraint.joint.CylindricalJointConfig=class extends Ut.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new Ut.common.Vec3(1,0,0),this.localAxis2=new Ut.common.Vec3(1,0,0),this.translationalLimitMotor=new Ut.dynamics.constraint.joint.TranslationalLimitMotor,this.translationalSpringDamper=new Ut.dynamics.constraint.joint.SpringDamper,this.rotationalLimitMotor=new Ut.dynamics.constraint.joint.RotationalLimitMotor,this.rotationalSpringDamper=new Ut.dynamics.constraint.joint.SpringDamper}init(t,i,s,n){this._init(t,i,s);let a,o,e,r,_,h,l=this.localAxis1;a=n.x,o=n.y,e=n.z,r=t._transform._rotation00*a+t._transform._rotation10*o+t._transform._rotation20*e,_=t._transform._rotation01*a+t._transform._rotation11*o+t._transform._rotation21*e,h=t._transform._rotation02*a+t._transform._rotation12*o+t._transform._rotation22*e,a=r,o=_,e=h,l.x=a,l.y=o,l.z=e;let c,m,b,p,d,u,f=this.localAxis2;return c=n.x,m=n.y,b=n.z,p=i._transform._rotation00*c+i._transform._rotation10*m+i._transform._rotation20*b,d=i._transform._rotation01*c+i._transform._rotation11*m+i._transform._rotation21*b,u=i._transform._rotation02*c+i._transform._rotation12*m+i._transform._rotation22*b,c=p,m=d,b=u,f.x=c,f.y=m,f.z=b,this}},Ut.dynamics.constraint.joint.GenericJoint=class extends Ut.dynamics.constraint.joint.Joint{constructor(t){let i;super(t,Ut.dynamics.constraint.joint.JointType.GENERIC);let s,n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g,v=t.localBasis1;if(v.e00*(v.e11*v.e22-v.e12*v.e21)-v.e01*(v.e10*v.e22-v.e12*v.e20)+v.e02*(v.e10*v.e21-v.e11*v.e20)<0)i=!0;else{let s=t.localBasis2;i=s.e00*(s.e11*s.e22-s.e12*s.e21)-s.e01*(s.e10*s.e22-s.e12*s.e20)+s.e02*(s.e10*s.e21-s.e11*s.e20)<0}i&&console.log("src/oimo/dynamics/constraint/joint/GenericJoint.hx:50:","[warning] joint basis must be right handed");let y=t.localBasis1;s=y.e00,n=y.e01,a=y.e02,o=y.e10,e=y.e11,r=y.e12,_=y.e20,h=y.e21,l=y.e22;let X=t.localBasis2;c=X.e00,m=X.e01,b=X.e02,p=X.e10,d=X.e11,u=X.e12,f=X.e20,x=X.e21,g=X.e22,this._localBasisX1X=s,this._localBasisX1Y=o,this._localBasisX1Z=_,this._localBasisY1X=n,this._localBasisY1Y=e,this._localBasisY1Z=h,this._localBasisZ1X=a,this._localBasisZ1Y=r,this._localBasisZ1Z=l,this._localBasisX2X=c,this._localBasisX2Y=p,this._localBasisX2Z=f,this._localBasisY2X=m,this._localBasisY2Y=d,this._localBasisY2Z=x,this._localBasisZ2X=b,this._localBasisZ2Y=u,this._localBasisZ2Z=g,this._angleX=0,this._angleY=0,this._angleZ=0,this.translationX=0,this.translationY=0,this.translationZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._translLms=new Array(3),this._translSds=new Array(3),this._rotLms=new Array(3),this._rotSds=new Array(3),this._translLms[0]=t.translationalLimitMotors[0].clone(),this._translLms[1]=t.translationalLimitMotors[1].clone(),this._translLms[2]=t.translationalLimitMotors[2].clone(),this._translSds[0]=t.translationalSpringDampers[0].clone(),this._translSds[1]=t.translationalSpringDampers[1].clone(),this._translSds[2]=t.translationalSpringDampers[2].clone(),this._rotLms[0]=t.rotationalLimitMotors[0].clone(),this._rotLms[1]=t.rotationalLimitMotors[1].clone(),this._rotLms[2]=t.rotationalLimitMotors[2].clone(),this._rotSds[0]=t.rotationalSpringDampers[0].clone(),this._rotSds[1]=t.rotationalSpringDampers[1].clone(),this._rotSds[2]=t.rotationalSpringDampers[2].clone()}getInfo(t,i,s){let n,a=1/(this._b1._invMass+this._b2._invMass),o=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),e=this.computeEffectiveInertiaMoment(this._axisYX,this._axisYY,this._axisYZ),r=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ);if(this._translSds[0].frequency<=0||!s){let o=this._impulses[0],e=t.rows[t.numRows++],r=e.jacobian;r.lin1X=0,r.lin1Y=0,r.lin1Z=0,r.lin2X=0,r.lin2Y=0,r.lin2Z=0,r.ang1X=0,r.ang1Y=0,r.ang1Z=0,r.ang2X=0,r.ang2Y=0,r.ang2Z=0,e.rhs=0,e.cfm=0,e.minImpulse=0,e.maxImpulse=0,e.motorSpeed=0,e.motorMaxImpulse=0,e.impulse=null,e.impulse=o,this.setSolverInfoRowLinear(e,this.translationX,this._translLms[0],a,this._translSds[0],i,s),n=e.jacobian,n.lin1X=this._basisX1X,n.lin1Y=this._basisX1Y,n.lin1Z=this._basisX1Z,n.lin2X=this._basisX1X,n.lin2Y=this._basisX1Y,n.lin2Z=this._basisX1Z,n.ang1X=this._relativeAnchor1Y*this._basisX1Z-this._relativeAnchor1Z*this._basisX1Y,n.ang1Y=this._relativeAnchor1Z*this._basisX1X-this._relativeAnchor1X*this._basisX1Z,n.ang1Z=this._relativeAnchor1X*this._basisX1Y-this._relativeAnchor1Y*this._basisX1X,n.ang2X=this._relativeAnchor2Y*this._basisX1Z-this._relativeAnchor2Z*this._basisX1Y,n.ang2Y=this._relativeAnchor2Z*this._basisX1X-this._relativeAnchor2X*this._basisX1Z,n.ang2Z=this._relativeAnchor2X*this._basisX1Y-this._relativeAnchor2Y*this._basisX1X}if(this._translSds[1].frequency<=0||!s){let o=this._impulses[1],e=t.rows[t.numRows++],r=e.jacobian;r.lin1X=0,r.lin1Y=0,r.lin1Z=0,r.lin2X=0,r.lin2Y=0,r.lin2Z=0,r.ang1X=0,r.ang1Y=0,r.ang1Z=0,r.ang2X=0,r.ang2Y=0,r.ang2Z=0,e.rhs=0,e.cfm=0,e.minImpulse=0,e.maxImpulse=0,e.motorSpeed=0,e.motorMaxImpulse=0,e.impulse=null,e.impulse=o,this.setSolverInfoRowLinear(e,this.translationY,this._translLms[1],a,this._translSds[1],i,s),n=e.jacobian,n.lin1X=this._basisY1X,n.lin1Y=this._basisY1Y,n.lin1Z=this._basisY1Z,n.lin2X=this._basisY1X,n.lin2Y=this._basisY1Y,n.lin2Z=this._basisY1Z,n.ang1X=this._relativeAnchor1Y*this._basisY1Z-this._relativeAnchor1Z*this._basisY1Y,n.ang1Y=this._relativeAnchor1Z*this._basisY1X-this._relativeAnchor1X*this._basisY1Z,n.ang1Z=this._relativeAnchor1X*this._basisY1Y-this._relativeAnchor1Y*this._basisY1X,n.ang2X=this._relativeAnchor2Y*this._basisY1Z-this._relativeAnchor2Z*this._basisY1Y,n.ang2Y=this._relativeAnchor2Z*this._basisY1X-this._relativeAnchor2X*this._basisY1Z,n.ang2Z=this._relativeAnchor2X*this._basisY1Y-this._relativeAnchor2Y*this._basisY1X}if(this._translSds[2].frequency<=0||!s){let o=this._impulses[2],e=t.rows[t.numRows++],r=e.jacobian;r.lin1X=0,r.lin1Y=0,r.lin1Z=0,r.lin2X=0,r.lin2Y=0,r.lin2Z=0,r.ang1X=0,r.ang1Y=0,r.ang1Z=0,r.ang2X=0,r.ang2Y=0,r.ang2Z=0,e.rhs=0,e.cfm=0,e.minImpulse=0,e.maxImpulse=0,e.motorSpeed=0,e.motorMaxImpulse=0,e.impulse=null,e.impulse=o,this.setSolverInfoRowLinear(e,this.translationZ,this._translLms[2],a,this._translSds[2],i,s),n=e.jacobian,n.lin1X=this._basisZ1X,n.lin1Y=this._basisZ1Y,n.lin1Z=this._basisZ1Z,n.lin2X=this._basisZ1X,n.lin2Y=this._basisZ1Y,n.lin2Z=this._basisZ1Z,n.ang1X=this._relativeAnchor1Y*this._basisZ1Z-this._relativeAnchor1Z*this._basisZ1Y,n.ang1Y=this._relativeAnchor1Z*this._basisZ1X-this._relativeAnchor1X*this._basisZ1Z,n.ang1Z=this._relativeAnchor1X*this._basisZ1Y-this._relativeAnchor1Y*this._basisZ1X,n.ang2X=this._relativeAnchor2Y*this._basisZ1Z-this._relativeAnchor2Z*this._basisZ1Y,n.ang2Y=this._relativeAnchor2Z*this._basisZ1X-this._relativeAnchor2X*this._basisZ1Z,n.ang2Z=this._relativeAnchor2X*this._basisZ1Y-this._relativeAnchor2Y*this._basisZ1X}if(!this.xSingular&&(this._rotSds[0].frequency<=0||!s)){let a=this._impulses[3],e=t.rows[t.numRows++],r=e.jacobian;r.lin1X=0,r.lin1Y=0,r.lin1Z=0,r.lin2X=0,r.lin2Y=0,r.lin2Z=0,r.ang1X=0,r.ang1Y=0,r.ang1Z=0,r.ang2X=0,r.ang2Y=0,r.ang2Z=0,e.rhs=0,e.cfm=0,e.minImpulse=0,e.maxImpulse=0,e.motorSpeed=0,e.motorMaxImpulse=0,e.impulse=null,e.impulse=a,this.setSolverInfoRowAngular(e,this._angleX,this._rotLms[0],o,this._rotSds[0],i,s),n=e.jacobian,n.ang1X=this._axisXX,n.ang1Y=this._axisXY,n.ang1Z=this._axisXZ,n.ang2X=this._axisXX,n.ang2Y=this._axisXY,n.ang2Z=this._axisXZ}if(!this.ySingular&&(this._rotSds[1].frequency<=0||!s)){let a=this._impulses[4],o=t.rows[t.numRows++],r=o.jacobian;r.lin1X=0,r.lin1Y=0,r.lin1Z=0,r.lin2X=0,r.lin2Y=0,r.lin2Z=0,r.ang1X=0,r.ang1Y=0,r.ang1Z=0,r.ang2X=0,r.ang2Y=0,r.ang2Z=0,o.rhs=0,o.cfm=0,o.minImpulse=0,o.maxImpulse=0,o.motorSpeed=0,o.motorMaxImpulse=0,o.impulse=null,o.impulse=a,this.setSolverInfoRowAngular(o,this._angleY,this._rotLms[1],e,this._rotSds[1],i,s),n=o.jacobian,n.ang1X=this._axisYX,n.ang1Y=this._axisYY,n.ang1Z=this._axisYZ,n.ang2X=this._axisYX,n.ang2Y=this._axisYY,n.ang2Z=this._axisYZ}if(!this.zSingular&&(this._rotSds[2].frequency<=0||!s)){let a=this._impulses[5],o=t.rows[t.numRows++],e=o.jacobian;e.lin1X=0,e.lin1Y=0,e.lin1Z=0,e.lin2X=0,e.lin2Y=0,e.lin2Z=0,e.ang1X=0,e.ang1Y=0,e.ang1Z=0,e.ang2X=0,e.ang2Y=0,e.ang2Z=0,o.rhs=0,o.cfm=0,o.minImpulse=0,o.maxImpulse=0,o.motorSpeed=0,o.motorMaxImpulse=0,o.impulse=null,o.impulse=a,this.setSolverInfoRowAngular(o,this._angleZ,this._rotLms[2],r,this._rotSds[2],i,s),n=o.jacobian,n.ang1X=this._axisZX,n.ang1Y=this._axisZY,n.ang1Z=this._axisZZ,n.ang2X=this._axisZX,n.ang2Y=this._axisZY,n.ang2Z=this._axisZZ}}_syncAnchors(){let t,i,s,n,a,o,e,r,_;super._syncAnchors(),t=this._basisX1X,i=this._basisX1Y,s=this._basisX1Z,e=this._basisZ2X,r=this._basisZ2Y,_=this._basisZ2Z,n=r*s-_*i,a=_*t-e*s,o=e*i-r*t,this._axisXX=a*_-o*r,this._axisXY=o*e-n*_,this._axisXZ=n*r-a*e,this._axisYX=n,this._axisYY=a,this._axisYZ=o,this._axisZX=i*o-s*a,this._axisZY=s*n-t*o,this._axisZZ=t*a-i*n;let h=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;h>0&&(h=1/Math.sqrt(h)),this._axisXX*=h,this._axisXY*=h,this._axisXZ*=h;let l=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;l>0&&(l=1/Math.sqrt(l)),this._axisYX*=l,this._axisYY*=l,this._axisYZ*=l;let c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C,T,j,E,R,D,F,q,N,H,O=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;O>0&&(O=1/Math.sqrt(O)),this._axisZX*=O,this._axisZY*=O,this._axisZZ*=O,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0,c=this._basisX1X,m=this._basisY1X,b=this._basisZ1X,p=this._basisX1Y,d=this._basisY1Y,u=this._basisZ1Y,f=this._basisX1Z,x=this._basisY1Z,g=this._basisZ1Z,v=this._basisX2X,y=this._basisY2X,X=this._basisZ2X,z=this._basisX2Y,M=this._basisY2Y,Y=this._basisZ2Y,Z=this._basisX2Z,w=this._basisY2Z,I=this._basisZ2Z,C=c*v+p*z+f*Z,T=c*y+p*M+f*w,j=c*X+p*Y+f*I,E=m*y+d*M+x*w,R=m*X+d*Y+x*I,D=b*y+u*M+g*w,F=b*X+u*Y+g*I,V=C,L=T,A=j,k=E,S=R,B=D,P=F;let W,G,U,J=A;if(J<=-1){let t=Math.atan2(B,k);q=.5*t,N=-1.570796326794895,H=.5*-t}else if(J>=1){let t=Math.atan2(B,k);q=.5*t,N=1.570796326794895,H=.5*t}else q=Math.atan2(-S,P),N=Math.asin(J),H=Math.atan2(-L,V);this._angleX=q,this._angleY=N,this._angleZ=H,W=this._anchor2X-this._anchor1X,G=this._anchor2Y-this._anchor1Y,U=this._anchor2Z-this._anchor1Z,this.translationX=W*this._basisX1X+G*this._basisX1Y+U*this._basisX1Z,this.translationY=W*this._basisY1X+G*this._basisY1Y+U*this._basisY1Z,this.translationZ=W*this._basisZ1X+G*this._basisZ1Y+U*this._basisZ1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxisX(){let t=new Ut.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxisY(){let t=new Ut.common.Vec3;return t.x=this._axisYX,t.y=this._axisYY,t.z=this._axisYZ,t}getAxisZ(){let t=new Ut.common.Vec3;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,t}getTranslationalSpringDampers(){return this._translSds.slice(0)}getRotationalSpringDampers(){return this._translSds.slice(0)}getTranslationalLimitMotors(){return this._translLms.slice(0)}getRotationalLimitMotors(){return this._rotLms.slice(0)}getAngles(){return new Ut.common.Vec3(this._angleX,this._angleY,this._angleZ)}getTranslations(){return new Ut.common.Vec3(this.translationX,this.translationY,this.translationZ)}},Ut.dynamics.constraint.joint.GenericJointConfig=class extends Ut.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localBasis1=new Ut.common.Mat3,this.localBasis2=new Ut.common.Mat3;let t=[];t.push((new Ut.dynamics.constraint.joint.TranslationalLimitMotor).setLimits(0,0)),t.push((new Ut.dynamics.constraint.joint.TranslationalLimitMotor).setLimits(0,0)),t.push((new Ut.dynamics.constraint.joint.TranslationalLimitMotor).setLimits(0,0)),this.translationalLimitMotors=t;let i=[];i.push((new Ut.dynamics.constraint.joint.RotationalLimitMotor).setLimits(0,0)),i.push((new Ut.dynamics.constraint.joint.RotationalLimitMotor).setLimits(0,0)),i.push((new Ut.dynamics.constraint.joint.RotationalLimitMotor).setLimits(0,0)),this.rotationalLimitMotors=i,this.translationalSpringDampers=[new Ut.dynamics.constraint.joint.SpringDamper,new Ut.dynamics.constraint.joint.SpringDamper,new Ut.dynamics.constraint.joint.SpringDamper],this.rotationalSpringDampers=[new Ut.dynamics.constraint.joint.SpringDamper,new Ut.dynamics.constraint.joint.SpringDamper,new Ut.dynamics.constraint.joint.SpringDamper]}init(t,i,s,n,a){this._init(t,i,s);let o,e,r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C,T,j,E,R,D,F,q,N,H,O,W,G,U,J,$,K,Q,tt,it,st,nt,at,ot=t._transform,et=i._transform;o=n.e00,e=n.e01,r=n.e02,_=n.e10,h=n.e11,l=n.e12,c=n.e20,m=n.e21,b=n.e22,p=a.e00,d=a.e01,u=a.e02,f=a.e10,x=a.e11,g=a.e12,v=a.e20,y=a.e21,X=a.e22,D=ot._rotation00*o+ot._rotation10*_+ot._rotation20*c,F=ot._rotation00*e+ot._rotation10*h+ot._rotation20*m,q=ot._rotation00*r+ot._rotation10*l+ot._rotation20*b,N=ot._rotation01*o+ot._rotation11*_+ot._rotation21*c,H=ot._rotation01*e+ot._rotation11*h+ot._rotation21*m,O=ot._rotation01*r+ot._rotation11*l+ot._rotation21*b,W=ot._rotation02*o+ot._rotation12*_+ot._rotation22*c,G=ot._rotation02*e+ot._rotation12*h+ot._rotation22*m,U=ot._rotation02*r+ot._rotation12*l+ot._rotation22*b,z=D,M=F,Y=q,Z=N,w=H,I=O,V=W,L=G,A=U,J=et._rotation00*p+et._rotation10*f+et._rotation20*v,$=et._rotation00*d+et._rotation10*x+et._rotation20*y,K=et._rotation00*u+et._rotation10*g+et._rotation20*X,Q=et._rotation01*p+et._rotation11*f+et._rotation21*v,tt=et._rotation01*d+et._rotation11*x+et._rotation21*y,it=et._rotation01*u+et._rotation11*g+et._rotation21*X,st=et._rotation02*p+et._rotation12*f+et._rotation22*v,nt=et._rotation02*d+et._rotation12*x+et._rotation22*y,at=et._rotation02*u+et._rotation12*g+et._rotation22*X,k=J,S=$,B=K,P=Q,C=tt,T=it,j=st,E=nt,R=at;let rt=this.localBasis1;rt.e00=z,rt.e01=M,rt.e02=Y,rt.e10=Z,rt.e11=w,rt.e12=I,rt.e20=V,rt.e21=L,rt.e22=A;let _t=this.localBasis2;return _t.e00=k,_t.e01=S,_t.e02=B,_t.e10=P,_t.e11=C,_t.e12=T,_t.e20=j,_t.e21=E,_t.e22=R,this}},Ut.dynamics.constraint.joint.JointImpulse=class{constructor(){this.impulse=0,this.impulseM=0,this.impulseP=0}},Ut.dynamics.constraint.joint.JointLink=class{constructor(t){this._joint=t}getContact(){return this._joint}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}},Ut.dynamics.constraint.joint.JointMacro=class{},Ut.dynamics.constraint.joint.JointType=class{},Ut.dynamics.constraint.joint.PrismaticJoint=class extends Ut.dynamics.constraint.joint.Joint{constructor(t){super(t,Ut.dynamics.constraint.joint.JointType.PRISMATIC);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let s=t.localAxis2;this._localBasisX2X=s.x,this._localBasisX2Y=s.y,this._localBasisX2Z=s.z,this.buildLocalBasesFromX(),this._basis=new Ut.dynamics.constraint.joint.BasisTracker(this),this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this.angularErrorX=0,this.angularErrorY=0,this.angularErrorZ=0,this._sd=t.springDamper.clone(),this._lm=t.limitMotor.clone()}getInfo(t,i,s){let n,a=this.getErp(i,s),o=this.linearErrorY*a,e=this.linearErrorZ*a,r=this.angularErrorX*a,_=this.angularErrorY*a,h=this.angularErrorZ*a;if(this._sd.frequency<=0||!s){let a=this._impulses[0],o=t.rows[t.numRows++],e=o.jacobian;e.lin1X=0,e.lin1Y=0,e.lin1Z=0,e.lin2X=0,e.lin2Y=0,e.lin2Z=0,e.ang1X=0,e.ang1Y=0,e.ang1Z=0,e.ang2X=0,e.ang2Y=0,e.ang2Z=0,o.rhs=0,o.cfm=0,o.minImpulse=0,o.maxImpulse=0,o.motorSpeed=0,o.motorMaxImpulse=0,o.impulse=null,o.impulse=a,this.setSolverInfoRowLinear(o,this.translation,this._lm,1/(this._b1._invMass+this._b2._invMass),this._sd,i,s),n=o.jacobian,n.lin1X=this._basis.xX,n.lin1Y=this._basis.xY,n.lin1Z=this._basis.xZ,n.lin2X=this._basis.xX,n.lin2Y=this._basis.xY,n.lin2Z=this._basis.xZ,n.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,n.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,n.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,n.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,n.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,n.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}let l=this._impulses[1],c=t.rows[t.numRows++],m=c.jacobian;m.lin1X=0,m.lin1Y=0,m.lin1Z=0,m.lin2X=0,m.lin2Y=0,m.lin2Z=0,m.ang1X=0,m.ang1Y=0,m.ang1Z=0,m.ang2X=0,m.ang2Y=0,m.ang2Z=0,c.rhs=0,c.cfm=0,c.minImpulse=0,c.maxImpulse=0,c.motorSpeed=0,c.motorMaxImpulse=0,c.impulse=null,c.impulse=l,c.rhs=o,c.cfm=0,c.minImpulse=-1/0,c.maxImpulse=1/0,n=c.jacobian,n.lin1X=this._basis.yX,n.lin1Y=this._basis.yY,n.lin1Z=this._basis.yZ,n.lin2X=this._basis.yX,n.lin2Y=this._basis.yY,n.lin2Z=this._basis.yZ,n.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,n.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,n.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,n.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,n.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,n.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;let b=this._impulses[2],p=t.rows[t.numRows++],d=p.jacobian;d.lin1X=0,d.lin1Y=0,d.lin1Z=0,d.lin2X=0,d.lin2Y=0,d.lin2Z=0,d.ang1X=0,d.ang1Y=0,d.ang1Z=0,d.ang2X=0,d.ang2Y=0,d.ang2Z=0,p.rhs=0,p.cfm=0,p.minImpulse=0,p.maxImpulse=0,p.motorSpeed=0,p.motorMaxImpulse=0,p.impulse=null,p.impulse=b,p.rhs=e,p.cfm=0,p.minImpulse=-1/0,p.maxImpulse=1/0,n=p.jacobian,n.lin1X=this._basis.zX,n.lin1Y=this._basis.zY,n.lin1Z=this._basis.zZ,n.lin2X=this._basis.zX,n.lin2Y=this._basis.zY,n.lin2Z=this._basis.zZ,n.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,n.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,n.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,n.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,n.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,n.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX;let u=this._impulses[3],f=t.rows[t.numRows++],x=f.jacobian;x.lin1X=0,x.lin1Y=0,x.lin1Z=0,x.lin2X=0,x.lin2Y=0,x.lin2Z=0,x.ang1X=0,x.ang1Y=0,x.ang1Z=0,x.ang2X=0,x.ang2Y=0,x.ang2Z=0,f.rhs=0,f.cfm=0,f.minImpulse=0,f.maxImpulse=0,f.motorSpeed=0,f.motorMaxImpulse=0,f.impulse=null,f.impulse=u,f.rhs=r,f.cfm=0,f.minImpulse=-1/0,f.maxImpulse=1/0,n=f.jacobian,n.ang1X=1,n.ang1Y=0,n.ang1Z=0,n.ang2X=1,n.ang2Y=0,n.ang2Z=0;let g=this._impulses[4],v=t.rows[t.numRows++],y=v.jacobian;y.lin1X=0,y.lin1Y=0,y.lin1Z=0,y.lin2X=0,y.lin2Y=0,y.lin2Z=0,y.ang1X=0,y.ang1Y=0,y.ang1Z=0,y.ang2X=0,y.ang2Y=0,y.ang2Z=0,v.rhs=0,v.cfm=0,v.minImpulse=0,v.maxImpulse=0,v.motorSpeed=0,v.motorMaxImpulse=0,v.impulse=null,v.impulse=g,v.rhs=_,v.cfm=0,v.minImpulse=-1/0,v.maxImpulse=1/0,n=v.jacobian,n.ang1X=0,n.ang1Y=1,n.ang1Z=0,n.ang2X=0,n.ang2Y=1,n.ang2Z=0;let X=this._impulses[5],z=t.rows[t.numRows++],M=z.jacobian;M.lin1X=0,M.lin1Y=0,M.lin1Z=0,M.lin2X=0,M.lin2Y=0,M.lin2Z=0,M.ang1X=0,M.ang1Y=0,M.ang1Z=0,M.ang2X=0,M.ang2Y=0,M.ang2Z=0,z.rhs=0,z.cfm=0,z.minImpulse=0,z.maxImpulse=0,z.motorSpeed=0,z.motorMaxImpulse=0,z.impulse=null,z.impulse=X,z.rhs=h,z.cfm=0,z.minImpulse=-1/0,z.maxImpulse=1/0,n=z.jacobian,n.ang1X=0,n.ang1Y=0,n.ang1Z=1,n.ang2X=0,n.ang2Y=0,n.ang2Z=1}_syncAnchors(){super._syncAnchors();let t,i,s,n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C,T,j,E,R,D,F,q,N=this._basis,H=N.joint._b1._invMass,O=N.joint._b2._invMass,W=N.joint._basisX1X*N.joint._basisX2X+N.joint._basisX1Y*N.joint._basisX2Y+N.joint._basisX1Z*N.joint._basisX2Z;if(W<-.999999999){let a,o,e,r,_=N.joint._basisX1X,h=N.joint._basisX1Y,l=N.joint._basisX1Z,c=_*_,m=h*h,b=l*l;c<m?c<b?(r=1/Math.sqrt(m+b),a=0,o=l*r,e=-h*r):(r=1/Math.sqrt(c+m),a=h*r,o=-_*r,e=0):m<b?(r=1/Math.sqrt(b+c),a=-l*r,o=0,e=_*r):(r=1/Math.sqrt(c+m),a=h*r,o=-_*r,e=0),t=a,i=o,s=e,n=0}else{let a,o,e;a=N.joint._basisX1Y*N.joint._basisX2Z-N.joint._basisX1Z*N.joint._basisX2Y,o=N.joint._basisX1Z*N.joint._basisX2X-N.joint._basisX1X*N.joint._basisX2Z,e=N.joint._basisX1X*N.joint._basisX2Y-N.joint._basisX1Y*N.joint._basisX2X;let r=Math.sqrt(.5*(1+W));W=.5/r,a*=W,o*=W,e*=W,t=a,i=o,s=e,n=r}a=0,o=0,e=0,r=1,C=0,T=0,j=0,E=1,R=t,D=i,F=s,q=n;let G=C*R+T*D+j*F+E*q;if(G<0&&(G=-G,R=-R,D=-D,F=-F,q=-q),G>.999999){let t,i,s,n;t=R-C,i=D-T,s=F-j,n=q-E,R=C+t*(H/(H+O)),D=T+i*(H/(H+O)),F=j+s*(H/(H+O)),q=E+n*(H/(H+O));let a=R*R+D*D+F*F+q*q;a>1e-32&&(a=1/Math.sqrt(a)),_=R*a,h=D*a,l=F*a,c=q*a}else{let t=H/(H+O)*Math.acos(G);R+=C*-G,D+=T*-G,F+=j*-G,q+=E*-G;let i=R*R+D*D+F*F+q*q;i>1e-32&&(i=1/Math.sqrt(i)),R*=i,D*=i,F*=i,q*=i;let s=Math.sin(t),n=Math.cos(t);C*=n,T*=n,j*=n,E*=n,_=C+R*s,h=T+D*s,l=j+F*s,c=E+q*s}let U,J,$,K=2*_,Q=2*h,tt=2*l,it=_*K,st=h*Q,nt=l*tt,at=_*Q,ot=h*tt,et=_*tt,rt=c*K,_t=c*Q,ht=c*tt;m=1-st-nt,b=at-ht,p=et+_t,d=at+ht,u=1-it-nt,f=ot-rt,x=et-_t,g=ot+rt,v=1-it-st,U=m*N.joint._basisX1X+b*N.joint._basisX1Y+p*N.joint._basisX1Z,J=d*N.joint._basisX1X+u*N.joint._basisX1Y+f*N.joint._basisX1Z,$=x*N.joint._basisX1X+g*N.joint._basisX1Y+v*N.joint._basisX1Z,y=U,X=J,z=$,L=N.xX,A=N.xY,k=N.xZ,S=N.yX,B=N.yY,P=N.yZ;let lt=L*y+A*X+k*z;if(lt<-.999999999){let t,i,s,n,a=L,o=A,e=k,r=a*a,m=o*o,b=e*e;r<m?r<b?(n=1/Math.sqrt(m+b),t=0,i=e*n,s=-o*n):(n=1/Math.sqrt(r+m),t=o*n,i=-a*n,s=0):m<b?(n=1/Math.sqrt(b+r),t=-e*n,i=0,s=a*n):(n=1/Math.sqrt(r+m),t=o*n,i=-a*n,s=0),_=t,h=i,l=s,c=0}else{let t,i,s;t=A*z-k*X,i=k*y-L*z,s=L*X-A*y;let n=Math.sqrt(.5*(1+lt));lt=.5/n,t*=lt,i*=lt,s*=lt,_=t,h=i,l=s,c=n}let ct,mt,bt,pt,dt,ut,ft,xt,gt,vt,yt,Xt,zt,Mt,Yt,Zt,wt,It,Vt,Lt,At,kt,St,Bt,Pt,Ct,Tt,jt,Et,Rt,Dt,Ft,qt,Nt,Ht,Ot,Wt,Gt,Ut,Jt,$t,Kt,Qt,ti=2*_,ii=2*h,si=2*l,ni=_*ti,ai=h*ii,oi=l*si,ei=_*ii,ri=h*si,_i=_*si,hi=c*ti,li=c*ii,ci=c*si;if(m=1-ai-oi,b=ei-ci,p=_i+li,d=ei+ci,u=1-ni-oi,f=ri-hi,x=_i-li,g=ri+hi,v=1-ni-ai,ct=m*S+b*B+p*P,mt=d*S+u*B+f*P,bt=x*S+g*B+v*P,M=ct,Y=mt,Z=bt,w=X*Z-z*Y,I=z*M-y*Z,V=y*Y-X*M,w*w+I*I+V*V>1e-6){let t=w*w+I*I+V*V;t>0&&(t=1/Math.sqrt(t)),w*=t,I*=t,V*=t}else{let t,i=y,s=X,n=z,a=i*i,o=s*s,e=n*n;a<o?a<e?(t=1/Math.sqrt(o+e),w=0,I=n*t,V=-s*t):(t=1/Math.sqrt(a+o),w=s*t,I=-i*t,V=0):o<e?(t=1/Math.sqrt(e+a),w=-n*t,I=0,V=i*t):(t=1/Math.sqrt(a+o),w=s*t,I=-i*t,V=0)}M=I*z-V*X,Y=V*y-w*z,Z=w*X-I*y,N.xX=y,N.xY=X,N.xZ=z,N.yX=M,N.yY=Y,N.yZ=Z,N.zX=w,N.zY=I,N.zZ=V,pt=this._basisX1X,dt=this._basisY1X,ut=this._basisZ1X,ft=this._basisX1Y,xt=this._basisY1Y,gt=this._basisZ1Y,vt=this._basisX1Z,yt=this._basisY1Z,Xt=this._basisZ1Z,zt=this._basisX2X,Mt=this._basisY2X,Yt=this._basisZ2X,Zt=this._basisX2Y,wt=this._basisY2Y,It=this._basisZ2Y,Vt=this._basisX2Z,Lt=this._basisY2Z,At=this._basisZ2Z,Dt=zt*pt+Mt*dt+Yt*ut,Ft=zt*ft+Mt*xt+Yt*gt,qt=zt*vt+Mt*yt+Yt*Xt,Nt=Zt*pt+wt*dt+It*ut,Ht=Zt*ft+wt*xt+It*gt,Ot=Zt*vt+wt*yt+It*Xt,Wt=Vt*pt+Lt*dt+At*ut,Gt=Vt*ft+Lt*xt+At*gt,Ut=Vt*vt+Lt*yt+At*Xt,kt=Dt,St=Ft,Bt=qt,Pt=Nt,Ct=Ht,Tt=Ot,jt=Wt,Et=Gt,Rt=Ut;let mi,bi=kt,pi=Ct,di=Rt,ui=bi+pi+di;ui>0?(mi=Math.sqrt(ui+1),Qt=.5*mi,mi=.5/mi,Jt=(Et-Tt)*mi,$t=(Bt-jt)*mi,Kt=(Pt-St)*mi):bi>pi?bi>di?(mi=Math.sqrt(bi-pi-di+1),Jt=.5*mi,mi=.5/mi,$t=(St+Pt)*mi,Kt=(Bt+jt)*mi,Qt=(Et-Tt)*mi):(mi=Math.sqrt(di-bi-pi+1),Kt=.5*mi,mi=.5/mi,Jt=(Bt+jt)*mi,$t=(Tt+Et)*mi,Qt=(Pt-St)*mi):pi>di?(mi=Math.sqrt(pi-di-bi+1),$t=.5*mi,mi=.5/mi,Jt=(St+Pt)*mi,Kt=(Tt+Et)*mi,Qt=(Bt-jt)*mi):(mi=Math.sqrt(di-bi-pi+1),Kt=.5*mi,mi=.5/mi,Jt=(Bt+jt)*mi,$t=(Tt+Et)*mi,Qt=(Pt-St)*mi);let fi=Qt,xi=2*(fi<=-1?3.14159265358979:fi>=1?0:Math.acos(fi));this.angularErrorX=Jt,this.angularErrorY=$t,this.angularErrorZ=Kt;let gi,vi,yi,Xi=this.angularErrorX*this.angularErrorX+this.angularErrorY*this.angularErrorY+this.angularErrorZ*this.angularErrorZ;Xi>0&&(Xi=1/Math.sqrt(Xi)),this.angularErrorX*=Xi,this.angularErrorY*=Xi,this.angularErrorZ*=Xi,this.angularErrorX*=xi,this.angularErrorY*=xi,this.angularErrorZ*=xi,gi=this._anchor2X-this._anchor1X,vi=this._anchor2Y-this._anchor1Y,yi=this._anchor2Z-this._anchor1Z,this.translation=gi*this._basis.xX+vi*this._basis.xY+yi*this._basis.xZ,this.linearErrorY=gi*this._basis.yX+vi*this._basis.yY+yi*this._basis.yZ,this.linearErrorZ=gi*this._basis.zX+vi*this._basis.zY+yi*this._basis.zZ}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new Ut.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new Ut.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new Ut.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new Ut.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getTranslation(){return this.translation}},Ut.dynamics.constraint.joint.PrismaticJointConfig=class extends Ut.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new Ut.common.Vec3(1,0,0),this.localAxis2=new Ut.common.Vec3(1,0,0),this.limitMotor=new Ut.dynamics.constraint.joint.TranslationalLimitMotor,this.springDamper=new Ut.dynamics.constraint.joint.SpringDamper}init(t,i,s,n){this._init(t,i,s);let a,o,e,r,_,h,l=this.localAxis1;a=n.x,o=n.y,e=n.z,r=t._transform._rotation00*a+t._transform._rotation10*o+t._transform._rotation20*e,_=t._transform._rotation01*a+t._transform._rotation11*o+t._transform._rotation21*e,h=t._transform._rotation02*a+t._transform._rotation12*o+t._transform._rotation22*e,a=r,o=_,e=h,l.x=a,l.y=o,l.z=e;let c,m,b,p,d,u,f=this.localAxis2;return c=n.x,m=n.y,b=n.z,p=i._transform._rotation00*c+i._transform._rotation10*m+i._transform._rotation20*b,d=i._transform._rotation01*c+i._transform._rotation11*m+i._transform._rotation21*b,u=i._transform._rotation02*c+i._transform._rotation12*m+i._transform._rotation22*b,c=p,m=d,b=u,f.x=c,f.y=m,f.z=b,this}},Ut.dynamics.constraint.joint.RagdollJoint=class extends Ut.dynamics.constraint.joint.Joint{constructor(t){super(t,Ut.dynamics.constraint.joint.JointType.RAGDOLL);let i=t.localTwistAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let s=t.localSwingAxis1;this._localBasisY1X=s.x,this._localBasisY1Y=s.y,this._localBasisY1Z=s.z;let n=t.localTwistAxis2;this._localBasisX2X=n.x,this._localBasisX2Y=n.y,this._localBasisX2Z=n.z,this.buildLocalBasesFromXY1X2(),this._twistSd=t.twistSpringDamper.clone(),this._twistLm=t.twistLimitMotor.clone(),this._swingSd=t.swingSpringDamper.clone(),this._maxSwingAngle1=t.maxSwingAngle1,this._maxSwingAngle2=t.maxSwingAngle2,this._maxSwingAngle1<Ut.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle1=Ut.common.Setting.minRagdollMaxSwingAngle),this._maxSwingAngle2<Ut.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle2=Ut.common.Setting.minRagdollMaxSwingAngle),this.dummySwingLm=new Ut.dynamics.constraint.joint.RotationalLimitMotor,this.dummySwingLm.lowerLimit=-1,this.dummySwingLm.upperLimit=0,this._swingAngle=0,this._twistAngle=0,this.swingError=0,this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.twistAxisX=0,this.twistAxisY=0,this.twistAxisZ=0}getInfo(t,i,s){let n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M=this.getErp(i,s);n=this.linearErrorX*M,a=this.linearErrorY*M,o=this.linearErrorZ*M,e=0,r=-this._relativeAnchor1Z,_=this._relativeAnchor1Y,h=this._relativeAnchor1Z,l=0,c=-this._relativeAnchor1X,m=-this._relativeAnchor1Y,b=this._relativeAnchor1X,p=0,d=0,u=-this._relativeAnchor2Z,f=this._relativeAnchor2Y,x=this._relativeAnchor2Z,g=0,v=-this._relativeAnchor2X,y=-this._relativeAnchor2Y,X=this._relativeAnchor2X,z=0,e=-e,r=-r,_=-_,h=-h,l=-l,c=-c,m=-m,b=-b,p=-p,d=-d,u=-u,f=-f,x=-x,g=-g,v=-v,y=-y,X=-X,z=-z;let Y=this.computeEffectiveInertiaMoment(this.swingAxisX,this.swingAxisY,this.swingAxisZ),Z=this.computeEffectiveInertiaMoment(this._basisX2X,this._basisX2Y,this._basisX2Z),w=this._impulses[0],I=t.rows[t.numRows++],V=I.jacobian;V.lin1X=0,V.lin1Y=0,V.lin1Z=0,V.lin2X=0,V.lin2Y=0,V.lin2Z=0,V.ang1X=0,V.ang1Y=0,V.ang1Z=0,V.ang2X=0,V.ang2Y=0,V.ang2Z=0,I.rhs=0,I.cfm=0,I.minImpulse=0,I.maxImpulse=0,I.motorSpeed=0,I.motorMaxImpulse=0,I.impulse=null,I.impulse=w,I.rhs=n,I.cfm=0,I.minImpulse=-1/0,I.maxImpulse=1/0;let L=I.jacobian;L.lin1X=1,L.lin1Y=0,L.lin1Z=0,L.lin2X=1,L.lin2Y=0,L.lin2Z=0,L.ang1X=e,L.ang1Y=r,L.ang1Z=_,L.ang2X=d,L.ang2Y=u,L.ang2Z=f;let A=this._impulses[1],k=t.rows[t.numRows++],S=k.jacobian;S.lin1X=0,S.lin1Y=0,S.lin1Z=0,S.lin2X=0,S.lin2Y=0,S.lin2Z=0,S.ang1X=0,S.ang1Y=0,S.ang1Z=0,S.ang2X=0,S.ang2Y=0,S.ang2Z=0,k.rhs=0,k.cfm=0,k.minImpulse=0,k.maxImpulse=0,k.motorSpeed=0,k.motorMaxImpulse=0,k.impulse=null,k.impulse=A,k.rhs=a,k.cfm=0,k.minImpulse=-1/0,k.maxImpulse=1/0,L=k.jacobian,L.lin1X=0,L.lin1Y=1,L.lin1Z=0,L.lin2X=0,L.lin2Y=1,L.lin2Z=0,L.ang1X=h,L.ang1Y=l,L.ang1Z=c,L.ang2X=x,L.ang2Y=g,L.ang2Z=v;let B=this._impulses[2],P=t.rows[t.numRows++],C=P.jacobian;if(C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,P.rhs=0,P.cfm=0,P.minImpulse=0,P.maxImpulse=0,P.motorSpeed=0,P.motorMaxImpulse=0,P.impulse=null,P.impulse=B,P.rhs=o,P.cfm=0,P.minImpulse=-1/0,P.maxImpulse=1/0,L=P.jacobian,L.lin1X=0,L.lin1Y=0,L.lin1Z=1,L.lin2X=0,L.lin2Y=0,L.lin2Z=1,L.ang1X=m,L.ang1Y=b,L.ang1Z=p,L.ang2X=y,L.ang2Y=X,L.ang2Z=z,this.swingError>0&&(this._swingSd.frequency<=0||!s)){let n=this._impulses[3],a=t.rows[t.numRows++],o=a.jacobian;o.lin1X=0,o.lin1Y=0,o.lin1Z=0,o.lin2X=0,o.lin2Y=0,o.lin2Z=0,o.ang1X=0,o.ang1Y=0,o.ang1Z=0,o.ang2X=0,o.ang2Y=0,o.ang2Z=0,a.rhs=0,a.cfm=0,a.minImpulse=0,a.maxImpulse=0,a.motorSpeed=0,a.motorMaxImpulse=0,a.impulse=null,a.impulse=n,this.setSolverInfoRowAngular(a,this.swingError,this.dummySwingLm,Y,this._swingSd,i,s),L=a.jacobian,L.ang1X=this.swingAxisX,L.ang1Y=this.swingAxisY,L.ang1Z=this.swingAxisZ,L.ang2X=this.swingAxisX,L.ang2Y=this.swingAxisY,L.ang2Z=this.swingAxisZ}if(this._twistSd.frequency<=0||!s){let n=this._impulses[4],a=t.rows[t.numRows++],o=a.jacobian;o.lin1X=0,o.lin1Y=0,o.lin1Z=0,o.lin2X=0,o.lin2Y=0,o.lin2Z=0,o.ang1X=0,o.ang1Y=0,o.ang1Z=0,o.ang2X=0,o.ang2Y=0,o.ang2Z=0,a.rhs=0,a.cfm=0,a.minImpulse=0,a.maxImpulse=0,a.motorSpeed=0,a.motorMaxImpulse=0,a.impulse=null,a.impulse=n,this.setSolverInfoRowAngular(a,this._twistAngle,this._twistLm,Z,this._twistSd,i,s),L=a.jacobian,L.ang1X=this.twistAxisX,L.ang1Y=this.twistAxisY,L.ang1Z=this.twistAxisZ,L.ang2X=this.twistAxisX,L.ang2Y=this.twistAxisY,L.ang2Z=this.twistAxisZ}}_syncAnchors(){let t,i,s,n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L;super._syncAnchors(),t=this._basisX1X,i=this._basisX1Y,s=this._basisX1Z,n=this._basisX2X,a=this._basisX2Y,o=this._basisX2Z,e=this._basisX1X,r=this._basisY1X,_=this._basisZ1X,h=this._basisX1Y,l=this._basisY1Y,c=this._basisZ1Y,m=this._basisX1Z,b=this._basisY1Z,p=this._basisZ1Z;let A=t*n+i*a+s*o;if(A<-.999999999){let n,a,o,e,r=t,_=i,h=s,l=r*r,c=_*_,m=h*h;l<c?l<m?(e=1/Math.sqrt(c+m),n=0,a=h*e,o=-_*e):(e=1/Math.sqrt(l+c),n=_*e,a=-r*e,o=0):c<m?(e=1/Math.sqrt(m+l),n=-h*e,a=0,o=r*e):(e=1/Math.sqrt(l+c),n=_*e,a=-r*e,o=0),d=n,u=a,f=o,x=0}else{let e,r,_;e=i*o-s*a,r=s*n-t*o,_=t*a-i*n;let h=Math.sqrt(.5*(1+A));A=.5/h,e*=A,r*=A,_*=A,d=e,u=r,f=_,x=h}let k,S,B,P,C,T,j=2*d,E=2*u,R=2*f,D=d*j,F=u*E,q=f*R,N=d*E,H=u*R,O=d*R,W=x*j,G=x*E,U=x*R;g=1-F-q,v=N-U,y=O+G,X=N+U,z=1-D-q,M=H-W,Y=O-G,Z=H+W,w=1-D-F,this._swingAngle=2*(x<=-1?3.14159265358979:x>=1?0:Math.acos(x)),I=d,V=u,L=f,P=g*this._basisY2X+X*this._basisY2Y+Y*this._basisY2Z,C=v*this._basisY2X+z*this._basisY2Y+Z*this._basisY2Z,T=y*this._basisY2X+M*this._basisY2Y+w*this._basisY2Z,k=P,S=C,B=T,this._twistAngle=Math.atan2(this._basisZ1X*k+this._basisZ1Y*S+this._basisZ1Z*B,this._basisY1X*k+this._basisY1Y*S+this._basisY1Z*B),this.twistAxisX=this._basisX1X+this._basisX2X,this.twistAxisY=this._basisX1Y+this._basisX2Y,this.twistAxisZ=this._basisX1Z+this._basisX2Z;let J=this.twistAxisX*this.twistAxisX+this.twistAxisY*this.twistAxisY+this.twistAxisZ*this.twistAxisZ;J>0&&(J=1/Math.sqrt(J)),this.twistAxisX*=J,this.twistAxisY*=J,this.twistAxisZ*=J;let $,K,Q=Math.sqrt(I*I+V*V+L*L);Q>0&&(Q=1/Q),I*=Q*this._swingAngle,V*=Q*this._swingAngle,L*=Q*this._swingAngle,$=r*I+l*V+b*L,K=_*I+c*V+p*L,V=$,L=K;let tt=V,it=L,st=this._maxSwingAngle1,nt=this._maxSwingAngle2,at=1/(st*st),ot=1/(nt*nt),et=tt*tt*at+it*it*ot;if(0==et)this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.swingError=0;else{let t=Math.sqrt(1/et),i=tt*t,s=it*t,n=i*at,a=s*ot;Q=1/Math.sqrt(n*n+a*a),n*=Q,a*=Q;let o=(tt-i)*n+(it-s)*a;if(o>0){let t,i,s,d,u,f;this.swingError=o,this.swingAxisX=0,this.swingAxisY=n,this.swingAxisZ=a,t=e*this.swingAxisX+r*this.swingAxisY+_*this.swingAxisZ,i=h*this.swingAxisX+l*this.swingAxisY+c*this.swingAxisZ,s=m*this.swingAxisX+b*this.swingAxisY+p*this.swingAxisZ,this.swingAxisX=t,this.swingAxisY=i,this.swingAxisZ=s,d=g*this.swingAxisX+v*this.swingAxisY+y*this.swingAxisZ,u=X*this.swingAxisX+z*this.swingAxisY+M*this.swingAxisZ,f=Y*this.swingAxisX+Z*this.swingAxisY+w*this.swingAxisZ,this.swingAxisX=d,this.swingAxisY=u,this.swingAxisZ=f}else this.swingError=0}this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new Ut.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new Ut.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new Ut.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new Ut.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTwistSpringDamper(){return this._twistSd}getTwistLimitMotor(){return this._twistLm}getSwingSpringDamper(){return this._swingSd}getSwingAxis(){let t=new Ut.common.Vec3;return t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ,t}getSwingAxisTo(t){t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ}getSwingAngle(){return this._swingAngle}getTwistAngle(){return this._twistAngle}},Ut.dynamics.constraint.joint.RagdollJointConfig=class extends Ut.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localTwistAxis1=new Ut.common.Vec3(1,0,0),this.localTwistAxis2=new Ut.common.Vec3(1,0,0),this.localSwingAxis1=new Ut.common.Vec3(0,1,0),this.twistSpringDamper=new Ut.dynamics.constraint.joint.SpringDamper,this.swingSpringDamper=new Ut.dynamics.constraint.joint.SpringDamper,this.twistLimitMotor=new Ut.dynamics.constraint.joint.RotationalLimitMotor,this.maxSwingAngle1=3.14159265358979,this.maxSwingAngle2=3.14159265358979}init(t,i,s,n,a){this._init(t,i,s);let o,e,r,_,h,l,c=this.localTwistAxis1;o=n.x,e=n.y,r=n.z,_=t._transform._rotation00*o+t._transform._rotation10*e+t._transform._rotation20*r,h=t._transform._rotation01*o+t._transform._rotation11*e+t._transform._rotation21*r,l=t._transform._rotation02*o+t._transform._rotation12*e+t._transform._rotation22*r,o=_,e=h,r=l,c.x=o,c.y=e,c.z=r;let m,b,p,d,u,f,x=this.localTwistAxis2;m=n.x,b=n.y,p=n.z,d=i._transform._rotation00*m+i._transform._rotation10*b+i._transform._rotation20*p,u=i._transform._rotation01*m+i._transform._rotation11*b+i._transform._rotation21*p,f=i._transform._rotation02*m+i._transform._rotation12*b+i._transform._rotation22*p,m=d,b=u,p=f,x.x=m,x.y=b,x.z=p;let g,v,y,X,z,M,Y=this.localSwingAxis1;return g=a.x,v=a.y,y=a.z,X=t._transform._rotation00*g+t._transform._rotation10*v+t._transform._rotation20*y,z=t._transform._rotation01*g+t._transform._rotation11*v+t._transform._rotation21*y,M=t._transform._rotation02*g+t._transform._rotation12*v+t._transform._rotation22*y,g=X,v=z,y=M,Y.x=g,Y.y=v,Y.z=y,this}},Ut.dynamics.constraint.joint.RevoluteJoint=class extends Ut.dynamics.constraint.joint.Joint{constructor(t){super(t,1);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let s=t.localAxis2;this._localBasisX2X=s.x,this._localBasisX2Y=s.y,this._localBasisX2Z=s.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this._basis=new Ut.dynamics.constraint.joint.BasisTracker(this),this._sd=t.springDamper.clone(),this._lm=t.limitMotor.clone()}getInfo(t,i,s){let n,a,o,e=this.getErp(i,s);n=this.linearErrorX*e,a=this.linearErrorY*e,o=this.linearErrorZ*e;let r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y=this.angularErrorY*e,Z=this.angularErrorZ*e;r=0,_=-this._relativeAnchor1Z,h=this._relativeAnchor1Y,l=this._relativeAnchor1Z,c=0,m=-this._relativeAnchor1X,b=-this._relativeAnchor1Y,p=this._relativeAnchor1X,d=0,u=0,f=-this._relativeAnchor2Z,x=this._relativeAnchor2Y,g=this._relativeAnchor2Z,v=0,y=-this._relativeAnchor2X,X=-this._relativeAnchor2Y,z=this._relativeAnchor2X,M=0,r=-r,_=-_,h=-h,l=-l,c=-c,m=-m,b=-b,p=-p,d=-d,u=-u,f=-f,x=-x,g=-g,v=-v,y=-y,X=-X,z=-z,M=-M;let w=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ),I=this._impulses[0],V=t.rows[t.numRows++],L=V.jacobian;L.lin1X=0,L.lin1Y=0,L.lin1Z=0,L.lin2X=0,L.lin2Y=0,L.lin2Z=0,L.ang1X=0,L.ang1Y=0,L.ang1Z=0,L.ang2X=0,L.ang2Y=0,L.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=I,V.rhs=n,V.cfm=0,V.minImpulse=-1/0,V.maxImpulse=1/0;let A=V.jacobian;A.lin1X=1,A.lin1Y=0,A.lin1Z=0,A.lin2X=1,A.lin2Y=0,A.lin2Z=0,A.ang1X=r,A.ang1Y=_,A.ang1Z=h,A.ang2X=u,A.ang2Y=f,A.ang2Z=x;let k=this._impulses[1],S=t.rows[t.numRows++],B=S.jacobian;B.lin1X=0,B.lin1Y=0,B.lin1Z=0,B.lin2X=0,B.lin2Y=0,B.lin2Z=0,B.ang1X=0,B.ang1Y=0,B.ang1Z=0,B.ang2X=0,B.ang2Y=0,B.ang2Z=0,S.rhs=0,S.cfm=0,S.minImpulse=0,S.maxImpulse=0,S.motorSpeed=0,S.motorMaxImpulse=0,S.impulse=null,S.impulse=k,S.rhs=a,S.cfm=0,S.minImpulse=-1/0,S.maxImpulse=1/0,A=S.jacobian,A.lin1X=0,A.lin1Y=1,A.lin1Z=0,A.lin2X=0,A.lin2Y=1,A.lin2Z=0,A.ang1X=l,A.ang1Y=c,A.ang1Z=m,A.ang2X=g,A.ang2Y=v,A.ang2Z=y;let P=this._impulses[2],C=t.rows[t.numRows++],T=C.jacobian;if(T.lin1X=0,T.lin1Y=0,T.lin1Z=0,T.lin2X=0,T.lin2Y=0,T.lin2Z=0,T.ang1X=0,T.ang1Y=0,T.ang1Z=0,T.ang2X=0,T.ang2Y=0,T.ang2Z=0,C.rhs=0,C.cfm=0,C.minImpulse=0,C.maxImpulse=0,C.motorSpeed=0,C.motorMaxImpulse=0,C.impulse=null,C.impulse=P,C.rhs=o,C.cfm=0,C.minImpulse=-1/0,C.maxImpulse=1/0,A=C.jacobian,A.lin1X=0,A.lin1Y=0,A.lin1Z=1,A.lin2X=0,A.lin2Y=0,A.lin2Z=1,A.ang1X=b,A.ang1Y=p,A.ang1Z=d,A.ang2X=X,A.ang2Y=z,A.ang2Z=M,this._sd.frequency<=0||!s){let n=this._impulses[3],a=t.rows[t.numRows++],o=a.jacobian;o.lin1X=0,o.lin1Y=0,o.lin1Z=0,o.lin2X=0,o.lin2Y=0,o.lin2Z=0,o.ang1X=0,o.ang1Y=0,o.ang1Z=0,o.ang2X=0,o.ang2Y=0,o.ang2Z=0,a.rhs=0,a.cfm=0,a.minImpulse=0,a.maxImpulse=0,a.motorSpeed=0,a.motorMaxImpulse=0,a.impulse=null,a.impulse=n,this.setSolverInfoRowAngular(a,this.angle,this._lm,w,this._sd,i,s),A=a.jacobian,A.ang1X=this._basis.xX,A.ang1Y=this._basis.xY,A.ang1Z=this._basis.xZ,A.ang2X=this._basis.xX,A.ang2Y=this._basis.xY,A.ang2Z=this._basis.xZ}let j=this._impulses[4],E=t.rows[t.numRows++],R=E.jacobian;R.lin1X=0,R.lin1Y=0,R.lin1Z=0,R.lin2X=0,R.lin2Y=0,R.lin2Z=0,R.ang1X=0,R.ang1Y=0,R.ang1Z=0,R.ang2X=0,R.ang2Y=0,R.ang2Z=0,E.rhs=0,E.cfm=0,E.minImpulse=0,E.maxImpulse=0,E.motorSpeed=0,E.motorMaxImpulse=0,E.impulse=null,E.impulse=j,E.rhs=Y,E.cfm=0,E.minImpulse=-1/0,E.maxImpulse=1/0,A=E.jacobian,A.ang1X=this._basis.yX,A.ang1Y=this._basis.yY,A.ang1Z=this._basis.yZ,A.ang2X=this._basis.yX,A.ang2Y=this._basis.yY,A.ang2Z=this._basis.yZ;let D=this._impulses[5],F=t.rows[t.numRows++],q=F.jacobian;q.lin1X=0,q.lin1Y=0,q.lin1Z=0,q.lin2X=0,q.lin2Y=0,q.lin2Z=0,q.ang1X=0,q.ang1Y=0,q.ang1Z=0,q.ang2X=0,q.ang2Y=0,q.ang2Z=0,F.rhs=0,F.cfm=0,F.minImpulse=0,F.maxImpulse=0,F.motorSpeed=0,F.motorMaxImpulse=0,F.impulse=null,F.impulse=D,F.rhs=Z,F.cfm=0,F.minImpulse=-1/0,F.maxImpulse=1/0,A=F.jacobian,A.ang1X=this._basis.zX,A.ang1Y=this._basis.zY,A.ang1Z=this._basis.zZ,A.ang2X=this._basis.zX,A.ang2Y=this._basis.zY,A.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();let t,i,s,n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C,T,j,E,R,D,F,q,N=this._basis,H=N.joint._b1._invMass,O=N.joint._b2._invMass,W=N.joint._basisX1X*N.joint._basisX2X+N.joint._basisX1Y*N.joint._basisX2Y+N.joint._basisX1Z*N.joint._basisX2Z;if(W<-.999999999){let a,o,e,r,_=N.joint._basisX1X,h=N.joint._basisX1Y,l=N.joint._basisX1Z,c=_*_,m=h*h,b=l*l;c<m?c<b?(r=1/Math.sqrt(m+b),a=0,o=l*r,e=-h*r):(r=1/Math.sqrt(c+m),a=h*r,o=-_*r,e=0):m<b?(r=1/Math.sqrt(b+c),a=-l*r,o=0,e=_*r):(r=1/Math.sqrt(c+m),a=h*r,o=-_*r,e=0),t=a,i=o,s=e,n=0}else{let a,o,e;a=N.joint._basisX1Y*N.joint._basisX2Z-N.joint._basisX1Z*N.joint._basisX2Y,o=N.joint._basisX1Z*N.joint._basisX2X-N.joint._basisX1X*N.joint._basisX2Z,e=N.joint._basisX1X*N.joint._basisX2Y-N.joint._basisX1Y*N.joint._basisX2X;let r=Math.sqrt(.5*(1+W));W=.5/r,a*=W,o*=W,e*=W,t=a,i=o,s=e,n=r}a=0,o=0,e=0,r=1,C=0,T=0,j=0,E=1,R=t,D=i,F=s,q=n;let G=C*R+T*D+j*F+E*q;if(G<0&&(G=-G,R=-R,D=-D,F=-F,q=-q),G>.999999){let t,i,s,n;t=R-C,i=D-T,s=F-j,n=q-E,R=C+t*(H/(H+O)),D=T+i*(H/(H+O)),F=j+s*(H/(H+O)),q=E+n*(H/(H+O));let a=R*R+D*D+F*F+q*q;a>1e-32&&(a=1/Math.sqrt(a)),_=R*a,h=D*a,l=F*a,c=q*a}else{let t=H/(H+O)*Math.acos(G);R+=C*-G,D+=T*-G,F+=j*-G,q+=E*-G;let i=R*R+D*D+F*F+q*q;i>1e-32&&(i=1/Math.sqrt(i)),R*=i,D*=i,F*=i,q*=i;let s=Math.sin(t),n=Math.cos(t);C*=n,T*=n,j*=n,E*=n,_=C+R*s,h=T+D*s,l=j+F*s,c=E+q*s}let U,J,$,K=2*_,Q=2*h,tt=2*l,it=_*K,st=h*Q,nt=l*tt,at=_*Q,ot=h*tt,et=_*tt,rt=c*K,_t=c*Q,ht=c*tt;m=1-st-nt,b=at-ht,p=et+_t,d=at+ht,u=1-it-nt,f=ot-rt,x=et-_t,g=ot+rt,v=1-it-st,U=m*N.joint._basisX1X+b*N.joint._basisX1Y+p*N.joint._basisX1Z,J=d*N.joint._basisX1X+u*N.joint._basisX1Y+f*N.joint._basisX1Z,$=x*N.joint._basisX1X+g*N.joint._basisX1Y+v*N.joint._basisX1Z,y=U,X=J,z=$,L=N.xX,A=N.xY,k=N.xZ,S=N.yX,B=N.yY,P=N.yZ;let lt=L*y+A*X+k*z;if(lt<-.999999999){let t,i,s,n,a=L,o=A,e=k,r=a*a,m=o*o,b=e*e;r<m?r<b?(n=1/Math.sqrt(m+b),t=0,i=e*n,s=-o*n):(n=1/Math.sqrt(r+m),t=o*n,i=-a*n,s=0):m<b?(n=1/Math.sqrt(b+r),t=-e*n,i=0,s=a*n):(n=1/Math.sqrt(r+m),t=o*n,i=-a*n,s=0),_=t,h=i,l=s,c=0}else{let t,i,s;t=A*z-k*X,i=k*y-L*z,s=L*X-A*y;let n=Math.sqrt(.5*(1+lt));lt=.5/n,t*=lt,i*=lt,s*=lt,_=t,h=i,l=s,c=n}let ct,mt,bt,pt,dt,ut,ft=2*_,xt=2*h,gt=2*l,vt=_*ft,yt=h*xt,Xt=l*gt,zt=_*xt,Mt=h*gt,Yt=_*gt,Zt=c*ft,wt=c*xt,It=c*gt;if(m=1-yt-Xt,b=zt-It,p=Yt+wt,d=zt+It,u=1-vt-Xt,f=Mt-Zt,x=Yt-wt,g=Mt+Zt,v=1-vt-yt,ct=m*S+b*B+p*P,mt=d*S+u*B+f*P,bt=x*S+g*B+v*P,M=ct,Y=mt,Z=bt,w=X*Z-z*Y,I=z*M-y*Z,V=y*Y-X*M,w*w+I*I+V*V>1e-6){let t=w*w+I*I+V*V;t>0&&(t=1/Math.sqrt(t)),w*=t,I*=t,V*=t}else{let t,i=y,s=X,n=z,a=i*i,o=s*s,e=n*n;a<o?a<e?(t=1/Math.sqrt(o+e),w=0,I=n*t,V=-s*t):(t=1/Math.sqrt(a+o),w=s*t,I=-i*t,V=0):o<e?(t=1/Math.sqrt(e+a),w=-n*t,I=0,V=i*t):(t=1/Math.sqrt(a+o),w=s*t,I=-i*t,V=0)}M=I*z-V*X,Y=V*y-w*z,Z=w*X-I*y,N.xX=y,N.xY=X,N.xZ=z,N.yX=M,N.yY=Y,N.yZ=Z,N.zX=w,N.zY=I,N.zZ=V,pt=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,dt=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,ut=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;let Vt,Lt,At,kt=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,St=kt<=-1?3.14159265358979:kt>=1?0:Math.acos(kt),Bt=pt*pt+dt*dt+ut*ut;Bt>0&&(Bt=1/Math.sqrt(Bt)),pt*=Bt,dt*=Bt,ut*=Bt,pt*=St,dt*=St,ut*=St,this.angularErrorY=pt*this._basis.yX+dt*this._basis.yY+ut*this._basis.yZ,this.angularErrorZ=pt*this._basis.zX+dt*this._basis.zY+ut*this._basis.zZ,Vt=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,Lt=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,At=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,kt=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=kt<=-1?3.14159265358979:kt>=1?0:Math.acos(kt),Vt*this._basis.xX+Lt*this._basis.xY+At*this._basis.xZ<0&&(this.angle=-this.angle),this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new Ut.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new Ut.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new Ut.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new Ut.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getAngle(){return this.angle}},Ut.dynamics.constraint.joint.RevoluteJointConfig=class extends Ut.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new Ut.common.Vec3(1,0,0),this.localAxis2=new Ut.common.Vec3(1,0,0),this.springDamper=new Ut.dynamics.constraint.joint.SpringDamper,this.limitMotor=new Ut.dynamics.constraint.joint.RotationalLimitMotor}init(t,i,s,n){this._init(t,i,s);let a,o,e,r,_,h,l=this.localAxis1;a=n.x,o=n.y,e=n.z,r=t._transform._rotation00*a+t._transform._rotation10*o+t._transform._rotation20*e,_=t._transform._rotation01*a+t._transform._rotation11*o+t._transform._rotation21*e,h=t._transform._rotation02*a+t._transform._rotation12*o+t._transform._rotation22*e,a=r,o=_,e=h,l.x=a,l.y=o,l.z=e;let c,m,b,p,d,u,f=this.localAxis2;return c=n.x,m=n.y,b=n.z,p=i._transform._rotation00*c+i._transform._rotation10*m+i._transform._rotation20*b,d=i._transform._rotation01*c+i._transform._rotation11*m+i._transform._rotation21*b,u=i._transform._rotation02*c+i._transform._rotation12*m+i._transform._rotation22*b,c=p,m=d,b=u,f.x=c,f.y=m,f.z=b,this}},Ut.dynamics.constraint.joint.RotationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorTorque=0}setLimits(t,i){return this.lowerLimit=t,this.upperLimit=i,this}setMotor(t,i){return this.motorSpeed=t,this.motorTorque=i,this}clone(){let t=new Ut.dynamics.constraint.joint.RotationalLimitMotor;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorTorque=this.motorTorque,t}},Ut.dynamics.constraint.joint.SphericalJoint=class extends Ut.dynamics.constraint.joint.Joint{constructor(t){super(t,0),this._sd=t.springDamper.clone()}getInfo(t,i,s){if(this._sd.frequency>0&&s)return;let n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I;if(n=this._anchor2X-this._anchor1X,a=this._anchor2Y-this._anchor1Y,o=this._anchor2Z-this._anchor1Z,this._sd.frequency>0){let t=6.28318530717958*this._sd.frequency,s=this._sd.dampingRatio;s<Ut.common.Setting.minSpringDamperDampingRatio&&(s=Ut.common.Setting.minSpringDamperDampingRatio);let n=i.dt,a=2*s*t,o=t*t;this._sd.useSymplecticEuler?(e=1/(n*a),r=o/a):(e=1/(n*(n*o+a)),r=o/(n*o+a)),e*=this._b1._invMass+this._b2._invMass}else e=0,r=this.getErp(i,s);_=n*r,h=a*r,l=o*r,c=0,m=-this._relativeAnchor1Z,b=this._relativeAnchor1Y,p=this._relativeAnchor1Z,d=0,u=-this._relativeAnchor1X,f=-this._relativeAnchor1Y,x=this._relativeAnchor1X,g=0,v=0,y=-this._relativeAnchor2Z,X=this._relativeAnchor2Y,z=this._relativeAnchor2Z,M=0,Y=-this._relativeAnchor2X,Z=-this._relativeAnchor2Y,w=this._relativeAnchor2X,I=0,c=-c,m=-m,b=-b,p=-p,d=-d,u=-u,f=-f,x=-x,g=-g,v=-v,y=-y,X=-X,z=-z,M=-M,Y=-Y,Z=-Z,w=-w,I=-I;let V=this._impulses[0],L=t.rows[t.numRows++],A=L.jacobian;A.lin1X=0,A.lin1Y=0,A.lin1Z=0,A.lin2X=0,A.lin2Y=0,A.lin2Z=0,A.ang1X=0,A.ang1Y=0,A.ang1Z=0,A.ang2X=0,A.ang2Y=0,A.ang2Z=0,L.rhs=0,L.cfm=0,L.minImpulse=0,L.maxImpulse=0,L.motorSpeed=0,L.motorMaxImpulse=0,L.impulse=null,L.impulse=V,L.rhs=_,L.cfm=e,L.minImpulse=-1/0,L.maxImpulse=1/0;let k=L.jacobian;k.lin1X=1,k.lin1Y=0,k.lin1Z=0,k.lin2X=1,k.lin2Y=0,k.lin2Z=0,k.ang1X=c,k.ang1Y=m,k.ang1Z=b,k.ang2X=v,k.ang2Y=y,k.ang2Z=X;let S=this._impulses[1],B=t.rows[t.numRows++],P=B.jacobian;P.lin1X=0,P.lin1Y=0,P.lin1Z=0,P.lin2X=0,P.lin2Y=0,P.lin2Z=0,P.ang1X=0,P.ang1Y=0,P.ang1Z=0,P.ang2X=0,P.ang2Y=0,P.ang2Z=0,B.rhs=0,B.cfm=0,B.minImpulse=0,B.maxImpulse=0,B.motorSpeed=0,B.motorMaxImpulse=0,B.impulse=null,B.impulse=S,B.rhs=h,B.cfm=e,B.minImpulse=-1/0,B.maxImpulse=1/0,k=B.jacobian,k.lin1X=0,k.lin1Y=1,k.lin1Z=0,k.lin2X=0,k.lin2Y=1,k.lin2Z=0,k.ang1X=p,k.ang1Y=d,k.ang1Z=u,k.ang2X=z,k.ang2Y=M,k.ang2Z=Y;let C=this._impulses[2],T=t.rows[t.numRows++],j=T.jacobian;j.lin1X=0,j.lin1Y=0,j.lin1Z=0,j.lin2X=0,j.lin2Y=0,j.lin2Z=0,j.ang1X=0,j.ang1Y=0,j.ang1Z=0,j.ang2X=0,j.ang2Y=0,j.ang2Z=0,T.rhs=0,T.cfm=0,T.minImpulse=0,T.maxImpulse=0,T.motorSpeed=0,T.motorMaxImpulse=0,T.impulse=null,T.impulse=C,T.rhs=l,T.cfm=e,T.minImpulse=-1/0,T.maxImpulse=1/0,k=T.jacobian,k.lin1X=0,k.lin1Y=0,k.lin1Z=1,k.lin2X=0,k.lin2Y=0,k.lin2Z=1,k.ang1X=f,k.ang1Y=x,k.ang1Z=g,k.ang2X=Z,k.ang2Y=w,k.ang2Z=I}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getSpringDamper(){return this._sd}},Ut.dynamics.constraint.joint.SphericalJointConfig=class extends Ut.dynamics.constraint.joint.JointConfig{constructor(){super(),this.springDamper=new Ut.dynamics.constraint.joint.SpringDamper}init(t,i,s){return this._init(t,i,s),this}},Ut.dynamics.constraint.joint.SpringDamper=class{constructor(){this.frequency=0,this.dampingRatio=0,this.useSymplecticEuler=!1}setSpring(t,i){return this.frequency=t,this.dampingRatio=i,this}setSymplecticEuler(t){return this.useSymplecticEuler=t,this}clone(){let t=new Ut.dynamics.constraint.joint.SpringDamper;return t.frequency=this.frequency,t.dampingRatio=this.dampingRatio,t.useSymplecticEuler=this.useSymplecticEuler,t}},Ut.dynamics.constraint.joint.TranslationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorForce=0}setLimits(t,i){return this.lowerLimit=t,this.upperLimit=i,this}setMotor(t,i){return this.motorSpeed=t,this.motorForce=i,this}clone(){let t=new Ut.dynamics.constraint.joint.TranslationalLimitMotor;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorForce=this.motorForce,t}},Ut.dynamics.constraint.joint.UniversalJoint=class extends Ut.dynamics.constraint.joint.Joint{constructor(t){super(t,Ut.dynamics.constraint.joint.JointType.UNIVERSAL);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let s=t.localAxis2;this._localBasisZ2X=s.x,this._localBasisZ2Y=s.y,this._localBasisZ2Z=s.z,this.buildLocalBasesFromX1Z2(),this._angleX=0,this._angleY=0,this._angleZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._sd1=t.springDamper1.clone(),this._sd2=t.springDamper2.clone(),this._lm1=t.limitMotor1.clone(),this._lm2=t.limitMotor2.clone()}getInfo(t,i,s){let n,a,o,e=this.getErp(i,s);n=this.linearErrorX*e,a=this.linearErrorY*e,o=this.linearErrorZ*e;let r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y=this._angleY*e;r=0,_=-this._relativeAnchor1Z,h=this._relativeAnchor1Y,l=this._relativeAnchor1Z,c=0,m=-this._relativeAnchor1X,b=-this._relativeAnchor1Y,p=this._relativeAnchor1X,d=0,u=0,f=-this._relativeAnchor2Z,x=this._relativeAnchor2Y,g=this._relativeAnchor2Z,v=0,y=-this._relativeAnchor2X,X=-this._relativeAnchor2Y,z=this._relativeAnchor2X,M=0,r=-r,_=-_,h=-h,l=-l,c=-c,m=-m,b=-b,p=-p,d=-d,u=-u,f=-f,x=-x,g=-g,v=-v,y=-y,X=-X,z=-z,M=-M;let Z=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),w=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ),I=this._impulses[0],V=t.rows[t.numRows++],L=V.jacobian;L.lin1X=0,L.lin1Y=0,L.lin1Z=0,L.lin2X=0,L.lin2Y=0,L.lin2Z=0,L.ang1X=0,L.ang1Y=0,L.ang1Z=0,L.ang2X=0,L.ang2Y=0,L.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=I,V.rhs=n,V.cfm=0,V.minImpulse=-1/0,V.maxImpulse=1/0;let A=V.jacobian;A.lin1X=1,A.lin1Y=0,A.lin1Z=0,A.lin2X=1,A.lin2Y=0,A.lin2Z=0,A.ang1X=r,A.ang1Y=_,A.ang1Z=h,A.ang2X=u,A.ang2Y=f,A.ang2Z=x;let k=this._impulses[1],S=t.rows[t.numRows++],B=S.jacobian;B.lin1X=0,B.lin1Y=0,B.lin1Z=0,B.lin2X=0,B.lin2Y=0,B.lin2Z=0,B.ang1X=0,B.ang1Y=0,B.ang1Z=0,B.ang2X=0,B.ang2Y=0,B.ang2Z=0,S.rhs=0,S.cfm=0,S.minImpulse=0,S.maxImpulse=0,S.motorSpeed=0,S.motorMaxImpulse=0,S.impulse=null,S.impulse=k,S.rhs=a,S.cfm=0,S.minImpulse=-1/0,S.maxImpulse=1/0,A=S.jacobian,A.lin1X=0,A.lin1Y=1,A.lin1Z=0,A.lin2X=0,A.lin2Y=1,A.lin2Z=0,A.ang1X=l,A.ang1Y=c,A.ang1Z=m,A.ang2X=g,A.ang2Y=v,A.ang2Z=y;let P=this._impulses[2],C=t.rows[t.numRows++],T=C.jacobian;if(T.lin1X=0,T.lin1Y=0,T.lin1Z=0,T.lin2X=0,T.lin2Y=0,T.lin2Z=0,T.ang1X=0,T.ang1Y=0,T.ang1Z=0,T.ang2X=0,T.ang2Y=0,T.ang2Z=0,C.rhs=0,C.cfm=0,C.minImpulse=0,C.maxImpulse=0,C.motorSpeed=0,C.motorMaxImpulse=0,C.impulse=null,C.impulse=P,C.rhs=o,C.cfm=0,C.minImpulse=-1/0,C.maxImpulse=1/0,A=C.jacobian,A.lin1X=0,A.lin1Y=0,A.lin1Z=1,A.lin2X=0,A.lin2Y=0,A.lin2Z=1,A.ang1X=b,A.ang1Y=p,A.ang1Z=d,A.ang2X=X,A.ang2Y=z,A.ang2Z=M,!this.xSingular&&(this._sd1.frequency<=0||!s)){let n=this._impulses[3],a=t.rows[t.numRows++],o=a.jacobian;o.lin1X=0,o.lin1Y=0,o.lin1Z=0,o.lin2X=0,o.lin2Y=0,o.lin2Z=0,o.ang1X=0,o.ang1Y=0,o.ang1Z=0,o.ang2X=0,o.ang2Y=0,o.ang2Z=0,a.rhs=0,a.cfm=0,a.minImpulse=0,a.maxImpulse=0,a.motorSpeed=0,a.motorMaxImpulse=0,a.impulse=null,a.impulse=n,this.setSolverInfoRowAngular(a,this._angleX,this._lm1,Z,this._sd1,i,s),A=a.jacobian,A.ang1X=this._axisXX,A.ang1Y=this._axisXY,A.ang1Z=this._axisXZ,A.ang2X=this._axisXX,A.ang2Y=this._axisXY,A.ang2Z=this._axisXZ}if(!this.ySingular){let i=this._impulses[4],s=t.rows[t.numRows++],n=s.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,s.rhs=0,s.cfm=0,s.minImpulse=0,s.maxImpulse=0,s.motorSpeed=0,s.motorMaxImpulse=0,s.impulse=null,s.impulse=i,s.rhs=Y,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=1/0,A=s.jacobian,A.ang1X=this._axisYX,A.ang1Y=this._axisYY,A.ang1Z=this._axisYZ,A.ang2X=this._axisYX,A.ang2Y=this._axisYY,A.ang2Z=this._axisYZ}if(!this.zSingular&&(this._sd2.frequency<=0||!s)){let n=this._impulses[5],a=t.rows[t.numRows++],o=a.jacobian;o.lin1X=0,o.lin1Y=0,o.lin1Z=0,o.lin2X=0,o.lin2Y=0,o.lin2Z=0,o.ang1X=0,o.ang1Y=0,o.ang1Z=0,o.ang2X=0,o.ang2Y=0,o.ang2Z=0,a.rhs=0,a.cfm=0,a.minImpulse=0,a.maxImpulse=0,a.motorSpeed=0,a.motorMaxImpulse=0,a.impulse=null,a.impulse=n,this.setSolverInfoRowAngular(a,this._angleZ,this._lm2,w,this._sd2,i,s),A=a.jacobian,A.ang1X=this._axisZX,A.ang1Y=this._axisZY,A.ang1Z=this._axisZZ,A.ang2X=this._axisZX,A.ang2Y=this._axisZY,A.ang2Z=this._axisZZ}}_syncAnchors(){let t,i,s,n,a,o,e,r,_;super._syncAnchors(),t=this._basisX1X,i=this._basisX1Y,s=this._basisX1Z,e=this._basisZ2X,r=this._basisZ2Y,_=this._basisZ2Z,n=r*s-_*i,a=_*t-e*s,o=e*i-r*t,this._axisXX=a*_-o*r,this._axisXY=o*e-n*_,this._axisXZ=n*r-a*e,this._axisYX=n,this._axisYY=a,this._axisYZ=o,this._axisZX=i*o-s*a,this._axisZY=s*n-t*o,this._axisZZ=t*a-i*n;let h=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;h>0&&(h=1/Math.sqrt(h)),this._axisXX*=h,this._axisXY*=h,this._axisXZ*=h;let l=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;l>0&&(l=1/Math.sqrt(l)),this._axisYX*=l,this._axisYY*=l,this._axisYZ*=l;let c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C,T,j,E,R,D,F,q,N,H,O=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;O>0&&(O=1/Math.sqrt(O)),this._axisZX*=O,this._axisZY*=O,this._axisZZ*=O,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0,c=this._basisX1X,m=this._basisY1X,b=this._basisZ1X,p=this._basisX1Y,d=this._basisY1Y,u=this._basisZ1Y,f=this._basisX1Z,x=this._basisY1Z,g=this._basisZ1Z,v=this._basisX2X,y=this._basisY2X,X=this._basisZ2X,z=this._basisX2Y,M=this._basisY2Y,Y=this._basisZ2Y,Z=this._basisX2Z,w=this._basisY2Z,I=this._basisZ2Z,C=c*v+p*z+f*Z,T=c*y+p*M+f*w,j=c*X+p*Y+f*I,E=m*y+d*M+x*w,R=m*X+d*Y+x*I,D=b*y+u*M+g*w,F=b*X+u*Y+g*I,V=C,L=T,A=j,k=E,S=R,B=D,P=F;let W=A;if(W<=-1){let t=Math.atan2(B,k);q=.5*t,N=-1.570796326794895,H=.5*-t}else if(W>=1){let t=Math.atan2(B,k);q=.5*t,N=1.570796326794895,H=.5*t}else q=Math.atan2(-S,P),N=Math.asin(W),H=Math.atan2(-L,V);this._angleX=q,this._angleY=N,this._angleZ=H,this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new Ut.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new Ut.common.Vec3;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z}getLocalAxis1(){let t=new Ut.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new Ut.common.Vec3;return t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z}getSpringDamper1(){return this._sd1}getSpringDamper2(){return this._sd2}getLimitMotor1(){return this._lm1}getLimitMotor2(){return this._lm2}getAngle1(){return this._angleX}getAngle2(){return this._angleZ}},Ut.dynamics.constraint.joint.UniversalJointConfig=class extends Ut.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new Ut.common.Vec3(1,0,0),this.localAxis2=new Ut.common.Vec3(1,0,0),this.springDamper1=new Ut.dynamics.constraint.joint.SpringDamper,this.springDamper2=new Ut.dynamics.constraint.joint.SpringDamper,this.limitMotor1=new Ut.dynamics.constraint.joint.RotationalLimitMotor,this.limitMotor2=new Ut.dynamics.constraint.joint.RotationalLimitMotor}init(t,i,s,n,a){this._init(t,i,s);let o,e,r,_,h,l,c=this.localAxis1;o=n.x,e=n.y,r=n.z,_=t._transform._rotation00*o+t._transform._rotation10*e+t._transform._rotation20*r,h=t._transform._rotation01*o+t._transform._rotation11*e+t._transform._rotation21*r,l=t._transform._rotation02*o+t._transform._rotation12*e+t._transform._rotation22*r,o=_,e=h,r=l,c.x=o,c.y=e,c.z=r;let m,b,p,d,u,f,x=this.localAxis2;return m=a.x,b=a.y,p=a.z,d=i._transform._rotation00*m+i._transform._rotation10*b+i._transform._rotation20*p,u=i._transform._rotation01*m+i._transform._rotation11*b+i._transform._rotation21*p,f=i._transform._rotation02*m+i._transform._rotation12*b+i._transform._rotation22*p,m=d,b=u,p=f,x.x=m,x.y=b,x.z=p,this}},Ut.dynamics.constraint.solver||(Ut.dynamics.constraint.solver={}),Ut.dynamics.constraint.solver.ConstraintSolverType=class{},Ut.dynamics.constraint.solver.common||(Ut.dynamics.constraint.solver.common={}),Ut.dynamics.constraint.solver.common.ContactSolverMassDataRow=class{constructor(){this.invMLinN1X=0,this.invMLinN1Y=0,this.invMLinN1Z=0,this.invMLinN2X=0,this.invMLinN2Y=0,this.invMLinN2Z=0,this.invMAngN1X=0,this.invMAngN1Y=0,this.invMAngN1Z=0,this.invMAngN2X=0,this.invMAngN2Y=0,this.invMAngN2Z=0,this.invMLinT1X=0,this.invMLinT1Y=0,this.invMLinT1Z=0,this.invMLinT2X=0,this.invMLinT2Y=0,this.invMLinT2Z=0,this.invMAngT1X=0,this.invMAngT1Y=0,this.invMAngT1Z=0,this.invMAngT2X=0,this.invMAngT2Y=0,this.invMAngT2Z=0,this.invMLinB1X=0,this.invMLinB1Y=0,this.invMLinB1Z=0,this.invMLinB2X=0,this.invMLinB2Y=0,this.invMLinB2Z=0,this.invMAngB1X=0,this.invMAngB1Y=0,this.invMAngB1Z=0,this.invMAngB2X=0,this.invMAngB2Y=0,this.invMAngB2Z=0,this.massN=0,this.massTB00=0,this.massTB01=0,this.massTB10=0,this.massTB11=0}},Ut.dynamics.constraint.solver.common.JointSolverMassDataRow=class{constructor(){this.invMLin1X=0,this.invMLin1Y=0,this.invMLin1Z=0,this.invMLin2X=0,this.invMLin2Y=0,this.invMLin2Z=0,this.invMAng1X=0,this.invMAng1Y=0,this.invMAng1Z=0,this.invMAng2X=0,this.invMAng2Y=0,this.invMAng2Z=0,this.mass=0,this.massWithoutCfm=0}},Ut.dynamics.constraint.solver.direct||(Ut.dynamics.constraint.solver.direct={}),Ut.dynamics.constraint.solver.direct.Boundary=class{constructor(t){this.iBounded=new Array(t),this.iUnbounded=new Array(t),this.signs=new Array(t),this.b=new Array(t),this.numBounded=0,this.numUnbounded=0,this.matrixId=0}init(t){this.numBounded=t.numBounded;let i=0,s=this.numBounded;for(;i<s;){let s=i++;this.iBounded[s]=t.iBounded[s],this.signs[s]=t.signs[s]}this.numUnbounded=t.numUnbounded,this.matrixId=0;let n=0,a=this.numUnbounded;for(;n<a;){let i=n++,s=t.iUnbounded[i];this.iUnbounded[i]=s,this.matrixId|=1<<s}}computeImpulses(t,i,s,n,a,o,e){let r=0,_=this.numUnbounded;for(;r<_;){let i=this.iUnbounded[r++],a=t.rows[i];this.b[i]=a.rhs*o-s[i]-a.cfm*n[i]}let h=i._invMassWithoutCfm,l=0,c=this.numBounded;for(;l<c;){let i=l++,s=this.iBounded[i],o=this.signs[i],e=t.rows[s],r=(o<0?e.minImpulse:o>0?e.maxImpulse:0)-n[s];if(a[s]=r,0!=r){let t=0,i=this.numUnbounded;for(;t<i;){let i=this.iUnbounded[t++];this.b[i]-=h[s][i]*r}}}let m,b=this.iUnbounded,p=this.numUnbounded,d=0,u=0;for(;u<p;)d|=1<<b[u++];i._cacheComputed[d]||(i.computeSubmatrix(d,b,p),i._cacheComputed[d]=!0),m=i._cachedSubmatrices[d];let f=!0,x=0,g=this.numUnbounded;for(;x<g;){let i=x++,s=this.iUnbounded[i],o=t.rows[s],e=n[s],r=e,_=0,h=this.numUnbounded;for(;_<h;){let t=_++;r+=this.b[this.iUnbounded[t]]*m[i][t]}if(r<o.minImpulse-Ut.common.Setting.directMlcpSolverEps||r>o.maxImpulse+Ut.common.Setting.directMlcpSolverEps){f=!1;break}a[s]=r-e}if(e)return!0;if(!f)return!1;let v=0,y=this.numBounded;for(;v<y;){let i=v++,e=this.iBounded[i],r=t.rows[e],_=this.signs[i],l=0,c=n[e]+a[e],m=s[e],b=0,p=t.numRows;for(;b<p;){let t=b++;m+=h[e][t]*a[t]}if(l=r.rhs*o-m-r.cfm*c,_<0&&l>Ut.common.Setting.directMlcpSolverEps||_>0&&l<-Ut.common.Setting.directMlcpSolverEps){f=!1;break}}return f}},Ut.dynamics.constraint.solver.direct.BoundaryBuildInfo=class{constructor(t){this.size=t,this.numBounded=0,this.iBounded=new Array(t),this.signs=new Array(t),this.numUnbounded=0,this.iUnbounded=new Array(t)}},Ut.dynamics.constraint.solver.direct.BoundaryBuilder=class{constructor(t){this.maxRows=t,this.numBoundaries=0,this.boundaries=new Array(1<<t),this.bbInfo=new Ut.dynamics.constraint.solver.direct.BoundaryBuildInfo(t)}buildBoundariesRecursive(t,i){if(i==t.numRows)return null==this.boundaries[this.numBoundaries]&&(this.boundaries[this.numBoundaries]=new Ut.dynamics.constraint.solver.direct.Boundary(this.maxRows)),void this.boundaries[this.numBoundaries++].init(this.bbInfo);let s=t.rows[i],n=s.minImpulse>-1/0,a=s.maxImpulse<1/0;if(0==s.minImpulse&&0==s.maxImpulse){let s=this.bbInfo;return s.iBounded[s.numBounded]=i,s.signs[s.numBounded]=0,s.numBounded++,this.buildBoundariesRecursive(t,i+1),void this.bbInfo.numBounded--}let o=this.bbInfo;if(o.iUnbounded[o.numUnbounded]=i,o.numUnbounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numUnbounded--,n){let s=this.bbInfo;s.iBounded[s.numBounded]=i,s.signs[s.numBounded]=-1,s.numBounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numBounded--}if(a){let s=this.bbInfo;s.iBounded[s.numBounded]=i,s.signs[s.numBounded]=1,s.numBounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numBounded--}}buildBoundaries(t){this.numBoundaries=0;let i=this.bbInfo;i.numBounded=0,i.numUnbounded=0,this.buildBoundariesRecursive(t,0)}},Ut.dynamics.constraint.solver.direct.BoundarySelector=class{constructor(t){this.n=t,this.indices=new Array(t),this.tmpIndices=new Array(t);let i=0;for(;i<t;){let t=i++;this.indices[t]=t}}getIndex(t){return this.indices[t]}select(t){let i=0;for(;this.indices[i]!=t;)++i;for(;i>0;){let t=this.indices[i];this.indices[i]=this.indices[i-1],this.indices[i-1]=t,--i}}setSize(t){let i=0,s=0,n=0,a=this.n;for(;n<a;){let a=this.indices[n++];a<t?(this.tmpIndices[i]=a,++i):(this.tmpIndices[t+s]=a,++s)}let o=this.indices;this.indices=this.tmpIndices,this.tmpIndices=o}},Ut.dynamics.constraint.solver.direct.DirectJointConstraintSolver=class extends Ut.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.joint=t,this.info=new Ut.dynamics.constraint.info.joint.JointSolverInfo;let i=Ut.common.Setting.maxJacobianRows;this.massMatrix=new Ut.dynamics.constraint.solver.direct.MassMatrix(i),this.boundaryBuilder=new Ut.dynamics.constraint.solver.direct.BoundaryBuilder(i),this.massData=new Array(i);let s=0,n=this.massData.length;for(;s<n;)this.massData[s++]=new Ut.dynamics.constraint.solver.common.JointSolverMassDataRow;let a=this.boundaryBuilder.boundaries.length;this.velBoundarySelector=new Ut.dynamics.constraint.solver.direct.BoundarySelector(a),this.posBoundarySelector=new Ut.dynamics.constraint.solver.direct.BoundarySelector(a),this.relVels=new Array(i),this.impulses=new Array(i),this.dImpulses=new Array(i),this.dTotalImpulses=new Array(i);let o=0;for(;o<i;){let t=o++;this.relVels[t]=0,this.impulses[t]=0,this.dImpulses[t]=0,this.dTotalImpulses[t]=0}}preSolveVelocity(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let i=this.boundaryBuilder;i.numBoundaries=0;let s=i.bbInfo;s.numBounded=0,s.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);let n=this.velBoundarySelector,a=this.boundaryBuilder.numBoundaries,o=0,e=0,r=0,_=n.n;for(;r<_;){let t=n.indices[r++];t<a?(n.tmpIndices[o]=t,++o):(n.tmpIndices[a+e]=t,++e)}let h=n.indices;n.indices=n.tmpIndices,n.tmpIndices=h}warmStart(t){let i=this.joint._positionCorrectionAlgorithm==Ut.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?Ut.common.Setting.jointWarmStartingFactorForBaungarte:Ut.common.Setting.jointWarmStartingFactor;if(i*=t.dtRatio,i<=0){let t=0,i=this.info.numRows;for(;t<i;){let i=this.info.rows[t++].impulse;i.impulse=0,i.impulseM=0,i.impulseP=0}return}let s=0,n=this.info.numRows;for(;s<n;){let t=s++,n=this.info.rows[t],a=n.impulse,o=a.impulse*i;if(o<n.minImpulse?o=n.minImpulse:o>n.maxImpulse&&(o=n.maxImpulse),a.impulse=o,n.motorMaxImpulse>0){let t=a.impulseM*i,s=n.motorMaxImpulse;t<-s?t=-s:t>s&&(t=s),a.impulseM=t}else a.impulseM=0;this.dImpulses[t]=a.impulse+a.impulseM}let a,o,e,r,_,h,l,c,m,b,p,d,u=this.dImpulses,f=!1,x=!1;a=this._b1._velX,o=this._b1._velY,e=this._b1._velZ,r=this._b2._velX,_=this._b2._velY,h=this._b2._velZ,l=this._b1._angVelX,c=this._b1._angVelY,m=this._b1._angVelZ,b=this._b2._angVelX,p=this._b2._angVelY,d=this._b2._angVelZ;let g=0,v=this.info.numRows;for(;g<v;){let t=g++,i=this.info.rows[t].jacobian,s=this.massData[t],n=u[t];0!=(1&i.flag)&&(a+=s.invMLin1X*n,o+=s.invMLin1Y*n,e+=s.invMLin1Z*n,r+=s.invMLin2X*-n,_+=s.invMLin2Y*-n,h+=s.invMLin2Z*-n,f=!0),0!=(2&i.flag)&&(l+=s.invMAng1X*n,c+=s.invMAng1Y*n,m+=s.invMAng1Z*n,b+=s.invMAng2X*-n,p+=s.invMAng2Y*-n,d+=s.invMAng2Z*-n,x=!0)}f&&(this._b1._velX=a,this._b1._velY=o,this._b1._velZ=e,this._b2._velX=r,this._b2._velY=_,this._b2._velZ=h),x&&(this._b1._angVelX=l,this._b1._angVelY=c,this._b1._angVelZ=m,this._b2._angVelX=b,this._b2._angVelY=p,this._b2._angVelZ=d)}solveVelocity(){let t,i,s,n,a,o,e,r,_,h,l,c,m=this.info.numRows;t=this._b1._velX,i=this._b1._velY,s=this._b1._velZ,n=this._b2._velX,a=this._b2._velY,o=this._b2._velZ,e=this._b1._angVelX,r=this._b1._angVelY,_=this._b1._angVelZ,h=this._b2._angVelX,l=this._b2._angVelY,c=this._b2._angVelZ;let b=0;for(;b<m;){let m=b++,p=this.info.rows[m],d=p.jacobian,u=0;u+=t*d.lin1X+i*d.lin1Y+s*d.lin1Z,u-=n*d.lin2X+a*d.lin2Y+o*d.lin2Z,u+=e*d.ang1X+r*d.ang1Y+_*d.ang1Z,u-=h*d.ang2X+l*d.ang2Y+c*d.ang2Z,this.relVels[m]=u,this.impulses[m]=p.impulse.impulse,this.dTotalImpulses[m]=0}let p=this.massMatrix._invMassWithoutCfm,d=0;for(;d<m;){let t=d++,i=this.info.rows[t],s=i.impulse;if(i.motorMaxImpulse>0){let n=s.impulseM,a=n+this.massData[t].massWithoutCfm*(-i.motorSpeed-this.relVels[t]),o=i.motorMaxImpulse;a<-o?a=-o:a>o&&(a=o),s.impulseM=a;let e=a-n;this.dTotalImpulses[t]=e;let r=0;for(;r<m;){let i=r++;this.relVels[i]+=e*p[t][i]}}}let u=!1,f=0,x=this.boundaryBuilder.numBoundaries;for(;f<x;){let t=this.velBoundarySelector.indices[f++];if(this.boundaryBuilder.boundaries[t].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,1,!1)){let i=0;for(;i<m;){let t=i++,s=this.dImpulses[t];this.info.rows[t].impulse.impulse+=s,this.dTotalImpulses[t]+=s}let s,n,a,o,e,r,_,h,l,c,b,p,d=this.dTotalImpulses,f=!1,x=!1;s=this._b1._velX,n=this._b1._velY,a=this._b1._velZ,o=this._b2._velX,e=this._b2._velY,r=this._b2._velZ,_=this._b1._angVelX,h=this._b1._angVelY,l=this._b1._angVelZ,c=this._b2._angVelX,b=this._b2._angVelY,p=this._b2._angVelZ;let g=0,v=this.info.numRows;for(;g<v;){let t=g++,i=this.info.rows[t].jacobian,m=this.massData[t],u=d[t];0!=(1&i.flag)&&(s+=m.invMLin1X*u,n+=m.invMLin1Y*u,a+=m.invMLin1Z*u,o+=m.invMLin2X*-u,e+=m.invMLin2Y*-u,r+=m.invMLin2Z*-u,f=!0),0!=(2&i.flag)&&(_+=m.invMAng1X*u,h+=m.invMAng1Y*u,l+=m.invMAng1Z*u,c+=m.invMAng2X*-u,b+=m.invMAng2Y*-u,p+=m.invMAng2Z*-u,x=!0)}f&&(this._b1._velX=s,this._b1._velY=n,this._b1._velZ=a,this._b2._velX=o,this._b2._velY=e,this._b2._velZ=r),x&&(this._b1._angVelX=_,this._b1._angVelY=h,this._b1._angVelZ=l,this._b2._angVelX=c,this._b2._angVelY=b,this._b2._angVelZ=p);let y=this.velBoundarySelector,X=0;for(;y.indices[X]!=t;)++X;for(;X>0;){let t=y.indices[X];y.indices[X]=y.indices[X-1],y.indices[X-1]=t,--X}u=!0;break}}u||console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:335:","could not find solution. (velocity)")}postSolveVelocity(t){let i,s,n,a,o,e;i=0,s=0,n=0,a=0,o=0,e=0;let r=0,_=this.info.numRows;for(;r<_;){let t=this.info.rows[r++],_=t.impulse,h=t.jacobian;0!=(1&h.flag)?(i+=h.lin1X*_.impulse,s+=h.lin1Y*_.impulse,n+=h.lin1Z*_.impulse):0!=(2&h.flag)&&(a+=h.ang1X*_.impulse,o+=h.ang1Y*_.impulse,e+=h.ang1Z*_.impulse)}this.joint._appliedForceX=i*t.invDt,this.joint._appliedForceY=s*t.invDt,this.joint._appliedForceZ=n*t.invDt,this.joint._appliedTorqueX=a*t.invDt,this.joint._appliedTorqueY=o*t.invDt,this.joint._appliedTorqueZ=e*t.invDt}preSolvePosition(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let i=this.boundaryBuilder;i.numBoundaries=0;let s=i.bbInfo;s.numBounded=0,s.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);let n=this.posBoundarySelector,a=this.boundaryBuilder.numBoundaries,o=0,e=0,r=0,_=n.n;for(;r<_;){let t=n.indices[r++];t<a?(n.tmpIndices[o]=t,++o):(n.tmpIndices[a+e]=t,++e)}let h=n.indices;n.indices=n.tmpIndices,n.tmpIndices=h;let l=0,c=this.info.numRows;for(;l<c;)this.info.rows[l++].impulse.impulseP=0}solvePositionSplitImpulse(){let t,i,s,n,a,o,e,r,_,h,l,c,m=this.info.numRows;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,s=this._b1._pseudoVelZ,n=this._b2._pseudoVelX,a=this._b2._pseudoVelY,o=this._b2._pseudoVelZ,e=this._b1._angPseudoVelX,r=this._b1._angPseudoVelY,_=this._b1._angPseudoVelZ,h=this._b2._angPseudoVelX,l=this._b2._angPseudoVelY,c=this._b2._angPseudoVelZ;let b=0;for(;b<m;){let m=b++,p=this.info.rows[m],d=p.jacobian,u=0;u+=t*d.lin1X+i*d.lin1Y+s*d.lin1Z,u-=n*d.lin2X+a*d.lin2Y+o*d.lin2Z,u+=e*d.ang1X+r*d.ang1Y+_*d.ang1Z,u-=h*d.ang2X+l*d.ang2Y+c*d.ang2Z,this.relVels[m]=u,this.impulses[m]=p.impulse.impulseP}let p=!1,d=0,u=this.boundaryBuilder.numBoundaries;for(;d<u;){let t=this.posBoundarySelector.indices[d++];if(this.boundaryBuilder.boundaries[t].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,Ut.common.Setting.positionSplitImpulseBaumgarte,!1)){let i=0;for(;i<m;){let t=i++;this.info.rows[t].impulse.impulseP+=this.dImpulses[t]}let s,n,a,o,e,r,_,h,l,c,b,d,u=this.dImpulses,f=!1,x=!1;s=this._b1._pseudoVelX,n=this._b1._pseudoVelY,a=this._b1._pseudoVelZ,o=this._b2._pseudoVelX,e=this._b2._pseudoVelY,r=this._b2._pseudoVelZ,_=this._b1._angPseudoVelX,h=this._b1._angPseudoVelY,l=this._b1._angPseudoVelZ,c=this._b2._angPseudoVelX,b=this._b2._angPseudoVelY,d=this._b2._angPseudoVelZ;let g=0,v=this.info.numRows;for(;g<v;){let t=g++,i=this.info.rows[t].jacobian,m=this.massData[t],p=u[t];0!=(1&i.flag)&&(s+=m.invMLin1X*p,n+=m.invMLin1Y*p,a+=m.invMLin1Z*p,o+=m.invMLin2X*-p,e+=m.invMLin2Y*-p,r+=m.invMLin2Z*-p,f=!0),0!=(2&i.flag)&&(_+=m.invMAng1X*p,h+=m.invMAng1Y*p,l+=m.invMAng1Z*p,c+=m.invMAng2X*-p,b+=m.invMAng2Y*-p,d+=m.invMAng2Z*-p,x=!0)}f&&(this._b1._pseudoVelX=s,this._b1._pseudoVelY=n,this._b1._pseudoVelZ=a,this._b2._pseudoVelX=o,this._b2._pseudoVelY=e,this._b2._pseudoVelZ=r),x&&(this._b1._angPseudoVelX=_,this._b1._angPseudoVelY=h,this._b1._angPseudoVelZ=l,this._b2._angPseudoVelX=c,this._b2._angPseudoVelY=b,this._b2._angPseudoVelZ=d);let y=this.posBoundarySelector,X=0;for(;y.indices[X]!=t;)++X;for(;X>0;){let t=y.indices[X];y.indices[X]=y.indices[X-1],y.indices[X-1]=t,--X}p=!0;break}}p||console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:450:","could not find solution. (split impulse)")}solvePositionNgs(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let i=this.boundaryBuilder;i.numBoundaries=0;let s=i.bbInfo;s.numBounded=0,s.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);let n=this.posBoundarySelector,a=this.boundaryBuilder.numBoundaries,o=0,e=0,r=0,_=n.n;for(;r<_;){let t=n.indices[r++];t<a?(n.tmpIndices[o]=t,++o):(n.tmpIndices[a+e]=t,++e)}let h=n.indices;n.indices=n.tmpIndices,n.tmpIndices=h;let l=this.info.numRows,c=0;for(;c<l;){let t=c++,i=this.info.rows[t].impulse;this.relVels[t]=0,this.impulses[t]=i.impulseP}let m=!1,b=0,p=this.boundaryBuilder.numBoundaries;for(;b<p;){let t=this.posBoundarySelector.indices[b++];if(this.boundaryBuilder.boundaries[t].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,Ut.common.Setting.positionNgsBaumgarte,!1)){let i=0;for(;i<l;){let t=i++;this.info.rows[t].impulse.impulseP+=this.dImpulses[t]}let s,n,a,o,e,r,_,h,c,b,p,d,u=this.dImpulses,f=!1,x=!1;s=0,n=0,a=0,o=0,e=0,r=0,_=0,h=0,c=0,b=0,p=0,d=0;let g=0,v=this.info.numRows;for(;g<v;){let t=g++,i=this.info.rows[t].jacobian,l=this.massData[t],m=u[t];0!=(1&i.flag)&&(s+=l.invMLin1X*m,n+=l.invMLin1Y*m,a+=l.invMLin1Z*m,o+=l.invMLin2X*-m,e+=l.invMLin2Y*-m,r+=l.invMLin2Z*-m,f=!0),0!=(2&i.flag)&&(_+=l.invMAng1X*m,h+=l.invMAng1Y*m,c+=l.invMAng1Z*m,b+=l.invMAng2X*-m,p+=l.invMAng2Y*-m,d+=l.invMAng2Z*-m,x=!0)}if(f){let t=this._b1;t._transform._positionX+=s,t._transform._positionY+=n,t._transform._positionZ+=a;let i=this._b2;i._transform._positionX+=o,i._transform._positionY+=e,i._transform._positionZ+=r}if(x){let t,i,s,n,a,o,e,r,l,m,u,f,x,g=this._b1,v=Math.sqrt(_*_+h*h+c*c),y=.5*v;if(y<.5){let s=y*y;t=.5*(1-.16666666666666666*s+s*s*.008333333333333333),i=1-.5*s+s*s*.041666666666666664}else t=Math.sin(y)/v,i=Math.cos(y);s=_*t,n=h*t,a=c*t,o=s,e=n,r=a,l=i;let X,z=g._transform._rotation00,M=g._transform._rotation11,Y=g._transform._rotation22,Z=z+M+Y;Z>0?(X=Math.sqrt(Z+1),x=.5*X,X=.5/X,m=(g._transform._rotation21-g._transform._rotation12)*X,u=(g._transform._rotation02-g._transform._rotation20)*X,f=(g._transform._rotation10-g._transform._rotation01)*X):z>M?z>Y?(X=Math.sqrt(z-M-Y+1),m=.5*X,X=.5/X,u=(g._transform._rotation01+g._transform._rotation10)*X,f=(g._transform._rotation02+g._transform._rotation20)*X,x=(g._transform._rotation21-g._transform._rotation12)*X):(X=Math.sqrt(Y-z-M+1),f=.5*X,X=.5/X,m=(g._transform._rotation02+g._transform._rotation20)*X,u=(g._transform._rotation12+g._transform._rotation21)*X,x=(g._transform._rotation10-g._transform._rotation01)*X):M>Y?(X=Math.sqrt(M-Y-z+1),u=.5*X,X=.5/X,m=(g._transform._rotation01+g._transform._rotation10)*X,f=(g._transform._rotation12+g._transform._rotation21)*X,x=(g._transform._rotation02-g._transform._rotation20)*X):(X=Math.sqrt(Y-z-M+1),f=.5*X,X=.5/X,m=(g._transform._rotation02+g._transform._rotation20)*X,u=(g._transform._rotation12+g._transform._rotation21)*X,x=(g._transform._rotation10-g._transform._rotation01)*X),m=l*m+o*x+e*f-r*u,u=l*u-o*f+e*x+r*m,f=l*f+o*u-e*m+r*x,x=l*x-o*m-e*u-r*f;let w=m*m+u*u+f*f+x*x;w>1e-32&&(w=1/Math.sqrt(w)),m*=w,u*=w,f*=w,x*=w;let I,V,L,A,k,S,B,P,C,T,j,E,R,D,F,q,N,H,O=2*m,W=2*u,G=2*f,U=m*O,J=u*W,$=f*G,K=m*W,Q=u*G,tt=m*G,it=x*O,st=x*W,nt=x*G;g._transform._rotation00=1-J-$,g._transform._rotation01=K-nt,g._transform._rotation02=tt+st,g._transform._rotation10=K+nt,g._transform._rotation11=1-U-$,g._transform._rotation12=Q-it,g._transform._rotation20=tt-st,g._transform._rotation21=Q+it,g._transform._rotation22=1-U-J,I=g._transform._rotation00*g._invLocalInertia00+g._transform._rotation01*g._invLocalInertia10+g._transform._rotation02*g._invLocalInertia20,V=g._transform._rotation00*g._invLocalInertia01+g._transform._rotation01*g._invLocalInertia11+g._transform._rotation02*g._invLocalInertia21,L=g._transform._rotation00*g._invLocalInertia02+g._transform._rotation01*g._invLocalInertia12+g._transform._rotation02*g._invLocalInertia22,A=g._transform._rotation10*g._invLocalInertia00+g._transform._rotation11*g._invLocalInertia10+g._transform._rotation12*g._invLocalInertia20,k=g._transform._rotation10*g._invLocalInertia01+g._transform._rotation11*g._invLocalInertia11+g._transform._rotation12*g._invLocalInertia21,S=g._transform._rotation10*g._invLocalInertia02+g._transform._rotation11*g._invLocalInertia12+g._transform._rotation12*g._invLocalInertia22,B=g._transform._rotation20*g._invLocalInertia00+g._transform._rotation21*g._invLocalInertia10+g._transform._rotation22*g._invLocalInertia20,P=g._transform._rotation20*g._invLocalInertia01+g._transform._rotation21*g._invLocalInertia11+g._transform._rotation22*g._invLocalInertia21,C=g._transform._rotation20*g._invLocalInertia02+g._transform._rotation21*g._invLocalInertia12+g._transform._rotation22*g._invLocalInertia22,g._invInertia00=I,g._invInertia01=V,g._invInertia02=L,g._invInertia10=A,g._invInertia11=k,g._invInertia12=S,g._invInertia20=B,g._invInertia21=P,g._invInertia22=C,T=g._invInertia00*g._transform._rotation00+g._invInertia01*g._transform._rotation01+g._invInertia02*g._transform._rotation02,j=g._invInertia00*g._transform._rotation10+g._invInertia01*g._transform._rotation11+g._invInertia02*g._transform._rotation12,E=g._invInertia00*g._transform._rotation20+g._invInertia01*g._transform._rotation21+g._invInertia02*g._transform._rotation22,R=g._invInertia10*g._transform._rotation00+g._invInertia11*g._transform._rotation01+g._invInertia12*g._transform._rotation02,D=g._invInertia10*g._transform._rotation10+g._invInertia11*g._transform._rotation11+g._invInertia12*g._transform._rotation12,F=g._invInertia10*g._transform._rotation20+g._invInertia11*g._transform._rotation21+g._invInertia12*g._transform._rotation22,q=g._invInertia20*g._transform._rotation00+g._invInertia21*g._transform._rotation01+g._invInertia22*g._transform._rotation02,N=g._invInertia20*g._transform._rotation10+g._invInertia21*g._transform._rotation11+g._invInertia22*g._transform._rotation12,H=g._invInertia20*g._transform._rotation20+g._invInertia21*g._transform._rotation21+g._invInertia22*g._transform._rotation22,g._invInertia00=T,g._invInertia01=j,g._invInertia02=E,g._invInertia10=R,g._invInertia11=D,g._invInertia12=F,g._invInertia20=q,g._invInertia21=N,g._invInertia22=H,g._invInertia00*=g._rotFactor.x,g._invInertia01*=g._rotFactor.x,g._invInertia02*=g._rotFactor.x,g._invInertia10*=g._rotFactor.y,g._invInertia11*=g._rotFactor.y,g._invInertia12*=g._rotFactor.y,g._invInertia20*=g._rotFactor.z,g._invInertia21*=g._rotFactor.z,g._invInertia22*=g._rotFactor.z;let at,ot,et,rt,_t,ht,lt,ct,mt,bt,pt,dt,ut,ft=this._b2,xt=Math.sqrt(b*b+p*p+d*d),gt=.5*xt;if(gt<.5){let t=gt*gt;at=.5*(1-.16666666666666666*t+t*t*.008333333333333333),ot=1-.5*t+t*t*.041666666666666664}else at=Math.sin(gt)/xt,ot=Math.cos(gt);et=b*at,rt=p*at,_t=d*at,ht=et,lt=rt,ct=_t,mt=ot;let vt,yt=ft._transform._rotation00,Xt=ft._transform._rotation11,zt=ft._transform._rotation22,Mt=yt+Xt+zt;Mt>0?(vt=Math.sqrt(Mt+1),ut=.5*vt,vt=.5/vt,bt=(ft._transform._rotation21-ft._transform._rotation12)*vt,pt=(ft._transform._rotation02-ft._transform._rotation20)*vt,dt=(ft._transform._rotation10-ft._transform._rotation01)*vt):yt>Xt?yt>zt?(vt=Math.sqrt(yt-Xt-zt+1),bt=.5*vt,vt=.5/vt,pt=(ft._transform._rotation01+ft._transform._rotation10)*vt,dt=(ft._transform._rotation02+ft._transform._rotation20)*vt,ut=(ft._transform._rotation21-ft._transform._rotation12)*vt):(vt=Math.sqrt(zt-yt-Xt+1),dt=.5*vt,vt=.5/vt,bt=(ft._transform._rotation02+ft._transform._rotation20)*vt,pt=(ft._transform._rotation12+ft._transform._rotation21)*vt,ut=(ft._transform._rotation10-ft._transform._rotation01)*vt):Xt>zt?(vt=Math.sqrt(Xt-zt-yt+1),pt=.5*vt,vt=.5/vt,bt=(ft._transform._rotation01+ft._transform._rotation10)*vt,dt=(ft._transform._rotation12+ft._transform._rotation21)*vt,ut=(ft._transform._rotation02-ft._transform._rotation20)*vt):(vt=Math.sqrt(zt-yt-Xt+1),dt=.5*vt,vt=.5/vt,bt=(ft._transform._rotation02+ft._transform._rotation20)*vt,pt=(ft._transform._rotation12+ft._transform._rotation21)*vt,ut=(ft._transform._rotation10-ft._transform._rotation01)*vt),bt=mt*bt+ht*ut+lt*dt-ct*pt,pt=mt*pt-ht*dt+lt*ut+ct*bt,dt=mt*dt+ht*pt-lt*bt+ct*ut,ut=mt*ut-ht*bt-lt*pt-ct*dt;let Yt=bt*bt+pt*pt+dt*dt+ut*ut;Yt>1e-32&&(Yt=1/Math.sqrt(Yt)),bt*=Yt,pt*=Yt,dt*=Yt,ut*=Yt;let Zt,wt,It,Vt,Lt,At,kt,St,Bt,Pt,Ct,Tt,jt,Et,Rt,Dt,Ft,qt,Nt=2*bt,Ht=2*pt,Ot=2*dt,Wt=bt*Nt,Gt=pt*Ht,Ut=dt*Ot,Jt=bt*Ht,$t=pt*Ot,Kt=bt*Ot,Qt=ut*Nt,ti=ut*Ht,ii=ut*Ot;ft._transform._rotation00=1-Gt-Ut,ft._transform._rotation01=Jt-ii,ft._transform._rotation02=Kt+ti,ft._transform._rotation10=Jt+ii,ft._transform._rotation11=1-Wt-Ut,ft._transform._rotation12=$t-Qt,ft._transform._rotation20=Kt-ti,ft._transform._rotation21=$t+Qt,ft._transform._rotation22=1-Wt-Gt,Zt=ft._transform._rotation00*ft._invLocalInertia00+ft._transform._rotation01*ft._invLocalInertia10+ft._transform._rotation02*ft._invLocalInertia20,wt=ft._transform._rotation00*ft._invLocalInertia01+ft._transform._rotation01*ft._invLocalInertia11+ft._transform._rotation02*ft._invLocalInertia21,It=ft._transform._rotation00*ft._invLocalInertia02+ft._transform._rotation01*ft._invLocalInertia12+ft._transform._rotation02*ft._invLocalInertia22,Vt=ft._transform._rotation10*ft._invLocalInertia00+ft._transform._rotation11*ft._invLocalInertia10+ft._transform._rotation12*ft._invLocalInertia20,Lt=ft._transform._rotation10*ft._invLocalInertia01+ft._transform._rotation11*ft._invLocalInertia11+ft._transform._rotation12*ft._invLocalInertia21,At=ft._transform._rotation10*ft._invLocalInertia02+ft._transform._rotation11*ft._invLocalInertia12+ft._transform._rotation12*ft._invLocalInertia22,kt=ft._transform._rotation20*ft._invLocalInertia00+ft._transform._rotation21*ft._invLocalInertia10+ft._transform._rotation22*ft._invLocalInertia20,St=ft._transform._rotation20*ft._invLocalInertia01+ft._transform._rotation21*ft._invLocalInertia11+ft._transform._rotation22*ft._invLocalInertia21,Bt=ft._transform._rotation20*ft._invLocalInertia02+ft._transform._rotation21*ft._invLocalInertia12+ft._transform._rotation22*ft._invLocalInertia22,ft._invInertia00=Zt,ft._invInertia01=wt,ft._invInertia02=It,ft._invInertia10=Vt,ft._invInertia11=Lt,ft._invInertia12=At,ft._invInertia20=kt,ft._invInertia21=St,ft._invInertia22=Bt,Pt=ft._invInertia00*ft._transform._rotation00+ft._invInertia01*ft._transform._rotation01+ft._invInertia02*ft._transform._rotation02,Ct=ft._invInertia00*ft._transform._rotation10+ft._invInertia01*ft._transform._rotation11+ft._invInertia02*ft._transform._rotation12,Tt=ft._invInertia00*ft._transform._rotation20+ft._invInertia01*ft._transform._rotation21+ft._invInertia02*ft._transform._rotation22,jt=ft._invInertia10*ft._transform._rotation00+ft._invInertia11*ft._transform._rotation01+ft._invInertia12*ft._transform._rotation02,Et=ft._invInertia10*ft._transform._rotation10+ft._invInertia11*ft._transform._rotation11+ft._invInertia12*ft._transform._rotation12,Rt=ft._invInertia10*ft._transform._rotation20+ft._invInertia11*ft._transform._rotation21+ft._invInertia12*ft._transform._rotation22,Dt=ft._invInertia20*ft._transform._rotation00+ft._invInertia21*ft._transform._rotation01+ft._invInertia22*ft._transform._rotation02,Ft=ft._invInertia20*ft._transform._rotation10+ft._invInertia21*ft._transform._rotation11+ft._invInertia22*ft._transform._rotation12,qt=ft._invInertia20*ft._transform._rotation20+ft._invInertia21*ft._transform._rotation21+ft._invInertia22*ft._transform._rotation22,ft._invInertia00=Pt,ft._invInertia01=Ct,ft._invInertia02=Tt,ft._invInertia10=jt,ft._invInertia11=Et,ft._invInertia12=Rt,ft._invInertia20=Dt,ft._invInertia21=Ft,ft._invInertia22=qt,ft._invInertia00*=ft._rotFactor.x,ft._invInertia01*=ft._rotFactor.x,ft._invInertia02*=ft._rotFactor.x,ft._invInertia10*=ft._rotFactor.y,ft._invInertia11*=ft._rotFactor.y,ft._invInertia12*=ft._rotFactor.y,ft._invInertia20*=ft._rotFactor.z,ft._invInertia21*=ft._rotFactor.z,ft._invInertia22*=ft._rotFactor.z}let y=this.posBoundarySelector,X=0;for(;y.indices[X]!=t;)++X;for(;X>0;){let t=y.indices[X];y.indices[X]=y.indices[X-1],y.indices[X-1]=t,--X}m=!0;break}}m||console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:502:","could not find solution. (NGS)")}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}},Ut.dynamics.constraint.solver.direct.MassMatrix=class{constructor(t){this._size=t,this.tmpMatrix=new Array(this._size),this._invMass=new Array(this._size),this._invMassWithoutCfm=new Array(this._size);let i=0,s=this._size;for(;i<s;){let t=i++;this.tmpMatrix[t]=new Array(this._size),this._invMass[t]=new Array(this._size),this._invMassWithoutCfm[t]=new Array(this._size);let s=0,n=this._size;for(;s<n;){let i=s++;this.tmpMatrix[t][i]=0,this._invMass[t][i]=0,this._invMassWithoutCfm[t][i]=0}}this._maxSubmatrixId=1<<this._size,this._cacheComputed=new Array(this._maxSubmatrixId),this._cachedSubmatrices=new Array(this._maxSubmatrixId);let n=0,a=this._maxSubmatrixId;for(;n<a;){let t,i=n++;t=(85&i)+(i>>1&85),t=(51&t)+(t>>2&51),t=(15&t)+(t>>4&15);let s=t,a=new Array(s),o=0;for(;o<s;){let t=o++;a[t]=new Array(s);let i=0;for(;i<s;)a[t][i++]=0}this._cacheComputed[i]=!1,this._cachedSubmatrices[i]=a}}computeSubmatrix(t,i,s){let n=0;for(;n<s;){let t=n++,a=i[t],o=0;for(;o<s;){let s=o++;this.tmpMatrix[t][s]=this._invMass[a][i[s]]}}let a,o,e,r,_,h=this.tmpMatrix,l=this._cachedSubmatrices[t];switch(s){case 4:a=h[0],o=l[0],_=1/a[0],o[0]=_,a[1]*=_,a[2]*=_,a[3]*=_,e=h[1],r=l[1],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],e=h[2],r=l[2],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],e=h[3],r=l[3],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],a=h[1],o=l[1],_=1/a[1],o[1]=_,o[0]*=_,a[2]*=_,a[3]*=_,e=h[0],r=l[0],r[0]-=o[0]*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],e=h[2],r=l[2],r[0]-=o[0]*e[1],r[1]=-_*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],e=h[3],r=l[3],r[0]-=o[0]*e[1],r[1]=-_*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],a=h[2],o=l[2],_=1/a[2],o[2]=_,o[0]*=_,o[1]*=_,a[3]*=_,e=h[0],r=l[0],r[0]-=o[0]*e[2],e[3]-=a[3]*e[2],e=h[1],r=l[1],r[0]-=o[0]*e[2],r[1]-=o[1]*e[2],e[3]-=a[3]*e[2],e=h[3],r=l[3],r[0]-=o[0]*e[2],r[1]-=o[1]*e[2],r[2]=-_*e[2],e[3]-=a[3]*e[2],a=h[3],o=l[3],_=1/a[3],o[3]=_,o[0]*=_,o[1]*=_,o[2]*=_,e=h[0],r=l[0],r[0]-=o[0]*e[3],e=h[1],r=l[1],r[0]-=o[0]*e[3],r[1]-=o[1]*e[3],e=h[2],r=l[2],r[0]-=o[0]*e[3],r[1]-=o[1]*e[3],r[2]-=o[2]*e[3],o=l[1],l[0][1]=o[0],o=l[2],l[0][2]=o[0],l[1][2]=o[1],o=l[3],l[0][3]=o[0],l[1][3]=o[1],l[2][3]=o[2];break;case 5:a=h[0],o=l[0],_=1/a[0],o[0]=_,a[1]*=_,a[2]*=_,a[3]*=_,a[4]*=_,e=h[1],r=l[1],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],e[4]-=a[4]*e[0],e=h[2],r=l[2],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],e[4]-=a[4]*e[0],e=h[3],r=l[3],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],e[4]-=a[4]*e[0],e=h[4],r=l[4],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],e[4]-=a[4]*e[0],a=h[1],o=l[1],_=1/a[1],o[1]=_,o[0]*=_,a[2]*=_,a[3]*=_,a[4]*=_,e=h[0],r=l[0],r[0]-=o[0]*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],e[4]-=a[4]*e[1],e=h[2],r=l[2],r[0]-=o[0]*e[1],r[1]=-_*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],e[4]-=a[4]*e[1],e=h[3],r=l[3],r[0]-=o[0]*e[1],r[1]=-_*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],e[4]-=a[4]*e[1],e=h[4],r=l[4],r[0]-=o[0]*e[1],r[1]=-_*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],e[4]-=a[4]*e[1],a=h[2],o=l[2],_=1/a[2],o[2]=_,o[0]*=_,o[1]*=_,a[3]*=_,a[4]*=_,e=h[0],r=l[0],r[0]-=o[0]*e[2],e[3]-=a[3]*e[2],e[4]-=a[4]*e[2],e=h[1],r=l[1],r[0]-=o[0]*e[2],r[1]-=o[1]*e[2],e[3]-=a[3]*e[2],e[4]-=a[4]*e[2],e=h[3],r=l[3],r[0]-=o[0]*e[2],r[1]-=o[1]*e[2],r[2]=-_*e[2],e[3]-=a[3]*e[2],e[4]-=a[4]*e[2],e=h[4],r=l[4],r[0]-=o[0]*e[2],r[1]-=o[1]*e[2],r[2]=-_*e[2],e[3]-=a[3]*e[2],e[4]-=a[4]*e[2],a=h[3],o=l[3],_=1/a[3],o[3]=_,o[0]*=_,o[1]*=_,o[2]*=_,a[4]*=_,e=h[0],r=l[0],r[0]-=o[0]*e[3],e[4]-=a[4]*e[3],e=h[1],r=l[1],r[0]-=o[0]*e[3],r[1]-=o[1]*e[3],e[4]-=a[4]*e[3],e=h[2],r=l[2],r[0]-=o[0]*e[3],r[1]-=o[1]*e[3],r[2]-=o[2]*e[3],e[4]-=a[4]*e[3],e=h[4],r=l[4],r[0]-=o[0]*e[3],r[1]-=o[1]*e[3],r[2]-=o[2]*e[3],r[3]=-_*e[3],e[4]-=a[4]*e[3],a=h[4],o=l[4],_=1/a[4],o[4]=_,o[0]*=_,o[1]*=_,o[2]*=_,o[3]*=_,e=h[0],r=l[0],r[0]-=o[0]*e[4],e=h[1],r=l[1],r[0]-=o[0]*e[4],r[1]-=o[1]*e[4],e=h[2],r=l[2],r[0]-=o[0]*e[4],r[1]-=o[1]*e[4],r[2]-=o[2]*e[4],e=h[3],r=l[3],r[0]-=o[0]*e[4],r[1]-=o[1]*e[4],r[2]-=o[2]*e[4],r[3]-=o[3]*e[4],o=l[1],l[0][1]=o[0],o=l[2],l[0][2]=o[0],l[1][2]=o[1],o=l[3],l[0][3]=o[0],l[1][3]=o[1],l[2][3]=o[2],o=l[4],l[0][4]=o[0],l[1][4]=o[1],l[2][4]=o[2],l[3][4]=o[3];break;case 6:a=h[0],o=l[0],_=1/a[0],o[0]=_,a[1]*=_,a[2]*=_,a[3]*=_,a[4]*=_,a[5]*=_,e=h[1],r=l[1],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],e[4]-=a[4]*e[0],e[5]-=a[5]*e[0],e=h[2],r=l[2],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],e[4]-=a[4]*e[0],e[5]-=a[5]*e[0],e=h[3],r=l[3],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],e[4]-=a[4]*e[0],e[5]-=a[5]*e[0],e=h[4],r=l[4],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],e[4]-=a[4]*e[0],e[5]-=a[5]*e[0],e=h[5],r=l[5],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],e[4]-=a[4]*e[0],e[5]-=a[5]*e[0],a=h[1],o=l[1],_=1/a[1],o[1]=_,o[0]*=_,a[2]*=_,a[3]*=_,a[4]*=_,a[5]*=_,e=h[0],r=l[0],r[0]-=o[0]*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],e[4]-=a[4]*e[1],e[5]-=a[5]*e[1],e=h[2],r=l[2],r[0]-=o[0]*e[1],r[1]=-_*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],e[4]-=a[4]*e[1],e[5]-=a[5]*e[1],e=h[3],r=l[3],r[0]-=o[0]*e[1],r[1]=-_*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],e[4]-=a[4]*e[1],e[5]-=a[5]*e[1],e=h[4],r=l[4],r[0]-=o[0]*e[1],r[1]=-_*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],e[4]-=a[4]*e[1],e[5]-=a[5]*e[1],e=h[5],r=l[5],r[0]-=o[0]*e[1],r[1]=-_*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],e[4]-=a[4]*e[1],e[5]-=a[5]*e[1],a=h[2],o=l[2],_=1/a[2],o[2]=_,o[0]*=_,o[1]*=_,a[3]*=_,a[4]*=_,a[5]*=_,e=h[0],r=l[0],r[0]-=o[0]*e[2],e[3]-=a[3]*e[2],e[4]-=a[4]*e[2],e[5]-=a[5]*e[2],e=h[1],r=l[1],r[0]-=o[0]*e[2],r[1]-=o[1]*e[2],e[3]-=a[3]*e[2],e[4]-=a[4]*e[2],e[5]-=a[5]*e[2],e=h[3],r=l[3],r[0]-=o[0]*e[2],r[1]-=o[1]*e[2],r[2]=-_*e[2],e[3]-=a[3]*e[2],e[4]-=a[4]*e[2],e[5]-=a[5]*e[2],e=h[4],r=l[4],r[0]-=o[0]*e[2],r[1]-=o[1]*e[2],r[2]=-_*e[2],e[3]-=a[3]*e[2],e[4]-=a[4]*e[2],e[5]-=a[5]*e[2],e=h[5],r=l[5],r[0]-=o[0]*e[2],r[1]-=o[1]*e[2],r[2]=-_*e[2],e[3]-=a[3]*e[2],e[4]-=a[4]*e[2],e[5]-=a[5]*e[2],a=h[3],o=l[3],_=1/a[3],o[3]=_,o[0]*=_,o[1]*=_,o[2]*=_,a[4]*=_,a[5]*=_,e=h[0],r=l[0],r[0]-=o[0]*e[3],e[4]-=a[4]*e[3],e[5]-=a[5]*e[3],e=h[1],r=l[1],r[0]-=o[0]*e[3],r[1]-=o[1]*e[3],e[4]-=a[4]*e[3],e[5]-=a[5]*e[3],e=h[2],r=l[2],r[0]-=o[0]*e[3],r[1]-=o[1]*e[3],r[2]-=o[2]*e[3],e[4]-=a[4]*e[3],e[5]-=a[5]*e[3],e=h[4],r=l[4],r[0]-=o[0]*e[3],r[1]-=o[1]*e[3],r[2]-=o[2]*e[3],r[3]=-_*e[3],e[4]-=a[4]*e[3],e[5]-=a[5]*e[3],e=h[5],r=l[5],r[0]-=o[0]*e[3],r[1]-=o[1]*e[3],r[2]-=o[2]*e[3],r[3]=-_*e[3],e[4]-=a[4]*e[3],e[5]-=a[5]*e[3],a=h[4],o=l[4],_=1/a[4],o[4]=_,o[0]*=_,o[1]*=_,o[2]*=_,o[3]*=_,a[5]*=_,e=h[0],r=l[0],r[0]-=o[0]*e[4],e[5]-=a[5]*e[4],e=h[1],r=l[1],r[0]-=o[0]*e[4],r[1]-=o[1]*e[4],e[5]-=a[5]*e[4],e=h[2],r=l[2],r[0]-=o[0]*e[4],r[1]-=o[1]*e[4],r[2]-=o[2]*e[4],e[5]-=a[5]*e[4],e=h[3],r=l[3],r[0]-=o[0]*e[4],r[1]-=o[1]*e[4],r[2]-=o[2]*e[4],r[3]-=o[3]*e[4],e[5]-=a[5]*e[4],e=h[5],r=l[5],r[0]-=o[0]*e[4],r[1]-=o[1]*e[4],r[2]-=o[2]*e[4],r[3]-=o[3]*e[4],r[4]=-_*e[4],e[5]-=a[5]*e[4],a=h[5],o=l[5],_=1/a[5],o[5]=_,o[0]*=_,o[1]*=_,o[2]*=_,o[3]*=_,o[4]*=_,e=h[0],r=l[0],r[0]-=o[0]*e[5],e=h[1],r=l[1],r[0]-=o[0]*e[5],r[1]-=o[1]*e[5],e=h[2],r=l[2],r[0]-=o[0]*e[5],r[1]-=o[1]*e[5],r[2]-=o[2]*e[5],e=h[3],r=l[3],r[0]-=o[0]*e[5],r[1]-=o[1]*e[5],r[2]-=o[2]*e[5],r[3]-=o[3]*e[5],e=h[4],r=l[4],r[0]-=o[0]*e[5],r[1]-=o[1]*e[5],r[2]-=o[2]*e[5],r[3]-=o[3]*e[5],r[4]-=o[4]*e[5],o=l[1],l[0][1]=o[0],o=l[2],l[0][2]=o[0],l[1][2]=o[1],o=l[3],l[0][3]=o[0],l[1][3]=o[1],l[2][3]=o[2],o=l[4],l[0][4]=o[0],l[1][4]=o[1],l[2][4]=o[2],l[3][4]=o[3],o=l[5],l[0][5]=o[0],l[1][5]=o[1],l[2][5]=o[2],l[3][5]=o[3],l[4][5]=o[4];break;default:let t=0;for(;t<s;){let i=t++;a=h[i],o=l[i];let n=1/a[i];o[i]=n;let _=0;for(;_<i;)o[_++]*=n;let c=i+1;for(;c<s;)a[c++]*=n;let m=0;for(;m<i;){let t=m++;e=h[t],r=l[t];let n=0,_=t+1;for(;n<_;){let t=n++;r[t]-=o[t]*e[i]}let c=i+1;for(;c<s;){let t=c++;e[t]-=a[t]*e[i]}}let b=i+1;for(;b<s;){let t=b++;e=h[t],r=l[t];let _=0;for(;_<i;){let t=_++;r[t]-=o[t]*e[i]}r[i]=-n*e[i];let c=i+1;for(;c<s;){let t=c++;e[t]-=a[t]*e[i]}}}let i=1;for(;i<s;){let t=i++;o=l[t];let s=0;for(;s<t;){let i=s++;l[i][t]=o[i]}}}}computeInvMass(t,i){let s,n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g,v=this._invMass,y=this._invMassWithoutCfm,X=t.numRows,z=t.b1,M=t.b2,Y=z._invMass,Z=M._invMass;s=z._invInertia00,n=z._invInertia01,a=z._invInertia02,o=z._invInertia10,e=z._invInertia11,r=z._invInertia12,_=z._invInertia20,h=z._invInertia21,l=z._invInertia22,c=M._invInertia00,m=M._invInertia01,b=M._invInertia02,p=M._invInertia10,d=M._invInertia11,u=M._invInertia12,f=M._invInertia20,x=M._invInertia21,g=M._invInertia22;let w=0;for(;w<X;){let v=w++,y=t.rows[v].jacobian,X=i[v];if(y.updateSparsity(),0!=(1&y.flag)?(X.invMLin1X=y.lin1X*Y,X.invMLin1Y=y.lin1Y*Y,X.invMLin1Z=y.lin1Z*Y,X.invMLin2X=y.lin2X*Z,X.invMLin2Y=y.lin2Y*Z,X.invMLin2Z=y.lin2Z*Z):(X.invMLin1X=0,X.invMLin1Y=0,X.invMLin1Z=0,X.invMLin2X=0,X.invMLin2Y=0,X.invMLin2Z=0),0!=(2&y.flag)){let t,i,v,z,M,Y;t=s*y.ang1X+n*y.ang1Y+a*y.ang1Z,i=o*y.ang1X+e*y.ang1Y+r*y.ang1Z,v=_*y.ang1X+h*y.ang1Y+l*y.ang1Z,X.invMAng1X=t,X.invMAng1Y=i,X.invMAng1Z=v,z=c*y.ang2X+m*y.ang2Y+b*y.ang2Z,M=p*y.ang2X+d*y.ang2Y+u*y.ang2Z,Y=f*y.ang2X+x*y.ang2Y+g*y.ang2Z,X.invMAng2X=z,X.invMAng2Y=M,X.invMAng2Z=Y}else X.invMAng1X=0,X.invMAng1Y=0,X.invMAng1Z=0,X.invMAng2X=0,X.invMAng2Y=0,X.invMAng2Z=0}let I=0;for(;I<X;){let s=I++,n=t.rows[s].jacobian,a=s;for(;a<X;){let o=a++,e=i[o],r=n.lin1X*e.invMLin1X+n.lin1Y*e.invMLin1Y+n.lin1Z*e.invMLin1Z+(n.ang1X*e.invMAng1X+n.ang1Y*e.invMAng1Y+n.ang1Z*e.invMAng1Z)+(n.lin2X*e.invMLin2X+n.lin2Y*e.invMLin2Y+n.lin2Z*e.invMLin2Z)+(n.ang2X*e.invMAng2X+n.ang2Y*e.invMAng2Y+n.ang2Z*e.invMAng2Z);s==o?(v[s][o]=r+t.rows[s].cfm,y[s][o]=r,e.mass=r+t.rows[s].cfm,e.massWithoutCfm=r,0!=e.mass&&(e.mass=1/e.mass),0!=e.massWithoutCfm&&(e.massWithoutCfm=1/e.massWithoutCfm)):(v[s][o]=r,v[o][s]=r,y[s][o]=r,y[o][s]=r)}}let V=0,L=this._maxSubmatrixId;for(;V<L;)this._cacheComputed[V++]=!1}},Ut.dynamics.constraint.solver.pgs||(Ut.dynamics.constraint.solver.pgs={}),Ut.dynamics.constraint.solver.pgs.PgsContactConstraintSolver=class extends Ut.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.constraint=t,this.info=new Ut.dynamics.constraint.info.contact.ContactSolverInfo,this.massData=new Array(Ut.common.Setting.maxManifoldPoints);let i=0,s=this.massData.length;for(;i<s;)this.massData[i++]=new Ut.dynamics.constraint.solver.common.ContactSolverMassDataRow}preSolveVelocity(t){this.constraint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i,s,n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g=this._b1._invMass,v=this._b2._invMass;i=this._b1._invInertia00,s=this._b1._invInertia01,n=this._b1._invInertia02,a=this._b1._invInertia10,o=this._b1._invInertia11,e=this._b1._invInertia12,r=this._b1._invInertia20,_=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,b=this._b2._invInertia10,p=this._b2._invInertia11,d=this._b2._invInertia12,u=this._b2._invInertia20,f=this._b2._invInertia21,x=this._b2._invInertia22;let y=0,X=this.info.numRows;for(;y<X;){let t,X,z,M,Y,Z,w=y++,I=this.info.rows[w],V=this.massData[w],L=I.jacobianN;V.invMLinN1X=L.lin1X*g,V.invMLinN1Y=L.lin1Y*g,V.invMLinN1Z=L.lin1Z*g,V.invMLinN2X=L.lin2X*v,V.invMLinN2Y=L.lin2Y*v,V.invMLinN2Z=L.lin2Z*v,t=i*L.ang1X+s*L.ang1Y+n*L.ang1Z,X=a*L.ang1X+o*L.ang1Y+e*L.ang1Z,z=r*L.ang1X+_*L.ang1Y+h*L.ang1Z,V.invMAngN1X=t,V.invMAngN1Y=X,V.invMAngN1Z=z,M=l*L.ang2X+c*L.ang2Y+m*L.ang2Z,Y=b*L.ang2X+p*L.ang2Y+d*L.ang2Z,Z=u*L.ang2X+f*L.ang2Y+x*L.ang2Z,V.invMAngN2X=M,V.invMAngN2Y=Y,V.invMAngN2Z=Z,V.massN=g+v+(V.invMAngN1X*L.ang1X+V.invMAngN1Y*L.ang1Y+V.invMAngN1Z*L.ang1Z)+(V.invMAngN2X*L.ang2X+V.invMAngN2Y*L.ang2Y+V.invMAngN2Z*L.ang2Z),0!=V.massN&&(V.massN=1/V.massN);let A,k,S,B,P,C,T,j,E,R,D,F,q=I.jacobianT,N=I.jacobianB;V.invMLinT1X=q.lin1X*g,V.invMLinT1Y=q.lin1Y*g,V.invMLinT1Z=q.lin1Z*g,V.invMLinT2X=q.lin2X*v,V.invMLinT2Y=q.lin2Y*v,V.invMLinT2Z=q.lin2Z*v,V.invMLinB1X=N.lin1X*g,V.invMLinB1Y=N.lin1Y*g,V.invMLinB1Z=N.lin1Z*g,V.invMLinB2X=N.lin2X*v,V.invMLinB2Y=N.lin2Y*v,V.invMLinB2Z=N.lin2Z*v,A=i*q.ang1X+s*q.ang1Y+n*q.ang1Z,k=a*q.ang1X+o*q.ang1Y+e*q.ang1Z,S=r*q.ang1X+_*q.ang1Y+h*q.ang1Z,V.invMAngT1X=A,V.invMAngT1Y=k,V.invMAngT1Z=S,B=l*q.ang2X+c*q.ang2Y+m*q.ang2Z,P=b*q.ang2X+p*q.ang2Y+d*q.ang2Z,C=u*q.ang2X+f*q.ang2Y+x*q.ang2Z,V.invMAngT2X=B,V.invMAngT2Y=P,V.invMAngT2Z=C,T=i*N.ang1X+s*N.ang1Y+n*N.ang1Z,j=a*N.ang1X+o*N.ang1Y+e*N.ang1Z,E=r*N.ang1X+_*N.ang1Y+h*N.ang1Z,V.invMAngB1X=T,V.invMAngB1Y=j,V.invMAngB1Z=E,R=l*N.ang2X+c*N.ang2Y+m*N.ang2Z,D=b*N.ang2X+p*N.ang2Y+d*N.ang2Z,F=u*N.ang2X+f*N.ang2Y+x*N.ang2Z,V.invMAngB2X=R,V.invMAngB2Y=D,V.invMAngB2Z=F;let H=g+v+(V.invMAngT1X*q.ang1X+V.invMAngT1Y*q.ang1Y+V.invMAngT1Z*q.ang1Z)+(V.invMAngT2X*q.ang2X+V.invMAngT2Y*q.ang2Y+V.invMAngT2Z*q.ang2Z),O=V.invMAngT1X*N.ang1X+V.invMAngT1Y*N.ang1Y+V.invMAngT1Z*N.ang1Z+(V.invMAngT2X*N.ang2X+V.invMAngT2Y*N.ang2Y+V.invMAngT2Z*N.ang2Z),W=g+v+(V.invMAngB1X*N.ang1X+V.invMAngB1Y*N.ang1Y+V.invMAngB1Z*N.ang1Z)+(V.invMAngB2X*N.ang2X+V.invMAngB2Y*N.ang2Y+V.invMAngB2Z*N.ang2Z),G=H*W-O*O;0!=G&&(G=1/G),V.massTB00=W*G,V.massTB01=-O*G,V.massTB10=-O*G,V.massTB11=H*G}}warmStart(t){let i,s,n,a,o,e,r,_,h,l,c,m;i=this._b1._velX,s=this._b1._velY,n=this._b1._velZ,a=this._b2._velX,o=this._b2._velY,e=this._b2._velZ,r=this._b1._angVelX,_=this._b1._angVelY,h=this._b1._angVelZ,l=this._b2._angVelX,c=this._b2._angVelY,m=this._b2._angVelZ;let b=0,p=this.info.numRows;for(;b<p;){let p=b++,d=this.info.rows[p],u=d.impulse,f=this.massData[p],x=d.jacobianT,g=d.jacobianB,v=u.impulseN,y=u.impulseLX*x.lin1X+u.impulseLY*x.lin1Y+u.impulseLZ*x.lin1Z,X=u.impulseLX*g.lin1X+u.impulseLY*g.lin1Y+u.impulseLZ*g.lin1Z;u.impulseT=y,u.impulseB=X,u.impulseN*=t.dtRatio,u.impulseT*=t.dtRatio,u.impulseB*=t.dtRatio,i+=f.invMLinN1X*v,s+=f.invMLinN1Y*v,n+=f.invMLinN1Z*v,i+=f.invMLinT1X*y,s+=f.invMLinT1Y*y,n+=f.invMLinT1Z*y,i+=f.invMLinB1X*X,s+=f.invMLinB1Y*X,n+=f.invMLinB1Z*X,a+=f.invMLinN2X*-v,o+=f.invMLinN2Y*-v,e+=f.invMLinN2Z*-v,a+=f.invMLinT2X*-y,o+=f.invMLinT2Y*-y,e+=f.invMLinT2Z*-y,a+=f.invMLinB2X*-X,o+=f.invMLinB2Y*-X,e+=f.invMLinB2Z*-X,r+=f.invMAngN1X*v,_+=f.invMAngN1Y*v,h+=f.invMAngN1Z*v,r+=f.invMAngT1X*y,_+=f.invMAngT1Y*y,h+=f.invMAngT1Z*y,r+=f.invMAngB1X*X,_+=f.invMAngB1Y*X,h+=f.invMAngB1Z*X,l+=f.invMAngN2X*-v,c+=f.invMAngN2Y*-v,m+=f.invMAngN2Z*-v,l+=f.invMAngT2X*-y,c+=f.invMAngT2Y*-y,m+=f.invMAngT2Z*-y,l+=f.invMAngB2X*-X,c+=f.invMAngB2Y*-X,m+=f.invMAngB2Z*-X}this._b1._velX=i,this._b1._velY=s,this._b1._velZ=n,this._b2._velX=a,this._b2._velY=o,this._b2._velZ=e,this._b1._angVelX=r,this._b1._angVelY=_,this._b1._angVelZ=h,this._b2._angVelX=l,this._b2._angVelY=c,this._b2._angVelZ=m}solveVelocity(){let t,i,s,n,a,o,e,r,_,h,l,c;t=this._b1._velX,i=this._b1._velY,s=this._b1._velZ,n=this._b2._velX,a=this._b2._velY,o=this._b2._velZ,e=this._b1._angVelX,r=this._b1._angVelY,_=this._b1._angVelZ,h=this._b2._angVelX,l=this._b2._angVelY,c=this._b2._angVelZ;let m=0,b=this.info.numRows;for(;m<b;){let b=m++,p=this.info.rows[b],d=this.massData[b],u=p.impulse,f=0,x=p.jacobianT;f+=t*x.lin1X+i*x.lin1Y+s*x.lin1Z,f-=n*x.lin2X+a*x.lin2Y+o*x.lin2Z,f+=e*x.ang1X+r*x.ang1Y+_*x.ang1Z,f-=h*x.ang2X+l*x.ang2Y+c*x.ang2Z;let g=0;x=p.jacobianB,g+=t*x.lin1X+i*x.lin1Y+s*x.lin1Z,g-=n*x.lin2X+a*x.lin2Y+o*x.lin2Z,g+=e*x.ang1X+r*x.ang1Y+_*x.ang1Z,g-=h*x.ang2X+l*x.ang2Y+c*x.ang2Z;let v=-(f*d.massTB00+g*d.massTB01),y=-(f*d.massTB10+g*d.massTB11),X=u.impulseT,z=u.impulseB;u.impulseT+=v,u.impulseB+=y;let M=p.friction*u.impulseN;if(0==M)u.impulseT=0,u.impulseB=0;else{let t=u.impulseT*u.impulseT+u.impulseB*u.impulseB;if(t>M*M){let i=M/Math.sqrt(t);u.impulseT*=i,u.impulseB*=i}}v=u.impulseT-X,y=u.impulseB-z,t+=d.invMLinT1X*v,i+=d.invMLinT1Y*v,s+=d.invMLinT1Z*v,t+=d.invMLinB1X*y,i+=d.invMLinB1Y*y,s+=d.invMLinB1Z*y,n+=d.invMLinT2X*-v,a+=d.invMLinT2Y*-v,o+=d.invMLinT2Z*-v,n+=d.invMLinB2X*-y,a+=d.invMLinB2Y*-y,o+=d.invMLinB2Z*-y,e+=d.invMAngT1X*v,r+=d.invMAngT1Y*v,_+=d.invMAngT1Z*v,e+=d.invMAngB1X*y,r+=d.invMAngB1Y*y,_+=d.invMAngB1Z*y,h+=d.invMAngT2X*-v,l+=d.invMAngT2Y*-v,c+=d.invMAngT2Z*-v,h+=d.invMAngB2X*-y,l+=d.invMAngB2Y*-y,c+=d.invMAngB2Z*-y}let p=0,d=this.info.numRows;for(;p<d;){let m=p++,b=this.info.rows[m],d=this.massData[m],u=b.impulse,f=0,x=b.jacobianN;f+=t*x.lin1X+i*x.lin1Y+s*x.lin1Z,f-=n*x.lin2X+a*x.lin2Y+o*x.lin2Z,f+=e*x.ang1X+r*x.ang1Y+_*x.ang1Z,f-=h*x.ang2X+l*x.ang2Y+c*x.ang2Z;let g=(b.rhs-f)*d.massN,v=u.impulseN;u.impulseN+=g,u.impulseN<0&&(u.impulseN=0),g=u.impulseN-v,t+=d.invMLinN1X*g,i+=d.invMLinN1Y*g,s+=d.invMLinN1Z*g,n+=d.invMLinN2X*-g,a+=d.invMLinN2Y*-g,o+=d.invMLinN2Z*-g,e+=d.invMAngN1X*g,r+=d.invMAngN1Y*g,_+=d.invMAngN1Z*g,h+=d.invMAngN2X*-g,l+=d.invMAngN2Y*-g,c+=d.invMAngN2Z*-g}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=s,this._b2._velX=n,this._b2._velY=a,this._b2._velZ=o,this._b1._angVelX=e,this._b1._angVelY=r,this._b1._angVelZ=_,this._b2._angVelX=h,this._b2._angVelY=l,this._b2._angVelZ=c}preSolvePosition(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);let i,s,n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g=this._b1._invMass,v=this._b2._invMass;i=this._b1._invInertia00,s=this._b1._invInertia01,n=this._b1._invInertia02,a=this._b1._invInertia10,o=this._b1._invInertia11,e=this._b1._invInertia12,r=this._b1._invInertia20,_=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,b=this._b2._invInertia10,p=this._b2._invInertia11,d=this._b2._invInertia12,u=this._b2._invInertia20,f=this._b2._invInertia21,x=this._b2._invInertia22;let y=0,X=this.info.numRows;for(;y<X;){let t,X,z,M,Y,Z,w=y++,I=this.massData[w],V=this.info.rows[w].jacobianN;I.invMLinN1X=V.lin1X*g,I.invMLinN1Y=V.lin1Y*g,I.invMLinN1Z=V.lin1Z*g,I.invMLinN2X=V.lin2X*v,I.invMLinN2Y=V.lin2Y*v,I.invMLinN2Z=V.lin2Z*v,t=i*V.ang1X+s*V.ang1Y+n*V.ang1Z,X=a*V.ang1X+o*V.ang1Y+e*V.ang1Z,z=r*V.ang1X+_*V.ang1Y+h*V.ang1Z,I.invMAngN1X=t,I.invMAngN1Y=X,I.invMAngN1Z=z,M=l*V.ang2X+c*V.ang2Y+m*V.ang2Z,Y=b*V.ang2X+p*V.ang2Y+d*V.ang2Z,Z=u*V.ang2X+f*V.ang2Y+x*V.ang2Z,I.invMAngN2X=M,I.invMAngN2Y=Y,I.invMAngN2Z=Z,I.massN=g+v+(I.invMAngN1X*V.ang1X+I.invMAngN1Y*V.ang1Y+I.invMAngN1Z*V.ang1Z)+(I.invMAngN2X*V.ang2X+I.invMAngN2Y*V.ang2Y+I.invMAngN2Z*V.ang2Z),0!=I.massN&&(I.massN=1/I.massN)}let z=0,M=this.info.numRows;for(;z<M;)this.info.rows[z++].impulse.impulseP=0}solvePositionSplitImpulse(){let t,i,s,n,a,o,e,r,_,h,l,c;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,s=this._b1._pseudoVelZ,n=this._b2._pseudoVelX,a=this._b2._pseudoVelY,o=this._b2._pseudoVelZ,e=this._b1._angPseudoVelX,r=this._b1._angPseudoVelY,_=this._b1._angPseudoVelZ,h=this._b2._angPseudoVelX,l=this._b2._angPseudoVelY,c=this._b2._angPseudoVelZ;let m=0,b=this.info.numRows;for(;m<b;){let b=m++,p=this.info.rows[b],d=this.massData[b],u=p.impulse,f=p.jacobianN,x=0;x+=t*f.lin1X+i*f.lin1Y+s*f.lin1Z,x-=n*f.lin2X+a*f.lin2Y+o*f.lin2Z,x+=e*f.ang1X+r*f.ang1Y+_*f.ang1Z,x-=h*f.ang2X+l*f.ang2Y+c*f.ang2Z;let g=(p.rhs-x)*d.massN*Ut.common.Setting.positionSplitImpulseBaumgarte,v=u.impulseP;u.impulseP+=g,u.impulseP<0&&(u.impulseP=0),g=u.impulseP-v,t+=d.invMLinN1X*g,i+=d.invMLinN1Y*g,s+=d.invMLinN1Z*g,n+=d.invMLinN2X*-g,a+=d.invMLinN2Y*-g,o+=d.invMLinN2Z*-g,e+=d.invMAngN1X*g,r+=d.invMAngN1Y*g,_+=d.invMAngN1Z*g,h+=d.invMAngN2X*-g,l+=d.invMAngN2Y*-g,c+=d.invMAngN2Z*-g}this._b1._pseudoVelX=t,this._b1._pseudoVelY=i,this._b1._pseudoVelZ=s,this._b2._pseudoVelX=n,this._b2._pseudoVelY=a,this._b2._pseudoVelZ=o,this._b1._angPseudoVelX=e,this._b1._angPseudoVelY=r,this._b1._angPseudoVelZ=_,this._b2._angPseudoVelX=h,this._b2._angPseudoVelY=l,this._b2._angPseudoVelZ=c}solvePositionNgs(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);let i,s,n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g=this._b1._invMass,v=this._b2._invMass;i=this._b1._invInertia00,s=this._b1._invInertia01,n=this._b1._invInertia02,a=this._b1._invInertia10,o=this._b1._invInertia11,e=this._b1._invInertia12,r=this._b1._invInertia20,_=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,b=this._b2._invInertia10,p=this._b2._invInertia11,d=this._b2._invInertia12,u=this._b2._invInertia20,f=this._b2._invInertia21,x=this._b2._invInertia22;let y,X,z,M,Y,Z,w,I,V,L,A,k,S=0,B=this.info.numRows;for(;S<B;){let t,y,X,z,M,Y,Z=S++,w=this.massData[Z],I=this.info.rows[Z].jacobianN;w.invMLinN1X=I.lin1X*g,w.invMLinN1Y=I.lin1Y*g,w.invMLinN1Z=I.lin1Z*g,w.invMLinN2X=I.lin2X*v,w.invMLinN2Y=I.lin2Y*v,w.invMLinN2Z=I.lin2Z*v,t=i*I.ang1X+s*I.ang1Y+n*I.ang1Z,y=a*I.ang1X+o*I.ang1Y+e*I.ang1Z,X=r*I.ang1X+_*I.ang1Y+h*I.ang1Z,w.invMAngN1X=t,w.invMAngN1Y=y,w.invMAngN1Z=X,z=l*I.ang2X+c*I.ang2Y+m*I.ang2Z,M=b*I.ang2X+p*I.ang2Y+d*I.ang2Z,Y=u*I.ang2X+f*I.ang2Y+x*I.ang2Z,w.invMAngN2X=z,w.invMAngN2Y=M,w.invMAngN2Z=Y,w.massN=g+v+(w.invMAngN1X*I.ang1X+w.invMAngN1Y*I.ang1Y+w.invMAngN1Z*I.ang1Z)+(w.invMAngN2X*I.ang2X+w.invMAngN2Y*I.ang2Y+w.invMAngN2Z*I.ang2Z),0!=w.massN&&(w.massN=1/w.massN)}y=0,X=0,z=0,M=0,Y=0,Z=0,w=0,I=0,V=0,L=0,A=0,k=0;let P=0,C=this.info.numRows;for(;P<C;){let t=P++,i=this.info.rows[t],s=this.massData[t],n=i.impulse,a=i.jacobianN,o=0;o+=y*a.lin1X+X*a.lin1Y+z*a.lin1Z,o-=M*a.lin2X+Y*a.lin2Y+Z*a.lin2Z,o+=w*a.ang1X+I*a.ang1Y+V*a.ang1Z,o-=L*a.ang2X+A*a.ang2Y+k*a.ang2Z;let e=(i.rhs-o)*s.massN*Ut.common.Setting.positionNgsBaumgarte,r=n.impulseP;n.impulseP+=e,n.impulseP<0&&(n.impulseP=0),e=n.impulseP-r,y+=s.invMLinN1X*e,X+=s.invMLinN1Y*e,z+=s.invMLinN1Z*e,M+=s.invMLinN2X*-e,Y+=s.invMLinN2Y*-e,Z+=s.invMLinN2Z*-e,w+=s.invMAngN1X*e,I+=s.invMAngN1Y*e,V+=s.invMAngN1Z*e,L+=s.invMAngN2X*-e,A+=s.invMAngN2Y*-e,k+=s.invMAngN2Z*-e}let T=this._b1;T._transform._positionX+=y,T._transform._positionY+=X,T._transform._positionZ+=z;let j=this._b2;j._transform._positionX+=M,j._transform._positionY+=Y,j._transform._positionZ+=Z;let E,R,D,F,q,N,H,O,W,G,U,J,$,K=this._b1,Q=Math.sqrt(w*w+I*I+V*V),tt=.5*Q;if(tt<.5){let t=tt*tt;E=.5*(1-.16666666666666666*t+t*t*.008333333333333333),R=1-.5*t+t*t*.041666666666666664}else E=Math.sin(tt)/Q,R=Math.cos(tt);D=w*E,F=I*E,q=V*E,N=D,H=F,O=q,W=R;let it,st=K._transform._rotation00,nt=K._transform._rotation11,at=K._transform._rotation22,ot=st+nt+at;ot>0?(it=Math.sqrt(ot+1),$=.5*it,it=.5/it,G=(K._transform._rotation21-K._transform._rotation12)*it,U=(K._transform._rotation02-K._transform._rotation20)*it,J=(K._transform._rotation10-K._transform._rotation01)*it):st>nt?st>at?(it=Math.sqrt(st-nt-at+1),G=.5*it,it=.5/it,U=(K._transform._rotation01+K._transform._rotation10)*it,J=(K._transform._rotation02+K._transform._rotation20)*it,$=(K._transform._rotation21-K._transform._rotation12)*it):(it=Math.sqrt(at-st-nt+1),J=.5*it,it=.5/it,G=(K._transform._rotation02+K._transform._rotation20)*it,U=(K._transform._rotation12+K._transform._rotation21)*it,$=(K._transform._rotation10-K._transform._rotation01)*it):nt>at?(it=Math.sqrt(nt-at-st+1),U=.5*it,it=.5/it,G=(K._transform._rotation01+K._transform._rotation10)*it,J=(K._transform._rotation12+K._transform._rotation21)*it,$=(K._transform._rotation02-K._transform._rotation20)*it):(it=Math.sqrt(at-st-nt+1),J=.5*it,it=.5/it,G=(K._transform._rotation02+K._transform._rotation20)*it,U=(K._transform._rotation12+K._transform._rotation21)*it,$=(K._transform._rotation10-K._transform._rotation01)*it),G=W*G+N*$+H*J-O*U,U=W*U-N*J+H*$+O*G,J=W*J+N*U-H*G+O*$,$=W*$-N*G-H*U-O*J;let et=G*G+U*U+J*J+$*$;et>1e-32&&(et=1/Math.sqrt(et)),G*=et,U*=et,J*=et,$*=et;let rt,_t,ht,lt,ct,mt,bt,pt,dt,ut,ft,xt,gt,vt,yt,Xt,zt,Mt,Yt=2*G,Zt=2*U,wt=2*J,It=G*Yt,Vt=U*Zt,Lt=J*wt,At=G*Zt,kt=U*wt,St=G*wt,Bt=$*Yt,Pt=$*Zt,Ct=$*wt;K._transform._rotation00=1-Vt-Lt,K._transform._rotation01=At-Ct,K._transform._rotation02=St+Pt,K._transform._rotation10=At+Ct,K._transform._rotation11=1-It-Lt,K._transform._rotation12=kt-Bt,K._transform._rotation20=St-Pt,K._transform._rotation21=kt+Bt,K._transform._rotation22=1-It-Vt,rt=K._transform._rotation00*K._invLocalInertia00+K._transform._rotation01*K._invLocalInertia10+K._transform._rotation02*K._invLocalInertia20,_t=K._transform._rotation00*K._invLocalInertia01+K._transform._rotation01*K._invLocalInertia11+K._transform._rotation02*K._invLocalInertia21,ht=K._transform._rotation00*K._invLocalInertia02+K._transform._rotation01*K._invLocalInertia12+K._transform._rotation02*K._invLocalInertia22,lt=K._transform._rotation10*K._invLocalInertia00+K._transform._rotation11*K._invLocalInertia10+K._transform._rotation12*K._invLocalInertia20,ct=K._transform._rotation10*K._invLocalInertia01+K._transform._rotation11*K._invLocalInertia11+K._transform._rotation12*K._invLocalInertia21,mt=K._transform._rotation10*K._invLocalInertia02+K._transform._rotation11*K._invLocalInertia12+K._transform._rotation12*K._invLocalInertia22,bt=K._transform._rotation20*K._invLocalInertia00+K._transform._rotation21*K._invLocalInertia10+K._transform._rotation22*K._invLocalInertia20,pt=K._transform._rotation20*K._invLocalInertia01+K._transform._rotation21*K._invLocalInertia11+K._transform._rotation22*K._invLocalInertia21,dt=K._transform._rotation20*K._invLocalInertia02+K._transform._rotation21*K._invLocalInertia12+K._transform._rotation22*K._invLocalInertia22,K._invInertia00=rt,K._invInertia01=_t,K._invInertia02=ht,K._invInertia10=lt,K._invInertia11=ct,K._invInertia12=mt,K._invInertia20=bt,K._invInertia21=pt,K._invInertia22=dt,ut=K._invInertia00*K._transform._rotation00+K._invInertia01*K._transform._rotation01+K._invInertia02*K._transform._rotation02,ft=K._invInertia00*K._transform._rotation10+K._invInertia01*K._transform._rotation11+K._invInertia02*K._transform._rotation12,xt=K._invInertia00*K._transform._rotation20+K._invInertia01*K._transform._rotation21+K._invInertia02*K._transform._rotation22,gt=K._invInertia10*K._transform._rotation00+K._invInertia11*K._transform._rotation01+K._invInertia12*K._transform._rotation02,vt=K._invInertia10*K._transform._rotation10+K._invInertia11*K._transform._rotation11+K._invInertia12*K._transform._rotation12,yt=K._invInertia10*K._transform._rotation20+K._invInertia11*K._transform._rotation21+K._invInertia12*K._transform._rotation22,Xt=K._invInertia20*K._transform._rotation00+K._invInertia21*K._transform._rotation01+K._invInertia22*K._transform._rotation02,zt=K._invInertia20*K._transform._rotation10+K._invInertia21*K._transform._rotation11+K._invInertia22*K._transform._rotation12,Mt=K._invInertia20*K._transform._rotation20+K._invInertia21*K._transform._rotation21+K._invInertia22*K._transform._rotation22,K._invInertia00=ut,K._invInertia01=ft,K._invInertia02=xt,K._invInertia10=gt,K._invInertia11=vt,K._invInertia12=yt,K._invInertia20=Xt,K._invInertia21=zt,K._invInertia22=Mt,K._invInertia00*=K._rotFactor.x,K._invInertia01*=K._rotFactor.x,K._invInertia02*=K._rotFactor.x,K._invInertia10*=K._rotFactor.y,K._invInertia11*=K._rotFactor.y,K._invInertia12*=K._rotFactor.y,K._invInertia20*=K._rotFactor.z,K._invInertia21*=K._rotFactor.z,K._invInertia22*=K._rotFactor.z;let Tt,jt,Et,Rt,Dt,Ft,qt,Nt,Ht,Ot,Wt,Gt,Jt,$t=this._b2,Kt=Math.sqrt(L*L+A*A+k*k),Qt=.5*Kt;if(Qt<.5){let t=Qt*Qt;Tt=.5*(1-.16666666666666666*t+t*t*.008333333333333333),jt=1-.5*t+t*t*.041666666666666664}else Tt=Math.sin(Qt)/Kt,jt=Math.cos(Qt);Et=L*Tt,Rt=A*Tt,Dt=k*Tt,Ft=Et,qt=Rt,Nt=Dt,Ht=jt;let ti,ii=$t._transform._rotation00,si=$t._transform._rotation11,ni=$t._transform._rotation22,ai=ii+si+ni;ai>0?(ti=Math.sqrt(ai+1),Jt=.5*ti,ti=.5/ti,Ot=($t._transform._rotation21-$t._transform._rotation12)*ti,Wt=($t._transform._rotation02-$t._transform._rotation20)*ti,Gt=($t._transform._rotation10-$t._transform._rotation01)*ti):ii>si?ii>ni?(ti=Math.sqrt(ii-si-ni+1),Ot=.5*ti,ti=.5/ti,Wt=($t._transform._rotation01+$t._transform._rotation10)*ti,Gt=($t._transform._rotation02+$t._transform._rotation20)*ti,Jt=($t._transform._rotation21-$t._transform._rotation12)*ti):(ti=Math.sqrt(ni-ii-si+1),Gt=.5*ti,ti=.5/ti,Ot=($t._transform._rotation02+$t._transform._rotation20)*ti,Wt=($t._transform._rotation12+$t._transform._rotation21)*ti,Jt=($t._transform._rotation10-$t._transform._rotation01)*ti):si>ni?(ti=Math.sqrt(si-ni-ii+1),Wt=.5*ti,ti=.5/ti,Ot=($t._transform._rotation01+$t._transform._rotation10)*ti,Gt=($t._transform._rotation12+$t._transform._rotation21)*ti,Jt=($t._transform._rotation02-$t._transform._rotation20)*ti):(ti=Math.sqrt(ni-ii-si+1),Gt=.5*ti,ti=.5/ti,Ot=($t._transform._rotation02+$t._transform._rotation20)*ti,Wt=($t._transform._rotation12+$t._transform._rotation21)*ti,Jt=($t._transform._rotation10-$t._transform._rotation01)*ti),Ot=Ht*Ot+Ft*Jt+qt*Gt-Nt*Wt,Wt=Ht*Wt-Ft*Gt+qt*Jt+Nt*Ot,Gt=Ht*Gt+Ft*Wt-qt*Ot+Nt*Jt,Jt=Ht*Jt-Ft*Ot-qt*Wt-Nt*Gt;let oi=Ot*Ot+Wt*Wt+Gt*Gt+Jt*Jt;oi>1e-32&&(oi=1/Math.sqrt(oi)),Ot*=oi,Wt*=oi,Gt*=oi,Jt*=oi;let ei,ri,_i,hi,li,ci,mi,bi,pi,di,ui,fi,xi,gi,vi,yi,Xi,zi,Mi=2*Ot,Yi=2*Wt,Zi=2*Gt,wi=Ot*Mi,Ii=Wt*Yi,Vi=Gt*Zi,Li=Ot*Yi,Ai=Wt*Zi,ki=Ot*Zi,Si=Jt*Mi,Bi=Jt*Yi,Pi=Jt*Zi;$t._transform._rotation00=1-Ii-Vi,$t._transform._rotation01=Li-Pi,$t._transform._rotation02=ki+Bi,$t._transform._rotation10=Li+Pi,$t._transform._rotation11=1-wi-Vi,$t._transform._rotation12=Ai-Si,$t._transform._rotation20=ki-Bi,$t._transform._rotation21=Ai+Si,$t._transform._rotation22=1-wi-Ii,ei=$t._transform._rotation00*$t._invLocalInertia00+$t._transform._rotation01*$t._invLocalInertia10+$t._transform._rotation02*$t._invLocalInertia20,ri=$t._transform._rotation00*$t._invLocalInertia01+$t._transform._rotation01*$t._invLocalInertia11+$t._transform._rotation02*$t._invLocalInertia21,_i=$t._transform._rotation00*$t._invLocalInertia02+$t._transform._rotation01*$t._invLocalInertia12+$t._transform._rotation02*$t._invLocalInertia22,hi=$t._transform._rotation10*$t._invLocalInertia00+$t._transform._rotation11*$t._invLocalInertia10+$t._transform._rotation12*$t._invLocalInertia20,li=$t._transform._rotation10*$t._invLocalInertia01+$t._transform._rotation11*$t._invLocalInertia11+$t._transform._rotation12*$t._invLocalInertia21,ci=$t._transform._rotation10*$t._invLocalInertia02+$t._transform._rotation11*$t._invLocalInertia12+$t._transform._rotation12*$t._invLocalInertia22,mi=$t._transform._rotation20*$t._invLocalInertia00+$t._transform._rotation21*$t._invLocalInertia10+$t._transform._rotation22*$t._invLocalInertia20,bi=$t._transform._rotation20*$t._invLocalInertia01+$t._transform._rotation21*$t._invLocalInertia11+$t._transform._rotation22*$t._invLocalInertia21,pi=$t._transform._rotation20*$t._invLocalInertia02+$t._transform._rotation21*$t._invLocalInertia12+$t._transform._rotation22*$t._invLocalInertia22,$t._invInertia00=ei,$t._invInertia01=ri,$t._invInertia02=_i,$t._invInertia10=hi,$t._invInertia11=li,$t._invInertia12=ci,$t._invInertia20=mi,$t._invInertia21=bi,$t._invInertia22=pi,di=$t._invInertia00*$t._transform._rotation00+$t._invInertia01*$t._transform._rotation01+$t._invInertia02*$t._transform._rotation02,ui=$t._invInertia00*$t._transform._rotation10+$t._invInertia01*$t._transform._rotation11+$t._invInertia02*$t._transform._rotation12,fi=$t._invInertia00*$t._transform._rotation20+$t._invInertia01*$t._transform._rotation21+$t._invInertia02*$t._transform._rotation22,xi=$t._invInertia10*$t._transform._rotation00+$t._invInertia11*$t._transform._rotation01+$t._invInertia12*$t._transform._rotation02,gi=$t._invInertia10*$t._transform._rotation10+$t._invInertia11*$t._transform._rotation11+$t._invInertia12*$t._transform._rotation12,vi=$t._invInertia10*$t._transform._rotation20+$t._invInertia11*$t._transform._rotation21+$t._invInertia12*$t._transform._rotation22,yi=$t._invInertia20*$t._transform._rotation00+$t._invInertia21*$t._transform._rotation01+$t._invInertia22*$t._transform._rotation02,Xi=$t._invInertia20*$t._transform._rotation10+$t._invInertia21*$t._transform._rotation11+$t._invInertia22*$t._transform._rotation12,zi=$t._invInertia20*$t._transform._rotation20+$t._invInertia21*$t._transform._rotation21+$t._invInertia22*$t._transform._rotation22,$t._invInertia00=di,$t._invInertia01=ui,$t._invInertia02=fi,$t._invInertia10=xi,$t._invInertia11=gi,$t._invInertia12=vi,$t._invInertia20=yi,$t._invInertia21=Xi,$t._invInertia22=zi,$t._invInertia00*=$t._rotFactor.x,$t._invInertia01*=$t._rotFactor.x,$t._invInertia02*=$t._rotFactor.x,$t._invInertia10*=$t._rotFactor.y,$t._invInertia11*=$t._rotFactor.y,$t._invInertia12*=$t._rotFactor.y,$t._invInertia20*=$t._rotFactor.z,$t._invInertia21*=$t._rotFactor.z,$t._invInertia22*=$t._rotFactor.z}postSolve(){let t,i,s,n,a,o,e,r,_;t=0,i=0,s=0,n=0,a=0,o=0,e=0,r=0,_=0;let h=0,l=this.info.numRows;for(;h<l;){let l,c,m,b=this.info.rows[h++],p=b.impulse,d=b.jacobianN,u=b.jacobianT,f=b.jacobianB,x=p.impulseN,g=p.impulseT,v=p.impulseB;l=0,c=0,m=0,l+=u.lin1X*g,c+=u.lin1Y*g,m+=u.lin1Z*g,l+=f.lin1X*v,c+=f.lin1Y*v,m+=f.lin1Z*v,p.impulseLX=l,p.impulseLY=c,p.impulseLZ=m,t+=d.lin1X*x,i+=d.lin1Y*x,s+=d.lin1Z*x,n+=d.ang1X*x,a+=d.ang1Y*x,o+=d.ang1Z*x,e+=d.ang2X*x,r+=d.ang2Y*x,_+=d.ang2Z*x,t+=u.lin1X*g,i+=u.lin1Y*g,s+=u.lin1Z*g,n+=u.ang1X*g,a+=u.ang1Y*g,o+=u.ang1Z*g,e+=u.ang2X*g,r+=u.ang2Y*g,_+=u.ang2Z*g,t+=f.lin1X*v,i+=f.lin1Y*v,s+=f.lin1Z*v,n+=f.ang1X*v,a+=f.ang1Y*v,o+=f.ang1Z*v,e+=f.ang2X*v,r+=f.ang2Y*v,_+=f.ang2Z*v}this._b1._linearContactImpulseX+=t,this._b1._linearContactImpulseY+=i,this._b1._linearContactImpulseZ+=s,this._b1._angularContactImpulseX+=n,this._b1._angularContactImpulseY+=a,this._b1._angularContactImpulseZ+=o,this._b2._linearContactImpulseX-=t,this._b2._linearContactImpulseY-=i,this._b2._linearContactImpulseZ-=s,this._b2._angularContactImpulseX-=e,this._b2._angularContactImpulseY-=r,this._b2._angularContactImpulseZ-=_,this.constraint._syncManifold()}},Ut.dynamics.constraint.solver.pgs.PgsJointConstraintSolver=class extends Ut.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.joint=t,this.info=new Ut.dynamics.constraint.info.joint.JointSolverInfo,this.massData=new Array(Ut.common.Setting.maxJacobianRows);let i=0,s=this.massData.length;for(;i<s;)this.massData[i++]=new Ut.dynamics.constraint.solver.common.JointSolverMassDataRow}preSolveVelocity(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i,s,n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g=this._b1._invMass,v=this._b2._invMass;i=this._b1._invInertia00,s=this._b1._invInertia01,n=this._b1._invInertia02,a=this._b1._invInertia10,o=this._b1._invInertia11,e=this._b1._invInertia12,r=this._b1._invInertia20,_=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,b=this._b2._invInertia10,p=this._b2._invInertia11,d=this._b2._invInertia12,u=this._b2._invInertia20,f=this._b2._invInertia21,x=this._b2._invInertia22;let y=0,X=this.info.numRows;for(;y<X;){let t=y++,X=this.info.rows[t],z=this.massData[t],M=X.jacobian;if(M.updateSparsity(),0!=(1&M.flag)?(z.invMLin1X=M.lin1X*g,z.invMLin1Y=M.lin1Y*g,z.invMLin1Z=M.lin1Z*g,z.invMLin2X=M.lin2X*v,z.invMLin2Y=M.lin2Y*v,z.invMLin2Z=M.lin2Z*v):(z.invMLin1X=0,z.invMLin1Y=0,z.invMLin1Z=0,z.invMLin2X=0,z.invMLin2Y=0,z.invMLin2Z=0),0!=(2&M.flag)){let t,g,v,y,X,Y;t=i*M.ang1X+s*M.ang1Y+n*M.ang1Z,g=a*M.ang1X+o*M.ang1Y+e*M.ang1Z,v=r*M.ang1X+_*M.ang1Y+h*M.ang1Z,z.invMAng1X=t,z.invMAng1Y=g,z.invMAng1Z=v,y=l*M.ang2X+c*M.ang2Y+m*M.ang2Z,X=b*M.ang2X+p*M.ang2Y+d*M.ang2Z,Y=u*M.ang2X+f*M.ang2Y+x*M.ang2Z,z.invMAng2X=y,z.invMAng2Y=X,z.invMAng2Z=Y}else z.invMAng1X=0,z.invMAng1Y=0,z.invMAng1Z=0,z.invMAng2X=0,z.invMAng2Y=0,z.invMAng2Z=0;z.massWithoutCfm=z.invMLin1X*M.lin1X+z.invMLin1Y*M.lin1Y+z.invMLin1Z*M.lin1Z+(z.invMLin2X*M.lin2X+z.invMLin2Y*M.lin2Y+z.invMLin2Z*M.lin2Z)+(z.invMAng1X*M.ang1X+z.invMAng1Y*M.ang1Y+z.invMAng1Z*M.ang1Z)+(z.invMAng2X*M.ang2X+z.invMAng2Y*M.ang2Y+z.invMAng2Z*M.ang2Z),z.mass=z.massWithoutCfm+X.cfm,0!=z.massWithoutCfm&&(z.massWithoutCfm=1/z.massWithoutCfm),0!=z.mass&&(z.mass=1/z.mass)}}warmStart(t){let i,s,n,a,o,e,r,_,h,l,c,m,b=this.joint._positionCorrectionAlgorithm==Ut.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?Ut.common.Setting.jointWarmStartingFactorForBaungarte:Ut.common.Setting.jointWarmStartingFactor;if(b*=t.dtRatio,b<=0){let t=0,i=this.info.numRows;for(;t<i;){let i=this.info.rows[t++].impulse;i.impulse=0,i.impulseM=0,i.impulseP=0}return}i=this._b1._velX,s=this._b1._velY,n=this._b1._velZ,a=this._b2._velX,o=this._b2._velY,e=this._b2._velZ,r=this._b1._angVelX,_=this._b1._angVelY,h=this._b1._angVelZ,l=this._b2._angVelX,c=this._b2._angVelY,m=this._b2._angVelZ;let p=0,d=this.info.numRows;for(;p<d;){let t=p++,d=this.massData[t],u=this.info.rows[t].impulse;u.impulse*=b,u.impulseM*=b;let f=u.impulse+u.impulseM;i+=d.invMLin1X*f,s+=d.invMLin1Y*f,n+=d.invMLin1Z*f,a+=d.invMLin2X*-f,o+=d.invMLin2Y*-f,e+=d.invMLin2Z*-f,r+=d.invMAng1X*f,_+=d.invMAng1Y*f,h+=d.invMAng1Z*f,l+=d.invMAng2X*-f,c+=d.invMAng2Y*-f,m+=d.invMAng2Z*-f}this._b1._velX=i,this._b1._velY=s,this._b1._velZ=n,this._b2._velX=a,this._b2._velY=o,this._b2._velZ=e,this._b1._angVelX=r,this._b1._angVelY=_,this._b1._angVelZ=h,this._b2._angVelX=l,this._b2._angVelY=c,this._b2._angVelZ=m}solveVelocity(){let t,i,s,n,a,o,e,r,_,h,l,c;t=this._b1._velX,i=this._b1._velY,s=this._b1._velZ,n=this._b2._velX,a=this._b2._velY,o=this._b2._velZ,e=this._b1._angVelX,r=this._b1._angVelY,_=this._b1._angVelZ,h=this._b2._angVelX,l=this._b2._angVelY,c=this._b2._angVelZ;let m=0,b=this.info.numRows;for(;m<b;){let b=m++,p=this.info.rows[b],d=this.massData[b],u=p.impulse,f=p.jacobian;if(0==p.motorMaxImpulse)continue;let x=0;x+=t*f.lin1X+i*f.lin1Y+s*f.lin1Z,x-=n*f.lin2X+a*f.lin2Y+o*f.lin2Z,x+=e*f.ang1X+r*f.ang1Y+_*f.ang1Z,x-=h*f.ang2X+l*f.ang2Y+c*f.ang2Z;let g=(-p.motorSpeed-x)*d.massWithoutCfm,v=u.impulseM;u.impulseM+=g,u.impulseM<-p.motorMaxImpulse?u.impulseM=-p.motorMaxImpulse:u.impulseM>p.motorMaxImpulse&&(u.impulseM=p.motorMaxImpulse),g=u.impulseM-v,0!=(1&f.flag)&&(t+=d.invMLin1X*g,i+=d.invMLin1Y*g,s+=d.invMLin1Z*g,n+=d.invMLin2X*-g,a+=d.invMLin2Y*-g,o+=d.invMLin2Z*-g),0!=(2&f.flag)&&(e+=d.invMAng1X*g,r+=d.invMAng1Y*g,_+=d.invMAng1Z*g,h+=d.invMAng2X*-g,l+=d.invMAng2Y*-g,c+=d.invMAng2Z*-g)}let p=0,d=this.info.numRows;for(;p<d;){let m=p++,b=this.info.rows[m],d=this.massData[m],u=b.impulse,f=b.jacobian,x=0;x+=t*f.lin1X+i*f.lin1Y+s*f.lin1Z,x-=n*f.lin2X+a*f.lin2Y+o*f.lin2Z,x+=e*f.ang1X+r*f.ang1Y+_*f.ang1Z,x-=h*f.ang2X+l*f.ang2Y+c*f.ang2Z;let g=(b.rhs-x-u.impulse*b.cfm)*d.mass,v=u.impulse;u.impulse+=g,u.impulse<b.minImpulse?u.impulse=b.minImpulse:u.impulse>b.maxImpulse&&(u.impulse=b.maxImpulse),g=u.impulse-v,0!=(1&f.flag)&&(t+=d.invMLin1X*g,i+=d.invMLin1Y*g,s+=d.invMLin1Z*g,n+=d.invMLin2X*-g,a+=d.invMLin2Y*-g,o+=d.invMLin2Z*-g),0!=(2&f.flag)&&(e+=d.invMAng1X*g,r+=d.invMAng1Y*g,_+=d.invMAng1Z*g,h+=d.invMAng2X*-g,l+=d.invMAng2Y*-g,c+=d.invMAng2Z*-g)}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=s,this._b2._velX=n,this._b2._velY=a,this._b2._velZ=o,this._b1._angVelX=e,this._b1._angVelY=r,this._b1._angVelZ=_,this._b2._angVelX=h,this._b2._angVelY=l,this._b2._angVelZ=c}postSolveVelocity(t){let i,s,n,a,o,e;i=0,s=0,n=0,a=0,o=0,e=0;let r=0,_=this.info.numRows;for(;r<_;){let t=this.info.rows[r++],_=t.impulse,h=t.jacobian;0!=(1&h.flag)?(i+=h.lin1X*_.impulse,s+=h.lin1Y*_.impulse,n+=h.lin1Z*_.impulse):0!=(2&h.flag)&&(a+=h.ang1X*_.impulse,o+=h.ang1Y*_.impulse,e+=h.ang1Z*_.impulse)}this.joint._appliedForceX=i*t.invDt,this.joint._appliedForceY=s*t.invDt,this.joint._appliedForceZ=n*t.invDt,this.joint._appliedTorqueX=a*t.invDt,this.joint._appliedTorqueY=o*t.invDt,this.joint._appliedTorqueZ=e*t.invDt}preSolvePosition(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i,s,n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g=this._b1._invMass,v=this._b2._invMass;i=this._b1._invInertia00,s=this._b1._invInertia01,n=this._b1._invInertia02,a=this._b1._invInertia10,o=this._b1._invInertia11,e=this._b1._invInertia12,r=this._b1._invInertia20,_=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,b=this._b2._invInertia10,p=this._b2._invInertia11,d=this._b2._invInertia12,u=this._b2._invInertia20,f=this._b2._invInertia21,x=this._b2._invInertia22;let y=0,X=this.info.numRows;for(;y<X;){let t,X,z,M,Y,Z,w=y++,I=this.massData[w],V=this.info.rows[w].jacobian;I.invMLin1X=V.lin1X*g,I.invMLin1Y=V.lin1Y*g,I.invMLin1Z=V.lin1Z*g,I.invMLin2X=V.lin2X*v,I.invMLin2Y=V.lin2Y*v,I.invMLin2Z=V.lin2Z*v,t=i*V.ang1X+s*V.ang1Y+n*V.ang1Z,X=a*V.ang1X+o*V.ang1Y+e*V.ang1Z,z=r*V.ang1X+_*V.ang1Y+h*V.ang1Z,I.invMAng1X=t,I.invMAng1Y=X,I.invMAng1Z=z,M=l*V.ang2X+c*V.ang2Y+m*V.ang2Z,Y=b*V.ang2X+p*V.ang2Y+d*V.ang2Z,Z=u*V.ang2X+f*V.ang2Y+x*V.ang2Z,I.invMAng2X=M,I.invMAng2Y=Y,I.invMAng2Z=Z,I.mass=I.invMLin1X*V.lin1X+I.invMLin1Y*V.lin1Y+I.invMLin1Z*V.lin1Z+(I.invMLin2X*V.lin2X+I.invMLin2Y*V.lin2Y+I.invMLin2Z*V.lin2Z)+(I.invMAng1X*V.ang1X+I.invMAng1Y*V.ang1Y+I.invMAng1Z*V.ang1Z)+(I.invMAng2X*V.ang2X+I.invMAng2Y*V.ang2Y+I.invMAng2Z*V.ang2Z),0!=I.mass&&(I.mass=1/I.mass)}let z=0,M=this.info.numRows;for(;z<M;)this.info.rows[z++].impulse.impulseP=0}solvePositionSplitImpulse(){let t,i,s,n,a,o,e,r,_,h,l,c;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,s=this._b1._pseudoVelZ,n=this._b2._pseudoVelX,a=this._b2._pseudoVelY,o=this._b2._pseudoVelZ,e=this._b1._angPseudoVelX,r=this._b1._angPseudoVelY,_=this._b1._angPseudoVelZ,h=this._b2._angPseudoVelX,l=this._b2._angPseudoVelY,c=this._b2._angPseudoVelZ;let m=0,b=this.info.numRows;for(;m<b;){let b=m++,p=this.info.rows[b],d=this.massData[b],u=p.impulse,f=p.jacobian,x=0;x+=t*f.lin1X+i*f.lin1Y+s*f.lin1Z,x-=n*f.lin2X+a*f.lin2Y+o*f.lin2Z,x+=e*f.ang1X+r*f.ang1Y+_*f.ang1Z,x-=h*f.ang2X+l*f.ang2Y+c*f.ang2Z;let g=(p.rhs*Ut.common.Setting.positionSplitImpulseBaumgarte-x)*d.mass,v=u.impulseP;u.impulseP+=g,u.impulseP<p.minImpulse?u.impulseP=p.minImpulse:u.impulseP>p.maxImpulse&&(u.impulseP=p.maxImpulse),g=u.impulseP-v,t+=d.invMLin1X*g,i+=d.invMLin1Y*g,s+=d.invMLin1Z*g,n+=d.invMLin2X*-g,a+=d.invMLin2Y*-g,o+=d.invMLin2Z*-g,e+=d.invMAng1X*g,r+=d.invMAng1Y*g,_+=d.invMAng1Z*g,h+=d.invMAng2X*-g,l+=d.invMAng2Y*-g,c+=d.invMAng2Z*-g}this._b1._pseudoVelX=t,this._b1._pseudoVelY=i,this._b1._pseudoVelZ=s,this._b2._pseudoVelX=n,this._b2._pseudoVelY=a,this._b2._pseudoVelZ=o,this._b1._angPseudoVelX=e,this._b1._angPseudoVelY=r,this._b1._angPseudoVelZ=_,this._b2._angPseudoVelX=h,this._b2._angPseudoVelY=l,this._b2._angPseudoVelZ=c}solvePositionNgs(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i,s,n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g=this._b1._invMass,v=this._b2._invMass;i=this._b1._invInertia00,s=this._b1._invInertia01,n=this._b1._invInertia02,a=this._b1._invInertia10,o=this._b1._invInertia11,e=this._b1._invInertia12,r=this._b1._invInertia20,_=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,b=this._b2._invInertia10,p=this._b2._invInertia11,d=this._b2._invInertia12,u=this._b2._invInertia20,f=this._b2._invInertia21,x=this._b2._invInertia22;let y,X,z,M,Y,Z,w,I,V,L,A,k,S=0,B=this.info.numRows;for(;S<B;){let t,y,X,z,M,Y,Z=S++,w=this.massData[Z],I=this.info.rows[Z].jacobian;w.invMLin1X=I.lin1X*g,w.invMLin1Y=I.lin1Y*g,w.invMLin1Z=I.lin1Z*g,w.invMLin2X=I.lin2X*v,w.invMLin2Y=I.lin2Y*v,w.invMLin2Z=I.lin2Z*v,t=i*I.ang1X+s*I.ang1Y+n*I.ang1Z,y=a*I.ang1X+o*I.ang1Y+e*I.ang1Z,X=r*I.ang1X+_*I.ang1Y+h*I.ang1Z,w.invMAng1X=t,w.invMAng1Y=y,w.invMAng1Z=X,z=l*I.ang2X+c*I.ang2Y+m*I.ang2Z,M=b*I.ang2X+p*I.ang2Y+d*I.ang2Z,Y=u*I.ang2X+f*I.ang2Y+x*I.ang2Z,w.invMAng2X=z,w.invMAng2Y=M,w.invMAng2Z=Y,w.mass=w.invMLin1X*I.lin1X+w.invMLin1Y*I.lin1Y+w.invMLin1Z*I.lin1Z+(w.invMLin2X*I.lin2X+w.invMLin2Y*I.lin2Y+w.invMLin2Z*I.lin2Z)+(w.invMAng1X*I.ang1X+w.invMAng1Y*I.ang1Y+w.invMAng1Z*I.ang1Z)+(w.invMAng2X*I.ang2X+w.invMAng2Y*I.ang2Y+w.invMAng2Z*I.ang2Z),0!=w.mass&&(w.mass=1/w.mass)}y=0,X=0,z=0,M=0,Y=0,Z=0,w=0,I=0,V=0,L=0,A=0,k=0;let P=0,C=this.info.numRows;for(;P<C;){let t=P++,i=this.info.rows[t],s=this.massData[t],n=i.impulse,a=i.jacobian,o=0;o+=y*a.lin1X+X*a.lin1Y+z*a.lin1Z,o-=M*a.lin2X+Y*a.lin2Y+Z*a.lin2Z,o+=w*a.ang1X+I*a.ang1Y+V*a.ang1Z,o-=L*a.ang2X+A*a.ang2Y+k*a.ang2Z;let e=(i.rhs*Ut.common.Setting.positionNgsBaumgarte-o)*s.mass,r=n.impulseP;n.impulseP+=e,n.impulseP<i.minImpulse?n.impulseP=i.minImpulse:n.impulseP>i.maxImpulse&&(n.impulseP=i.maxImpulse),e=n.impulseP-r,y+=s.invMLin1X*e,X+=s.invMLin1Y*e,z+=s.invMLin1Z*e,M+=s.invMLin2X*-e,Y+=s.invMLin2Y*-e,Z+=s.invMLin2Z*-e,w+=s.invMAng1X*e,I+=s.invMAng1Y*e,V+=s.invMAng1Z*e,L+=s.invMAng2X*-e,A+=s.invMAng2Y*-e,k+=s.invMAng2Z*-e}let T=this._b1;T._transform._positionX+=y,T._transform._positionY+=X,T._transform._positionZ+=z;let j=this._b2;j._transform._positionX+=M,j._transform._positionY+=Y,j._transform._positionZ+=Z;let E,R,D,F,q,N,H,O,W,G,U,J,$,K=this._b1,Q=Math.sqrt(w*w+I*I+V*V),tt=.5*Q;if(tt<.5){let t=tt*tt;E=.5*(1-.16666666666666666*t+t*t*.008333333333333333),R=1-.5*t+t*t*.041666666666666664}else E=Math.sin(tt)/Q,R=Math.cos(tt);D=w*E,F=I*E,q=V*E,N=D,H=F,O=q,W=R;let it,st=K._transform._rotation00,nt=K._transform._rotation11,at=K._transform._rotation22,ot=st+nt+at;ot>0?(it=Math.sqrt(ot+1),$=.5*it,it=.5/it,G=(K._transform._rotation21-K._transform._rotation12)*it,U=(K._transform._rotation02-K._transform._rotation20)*it,J=(K._transform._rotation10-K._transform._rotation01)*it):st>nt?st>at?(it=Math.sqrt(st-nt-at+1),G=.5*it,it=.5/it,U=(K._transform._rotation01+K._transform._rotation10)*it,J=(K._transform._rotation02+K._transform._rotation20)*it,$=(K._transform._rotation21-K._transform._rotation12)*it):(it=Math.sqrt(at-st-nt+1),J=.5*it,it=.5/it,G=(K._transform._rotation02+K._transform._rotation20)*it,U=(K._transform._rotation12+K._transform._rotation21)*it,$=(K._transform._rotation10-K._transform._rotation01)*it):nt>at?(it=Math.sqrt(nt-at-st+1),U=.5*it,it=.5/it,G=(K._transform._rotation01+K._transform._rotation10)*it,J=(K._transform._rotation12+K._transform._rotation21)*it,$=(K._transform._rotation02-K._transform._rotation20)*it):(it=Math.sqrt(at-st-nt+1),J=.5*it,it=.5/it,G=(K._transform._rotation02+K._transform._rotation20)*it,U=(K._transform._rotation12+K._transform._rotation21)*it,$=(K._transform._rotation10-K._transform._rotation01)*it),G=W*G+N*$+H*J-O*U,U=W*U-N*J+H*$+O*G,J=W*J+N*U-H*G+O*$,$=W*$-N*G-H*U-O*J;let et=G*G+U*U+J*J+$*$;et>1e-32&&(et=1/Math.sqrt(et)),G*=et,U*=et,J*=et,$*=et;let rt,_t,ht,lt,ct,mt,bt,pt,dt,ut,ft,xt,gt,vt,yt,Xt,zt,Mt,Yt=2*G,Zt=2*U,wt=2*J,It=G*Yt,Vt=U*Zt,Lt=J*wt,At=G*Zt,kt=U*wt,St=G*wt,Bt=$*Yt,Pt=$*Zt,Ct=$*wt;K._transform._rotation00=1-Vt-Lt,K._transform._rotation01=At-Ct,K._transform._rotation02=St+Pt,K._transform._rotation10=At+Ct,K._transform._rotation11=1-It-Lt,K._transform._rotation12=kt-Bt,K._transform._rotation20=St-Pt,K._transform._rotation21=kt+Bt,K._transform._rotation22=1-It-Vt,rt=K._transform._rotation00*K._invLocalInertia00+K._transform._rotation01*K._invLocalInertia10+K._transform._rotation02*K._invLocalInertia20,_t=K._transform._rotation00*K._invLocalInertia01+K._transform._rotation01*K._invLocalInertia11+K._transform._rotation02*K._invLocalInertia21,ht=K._transform._rotation00*K._invLocalInertia02+K._transform._rotation01*K._invLocalInertia12+K._transform._rotation02*K._invLocalInertia22,lt=K._transform._rotation10*K._invLocalInertia00+K._transform._rotation11*K._invLocalInertia10+K._transform._rotation12*K._invLocalInertia20,ct=K._transform._rotation10*K._invLocalInertia01+K._transform._rotation11*K._invLocalInertia11+K._transform._rotation12*K._invLocalInertia21,mt=K._transform._rotation10*K._invLocalInertia02+K._transform._rotation11*K._invLocalInertia12+K._transform._rotation12*K._invLocalInertia22,bt=K._transform._rotation20*K._invLocalInertia00+K._transform._rotation21*K._invLocalInertia10+K._transform._rotation22*K._invLocalInertia20,pt=K._transform._rotation20*K._invLocalInertia01+K._transform._rotation21*K._invLocalInertia11+K._transform._rotation22*K._invLocalInertia21,dt=K._transform._rotation20*K._invLocalInertia02+K._transform._rotation21*K._invLocalInertia12+K._transform._rotation22*K._invLocalInertia22,K._invInertia00=rt,K._invInertia01=_t,K._invInertia02=ht,K._invInertia10=lt,K._invInertia11=ct,K._invInertia12=mt,K._invInertia20=bt,K._invInertia21=pt,K._invInertia22=dt,ut=K._invInertia00*K._transform._rotation00+K._invInertia01*K._transform._rotation01+K._invInertia02*K._transform._rotation02,ft=K._invInertia00*K._transform._rotation10+K._invInertia01*K._transform._rotation11+K._invInertia02*K._transform._rotation12,xt=K._invInertia00*K._transform._rotation20+K._invInertia01*K._transform._rotation21+K._invInertia02*K._transform._rotation22,gt=K._invInertia10*K._transform._rotation00+K._invInertia11*K._transform._rotation01+K._invInertia12*K._transform._rotation02,vt=K._invInertia10*K._transform._rotation10+K._invInertia11*K._transform._rotation11+K._invInertia12*K._transform._rotation12,yt=K._invInertia10*K._transform._rotation20+K._invInertia11*K._transform._rotation21+K._invInertia12*K._transform._rotation22,Xt=K._invInertia20*K._transform._rotation00+K._invInertia21*K._transform._rotation01+K._invInertia22*K._transform._rotation02,zt=K._invInertia20*K._transform._rotation10+K._invInertia21*K._transform._rotation11+K._invInertia22*K._transform._rotation12,Mt=K._invInertia20*K._transform._rotation20+K._invInertia21*K._transform._rotation21+K._invInertia22*K._transform._rotation22,K._invInertia00=ut,K._invInertia01=ft,K._invInertia02=xt,K._invInertia10=gt,K._invInertia11=vt,K._invInertia12=yt,K._invInertia20=Xt,K._invInertia21=zt,K._invInertia22=Mt,K._invInertia00*=K._rotFactor.x,K._invInertia01*=K._rotFactor.x,K._invInertia02*=K._rotFactor.x,K._invInertia10*=K._rotFactor.y,K._invInertia11*=K._rotFactor.y,K._invInertia12*=K._rotFactor.y,K._invInertia20*=K._rotFactor.z,K._invInertia21*=K._rotFactor.z,K._invInertia22*=K._rotFactor.z;let Tt,jt,Et,Rt,Dt,Ft,qt,Nt,Ht,Ot,Wt,Gt,Jt,$t=this._b2,Kt=Math.sqrt(L*L+A*A+k*k),Qt=.5*Kt;if(Qt<.5){let t=Qt*Qt;Tt=.5*(1-.16666666666666666*t+t*t*.008333333333333333),jt=1-.5*t+t*t*.041666666666666664}else Tt=Math.sin(Qt)/Kt,jt=Math.cos(Qt);Et=L*Tt,Rt=A*Tt,Dt=k*Tt,Ft=Et,qt=Rt,Nt=Dt,Ht=jt;let ti,ii=$t._transform._rotation00,si=$t._transform._rotation11,ni=$t._transform._rotation22,ai=ii+si+ni;ai>0?(ti=Math.sqrt(ai+1),Jt=.5*ti,ti=.5/ti,Ot=($t._transform._rotation21-$t._transform._rotation12)*ti,Wt=($t._transform._rotation02-$t._transform._rotation20)*ti,Gt=($t._transform._rotation10-$t._transform._rotation01)*ti):ii>si?ii>ni?(ti=Math.sqrt(ii-si-ni+1),Ot=.5*ti,ti=.5/ti,Wt=($t._transform._rotation01+$t._transform._rotation10)*ti,Gt=($t._transform._rotation02+$t._transform._rotation20)*ti,Jt=($t._transform._rotation21-$t._transform._rotation12)*ti):(ti=Math.sqrt(ni-ii-si+1),Gt=.5*ti,ti=.5/ti,Ot=($t._transform._rotation02+$t._transform._rotation20)*ti,Wt=($t._transform._rotation12+$t._transform._rotation21)*ti,Jt=($t._transform._rotation10-$t._transform._rotation01)*ti):si>ni?(ti=Math.sqrt(si-ni-ii+1),Wt=.5*ti,ti=.5/ti,Ot=($t._transform._rotation01+$t._transform._rotation10)*ti,Gt=($t._transform._rotation12+$t._transform._rotation21)*ti,Jt=($t._transform._rotation02-$t._transform._rotation20)*ti):(ti=Math.sqrt(ni-ii-si+1),Gt=.5*ti,ti=.5/ti,Ot=($t._transform._rotation02+$t._transform._rotation20)*ti,Wt=($t._transform._rotation12+$t._transform._rotation21)*ti,Jt=($t._transform._rotation10-$t._transform._rotation01)*ti),Ot=Ht*Ot+Ft*Jt+qt*Gt-Nt*Wt,Wt=Ht*Wt-Ft*Gt+qt*Jt+Nt*Ot,Gt=Ht*Gt+Ft*Wt-qt*Ot+Nt*Jt,Jt=Ht*Jt-Ft*Ot-qt*Wt-Nt*Gt;let oi=Ot*Ot+Wt*Wt+Gt*Gt+Jt*Jt;oi>1e-32&&(oi=1/Math.sqrt(oi)),Ot*=oi,Wt*=oi,Gt*=oi,Jt*=oi;let ei,ri,_i,hi,li,ci,mi,bi,pi,di,ui,fi,xi,gi,vi,yi,Xi,zi,Mi=2*Ot,Yi=2*Wt,Zi=2*Gt,wi=Ot*Mi,Ii=Wt*Yi,Vi=Gt*Zi,Li=Ot*Yi,Ai=Wt*Zi,ki=Ot*Zi,Si=Jt*Mi,Bi=Jt*Yi,Pi=Jt*Zi;$t._transform._rotation00=1-Ii-Vi,$t._transform._rotation01=Li-Pi,$t._transform._rotation02=ki+Bi,$t._transform._rotation10=Li+Pi,$t._transform._rotation11=1-wi-Vi,$t._transform._rotation12=Ai-Si,$t._transform._rotation20=ki-Bi,$t._transform._rotation21=Ai+Si,$t._transform._rotation22=1-wi-Ii,ei=$t._transform._rotation00*$t._invLocalInertia00+$t._transform._rotation01*$t._invLocalInertia10+$t._transform._rotation02*$t._invLocalInertia20,ri=$t._transform._rotation00*$t._invLocalInertia01+$t._transform._rotation01*$t._invLocalInertia11+$t._transform._rotation02*$t._invLocalInertia21,_i=$t._transform._rotation00*$t._invLocalInertia02+$t._transform._rotation01*$t._invLocalInertia12+$t._transform._rotation02*$t._invLocalInertia22,hi=$t._transform._rotation10*$t._invLocalInertia00+$t._transform._rotation11*$t._invLocalInertia10+$t._transform._rotation12*$t._invLocalInertia20,li=$t._transform._rotation10*$t._invLocalInertia01+$t._transform._rotation11*$t._invLocalInertia11+$t._transform._rotation12*$t._invLocalInertia21,ci=$t._transform._rotation10*$t._invLocalInertia02+$t._transform._rotation11*$t._invLocalInertia12+$t._transform._rotation12*$t._invLocalInertia22,mi=$t._transform._rotation20*$t._invLocalInertia00+$t._transform._rotation21*$t._invLocalInertia10+$t._transform._rotation22*$t._invLocalInertia20,bi=$t._transform._rotation20*$t._invLocalInertia01+$t._transform._rotation21*$t._invLocalInertia11+$t._transform._rotation22*$t._invLocalInertia21,pi=$t._transform._rotation20*$t._invLocalInertia02+$t._transform._rotation21*$t._invLocalInertia12+$t._transform._rotation22*$t._invLocalInertia22,$t._invInertia00=ei,$t._invInertia01=ri,$t._invInertia02=_i,$t._invInertia10=hi,$t._invInertia11=li,$t._invInertia12=ci,$t._invInertia20=mi,$t._invInertia21=bi,$t._invInertia22=pi,di=$t._invInertia00*$t._transform._rotation00+$t._invInertia01*$t._transform._rotation01+$t._invInertia02*$t._transform._rotation02,ui=$t._invInertia00*$t._transform._rotation10+$t._invInertia01*$t._transform._rotation11+$t._invInertia02*$t._transform._rotation12,fi=$t._invInertia00*$t._transform._rotation20+$t._invInertia01*$t._transform._rotation21+$t._invInertia02*$t._transform._rotation22,xi=$t._invInertia10*$t._transform._rotation00+$t._invInertia11*$t._transform._rotation01+$t._invInertia12*$t._transform._rotation02,gi=$t._invInertia10*$t._transform._rotation10+$t._invInertia11*$t._transform._rotation11+$t._invInertia12*$t._transform._rotation12,vi=$t._invInertia10*$t._transform._rotation20+$t._invInertia11*$t._transform._rotation21+$t._invInertia12*$t._transform._rotation22,yi=$t._invInertia20*$t._transform._rotation00+$t._invInertia21*$t._transform._rotation01+$t._invInertia22*$t._transform._rotation02,Xi=$t._invInertia20*$t._transform._rotation10+$t._invInertia21*$t._transform._rotation11+$t._invInertia22*$t._transform._rotation12,zi=$t._invInertia20*$t._transform._rotation20+$t._invInertia21*$t._transform._rotation21+$t._invInertia22*$t._transform._rotation22,$t._invInertia00=di,$t._invInertia01=ui,$t._invInertia02=fi,$t._invInertia10=xi,$t._invInertia11=gi,$t._invInertia12=vi,$t._invInertia20=yi,$t._invInertia21=Xi,$t._invInertia22=zi,$t._invInertia00*=$t._rotFactor.x,$t._invInertia01*=$t._rotFactor.x,$t._invInertia02*=$t._rotFactor.x,$t._invInertia10*=$t._rotFactor.y,$t._invInertia11*=$t._rotFactor.y,$t._invInertia12*=$t._rotFactor.y,$t._invInertia20*=$t._rotFactor.z,$t._invInertia21*=$t._rotFactor.z,$t._invInertia22*=$t._rotFactor.z}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}},Ut.dynamics.rigidbody||(Ut.dynamics.rigidbody={}),Ut.dynamics.rigidbody.MassData=class{constructor(){this.mass=0,this.localInertia=new Ut.common.Mat3}},Ut.dynamics.rigidbody.RigidBody=class{constructor(t){this._next=null,this._prev=null,this._shapeList=null,this._shapeListLast=null,this._numShapes=0,this._contactLinkList=null,this._contactLinkListLast=null,this._numContactLinks=0,this._jointLinkList=null,this._jointLinkListLast=null,this._numJointLinks=0;let i=t.linearVelocity;this._velX=i.x,this._velY=i.y,this._velZ=i.z;let s=t.angularVelocity;this._angVelX=s.x,this._angVelY=s.y,this._angVelZ=s.z,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._ptransform=new Ut.common.Transform,this._transform=new Ut.common.Transform;let n=t.position;this._ptransform._positionX=n.x,this._ptransform._positionY=n.y,this._ptransform._positionZ=n.z;let a=t.rotation;this._ptransform._rotation00=a.e00,this._ptransform._rotation01=a.e01,this._ptransform._rotation02=a.e02,this._ptransform._rotation10=a.e10,this._ptransform._rotation11=a.e11,this._ptransform._rotation12=a.e12,this._ptransform._rotation20=a.e20,this._ptransform._rotation21=a.e21,this._ptransform._rotation22=a.e22;let o=this._transform,e=this._ptransform;o._positionX=e._positionX,o._positionY=e._positionY,o._positionZ=e._positionZ,o._rotation00=e._rotation00,o._rotation01=e._rotation01,o._rotation02=e._rotation02,o._rotation10=e._rotation10,o._rotation11=e._rotation11,o._rotation12=e._rotation12,o._rotation20=e._rotation20,o._rotation21=e._rotation21,o._rotation22=e._rotation22,this._type=t.type,this._sleepTime=0,this._sleeping=!1,this._autoSleep=t.autoSleep,this._mass=0,this._invMass=0,this._localInertia00=0,this._localInertia01=0,this._localInertia02=0,this._localInertia10=0,this._localInertia11=0,this._localInertia12=0,this._localInertia20=0,this._localInertia21=0,this._localInertia22=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._invInertia00=0,this._invInertia01=0,this._invInertia02=0,this._invInertia10=0,this._invInertia11=0,this._invInertia12=0,this._invInertia20=0,this._invInertia21=0,this._invInertia22=0,this._linearDamping=t.linearDamping,this._angularDamping=t.angularDamping,this._forceX=0,this._forceY=0,this._forceZ=0,this._torqueX=0,this._torqueY=0,this._torqueZ=0,this._linearContactImpulseX=0,this._linearContactImpulseY=0,this._linearContactImpulseZ=0,this._angularContactImpulseX=0,this._angularContactImpulseY=0,this._angularContactImpulseZ=0,this._rotFactor=new Ut.common.Vec3(1,1,1),this._addedToIsland=!1,this._gravityScale=1,this._world=null}_integrate(t){switch(this._type){case 1:this._velX=0,this._velY=0,this._velZ=0,this._angVelX=0,this._angVelY=0,this._angVelZ=0,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:let i,s,n,a,o,e;i=this._velX*t,s=this._velY*t,n=this._velZ*t,a=this._angVelX*t,o=this._angVelY*t,e=this._angVelZ*t;let r=i*i+s*s+n*n,_=a*a+o*o+e*e;if(0==r&&0==_)return;if(r>Ut.common.Setting.maxTranslationPerStep*Ut.common.Setting.maxTranslationPerStep){let t=Ut.common.Setting.maxTranslationPerStep/Math.sqrt(r);this._velX*=t,this._velY*=t,this._velZ*=t,i*=t,s*=t,n*=t}if(_>Ut.common.Setting.maxRotationPerStep*Ut.common.Setting.maxRotationPerStep){let t=Ut.common.Setting.maxRotationPerStep/Math.sqrt(_);this._angVelX*=t,this._angVelY*=t,this._angVelZ*=t,a*=t,o*=t,e*=t}this._transform._positionX+=i,this._transform._positionY+=s,this._transform._positionZ+=n;let h,l,c,m,b,p,d,u,f,x,g,v,y,X=Math.sqrt(a*a+o*o+e*e),z=.5*X;if(z<.5){let t=z*z;h=.5*(1-.16666666666666666*t+t*t*.008333333333333333),l=1-.5*t+t*t*.041666666666666664}else h=Math.sin(z)/X,l=Math.cos(z);c=a*h,m=o*h,b=e*h,p=c,d=m,u=b,f=l;let M,Y=this._transform._rotation00,Z=this._transform._rotation11,w=this._transform._rotation22,I=Y+Z+w;I>0?(M=Math.sqrt(I+1),y=.5*M,M=.5/M,x=(this._transform._rotation21-this._transform._rotation12)*M,g=(this._transform._rotation02-this._transform._rotation20)*M,v=(this._transform._rotation10-this._transform._rotation01)*M):Y>Z?Y>w?(M=Math.sqrt(Y-Z-w+1),x=.5*M,M=.5/M,g=(this._transform._rotation01+this._transform._rotation10)*M,v=(this._transform._rotation02+this._transform._rotation20)*M,y=(this._transform._rotation21-this._transform._rotation12)*M):(M=Math.sqrt(w-Y-Z+1),v=.5*M,M=.5/M,x=(this._transform._rotation02+this._transform._rotation20)*M,g=(this._transform._rotation12+this._transform._rotation21)*M,y=(this._transform._rotation10-this._transform._rotation01)*M):Z>w?(M=Math.sqrt(Z-w-Y+1),g=.5*M,M=.5/M,x=(this._transform._rotation01+this._transform._rotation10)*M,v=(this._transform._rotation12+this._transform._rotation21)*M,y=(this._transform._rotation02-this._transform._rotation20)*M):(M=Math.sqrt(w-Y-Z+1),v=.5*M,M=.5/M,x=(this._transform._rotation02+this._transform._rotation20)*M,g=(this._transform._rotation12+this._transform._rotation21)*M,y=(this._transform._rotation10-this._transform._rotation01)*M),x=f*x+p*y+d*v-u*g,g=f*g-p*v+d*y+u*x,v=f*v+p*g-d*x+u*y,y=f*y-p*x-d*g-u*v;let V=x*x+g*g+v*v+y*y;V>1e-32&&(V=1/Math.sqrt(V)),x*=V,g*=V,v*=V,y*=V;let L,A,k,S,B,P,C,T,j,E,R,D,F,q,N,H,O,W,G=2*x,U=2*g,J=2*v,$=x*G,K=g*U,Q=v*J,tt=x*U,it=g*J,st=x*J,nt=y*G,at=y*U,ot=y*J;this._transform._rotation00=1-K-Q,this._transform._rotation01=tt-ot,this._transform._rotation02=st+at,this._transform._rotation10=tt+ot,this._transform._rotation11=1-$-Q,this._transform._rotation12=it-nt,this._transform._rotation20=st-at,this._transform._rotation21=it+nt,this._transform._rotation22=1-$-K,L=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,A=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,k=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,S=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,B=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,P=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,C=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,T=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,j=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=L,this._invInertia01=A,this._invInertia02=k,this._invInertia10=S,this._invInertia11=B,this._invInertia12=P,this._invInertia20=C,this._invInertia21=T,this._invInertia22=j,E=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,R=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,D=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,F=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,q=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,N=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,H=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,O=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,W=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=E,this._invInertia01=R,this._invInertia02=D,this._invInertia10=F,this._invInertia11=q,this._invInertia12=N,this._invInertia20=H,this._invInertia21=O,this._invInertia22=W,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z}}_integratePseudoVelocity(){if(this._pseudoVelX*this._pseudoVelX+this._pseudoVelY*this._pseudoVelY+this._pseudoVelZ*this._pseudoVelZ!=0||this._angPseudoVelX*this._angPseudoVelX+this._angPseudoVelY*this._angPseudoVelY+this._angPseudoVelZ*this._angPseudoVelZ!=0)switch(this._type){case 1:this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:let t,i,s,n,a,o;t=this._pseudoVelX,i=this._pseudoVelY,s=this._pseudoVelZ,n=this._angPseudoVelX,a=this._angPseudoVelY,o=this._angPseudoVelZ,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._transform._positionX+=t,this._transform._positionY+=i,this._transform._positionZ+=s;let e,r,_,h,l,c,m,b,p,d,u,f,x,g=Math.sqrt(n*n+a*a+o*o),v=.5*g;if(v<.5){let t=v*v;e=.5*(1-.16666666666666666*t+t*t*.008333333333333333),r=1-.5*t+t*t*.041666666666666664}else e=Math.sin(v)/g,r=Math.cos(v);_=n*e,h=a*e,l=o*e,c=_,m=h,b=l,p=r;let y,X=this._transform._rotation00,z=this._transform._rotation11,M=this._transform._rotation22,Y=X+z+M;Y>0?(y=Math.sqrt(Y+1),x=.5*y,y=.5/y,d=(this._transform._rotation21-this._transform._rotation12)*y,u=(this._transform._rotation02-this._transform._rotation20)*y,f=(this._transform._rotation10-this._transform._rotation01)*y):X>z?X>M?(y=Math.sqrt(X-z-M+1),d=.5*y,y=.5/y,u=(this._transform._rotation01+this._transform._rotation10)*y,f=(this._transform._rotation02+this._transform._rotation20)*y,x=(this._transform._rotation21-this._transform._rotation12)*y):(y=Math.sqrt(M-X-z+1),f=.5*y,y=.5/y,d=(this._transform._rotation02+this._transform._rotation20)*y,u=(this._transform._rotation12+this._transform._rotation21)*y,x=(this._transform._rotation10-this._transform._rotation01)*y):z>M?(y=Math.sqrt(z-M-X+1),u=.5*y,y=.5/y,d=(this._transform._rotation01+this._transform._rotation10)*y,f=(this._transform._rotation12+this._transform._rotation21)*y,x=(this._transform._rotation02-this._transform._rotation20)*y):(y=Math.sqrt(M-X-z+1),f=.5*y,y=.5/y,d=(this._transform._rotation02+this._transform._rotation20)*y,u=(this._transform._rotation12+this._transform._rotation21)*y,x=(this._transform._rotation10-this._transform._rotation01)*y),d=p*d+c*x+m*f-b*u,u=p*u-c*f+m*x+b*d,f=p*f+c*u-m*d+b*x,x=p*x-c*d-m*u-b*f;let Z=d*d+u*u+f*f+x*x;Z>1e-32&&(Z=1/Math.sqrt(Z)),d*=Z,u*=Z,f*=Z,x*=Z;let w,I,V,L,A,k,S,B,P,C,T,j,E,R,D,F,q,N,H=2*d,O=2*u,W=2*f,G=d*H,U=u*O,J=f*W,$=d*O,K=u*W,Q=d*W,tt=x*H,it=x*O,st=x*W;this._transform._rotation00=1-U-J,this._transform._rotation01=$-st,this._transform._rotation02=Q+it,this._transform._rotation10=$+st,this._transform._rotation11=1-G-J,this._transform._rotation12=K-tt,this._transform._rotation20=Q-it,this._transform._rotation21=K+tt,this._transform._rotation22=1-G-U,w=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,I=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,V=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,L=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,A=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,k=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,S=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,B=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,P=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=w,this._invInertia01=I,this._invInertia02=V,this._invInertia10=L,this._invInertia11=A,this._invInertia12=k,this._invInertia20=S,this._invInertia21=B,this._invInertia22=P,C=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,T=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,j=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,E=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,R=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,D=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,F=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,q=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,N=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=C,this._invInertia01=T,this._invInertia02=j,this._invInertia10=E,this._invInertia11=R,this._invInertia12=D,this._invInertia20=F,this._invInertia21=q,this._invInertia22=N,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z}}updateMass(){let t,i,s,n,a,o,e,r,_;t=0,i=0,s=0,n=0,a=0,o=0,e=0,r=0,_=0;let h,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w=0,I=this._shapeList;for(;null!=I;){let h=I._next,l=I._geom;l._updateMass();let c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,V,L,A,k,S,B,P,C,T,j,E,R,D,F,q,N,H,O,W,G,U=I._density*l._volume;v=I._localTransform._rotation00*l._inertiaCoeff00+I._localTransform._rotation01*l._inertiaCoeff10+I._localTransform._rotation02*l._inertiaCoeff20,y=I._localTransform._rotation00*l._inertiaCoeff01+I._localTransform._rotation01*l._inertiaCoeff11+I._localTransform._rotation02*l._inertiaCoeff21,X=I._localTransform._rotation00*l._inertiaCoeff02+I._localTransform._rotation01*l._inertiaCoeff12+I._localTransform._rotation02*l._inertiaCoeff22,z=I._localTransform._rotation10*l._inertiaCoeff00+I._localTransform._rotation11*l._inertiaCoeff10+I._localTransform._rotation12*l._inertiaCoeff20,M=I._localTransform._rotation10*l._inertiaCoeff01+I._localTransform._rotation11*l._inertiaCoeff11+I._localTransform._rotation12*l._inertiaCoeff21,Y=I._localTransform._rotation10*l._inertiaCoeff02+I._localTransform._rotation11*l._inertiaCoeff12+I._localTransform._rotation12*l._inertiaCoeff22,Z=I._localTransform._rotation20*l._inertiaCoeff00+I._localTransform._rotation21*l._inertiaCoeff10+I._localTransform._rotation22*l._inertiaCoeff20,V=I._localTransform._rotation20*l._inertiaCoeff01+I._localTransform._rotation21*l._inertiaCoeff11+I._localTransform._rotation22*l._inertiaCoeff21,L=I._localTransform._rotation20*l._inertiaCoeff02+I._localTransform._rotation21*l._inertiaCoeff12+I._localTransform._rotation22*l._inertiaCoeff22,c=v,m=y,b=X,p=z,d=M,u=Y,f=Z,x=V,g=L,A=c*I._localTransform._rotation00+m*I._localTransform._rotation01+b*I._localTransform._rotation02,k=c*I._localTransform._rotation10+m*I._localTransform._rotation11+b*I._localTransform._rotation12,S=c*I._localTransform._rotation20+m*I._localTransform._rotation21+b*I._localTransform._rotation22,B=p*I._localTransform._rotation00+d*I._localTransform._rotation01+u*I._localTransform._rotation02,P=p*I._localTransform._rotation10+d*I._localTransform._rotation11+u*I._localTransform._rotation12,C=p*I._localTransform._rotation20+d*I._localTransform._rotation21+u*I._localTransform._rotation22,T=f*I._localTransform._rotation00+x*I._localTransform._rotation01+g*I._localTransform._rotation02,j=f*I._localTransform._rotation10+x*I._localTransform._rotation11+g*I._localTransform._rotation12,E=f*I._localTransform._rotation20+x*I._localTransform._rotation21+g*I._localTransform._rotation22,c=A,m=k,b=S,p=B,d=P,u=C,f=T,x=j,g=E,c*=U,m*=U,b*=U,p*=U,d*=U,u*=U,f*=U,x*=U,g*=U;let J=I._localTransform._positionX*I._localTransform._positionX,$=I._localTransform._positionY*I._localTransform._positionY,K=I._localTransform._positionZ*I._localTransform._positionZ,Q=-I._localTransform._positionX*I._localTransform._positionY,tt=-I._localTransform._positionY*I._localTransform._positionZ,it=-I._localTransform._positionZ*I._localTransform._positionX;R=$+K,D=Q,F=it,q=Q,N=J+K,H=tt,O=it,W=tt,G=J+$,c+=R*U,m+=D*U,b+=F*U,p+=q*U,d+=N*U,u+=H*U,f+=O*U,x+=W*U,g+=G*U,w+=U,t+=c,i+=m,s+=b,n+=p,a+=d,o+=u,e+=f,r+=x,_+=g,I=h}if(this._mass=w,this._localInertia00=t,this._localInertia01=i,this._localInertia02=s,this._localInertia10=n,this._localInertia11=a,this._localInertia12=o,this._localInertia20=e,this._localInertia21=r,this._localInertia22=_,this._mass>0&&this._localInertia00*(this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21)-this._localInertia01*(this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20)+this._localInertia02*(this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20)>0&&0==this._type){this._invMass=1/this._mass;let t=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,i=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,s=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,n=this._localInertia00*t-this._localInertia01*i+this._localInertia02*s;(n<-1e-32||n>1e-32)&&(n=1/n),this._invLocalInertia00=t*n,this._invLocalInertia01=-(this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21)*n,this._invLocalInertia02=(this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11)*n,this._invLocalInertia10=-i*n,this._invLocalInertia11=(this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20)*n,this._invLocalInertia12=-(this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10)*n,this._invLocalInertia20=s*n,this._invLocalInertia21=-(this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20)*n,this._invLocalInertia22=(this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10)*n,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,0==this._type&&(this._type=1);h=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,l=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,c=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,m=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,b=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,p=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,d=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,u=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,f=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=h,this._invInertia01=l,this._invInertia02=c,this._invInertia10=m,this._invInertia11=b,this._invInertia12=p,this._invInertia20=d,this._invInertia21=u,this._invInertia22=f,x=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,g=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,v=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,y=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,X=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,z=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,M=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,Y=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Z=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=x,this._invInertia01=g,this._invInertia02=v,this._invInertia10=y,this._invInertia11=X,this._invInertia12=z,this._invInertia20=M,this._invInertia21=Y,this._invInertia22=Z,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getPosition(){let t=new Ut.common.Vec3;return t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ,t}getPositionTo(t){t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ}setPosition(t){this._transform._positionX=t.x,this._transform._positionY=t.y,this._transform._positionZ=t.z;let i=this._ptransform,s=this._transform;i._positionX=s._positionX,i._positionY=s._positionY,i._positionZ=s._positionZ,i._rotation00=s._rotation00,i._rotation01=s._rotation01,i._rotation02=s._rotation02,i._rotation10=s._rotation10,i._rotation11=s._rotation11,i._rotation12=s._rotation12,i._rotation20=s._rotation20,i._rotation21=s._rotation21,i._rotation22=s._rotation22;let n=this._shapeList;for(;null!=n;){let t,i,s,a,o,e,r,_,h,l,c,m,b=n._next,p=this._ptransform,d=this._transform,u=n._ptransform,f=n._localTransform;t=p._rotation00*f._rotation00+p._rotation01*f._rotation10+p._rotation02*f._rotation20,i=p._rotation00*f._rotation01+p._rotation01*f._rotation11+p._rotation02*f._rotation21,s=p._rotation00*f._rotation02+p._rotation01*f._rotation12+p._rotation02*f._rotation22,a=p._rotation10*f._rotation00+p._rotation11*f._rotation10+p._rotation12*f._rotation20,o=p._rotation10*f._rotation01+p._rotation11*f._rotation11+p._rotation12*f._rotation21,e=p._rotation10*f._rotation02+p._rotation11*f._rotation12+p._rotation12*f._rotation22,r=p._rotation20*f._rotation00+p._rotation21*f._rotation10+p._rotation22*f._rotation20,_=p._rotation20*f._rotation01+p._rotation21*f._rotation11+p._rotation22*f._rotation21,h=p._rotation20*f._rotation02+p._rotation21*f._rotation12+p._rotation22*f._rotation22,u._rotation00=t,u._rotation01=i,u._rotation02=s,u._rotation10=a,u._rotation11=o,u._rotation12=e,u._rotation20=r,u._rotation21=_,u._rotation22=h,l=p._rotation00*f._positionX+p._rotation01*f._positionY+p._rotation02*f._positionZ,c=p._rotation10*f._positionX+p._rotation11*f._positionY+p._rotation12*f._positionZ,m=p._rotation20*f._positionX+p._rotation21*f._positionY+p._rotation22*f._positionZ,u._positionX=l,u._positionY=c,u._positionZ=m,u._positionX+=p._positionX,u._positionY+=p._positionY,u._positionZ+=p._positionZ;let x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C=n._transform,T=n._localTransform;if(x=d._rotation00*T._rotation00+d._rotation01*T._rotation10+d._rotation02*T._rotation20,g=d._rotation00*T._rotation01+d._rotation01*T._rotation11+d._rotation02*T._rotation21,v=d._rotation00*T._rotation02+d._rotation01*T._rotation12+d._rotation02*T._rotation22,y=d._rotation10*T._rotation00+d._rotation11*T._rotation10+d._rotation12*T._rotation20,X=d._rotation10*T._rotation01+d._rotation11*T._rotation11+d._rotation12*T._rotation21,z=d._rotation10*T._rotation02+d._rotation11*T._rotation12+d._rotation12*T._rotation22,M=d._rotation20*T._rotation00+d._rotation21*T._rotation10+d._rotation22*T._rotation20,Y=d._rotation20*T._rotation01+d._rotation21*T._rotation11+d._rotation22*T._rotation21,Z=d._rotation20*T._rotation02+d._rotation21*T._rotation12+d._rotation22*T._rotation22,C._rotation00=x,C._rotation01=g,C._rotation02=v,C._rotation10=y,C._rotation11=X,C._rotation12=z,C._rotation20=M,C._rotation21=Y,C._rotation22=Z,w=d._rotation00*T._positionX+d._rotation01*T._positionY+d._rotation02*T._positionZ,I=d._rotation10*T._positionX+d._rotation11*T._positionY+d._rotation12*T._positionZ,V=d._rotation20*T._positionX+d._rotation21*T._positionY+d._rotation22*T._positionZ,C._positionX=w,C._positionY=I,C._positionZ=V,C._positionX+=d._positionX,C._positionY+=d._positionY,C._positionZ+=d._positionZ,n._geom._computeAabb(n._aabb,n._ptransform),L=n._aabb._minX,A=n._aabb._minY,k=n._aabb._minZ,S=n._aabb._maxX,B=n._aabb._maxY,P=n._aabb._maxZ,n._geom._computeAabb(n._aabb,n._transform),n._aabb._minX=L<n._aabb._minX?L:n._aabb._minX,n._aabb._minY=A<n._aabb._minY?A:n._aabb._minY,n._aabb._minZ=k<n._aabb._minZ?k:n._aabb._minZ,n._aabb._maxX=S>n._aabb._maxX?S:n._aabb._maxX,n._aabb._maxY=B>n._aabb._maxY?B:n._aabb._maxY,n._aabb._maxZ=P>n._aabb._maxZ?P:n._aabb._maxZ,null!=n._proxy){let t,i,s;t=n._transform._positionX-n._ptransform._positionX,i=n._transform._positionY-n._ptransform._positionY,s=n._transform._positionZ-n._ptransform._positionZ;let a=n.displacement;a.x=t,a.y=i,a.z=s,n._rigidBody._world._broadPhase.moveProxy(n._proxy,n._aabb,n.displacement)}n=b}this._sleeping=!1,this._sleepTime=0}translate(t){let i,s,n;i=t.x,s=t.y,n=t.z,this._transform._positionX+=i,this._transform._positionY+=s,this._transform._positionZ+=n;let a=this._ptransform,o=this._transform;a._positionX=o._positionX,a._positionY=o._positionY,a._positionZ=o._positionZ,a._rotation00=o._rotation00,a._rotation01=o._rotation01,a._rotation02=o._rotation02,a._rotation10=o._rotation10,a._rotation11=o._rotation11,a._rotation12=o._rotation12,a._rotation20=o._rotation20,a._rotation21=o._rotation21,a._rotation22=o._rotation22;let e=this._shapeList;for(;null!=e;){let t,i,s,n,a,o,r,_,h,l,c,m,b=e._next,p=this._ptransform,d=this._transform,u=e._ptransform,f=e._localTransform;t=p._rotation00*f._rotation00+p._rotation01*f._rotation10+p._rotation02*f._rotation20,i=p._rotation00*f._rotation01+p._rotation01*f._rotation11+p._rotation02*f._rotation21,s=p._rotation00*f._rotation02+p._rotation01*f._rotation12+p._rotation02*f._rotation22,n=p._rotation10*f._rotation00+p._rotation11*f._rotation10+p._rotation12*f._rotation20,a=p._rotation10*f._rotation01+p._rotation11*f._rotation11+p._rotation12*f._rotation21,o=p._rotation10*f._rotation02+p._rotation11*f._rotation12+p._rotation12*f._rotation22,r=p._rotation20*f._rotation00+p._rotation21*f._rotation10+p._rotation22*f._rotation20,_=p._rotation20*f._rotation01+p._rotation21*f._rotation11+p._rotation22*f._rotation21,h=p._rotation20*f._rotation02+p._rotation21*f._rotation12+p._rotation22*f._rotation22,u._rotation00=t,u._rotation01=i,u._rotation02=s,u._rotation10=n,u._rotation11=a,u._rotation12=o,u._rotation20=r,u._rotation21=_,u._rotation22=h,l=p._rotation00*f._positionX+p._rotation01*f._positionY+p._rotation02*f._positionZ,c=p._rotation10*f._positionX+p._rotation11*f._positionY+p._rotation12*f._positionZ,m=p._rotation20*f._positionX+p._rotation21*f._positionY+p._rotation22*f._positionZ,u._positionX=l,u._positionY=c,u._positionZ=m,u._positionX+=p._positionX,u._positionY+=p._positionY,u._positionZ+=p._positionZ;let x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C=e._transform,T=e._localTransform;if(x=d._rotation00*T._rotation00+d._rotation01*T._rotation10+d._rotation02*T._rotation20,g=d._rotation00*T._rotation01+d._rotation01*T._rotation11+d._rotation02*T._rotation21,v=d._rotation00*T._rotation02+d._rotation01*T._rotation12+d._rotation02*T._rotation22,y=d._rotation10*T._rotation00+d._rotation11*T._rotation10+d._rotation12*T._rotation20,X=d._rotation10*T._rotation01+d._rotation11*T._rotation11+d._rotation12*T._rotation21,z=d._rotation10*T._rotation02+d._rotation11*T._rotation12+d._rotation12*T._rotation22,M=d._rotation20*T._rotation00+d._rotation21*T._rotation10+d._rotation22*T._rotation20,Y=d._rotation20*T._rotation01+d._rotation21*T._rotation11+d._rotation22*T._rotation21,Z=d._rotation20*T._rotation02+d._rotation21*T._rotation12+d._rotation22*T._rotation22,C._rotation00=x,C._rotation01=g,C._rotation02=v,C._rotation10=y,C._rotation11=X,C._rotation12=z,C._rotation20=M,C._rotation21=Y,C._rotation22=Z,w=d._rotation00*T._positionX+d._rotation01*T._positionY+d._rotation02*T._positionZ,I=d._rotation10*T._positionX+d._rotation11*T._positionY+d._rotation12*T._positionZ,V=d._rotation20*T._positionX+d._rotation21*T._positionY+d._rotation22*T._positionZ,C._positionX=w,C._positionY=I,C._positionZ=V,C._positionX+=d._positionX,C._positionY+=d._positionY,C._positionZ+=d._positionZ,e._geom._computeAabb(e._aabb,e._ptransform),L=e._aabb._minX,A=e._aabb._minY,k=e._aabb._minZ,S=e._aabb._maxX,B=e._aabb._maxY,P=e._aabb._maxZ,e._geom._computeAabb(e._aabb,e._transform),e._aabb._minX=L<e._aabb._minX?L:e._aabb._minX,e._aabb._minY=A<e._aabb._minY?A:e._aabb._minY,e._aabb._minZ=k<e._aabb._minZ?k:e._aabb._minZ,e._aabb._maxX=S>e._aabb._maxX?S:e._aabb._maxX,e._aabb._maxY=B>e._aabb._maxY?B:e._aabb._maxY,e._aabb._maxZ=P>e._aabb._maxZ?P:e._aabb._maxZ,null!=e._proxy){let t,i,s;t=e._transform._positionX-e._ptransform._positionX,i=e._transform._positionY-e._ptransform._positionY,s=e._transform._positionZ-e._ptransform._positionZ;let n=e.displacement;n.x=t,n.y=i,n.z=s,e._rigidBody._world._broadPhase.moveProxy(e._proxy,e._aabb,e.displacement)}e=b}this._sleeping=!1,this._sleepTime=0}getRotation(){let t=new Ut.common.Mat3;return t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22,t}getRotationTo(t){t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22}setRotation(t){let i,s,n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x;this._transform._rotation00=t.e00,this._transform._rotation01=t.e01,this._transform._rotation02=t.e02,this._transform._rotation10=t.e10,this._transform._rotation11=t.e11,this._transform._rotation12=t.e12,this._transform._rotation20=t.e20,this._transform._rotation21=t.e21,this._transform._rotation22=t.e22,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,s=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,n=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,a=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,o=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,e=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,r=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=s,this._invInertia02=n,this._invInertia10=a,this._invInertia11=o,this._invInertia12=e,this._invInertia20=r,this._invInertia21=_,this._invInertia22=h,l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,b=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,p=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,d=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,u=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,f=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,x=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=c,this._invInertia02=m,this._invInertia10=b,this._invInertia11=p,this._invInertia12=d,this._invInertia20=u,this._invInertia21=f,this._invInertia22=x,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let g=this._ptransform,v=this._transform;g._positionX=v._positionX,g._positionY=v._positionY,g._positionZ=v._positionZ,g._rotation00=v._rotation00,g._rotation01=v._rotation01,g._rotation02=v._rotation02,g._rotation10=v._rotation10,g._rotation11=v._rotation11,g._rotation12=v._rotation12,g._rotation20=v._rotation20,g._rotation21=v._rotation21,g._rotation22=v._rotation22;let y=this._shapeList;for(;null!=y;){let t,i,s,n,a,o,e,r,_,h,l,c,m=y._next,b=this._ptransform,p=this._transform,d=y._ptransform,u=y._localTransform;t=b._rotation00*u._rotation00+b._rotation01*u._rotation10+b._rotation02*u._rotation20,i=b._rotation00*u._rotation01+b._rotation01*u._rotation11+b._rotation02*u._rotation21,s=b._rotation00*u._rotation02+b._rotation01*u._rotation12+b._rotation02*u._rotation22,n=b._rotation10*u._rotation00+b._rotation11*u._rotation10+b._rotation12*u._rotation20,a=b._rotation10*u._rotation01+b._rotation11*u._rotation11+b._rotation12*u._rotation21,o=b._rotation10*u._rotation02+b._rotation11*u._rotation12+b._rotation12*u._rotation22,e=b._rotation20*u._rotation00+b._rotation21*u._rotation10+b._rotation22*u._rotation20,r=b._rotation20*u._rotation01+b._rotation21*u._rotation11+b._rotation22*u._rotation21,_=b._rotation20*u._rotation02+b._rotation21*u._rotation12+b._rotation22*u._rotation22,d._rotation00=t,d._rotation01=i,d._rotation02=s,d._rotation10=n,d._rotation11=a,d._rotation12=o,d._rotation20=e,d._rotation21=r,d._rotation22=_,h=b._rotation00*u._positionX+b._rotation01*u._positionY+b._rotation02*u._positionZ,l=b._rotation10*u._positionX+b._rotation11*u._positionY+b._rotation12*u._positionZ,c=b._rotation20*u._positionX+b._rotation21*u._positionY+b._rotation22*u._positionZ,d._positionX=h,d._positionY=l,d._positionZ=c,d._positionX+=b._positionX,d._positionY+=b._positionY,d._positionZ+=b._positionZ;let f,x,g,v,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C=y._transform,T=y._localTransform;if(f=p._rotation00*T._rotation00+p._rotation01*T._rotation10+p._rotation02*T._rotation20,x=p._rotation00*T._rotation01+p._rotation01*T._rotation11+p._rotation02*T._rotation21,g=p._rotation00*T._rotation02+p._rotation01*T._rotation12+p._rotation02*T._rotation22,v=p._rotation10*T._rotation00+p._rotation11*T._rotation10+p._rotation12*T._rotation20,X=p._rotation10*T._rotation01+p._rotation11*T._rotation11+p._rotation12*T._rotation21,z=p._rotation10*T._rotation02+p._rotation11*T._rotation12+p._rotation12*T._rotation22,M=p._rotation20*T._rotation00+p._rotation21*T._rotation10+p._rotation22*T._rotation20,Y=p._rotation20*T._rotation01+p._rotation21*T._rotation11+p._rotation22*T._rotation21,Z=p._rotation20*T._rotation02+p._rotation21*T._rotation12+p._rotation22*T._rotation22,C._rotation00=f,C._rotation01=x,C._rotation02=g,C._rotation10=v,C._rotation11=X,C._rotation12=z,C._rotation20=M,C._rotation21=Y,C._rotation22=Z,w=p._rotation00*T._positionX+p._rotation01*T._positionY+p._rotation02*T._positionZ,I=p._rotation10*T._positionX+p._rotation11*T._positionY+p._rotation12*T._positionZ,V=p._rotation20*T._positionX+p._rotation21*T._positionY+p._rotation22*T._positionZ,C._positionX=w,C._positionY=I,C._positionZ=V,C._positionX+=p._positionX,C._positionY+=p._positionY,C._positionZ+=p._positionZ,y._geom._computeAabb(y._aabb,y._ptransform),L=y._aabb._minX,A=y._aabb._minY,k=y._aabb._minZ,S=y._aabb._maxX,B=y._aabb._maxY,P=y._aabb._maxZ,y._geom._computeAabb(y._aabb,y._transform),y._aabb._minX=L<y._aabb._minX?L:y._aabb._minX,y._aabb._minY=A<y._aabb._minY?A:y._aabb._minY,y._aabb._minZ=k<y._aabb._minZ?k:y._aabb._minZ,y._aabb._maxX=S>y._aabb._maxX?S:y._aabb._maxX,y._aabb._maxY=B>y._aabb._maxY?B:y._aabb._maxY,y._aabb._maxZ=P>y._aabb._maxZ?P:y._aabb._maxZ,null!=y._proxy){let t,i,s;t=y._transform._positionX-y._ptransform._positionX,i=y._transform._positionY-y._ptransform._positionY,s=y._transform._positionZ-y._ptransform._positionZ;let n=y.displacement;n.x=t,n.y=i,n.z=s,y._rigidBody._world._broadPhase.moveProxy(y._proxy,y._aabb,y.displacement)}y=m}this._sleeping=!1,this._sleepTime=0}setRotationXyz(t){let i,s,n;i=t.x,s=t.y,n=t.z;let a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X=Math.sin(i),z=Math.sin(s),M=Math.sin(n),Y=Math.cos(i),Z=Math.cos(s),w=Math.cos(n);this._transform._rotation00=Z*w,this._transform._rotation01=-Z*M,this._transform._rotation02=z,this._transform._rotation10=Y*M+w*X*z,this._transform._rotation11=Y*w-X*z*M,this._transform._rotation12=-Z*X,this._transform._rotation20=X*M-Y*w*z,this._transform._rotation21=w*X+Y*z*M,this._transform._rotation22=Y*Z,a=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,o=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,e=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,r=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,_=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,h=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,l=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,c=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,m=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=a,this._invInertia01=o,this._invInertia02=e,this._invInertia10=r,this._invInertia11=_,this._invInertia12=h,this._invInertia20=l,this._invInertia21=c,this._invInertia22=m,b=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,p=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,d=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,u=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,f=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,x=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,g=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,v=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,y=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=b,this._invInertia01=p,this._invInertia02=d,this._invInertia10=u,this._invInertia11=f,this._invInertia12=x,this._invInertia20=g,this._invInertia21=v,this._invInertia22=y,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let I=this._ptransform,V=this._transform;I._positionX=V._positionX,I._positionY=V._positionY,I._positionZ=V._positionZ,I._rotation00=V._rotation00,I._rotation01=V._rotation01,I._rotation02=V._rotation02,I._rotation10=V._rotation10,I._rotation11=V._rotation11,I._rotation12=V._rotation12,I._rotation20=V._rotation20,I._rotation21=V._rotation21,I._rotation22=V._rotation22;let L=this._shapeList;for(;null!=L;){let t,i,s,n,a,o,e,r,_,h,l,c,m=L._next,b=this._ptransform,p=this._transform,d=L._ptransform,u=L._localTransform;t=b._rotation00*u._rotation00+b._rotation01*u._rotation10+b._rotation02*u._rotation20,i=b._rotation00*u._rotation01+b._rotation01*u._rotation11+b._rotation02*u._rotation21,s=b._rotation00*u._rotation02+b._rotation01*u._rotation12+b._rotation02*u._rotation22,n=b._rotation10*u._rotation00+b._rotation11*u._rotation10+b._rotation12*u._rotation20,a=b._rotation10*u._rotation01+b._rotation11*u._rotation11+b._rotation12*u._rotation21,o=b._rotation10*u._rotation02+b._rotation11*u._rotation12+b._rotation12*u._rotation22,e=b._rotation20*u._rotation00+b._rotation21*u._rotation10+b._rotation22*u._rotation20,r=b._rotation20*u._rotation01+b._rotation21*u._rotation11+b._rotation22*u._rotation21,_=b._rotation20*u._rotation02+b._rotation21*u._rotation12+b._rotation22*u._rotation22,d._rotation00=t,d._rotation01=i,d._rotation02=s,d._rotation10=n,d._rotation11=a,d._rotation12=o,d._rotation20=e,d._rotation21=r,d._rotation22=_,h=b._rotation00*u._positionX+b._rotation01*u._positionY+b._rotation02*u._positionZ,l=b._rotation10*u._positionX+b._rotation11*u._positionY+b._rotation12*u._positionZ,c=b._rotation20*u._positionX+b._rotation21*u._positionY+b._rotation22*u._positionZ,d._positionX=h,d._positionY=l,d._positionZ=c,d._positionX+=b._positionX,d._positionY+=b._positionY,d._positionZ+=b._positionZ;let f,x,g,v,y,X,z,M,Y,Z,w,I,V,A,k,S,B,P,C=L._transform,T=L._localTransform;if(f=p._rotation00*T._rotation00+p._rotation01*T._rotation10+p._rotation02*T._rotation20,x=p._rotation00*T._rotation01+p._rotation01*T._rotation11+p._rotation02*T._rotation21,g=p._rotation00*T._rotation02+p._rotation01*T._rotation12+p._rotation02*T._rotation22,v=p._rotation10*T._rotation00+p._rotation11*T._rotation10+p._rotation12*T._rotation20,y=p._rotation10*T._rotation01+p._rotation11*T._rotation11+p._rotation12*T._rotation21,X=p._rotation10*T._rotation02+p._rotation11*T._rotation12+p._rotation12*T._rotation22,z=p._rotation20*T._rotation00+p._rotation21*T._rotation10+p._rotation22*T._rotation20,M=p._rotation20*T._rotation01+p._rotation21*T._rotation11+p._rotation22*T._rotation21,Y=p._rotation20*T._rotation02+p._rotation21*T._rotation12+p._rotation22*T._rotation22,C._rotation00=f,C._rotation01=x,C._rotation02=g,C._rotation10=v,C._rotation11=y,C._rotation12=X,C._rotation20=z,C._rotation21=M,C._rotation22=Y,Z=p._rotation00*T._positionX+p._rotation01*T._positionY+p._rotation02*T._positionZ,w=p._rotation10*T._positionX+p._rotation11*T._positionY+p._rotation12*T._positionZ,I=p._rotation20*T._positionX+p._rotation21*T._positionY+p._rotation22*T._positionZ,C._positionX=Z,C._positionY=w,C._positionZ=I,C._positionX+=p._positionX,C._positionY+=p._positionY,C._positionZ+=p._positionZ,L._geom._computeAabb(L._aabb,L._ptransform),V=L._aabb._minX,A=L._aabb._minY,k=L._aabb._minZ,S=L._aabb._maxX,B=L._aabb._maxY,P=L._aabb._maxZ,L._geom._computeAabb(L._aabb,L._transform),L._aabb._minX=V<L._aabb._minX?V:L._aabb._minX,L._aabb._minY=A<L._aabb._minY?A:L._aabb._minY,L._aabb._minZ=k<L._aabb._minZ?k:L._aabb._minZ,L._aabb._maxX=S>L._aabb._maxX?S:L._aabb._maxX,L._aabb._maxY=B>L._aabb._maxY?B:L._aabb._maxY,L._aabb._maxZ=P>L._aabb._maxZ?P:L._aabb._maxZ,null!=L._proxy){let t,i,s;t=L._transform._positionX-L._ptransform._positionX,i=L._transform._positionY-L._ptransform._positionY,s=L._transform._positionZ-L._ptransform._positionZ;let n=L.displacement;n.x=t,n.y=i,n.z=s,L._rigidBody._world._broadPhase.moveProxy(L._proxy,L._aabb,L.displacement)}L=m}this._sleeping=!1,this._sleepTime=0}rotate(t){let i,s,n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C;i=t.e00,s=t.e01,n=t.e02,a=t.e10,o=t.e11,e=t.e12,r=t.e20,_=t.e21,h=t.e22,l=i*this._transform._rotation00+s*this._transform._rotation10+n*this._transform._rotation20,c=i*this._transform._rotation01+s*this._transform._rotation11+n*this._transform._rotation21,m=i*this._transform._rotation02+s*this._transform._rotation12+n*this._transform._rotation22,b=a*this._transform._rotation00+o*this._transform._rotation10+e*this._transform._rotation20,p=a*this._transform._rotation01+o*this._transform._rotation11+e*this._transform._rotation21,d=a*this._transform._rotation02+o*this._transform._rotation12+e*this._transform._rotation22,u=r*this._transform._rotation00+_*this._transform._rotation10+h*this._transform._rotation20,f=r*this._transform._rotation01+_*this._transform._rotation11+h*this._transform._rotation21,x=r*this._transform._rotation02+_*this._transform._rotation12+h*this._transform._rotation22,this._transform._rotation00=l,this._transform._rotation01=c,this._transform._rotation02=m,this._transform._rotation10=b,this._transform._rotation11=p,this._transform._rotation12=d,this._transform._rotation20=u,this._transform._rotation21=f,this._transform._rotation22=x,g=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,v=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,y=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,X=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,z=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,M=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,Y=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,Z=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,w=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=g,this._invInertia01=v,this._invInertia02=y,this._invInertia10=X,this._invInertia11=z,this._invInertia12=M,this._invInertia20=Y,this._invInertia21=Z,this._invInertia22=w,I=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,V=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,L=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,A=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,k=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,S=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,B=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,P=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,C=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=I,this._invInertia01=V,this._invInertia02=L,this._invInertia10=A,this._invInertia11=k,this._invInertia12=S,this._invInertia20=B,this._invInertia21=P,this._invInertia22=C,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let T=this._ptransform,j=this._transform;T._positionX=j._positionX,T._positionY=j._positionY,T._positionZ=j._positionZ,T._rotation00=j._rotation00,T._rotation01=j._rotation01,T._rotation02=j._rotation02,T._rotation10=j._rotation10,T._rotation11=j._rotation11,T._rotation12=j._rotation12,T._rotation20=j._rotation20,T._rotation21=j._rotation21,T._rotation22=j._rotation22;let E=this._shapeList;for(;null!=E;){let t,i,s,n,a,o,e,r,_,h,l,c,m=E._next,b=this._ptransform,p=this._transform,d=E._ptransform,u=E._localTransform;t=b._rotation00*u._rotation00+b._rotation01*u._rotation10+b._rotation02*u._rotation20,i=b._rotation00*u._rotation01+b._rotation01*u._rotation11+b._rotation02*u._rotation21,s=b._rotation00*u._rotation02+b._rotation01*u._rotation12+b._rotation02*u._rotation22,n=b._rotation10*u._rotation00+b._rotation11*u._rotation10+b._rotation12*u._rotation20,a=b._rotation10*u._rotation01+b._rotation11*u._rotation11+b._rotation12*u._rotation21,o=b._rotation10*u._rotation02+b._rotation11*u._rotation12+b._rotation12*u._rotation22,e=b._rotation20*u._rotation00+b._rotation21*u._rotation10+b._rotation22*u._rotation20,r=b._rotation20*u._rotation01+b._rotation21*u._rotation11+b._rotation22*u._rotation21,_=b._rotation20*u._rotation02+b._rotation21*u._rotation12+b._rotation22*u._rotation22,d._rotation00=t,d._rotation01=i,d._rotation02=s,d._rotation10=n,d._rotation11=a,d._rotation12=o,d._rotation20=e,d._rotation21=r,d._rotation22=_,h=b._rotation00*u._positionX+b._rotation01*u._positionY+b._rotation02*u._positionZ,l=b._rotation10*u._positionX+b._rotation11*u._positionY+b._rotation12*u._positionZ,c=b._rotation20*u._positionX+b._rotation21*u._positionY+b._rotation22*u._positionZ,d._positionX=h,d._positionY=l,d._positionZ=c,d._positionX+=b._positionX,d._positionY+=b._positionY,d._positionZ+=b._positionZ;let f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P=E._transform,C=E._localTransform;if(f=p._rotation00*C._rotation00+p._rotation01*C._rotation10+p._rotation02*C._rotation20,x=p._rotation00*C._rotation01+p._rotation01*C._rotation11+p._rotation02*C._rotation21,g=p._rotation00*C._rotation02+p._rotation01*C._rotation12+p._rotation02*C._rotation22,v=p._rotation10*C._rotation00+p._rotation11*C._rotation10+p._rotation12*C._rotation20,y=p._rotation10*C._rotation01+p._rotation11*C._rotation11+p._rotation12*C._rotation21,X=p._rotation10*C._rotation02+p._rotation11*C._rotation12+p._rotation12*C._rotation22,z=p._rotation20*C._rotation00+p._rotation21*C._rotation10+p._rotation22*C._rotation20,M=p._rotation20*C._rotation01+p._rotation21*C._rotation11+p._rotation22*C._rotation21,Y=p._rotation20*C._rotation02+p._rotation21*C._rotation12+p._rotation22*C._rotation22,P._rotation00=f,P._rotation01=x,P._rotation02=g,P._rotation10=v,P._rotation11=y,P._rotation12=X,P._rotation20=z,P._rotation21=M,P._rotation22=Y,Z=p._rotation00*C._positionX+p._rotation01*C._positionY+p._rotation02*C._positionZ,w=p._rotation10*C._positionX+p._rotation11*C._positionY+p._rotation12*C._positionZ,I=p._rotation20*C._positionX+p._rotation21*C._positionY+p._rotation22*C._positionZ,P._positionX=Z,P._positionY=w,P._positionZ=I,P._positionX+=p._positionX,P._positionY+=p._positionY,P._positionZ+=p._positionZ,E._geom._computeAabb(E._aabb,E._ptransform),V=E._aabb._minX,L=E._aabb._minY,A=E._aabb._minZ,k=E._aabb._maxX,S=E._aabb._maxY,B=E._aabb._maxZ,E._geom._computeAabb(E._aabb,E._transform),E._aabb._minX=V<E._aabb._minX?V:E._aabb._minX,E._aabb._minY=L<E._aabb._minY?L:E._aabb._minY,E._aabb._minZ=A<E._aabb._minZ?A:E._aabb._minZ,E._aabb._maxX=k>E._aabb._maxX?k:E._aabb._maxX,E._aabb._maxY=S>E._aabb._maxY?S:E._aabb._maxY,E._aabb._maxZ=B>E._aabb._maxZ?B:E._aabb._maxZ,null!=E._proxy){let t,i,s;t=E._transform._positionX-E._ptransform._positionX,i=E._transform._positionY-E._ptransform._positionY,s=E._transform._positionZ-E._ptransform._positionZ;let n=E.displacement;n.x=t,n.y=i,n.z=s,E._rigidBody._world._broadPhase.moveProxy(E._proxy,E._aabb,E.displacement)}E=m}this._sleeping=!1,this._sleepTime=0}rotateXyz(t){let i,s,n,a,o,e,r,_,h,l,c,m;i=t.x,s=t.y,n=t.z;let b,p,d,u,f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C,T,j,E,R=Math.sin(i),D=Math.sin(s),F=Math.sin(n),q=Math.cos(i),N=Math.cos(s),H=Math.cos(n);a=N*H,o=-N*F,e=D,r=q*F+H*R*D,_=q*H-R*D*F,h=-N*R,l=R*F-q*H*D,c=H*R+q*D*F,m=q*N,b=a*this._transform._rotation00+o*this._transform._rotation10+e*this._transform._rotation20,p=a*this._transform._rotation01+o*this._transform._rotation11+e*this._transform._rotation21,d=a*this._transform._rotation02+o*this._transform._rotation12+e*this._transform._rotation22,u=r*this._transform._rotation00+_*this._transform._rotation10+h*this._transform._rotation20,f=r*this._transform._rotation01+_*this._transform._rotation11+h*this._transform._rotation21,x=r*this._transform._rotation02+_*this._transform._rotation12+h*this._transform._rotation22,g=l*this._transform._rotation00+c*this._transform._rotation10+m*this._transform._rotation20,v=l*this._transform._rotation01+c*this._transform._rotation11+m*this._transform._rotation21,y=l*this._transform._rotation02+c*this._transform._rotation12+m*this._transform._rotation22,this._transform._rotation00=b,this._transform._rotation01=p,this._transform._rotation02=d,this._transform._rotation10=u,this._transform._rotation11=f,this._transform._rotation12=x,this._transform._rotation20=g,this._transform._rotation21=v,this._transform._rotation22=y,X=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,z=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,M=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,Y=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,Z=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,w=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,I=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,V=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,L=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=X,this._invInertia01=z,this._invInertia02=M,this._invInertia10=Y,this._invInertia11=Z,this._invInertia12=w,this._invInertia20=I,this._invInertia21=V,this._invInertia22=L,A=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,k=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,S=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,B=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,P=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,C=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,T=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,j=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,E=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=A,this._invInertia01=k,this._invInertia02=S,this._invInertia10=B,this._invInertia11=P,this._invInertia12=C,this._invInertia20=T,this._invInertia21=j,this._invInertia22=E,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let O=this._ptransform,W=this._transform;O._positionX=W._positionX,O._positionY=W._positionY,O._positionZ=W._positionZ,O._rotation00=W._rotation00,O._rotation01=W._rotation01,O._rotation02=W._rotation02,O._rotation10=W._rotation10,O._rotation11=W._rotation11,O._rotation12=W._rotation12,O._rotation20=W._rotation20,O._rotation21=W._rotation21,O._rotation22=W._rotation22;let G=this._shapeList;for(;null!=G;){let t,i,s,n,a,o,e,r,_,h,l,c,m=G._next,b=this._ptransform,p=this._transform,d=G._ptransform,u=G._localTransform;t=b._rotation00*u._rotation00+b._rotation01*u._rotation10+b._rotation02*u._rotation20,i=b._rotation00*u._rotation01+b._rotation01*u._rotation11+b._rotation02*u._rotation21,s=b._rotation00*u._rotation02+b._rotation01*u._rotation12+b._rotation02*u._rotation22,n=b._rotation10*u._rotation00+b._rotation11*u._rotation10+b._rotation12*u._rotation20,a=b._rotation10*u._rotation01+b._rotation11*u._rotation11+b._rotation12*u._rotation21,o=b._rotation10*u._rotation02+b._rotation11*u._rotation12+b._rotation12*u._rotation22,e=b._rotation20*u._rotation00+b._rotation21*u._rotation10+b._rotation22*u._rotation20,r=b._rotation20*u._rotation01+b._rotation21*u._rotation11+b._rotation22*u._rotation21,_=b._rotation20*u._rotation02+b._rotation21*u._rotation12+b._rotation22*u._rotation22,d._rotation00=t,d._rotation01=i,d._rotation02=s,d._rotation10=n,d._rotation11=a,d._rotation12=o,d._rotation20=e,d._rotation21=r,d._rotation22=_,h=b._rotation00*u._positionX+b._rotation01*u._positionY+b._rotation02*u._positionZ,l=b._rotation10*u._positionX+b._rotation11*u._positionY+b._rotation12*u._positionZ,c=b._rotation20*u._positionX+b._rotation21*u._positionY+b._rotation22*u._positionZ,d._positionX=h,d._positionY=l,d._positionZ=c,d._positionX+=b._positionX,d._positionY+=b._positionY,d._positionZ+=b._positionZ;let f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P=G._transform,C=G._localTransform;if(f=p._rotation00*C._rotation00+p._rotation01*C._rotation10+p._rotation02*C._rotation20,x=p._rotation00*C._rotation01+p._rotation01*C._rotation11+p._rotation02*C._rotation21,g=p._rotation00*C._rotation02+p._rotation01*C._rotation12+p._rotation02*C._rotation22,v=p._rotation10*C._rotation00+p._rotation11*C._rotation10+p._rotation12*C._rotation20,y=p._rotation10*C._rotation01+p._rotation11*C._rotation11+p._rotation12*C._rotation21,X=p._rotation10*C._rotation02+p._rotation11*C._rotation12+p._rotation12*C._rotation22,z=p._rotation20*C._rotation00+p._rotation21*C._rotation10+p._rotation22*C._rotation20,M=p._rotation20*C._rotation01+p._rotation21*C._rotation11+p._rotation22*C._rotation21,Y=p._rotation20*C._rotation02+p._rotation21*C._rotation12+p._rotation22*C._rotation22,P._rotation00=f,P._rotation01=x,P._rotation02=g,P._rotation10=v,P._rotation11=y,P._rotation12=X,P._rotation20=z,P._rotation21=M,P._rotation22=Y,Z=p._rotation00*C._positionX+p._rotation01*C._positionY+p._rotation02*C._positionZ,w=p._rotation10*C._positionX+p._rotation11*C._positionY+p._rotation12*C._positionZ,I=p._rotation20*C._positionX+p._rotation21*C._positionY+p._rotation22*C._positionZ,P._positionX=Z,P._positionY=w,P._positionZ=I,P._positionX+=p._positionX,P._positionY+=p._positionY,P._positionZ+=p._positionZ,G._geom._computeAabb(G._aabb,G._ptransform),V=G._aabb._minX,L=G._aabb._minY,A=G._aabb._minZ,k=G._aabb._maxX,S=G._aabb._maxY,B=G._aabb._maxZ,G._geom._computeAabb(G._aabb,G._transform),G._aabb._minX=V<G._aabb._minX?V:G._aabb._minX,G._aabb._minY=L<G._aabb._minY?L:G._aabb._minY,G._aabb._minZ=A<G._aabb._minZ?A:G._aabb._minZ,G._aabb._maxX=k>G._aabb._maxX?k:G._aabb._maxX,G._aabb._maxY=S>G._aabb._maxY?S:G._aabb._maxY,G._aabb._maxZ=B>G._aabb._maxZ?B:G._aabb._maxZ,null!=G._proxy){let t,i,s;t=G._transform._positionX-G._ptransform._positionX,i=G._transform._positionY-G._ptransform._positionY,s=G._transform._positionZ-G._ptransform._positionZ;let n=G.displacement;n.x=t,n.y=i,n.z=s,G._rigidBody._world._broadPhase.moveProxy(G._proxy,G._aabb,G.displacement)}G=m}this._sleeping=!1,this._sleepTime=0}getOrientation(){let t,i,s,n,a,o=new Ut.common.Quat,e=this._transform._rotation00,r=this._transform._rotation11,_=this._transform._rotation22,h=e+r+_;return h>0?(a=Math.sqrt(h+1),n=.5*a,a=.5/a,t=(this._transform._rotation21-this._transform._rotation12)*a,i=(this._transform._rotation02-this._transform._rotation20)*a,s=(this._transform._rotation10-this._transform._rotation01)*a):e>r?e>_?(a=Math.sqrt(e-r-_+1),t=.5*a,a=.5/a,i=(this._transform._rotation01+this._transform._rotation10)*a,s=(this._transform._rotation02+this._transform._rotation20)*a,n=(this._transform._rotation21-this._transform._rotation12)*a):(a=Math.sqrt(_-e-r+1),s=.5*a,a=.5/a,t=(this._transform._rotation02+this._transform._rotation20)*a,i=(this._transform._rotation12+this._transform._rotation21)*a,n=(this._transform._rotation10-this._transform._rotation01)*a):r>_?(a=Math.sqrt(r-_-e+1),i=.5*a,a=.5/a,t=(this._transform._rotation01+this._transform._rotation10)*a,s=(this._transform._rotation12+this._transform._rotation21)*a,n=(this._transform._rotation02-this._transform._rotation20)*a):(a=Math.sqrt(_-e-r+1),s=.5*a,a=.5/a,t=(this._transform._rotation02+this._transform._rotation20)*a,i=(this._transform._rotation12+this._transform._rotation21)*a,n=(this._transform._rotation10-this._transform._rotation01)*a),o.x=t,o.y=i,o.z=s,o.w=n,o}getOrientationTo(t){let i,s,n,a,o,e=this._transform._rotation00,r=this._transform._rotation11,_=this._transform._rotation22,h=e+r+_;h>0?(o=Math.sqrt(h+1),a=.5*o,o=.5/o,i=(this._transform._rotation21-this._transform._rotation12)*o,s=(this._transform._rotation02-this._transform._rotation20)*o,n=(this._transform._rotation10-this._transform._rotation01)*o):e>r?e>_?(o=Math.sqrt(e-r-_+1),i=.5*o,o=.5/o,s=(this._transform._rotation01+this._transform._rotation10)*o,n=(this._transform._rotation02+this._transform._rotation20)*o,a=(this._transform._rotation21-this._transform._rotation12)*o):(o=Math.sqrt(_-e-r+1),n=.5*o,o=.5/o,i=(this._transform._rotation02+this._transform._rotation20)*o,s=(this._transform._rotation12+this._transform._rotation21)*o,a=(this._transform._rotation10-this._transform._rotation01)*o):r>_?(o=Math.sqrt(r-_-e+1),s=.5*o,o=.5/o,i=(this._transform._rotation01+this._transform._rotation10)*o,n=(this._transform._rotation12+this._transform._rotation21)*o,a=(this._transform._rotation02-this._transform._rotation20)*o):(o=Math.sqrt(_-e-r+1),n=.5*o,o=.5/o,i=(this._transform._rotation02+this._transform._rotation20)*o,s=(this._transform._rotation12+this._transform._rotation21)*o,a=(this._transform._rotation10-this._transform._rotation01)*o),t.x=i,t.y=s,t.z=n,t.w=a}setOrientation(t){let i,s,n,a;i=t.x,s=t.y,n=t.z,a=t.w;let o,e,r,_,h,l,c,m,b,p,d,u,f,x,g,v,y,X,z=2*i,M=2*s,Y=2*n,Z=i*z,w=s*M,I=n*Y,V=i*M,L=s*Y,A=i*Y,k=a*z,S=a*M,B=a*Y;this._transform._rotation00=1-w-I,this._transform._rotation01=V-B,this._transform._rotation02=A+S,this._transform._rotation10=V+B,this._transform._rotation11=1-Z-I,this._transform._rotation12=L-k,this._transform._rotation20=A-S,this._transform._rotation21=L+k,this._transform._rotation22=1-Z-w,o=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,e=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,r=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,_=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,h=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,l=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,c=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,m=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,b=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=o,this._invInertia01=e,this._invInertia02=r,this._invInertia10=_,this._invInertia11=h,this._invInertia12=l,this._invInertia20=c,this._invInertia21=m,this._invInertia22=b,p=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,d=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,u=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,f=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,x=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,g=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,v=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,y=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,X=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=p,this._invInertia01=d,this._invInertia02=u,this._invInertia10=f,this._invInertia11=x,this._invInertia12=g,this._invInertia20=v,this._invInertia21=y,this._invInertia22=X,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let P=this._ptransform,C=this._transform;P._positionX=C._positionX,P._positionY=C._positionY,P._positionZ=C._positionZ,P._rotation00=C._rotation00,P._rotation01=C._rotation01,P._rotation02=C._rotation02,P._rotation10=C._rotation10,P._rotation11=C._rotation11,P._rotation12=C._rotation12,P._rotation20=C._rotation20,P._rotation21=C._rotation21,P._rotation22=C._rotation22;let T=this._shapeList;for(;null!=T;){let t,i,s,n,a,o,e,r,_,h,l,c,m=T._next,b=this._ptransform,p=this._transform,d=T._ptransform,u=T._localTransform;t=b._rotation00*u._rotation00+b._rotation01*u._rotation10+b._rotation02*u._rotation20,i=b._rotation00*u._rotation01+b._rotation01*u._rotation11+b._rotation02*u._rotation21,s=b._rotation00*u._rotation02+b._rotation01*u._rotation12+b._rotation02*u._rotation22,n=b._rotation10*u._rotation00+b._rotation11*u._rotation10+b._rotation12*u._rotation20,a=b._rotation10*u._rotation01+b._rotation11*u._rotation11+b._rotation12*u._rotation21,o=b._rotation10*u._rotation02+b._rotation11*u._rotation12+b._rotation12*u._rotation22,e=b._rotation20*u._rotation00+b._rotation21*u._rotation10+b._rotation22*u._rotation20,r=b._rotation20*u._rotation01+b._rotation21*u._rotation11+b._rotation22*u._rotation21,_=b._rotation20*u._rotation02+b._rotation21*u._rotation12+b._rotation22*u._rotation22,d._rotation00=t,d._rotation01=i,d._rotation02=s,d._rotation10=n,d._rotation11=a,d._rotation12=o,d._rotation20=e,d._rotation21=r,d._rotation22=_,h=b._rotation00*u._positionX+b._rotation01*u._positionY+b._rotation02*u._positionZ,l=b._rotation10*u._positionX+b._rotation11*u._positionY+b._rotation12*u._positionZ,c=b._rotation20*u._positionX+b._rotation21*u._positionY+b._rotation22*u._positionZ,d._positionX=h,d._positionY=l,d._positionZ=c,d._positionX+=b._positionX,d._positionY+=b._positionY,d._positionZ+=b._positionZ;let f,x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P=T._transform,C=T._localTransform;if(f=p._rotation00*C._rotation00+p._rotation01*C._rotation10+p._rotation02*C._rotation20,x=p._rotation00*C._rotation01+p._rotation01*C._rotation11+p._rotation02*C._rotation21,g=p._rotation00*C._rotation02+p._rotation01*C._rotation12+p._rotation02*C._rotation22,v=p._rotation10*C._rotation00+p._rotation11*C._rotation10+p._rotation12*C._rotation20,y=p._rotation10*C._rotation01+p._rotation11*C._rotation11+p._rotation12*C._rotation21,X=p._rotation10*C._rotation02+p._rotation11*C._rotation12+p._rotation12*C._rotation22,z=p._rotation20*C._rotation00+p._rotation21*C._rotation10+p._rotation22*C._rotation20,M=p._rotation20*C._rotation01+p._rotation21*C._rotation11+p._rotation22*C._rotation21,Y=p._rotation20*C._rotation02+p._rotation21*C._rotation12+p._rotation22*C._rotation22,P._rotation00=f,P._rotation01=x,P._rotation02=g,P._rotation10=v,P._rotation11=y,P._rotation12=X,P._rotation20=z,P._rotation21=M,P._rotation22=Y,Z=p._rotation00*C._positionX+p._rotation01*C._positionY+p._rotation02*C._positionZ,w=p._rotation10*C._positionX+p._rotation11*C._positionY+p._rotation12*C._positionZ,I=p._rotation20*C._positionX+p._rotation21*C._positionY+p._rotation22*C._positionZ,P._positionX=Z,P._positionY=w,P._positionZ=I,P._positionX+=p._positionX,P._positionY+=p._positionY,P._positionZ+=p._positionZ,T._geom._computeAabb(T._aabb,T._ptransform),V=T._aabb._minX,L=T._aabb._minY,A=T._aabb._minZ,k=T._aabb._maxX,S=T._aabb._maxY,B=T._aabb._maxZ,T._geom._computeAabb(T._aabb,T._transform),T._aabb._minX=V<T._aabb._minX?V:T._aabb._minX,T._aabb._minY=L<T._aabb._minY?L:T._aabb._minY,T._aabb._minZ=A<T._aabb._minZ?A:T._aabb._minZ,T._aabb._maxX=k>T._aabb._maxX?k:T._aabb._maxX,T._aabb._maxY=S>T._aabb._maxY?S:T._aabb._maxY,T._aabb._maxZ=B>T._aabb._maxZ?B:T._aabb._maxZ,null!=T._proxy){let t,i,s;t=T._transform._positionX-T._ptransform._positionX,i=T._transform._positionY-T._ptransform._positionY,s=T._transform._positionZ-T._ptransform._positionZ;let n=T.displacement;n.x=t,n.y=i,n.z=s,T._rigidBody._world._broadPhase.moveProxy(T._proxy,T._aabb,T.displacement)}T=m}this._sleeping=!1,this._sleepTime=0}getTransform(){let t=this._transform,i=new Ut.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i}getTransformTo(t){let i=this._transform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}setTransform(t){let i,s,n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x;this._transform._positionX=t._positionX,this._transform._positionY=t._positionY,this._transform._positionZ=t._positionZ,this._transform._rotation00=t._rotation00,this._transform._rotation01=t._rotation01,this._transform._rotation02=t._rotation02,this._transform._rotation10=t._rotation10,this._transform._rotation11=t._rotation11,this._transform._rotation12=t._rotation12,this._transform._rotation20=t._rotation20,this._transform._rotation21=t._rotation21,this._transform._rotation22=t._rotation22,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,s=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,n=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,a=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,o=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,e=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,r=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=s,this._invInertia02=n,this._invInertia10=a,this._invInertia11=o,this._invInertia12=e,this._invInertia20=r,this._invInertia21=_,this._invInertia22=h,l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,b=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,p=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,d=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,u=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,f=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,x=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=c,this._invInertia02=m,this._invInertia10=b,this._invInertia11=p,this._invInertia12=d,this._invInertia20=u,this._invInertia21=f,this._invInertia22=x,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let g=this._ptransform,v=this._transform;g._positionX=v._positionX,g._positionY=v._positionY,g._positionZ=v._positionZ,g._rotation00=v._rotation00,g._rotation01=v._rotation01,g._rotation02=v._rotation02,g._rotation10=v._rotation10,g._rotation11=v._rotation11,g._rotation12=v._rotation12,g._rotation20=v._rotation20,g._rotation21=v._rotation21,g._rotation22=v._rotation22;let y=this._shapeList;for(;null!=y;){let t,i,s,n,a,o,e,r,_,h,l,c,m=y._next,b=this._ptransform,p=this._transform,d=y._ptransform,u=y._localTransform;t=b._rotation00*u._rotation00+b._rotation01*u._rotation10+b._rotation02*u._rotation20,i=b._rotation00*u._rotation01+b._rotation01*u._rotation11+b._rotation02*u._rotation21,s=b._rotation00*u._rotation02+b._rotation01*u._rotation12+b._rotation02*u._rotation22,n=b._rotation10*u._rotation00+b._rotation11*u._rotation10+b._rotation12*u._rotation20,a=b._rotation10*u._rotation01+b._rotation11*u._rotation11+b._rotation12*u._rotation21,o=b._rotation10*u._rotation02+b._rotation11*u._rotation12+b._rotation12*u._rotation22,e=b._rotation20*u._rotation00+b._rotation21*u._rotation10+b._rotation22*u._rotation20,r=b._rotation20*u._rotation01+b._rotation21*u._rotation11+b._rotation22*u._rotation21,_=b._rotation20*u._rotation02+b._rotation21*u._rotation12+b._rotation22*u._rotation22,d._rotation00=t,d._rotation01=i,d._rotation02=s,d._rotation10=n,d._rotation11=a,d._rotation12=o,d._rotation20=e,d._rotation21=r,d._rotation22=_,h=b._rotation00*u._positionX+b._rotation01*u._positionY+b._rotation02*u._positionZ,l=b._rotation10*u._positionX+b._rotation11*u._positionY+b._rotation12*u._positionZ,c=b._rotation20*u._positionX+b._rotation21*u._positionY+b._rotation22*u._positionZ,d._positionX=h,d._positionY=l,d._positionZ=c,d._positionX+=b._positionX,d._positionY+=b._positionY,d._positionZ+=b._positionZ;let f,x,g,v,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C=y._transform,T=y._localTransform;if(f=p._rotation00*T._rotation00+p._rotation01*T._rotation10+p._rotation02*T._rotation20,x=p._rotation00*T._rotation01+p._rotation01*T._rotation11+p._rotation02*T._rotation21,g=p._rotation00*T._rotation02+p._rotation01*T._rotation12+p._rotation02*T._rotation22,v=p._rotation10*T._rotation00+p._rotation11*T._rotation10+p._rotation12*T._rotation20,X=p._rotation10*T._rotation01+p._rotation11*T._rotation11+p._rotation12*T._rotation21,z=p._rotation10*T._rotation02+p._rotation11*T._rotation12+p._rotation12*T._rotation22,M=p._rotation20*T._rotation00+p._rotation21*T._rotation10+p._rotation22*T._rotation20,Y=p._rotation20*T._rotation01+p._rotation21*T._rotation11+p._rotation22*T._rotation21,Z=p._rotation20*T._rotation02+p._rotation21*T._rotation12+p._rotation22*T._rotation22,C._rotation00=f,C._rotation01=x,C._rotation02=g,C._rotation10=v,C._rotation11=X,C._rotation12=z,C._rotation20=M,C._rotation21=Y,C._rotation22=Z,w=p._rotation00*T._positionX+p._rotation01*T._positionY+p._rotation02*T._positionZ,I=p._rotation10*T._positionX+p._rotation11*T._positionY+p._rotation12*T._positionZ,V=p._rotation20*T._positionX+p._rotation21*T._positionY+p._rotation22*T._positionZ,C._positionX=w,C._positionY=I,C._positionZ=V,C._positionX+=p._positionX,C._positionY+=p._positionY,C._positionZ+=p._positionZ,y._geom._computeAabb(y._aabb,y._ptransform),L=y._aabb._minX,A=y._aabb._minY,k=y._aabb._minZ,S=y._aabb._maxX,B=y._aabb._maxY,P=y._aabb._maxZ,y._geom._computeAabb(y._aabb,y._transform),y._aabb._minX=L<y._aabb._minX?L:y._aabb._minX,y._aabb._minY=A<y._aabb._minY?A:y._aabb._minY,y._aabb._minZ=k<y._aabb._minZ?k:y._aabb._minZ,y._aabb._maxX=S>y._aabb._maxX?S:y._aabb._maxX,y._aabb._maxY=B>y._aabb._maxY?B:y._aabb._maxY,y._aabb._maxZ=P>y._aabb._maxZ?P:y._aabb._maxZ,null!=y._proxy){let t,i,s;t=y._transform._positionX-y._ptransform._positionX,i=y._transform._positionY-y._ptransform._positionY,s=y._transform._positionZ-y._ptransform._positionZ;let n=y.displacement;n.x=t,n.y=i,n.z=s,y._rigidBody._world._broadPhase.moveProxy(y._proxy,y._aabb,y.displacement)}y=m}this._sleeping=!1,this._sleepTime=0}getMass(){return this._mass}getLocalInertia(){let t=new Ut.common.Mat3;return t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22,t}getLocalInertiaTo(t){t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22}getMassData(){let t=new Ut.dynamics.rigidbody.MassData;t.mass=this._mass;let i=t.localInertia;return i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22,t}getMassDataTo(t){t.mass=this._mass;let i=t.localInertia;i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22}setMassData(t){this._mass=t.mass;let i,s,n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g=t.localInertia;if(this._localInertia00=g.e00,this._localInertia01=g.e01,this._localInertia02=g.e02,this._localInertia10=g.e10,this._localInertia11=g.e11,this._localInertia12=g.e12,this._localInertia20=g.e20,this._localInertia21=g.e21,this._localInertia22=g.e22,this._mass>0&&this._localInertia00*(this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21)-this._localInertia01*(this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20)+this._localInertia02*(this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20)>0&&0==this._type){this._invMass=1/this._mass;let t=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,i=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,s=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,n=this._localInertia00*t-this._localInertia01*i+this._localInertia02*s;(n<-1e-32||n>1e-32)&&(n=1/n),this._invLocalInertia00=t*n,this._invLocalInertia01=-(this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21)*n,this._invLocalInertia02=(this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11)*n,this._invLocalInertia10=-i*n,this._invLocalInertia11=(this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20)*n,this._invLocalInertia12=-(this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10)*n,this._invLocalInertia20=s*n,this._invLocalInertia21=-(this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20)*n,this._invLocalInertia22=(this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10)*n,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,0==this._type&&(this._type=1);i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,s=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,n=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,a=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,o=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,e=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,r=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=s,this._invInertia02=n,this._invInertia10=a,this._invInertia11=o,this._invInertia12=e,this._invInertia20=r,this._invInertia21=_,this._invInertia22=h,l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,b=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,p=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,d=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,u=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,f=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,x=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=c,this._invInertia02=m,this._invInertia10=b,this._invInertia11=p,this._invInertia12=d,this._invInertia20=u,this._invInertia21=f,this._invInertia22=x,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getRotationFactor(){let t=this._rotFactor;return new Ut.common.Vec3(t.x,t.y,t.z)}setRotationFactor(t){let i,s,n,a,o,e,r,_,h,l,c,m,b,p,d,u,f,x,g=this._rotFactor;g.x=t.x,g.y=t.y,g.z=t.z,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,s=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,n=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,a=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,o=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,e=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,r=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=s,this._invInertia02=n,this._invInertia10=a,this._invInertia11=o,this._invInertia12=e,this._invInertia20=r,this._invInertia21=_,this._invInertia22=h,l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,b=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,p=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,d=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,u=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,f=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,x=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=c,this._invInertia02=m,this._invInertia10=b,this._invInertia11=p,this._invInertia12=d,this._invInertia20=u,this._invInertia21=f,this._invInertia22=x,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getLinearVelocity(){let t=new Ut.common.Vec3;return t.x=this._velX,t.y=this._velY,t.z=this._velZ,t}getLinearVelocityTo(t){t.x=this._velX,t.y=this._velY,t.z=this._velZ}setLinearVelocity(t){1==this._type?(this._velX=0,this._velY=0,this._velZ=0):(this._velX=t.x,this._velY=t.y,this._velZ=t.z),this._sleeping=!1,this._sleepTime=0}getAngularVelocity(){let t=new Ut.common.Vec3;return t.x=this._angVelX,t.y=this._angVelY,t.z=this._angVelZ,t}getAngularVelocityTo(t){t.x=this._velX,t.y=this._velY,t.z=this._velZ}setAngularVelocity(t){1==this._type?(this._angVelX=0,this._angVelY=0,this._angVelZ=0):(this._angVelX=t.x,this._angVelY=t.y,this._angVelZ=t.z),this._sleeping=!1,this._sleepTime=0}addLinearVelocity(t){if(1!=this._type){let i,s,n;i=t.x,s=t.y,n=t.z,this._velX+=i,this._velY+=s,this._velZ+=n}this._sleeping=!1,this._sleepTime=0}addAngularVelocity(t){if(1!=this._type){let i,s,n;i=t.x,s=t.y,n=t.z,this._angVelX+=i,this._angVelY+=s,this._angVelZ+=n}this._sleeping=!1,this._sleepTime=0}applyImpulse(t,i){let s,n,a,o,e,r,_,h,l,c,m,b;s=t.x,n=t.y,a=t.z,this._velX+=s*this._invMass,this._velY+=n*this._invMass,this._velZ+=a*this._invMass,_=i.x,h=i.y,l=i.z,_-=this._transform._positionX,h-=this._transform._positionY,l-=this._transform._positionZ,o=h*a-l*n,e=l*s-_*a,r=_*n-h*s,c=this._invInertia00*o+this._invInertia01*e+this._invInertia02*r,m=this._invInertia10*o+this._invInertia11*e+this._invInertia12*r,b=this._invInertia20*o+this._invInertia21*e+this._invInertia22*r,o=c,e=m,r=b,this._angVelX+=o,this._angVelY+=e,this._angVelZ+=r,this._sleeping=!1,this._sleepTime=0}applyLinearImpulse(t){let i,s,n;i=t.x,s=t.y,n=t.z,this._velX+=i*this._invMass,this._velY+=s*this._invMass,this._velZ+=n*this._invMass,this._sleeping=!1,this._sleepTime=0}applyAngularImpulse(t){let i,s,n,a,o,e;i=t.x,s=t.y,n=t.z,a=this._invInertia00*i+this._invInertia01*s+this._invInertia02*n,o=this._invInertia10*i+this._invInertia11*s+this._invInertia12*n,e=this._invInertia20*i+this._invInertia21*s+this._invInertia22*n,i=a,s=o,n=e,this._angVelX+=i,this._angVelY+=s,this._angVelZ+=n,this._sleeping=!1,this._sleepTime=0}applyForce(t,i){let s,n,a,o,e,r,_,h,l;s=t.x,n=t.y,a=t.z,this._forceX+=s,this._forceY+=n,this._forceZ+=a,_=i.x,h=i.y,l=i.z,_-=this._transform._positionX,h-=this._transform._positionY,l-=this._transform._positionZ,o=h*a-l*n,e=l*s-_*a,r=_*n-h*s,this._torqueX+=o,this._torqueY+=e,this._torqueZ+=r,this._sleeping=!1,this._sleepTime=0}applyForceToCenter(t){let i,s,n;i=t.x,s=t.y,n=t.z,this._forceX+=i,this._forceY+=s,this._forceZ+=n,this._sleeping=!1,this._sleepTime=0}applyTorque(t){let i,s,n;i=t.x,s=t.y,n=t.z,this._torqueX+=i,this._torqueY+=s,this._torqueZ+=n,this._sleeping=!1,this._sleepTime=0}getLinearContactImpulse(){let t=new Ut.common.Vec3;return t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ,t}getLinearContactImpulseTo(t){t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ}getAngularContactImpulse(){let t=new Ut.common.Vec3;return t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ,t}getAngularContactImpulseTo(t){t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ}getGravityScale(){return this._gravityScale}setGravityScale(t){this._gravityScale=t,this._sleeping=!1,this._sleepTime=0}getLocalPoint(t){let i,s,n,a,o,e;i=t.x,s=t.y,n=t.z,i-=this._transform._positionX,s-=this._transform._positionY,n-=this._transform._positionZ,a=this._transform._rotation00*i+this._transform._rotation10*s+this._transform._rotation20*n,o=this._transform._rotation01*i+this._transform._rotation11*s+this._transform._rotation21*n,e=this._transform._rotation02*i+this._transform._rotation12*s+this._transform._rotation22*n,i=a,s=o,n=e;let r=new Ut.common.Vec3;return r.x=i,r.y=s,r.z=n,r}getLocalPointTo(t,i){let s,n,a,o,e,r;s=t.x,n=t.y,a=t.z,s-=this._transform._positionX,n-=this._transform._positionY,a-=this._transform._positionZ,o=this._transform._rotation00*s+this._transform._rotation10*n+this._transform._rotation20*a,e=this._transform._rotation01*s+this._transform._rotation11*n+this._transform._rotation21*a,r=this._transform._rotation02*s+this._transform._rotation12*n+this._transform._rotation22*a,s=o,n=e,a=r,i.x=s,i.y=n,i.z=a}getLocalVector(t){let i,s,n,a,o,e;i=t.x,s=t.y,n=t.z,a=this._transform._rotation00*i+this._transform._rotation10*s+this._transform._rotation20*n,o=this._transform._rotation01*i+this._transform._rotation11*s+this._transform._rotation21*n,e=this._transform._rotation02*i+this._transform._rotation12*s+this._transform._rotation22*n,i=a,s=o,n=e;let r=new Ut.common.Vec3;return r.x=i,r.y=s,r.z=n,r}getLocalVectorTo(t,i){let s,n,a,o,e,r;s=t.x,n=t.y,a=t.z,o=this._transform._rotation00*s+this._transform._rotation10*n+this._transform._rotation20*a,e=this._transform._rotation01*s+this._transform._rotation11*n+this._transform._rotation21*a,r=this._transform._rotation02*s+this._transform._rotation12*n+this._transform._rotation22*a,s=o,n=e,a=r,i.x=s,i.y=n,i.z=a}getWorldPoint(t){let i,s,n,a,o,e;i=t.x,s=t.y,n=t.z,a=this._transform._rotation00*i+this._transform._rotation01*s+this._transform._rotation02*n,o=this._transform._rotation10*i+this._transform._rotation11*s+this._transform._rotation12*n,e=this._transform._rotation20*i+this._transform._rotation21*s+this._transform._rotation22*n,i=a,s=o,n=e,i+=this._transform._positionX,s+=this._transform._positionY,n+=this._transform._positionZ;let r=new Ut.common.Vec3;return r.x=i,r.y=s,r.z=n,r}getWorldPointTo(t,i){let s,n,a,o,e,r;s=t.x,n=t.y,a=t.z,o=this._transform._rotation00*s+this._transform._rotation01*n+this._transform._rotation02*a,e=this._transform._rotation10*s+this._transform._rotation11*n+this._transform._rotation12*a,r=this._transform._rotation20*s+this._transform._rotation21*n+this._transform._rotation22*a,s=o,n=e,a=r,s+=this._transform._positionX,n+=this._transform._positionY,a+=this._transform._positionZ,i.x=s,i.y=n,i.z=a}getWorldVector(t){let i,s,n,a,o,e;i=t.x,s=t.y,n=t.z,a=this._transform._rotation00*i+this._transform._rotation01*s+this._transform._rotation02*n,o=this._transform._rotation10*i+this._transform._rotation11*s+this._transform._rotation12*n,e=this._transform._rotation20*i+this._transform._rotation21*s+this._transform._rotation22*n,i=a,s=o,n=e;let r=new Ut.common.Vec3;return r.x=i,r.y=s,r.z=n,r}getWorldVectorTo(t,i){let s,n,a,o,e,r;s=t.x,n=t.y,a=t.z,o=this._transform._rotation00*s+this._transform._rotation01*n+this._transform._rotation02*a,e=this._transform._rotation10*s+this._transform._rotation11*n+this._transform._rotation12*a,r=this._transform._rotation20*s+this._transform._rotation21*n+this._transform._rotation22*a,s=o,n=e,a=r,i.x=s,i.y=n,i.z=a}getNumShapes(){return this._numShapes}getShapeList(){return this._shapeList}getNumContectLinks(){return this._numContactLinks}getContactLinkList(){return this._contactLinkList}getNumJointLinks(){return this._numJointLinks}getJointLinkList(){return this._jointLinkList}addShape(t){if(null==this._shapeList?(this._shapeList=t,this._shapeListLast=t):(this._shapeListLast._next=t,t._prev=this._shapeListLast,this._shapeListLast=t),this._numShapes++,t._rigidBody=this,null!=this._world){let i=this._world;t._proxy=i._broadPhase.createProxy(t,t._aabb),t._id=i._shapeIdCount++,i._numShapes++}this.updateMass();let i=this._shapeList;for(;null!=i;){let t,s,n,a,o,e,r,_,h,l,c,m,b=i._next,p=this._ptransform,d=this._transform,u=i._ptransform,f=i._localTransform;t=p._rotation00*f._rotation00+p._rotation01*f._rotation10+p._rotation02*f._rotation20,s=p._rotation00*f._rotation01+p._rotation01*f._rotation11+p._rotation02*f._rotation21,n=p._rotation00*f._rotation02+p._rotation01*f._rotation12+p._rotation02*f._rotation22,a=p._rotation10*f._rotation00+p._rotation11*f._rotation10+p._rotation12*f._rotation20,o=p._rotation10*f._rotation01+p._rotation11*f._rotation11+p._rotation12*f._rotation21,e=p._rotation10*f._rotation02+p._rotation11*f._rotation12+p._rotation12*f._rotation22,r=p._rotation20*f._rotation00+p._rotation21*f._rotation10+p._rotation22*f._rotation20,_=p._rotation20*f._rotation01+p._rotation21*f._rotation11+p._rotation22*f._rotation21,h=p._rotation20*f._rotation02+p._rotation21*f._rotation12+p._rotation22*f._rotation22,u._rotation00=t,u._rotation01=s,u._rotation02=n,u._rotation10=a,u._rotation11=o,u._rotation12=e,u._rotation20=r,u._rotation21=_,u._rotation22=h,l=p._rotation00*f._positionX+p._rotation01*f._positionY+p._rotation02*f._positionZ,c=p._rotation10*f._positionX+p._rotation11*f._positionY+p._rotation12*f._positionZ,m=p._rotation20*f._positionX+p._rotation21*f._positionY+p._rotation22*f._positionZ,u._positionX=l,u._positionY=c,u._positionZ=m,u._positionX+=p._positionX,u._positionY+=p._positionY,u._positionZ+=p._positionZ;let x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C=i._transform,T=i._localTransform;if(x=d._rotation00*T._rotation00+d._rotation01*T._rotation10+d._rotation02*T._rotation20,g=d._rotation00*T._rotation01+d._rotation01*T._rotation11+d._rotation02*T._rotation21,v=d._rotation00*T._rotation02+d._rotation01*T._rotation12+d._rotation02*T._rotation22,y=d._rotation10*T._rotation00+d._rotation11*T._rotation10+d._rotation12*T._rotation20,X=d._rotation10*T._rotation01+d._rotation11*T._rotation11+d._rotation12*T._rotation21,z=d._rotation10*T._rotation02+d._rotation11*T._rotation12+d._rotation12*T._rotation22,M=d._rotation20*T._rotation00+d._rotation21*T._rotation10+d._rotation22*T._rotation20,Y=d._rotation20*T._rotation01+d._rotation21*T._rotation11+d._rotation22*T._rotation21,Z=d._rotation20*T._rotation02+d._rotation21*T._rotation12+d._rotation22*T._rotation22,C._rotation00=x,C._rotation01=g,C._rotation02=v,C._rotation10=y,C._rotation11=X,C._rotation12=z,C._rotation20=M,C._rotation21=Y,C._rotation22=Z,w=d._rotation00*T._positionX+d._rotation01*T._positionY+d._rotation02*T._positionZ,I=d._rotation10*T._positionX+d._rotation11*T._positionY+d._rotation12*T._positionZ,V=d._rotation20*T._positionX+d._rotation21*T._positionY+d._rotation22*T._positionZ,C._positionX=w,C._positionY=I,C._positionZ=V,C._positionX+=d._positionX,C._positionY+=d._positionY,C._positionZ+=d._positionZ,i._geom._computeAabb(i._aabb,i._ptransform),L=i._aabb._minX,A=i._aabb._minY,k=i._aabb._minZ,S=i._aabb._maxX,B=i._aabb._maxY,P=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=L<i._aabb._minX?L:i._aabb._minX,i._aabb._minY=A<i._aabb._minY?A:i._aabb._minY,i._aabb._minZ=k<i._aabb._minZ?k:i._aabb._minZ,i._aabb._maxX=S>i._aabb._maxX?S:i._aabb._maxX,i._aabb._maxY=B>i._aabb._maxY?B:i._aabb._maxY,i._aabb._maxZ=P>i._aabb._maxZ?P:i._aabb._maxZ,null!=i._proxy){let t,s,n;t=i._transform._positionX-i._ptransform._positionX,s=i._transform._positionY-i._ptransform._positionY,n=i._transform._positionZ-i._ptransform._positionZ;let a=i.displacement;a.x=t,a.y=s,a.z=n,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=b}}removeShape(t){let i=t._prev,s=t._next;if(null!=i&&(i._next=s),null!=s&&(s._prev=i),t==this._shapeList&&(this._shapeList=this._shapeList._next),t==this._shapeListLast&&(this._shapeListLast=this._shapeListLast._prev),t._next=null,t._prev=null,this._numShapes--,t._rigidBody=null,null!=this._world){let i=this._world;i._broadPhase.destroyProxy(t._proxy),t._proxy=null,t._id=-1;let s=t._rigidBody._contactLinkList;for(;null!=s;){let n=s._next,a=s._contact;if(a._s1==t||a._s2==t){let t=s._other;t._sleeping=!1,t._sleepTime=0;let n=i._contactManager,o=a._prev,e=a._next;if(null!=o&&(o._next=e),null!=e&&(e._prev=o),a==n._contactList&&(n._contactList=n._contactList._next),a==n._contactListLast&&(n._contactListLast=n._contactListLast._prev),a._next=null,a._prev=null,a._touching){let t=a._s1._contactCallback,i=a._s2._contactCallback;t==i&&(i=null),null!=t&&t.endContact(a),null!=i&&i.endContact(a)}let r=a._link1._prev,_=a._link1._next;null!=r&&(r._next=_),null!=_&&(_._prev=r),a._link1==a._b1._contactLinkList&&(a._b1._contactLinkList=a._b1._contactLinkList._next),a._link1==a._b1._contactLinkListLast&&(a._b1._contactLinkListLast=a._b1._contactLinkListLast._prev),a._link1._next=null,a._link1._prev=null;let h=a._link2._prev,l=a._link2._next;null!=h&&(h._next=l),null!=l&&(l._prev=h),a._link2==a._b2._contactLinkList&&(a._b2._contactLinkList=a._b2._contactLinkList._next),a._link2==a._b2._contactLinkListLast&&(a._b2._contactLinkListLast=a._b2._contactLinkListLast._prev),a._link2._next=null,a._link2._prev=null,a._b1._numContactLinks--,a._b2._numContactLinks--,a._link1._other=null,a._link2._other=null,a._link1._contact=null,a._link2._contact=null,a._s1=null,a._s2=null,a._b1=null,a._b2=null,a._touching=!1,a._cachedDetectorData._clear(),a._manifold._clear(),a._detector=null;let c=a._contactConstraint;c._s1=null,c._s2=null,c._b1=null,c._b2=null,c._tf1=null,c._tf2=null,a._next=n._contactPool,n._contactPool=a,n._numContacts--}s=n}i._numShapes--}this.updateMass();let n=this._shapeList;for(;null!=n;){let t,i,s,a,o,e,r,_,h,l,c,m,b=n._next,p=this._ptransform,d=this._transform,u=n._ptransform,f=n._localTransform;t=p._rotation00*f._rotation00+p._rotation01*f._rotation10+p._rotation02*f._rotation20,i=p._rotation00*f._rotation01+p._rotation01*f._rotation11+p._rotation02*f._rotation21,s=p._rotation00*f._rotation02+p._rotation01*f._rotation12+p._rotation02*f._rotation22,a=p._rotation10*f._rotation00+p._rotation11*f._rotation10+p._rotation12*f._rotation20,o=p._rotation10*f._rotation01+p._rotation11*f._rotation11+p._rotation12*f._rotation21,e=p._rotation10*f._rotation02+p._rotation11*f._rotation12+p._rotation12*f._rotation22,r=p._rotation20*f._rotation00+p._rotation21*f._rotation10+p._rotation22*f._rotation20,_=p._rotation20*f._rotation01+p._rotation21*f._rotation11+p._rotation22*f._rotation21,h=p._rotation20*f._rotation02+p._rotation21*f._rotation12+p._rotation22*f._rotation22,u._rotation00=t,u._rotation01=i,u._rotation02=s,u._rotation10=a,u._rotation11=o,u._rotation12=e,u._rotation20=r,u._rotation21=_,u._rotation22=h,l=p._rotation00*f._positionX+p._rotation01*f._positionY+p._rotation02*f._positionZ,c=p._rotation10*f._positionX+p._rotation11*f._positionY+p._rotation12*f._positionZ,m=p._rotation20*f._positionX+p._rotation21*f._positionY+p._rotation22*f._positionZ,u._positionX=l,u._positionY=c,u._positionZ=m,u._positionX+=p._positionX,u._positionY+=p._positionY,u._positionZ+=p._positionZ;let x,g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C=n._transform,T=n._localTransform;if(x=d._rotation00*T._rotation00+d._rotation01*T._rotation10+d._rotation02*T._rotation20,g=d._rotation00*T._rotation01+d._rotation01*T._rotation11+d._rotation02*T._rotation21,v=d._rotation00*T._rotation02+d._rotation01*T._rotation12+d._rotation02*T._rotation22,y=d._rotation10*T._rotation00+d._rotation11*T._rotation10+d._rotation12*T._rotation20,X=d._rotation10*T._rotation01+d._rotation11*T._rotation11+d._rotation12*T._rotation21,z=d._rotation10*T._rotation02+d._rotation11*T._rotation12+d._rotation12*T._rotation22,M=d._rotation20*T._rotation00+d._rotation21*T._rotation10+d._rotation22*T._rotation20,Y=d._rotation20*T._rotation01+d._rotation21*T._rotation11+d._rotation22*T._rotation21,Z=d._rotation20*T._rotation02+d._rotation21*T._rotation12+d._rotation22*T._rotation22,C._rotation00=x,C._rotation01=g,C._rotation02=v,C._rotation10=y,C._rotation11=X,C._rotation12=z,C._rotation20=M,C._rotation21=Y,C._rotation22=Z,w=d._rotation00*T._positionX+d._rotation01*T._positionY+d._rotation02*T._positionZ,I=d._rotation10*T._positionX+d._rotation11*T._positionY+d._rotation12*T._positionZ,V=d._rotation20*T._positionX+d._rotation21*T._positionY+d._rotation22*T._positionZ,C._positionX=w,C._positionY=I,C._positionZ=V,C._positionX+=d._positionX,C._positionY+=d._positionY,C._positionZ+=d._positionZ,n._geom._computeAabb(n._aabb,n._ptransform),L=n._aabb._minX,A=n._aabb._minY,k=n._aabb._minZ,S=n._aabb._maxX,B=n._aabb._maxY,P=n._aabb._maxZ,n._geom._computeAabb(n._aabb,n._transform),n._aabb._minX=L<n._aabb._minX?L:n._aabb._minX,n._aabb._minY=A<n._aabb._minY?A:n._aabb._minY,n._aabb._minZ=k<n._aabb._minZ?k:n._aabb._minZ,n._aabb._maxX=S>n._aabb._maxX?S:n._aabb._maxX,n._aabb._maxY=B>n._aabb._maxY?B:n._aabb._maxY,n._aabb._maxZ=P>n._aabb._maxZ?P:n._aabb._maxZ,null!=n._proxy){let t,i,s;t=n._transform._positionX-n._ptransform._positionX,i=n._transform._positionY-n._ptransform._positionY,s=n._transform._positionZ-n._ptransform._positionZ;let a=n.displacement;a.x=t,a.y=i,a.z=s,n._rigidBody._world._broadPhase.moveProxy(n._proxy,n._aabb,n.displacement)}n=b}}getType(){return this._type}setType(t){this._type=t,this.updateMass()}wakeUp(){this._sleeping=!1,this._sleepTime=0}sleep(){this._sleeping=!0,this._sleepTime=0}isSleeping(){return this._sleeping}getSleepTime(){return this._sleepTime}setAutoSleep(t){this._autoSleep=t,this._sleeping=!1,this._sleepTime=0}getLinearDamping(){return this._linearDamping}setLinearDamping(t){this._linearDamping=t}getAngularDamping(){return this._angularDamping}setAngularDamping(t){this._angularDamping=t}getPrev(){return this._prev}getNext(){return this._next}},Ut.dynamics.rigidbody.RigidBodyConfig=class{constructor(){this.position=new Ut.common.Vec3,this.rotation=new Ut.common.Mat3,this.linearVelocity=new Ut.common.Vec3,this.angularVelocity=new Ut.common.Vec3,this.type=0,this.autoSleep=!0,this.linearDamping=0,this.angularDamping=0}},Ut.dynamics.rigidbody.RigidBodyType=class{},Ut.dynamics.rigidbody.Shape=class{constructor(t){this._id=-1,this._localTransform=new Ut.common.Transform,this._ptransform=new Ut.common.Transform,this._transform=new Ut.common.Transform;let i=t.position;this._localTransform._positionX=i.x,this._localTransform._positionY=i.y,this._localTransform._positionZ=i.z;let s=t.rotation;this._localTransform._rotation00=s.e00,this._localTransform._rotation01=s.e01,this._localTransform._rotation02=s.e02,this._localTransform._rotation10=s.e10,this._localTransform._rotation11=s.e11,this._localTransform._rotation12=s.e12,this._localTransform._rotation20=s.e20,this._localTransform._rotation21=s.e21,this._localTransform._rotation22=s.e22;let n=this._ptransform,a=this._localTransform;n._positionX=a._positionX,n._positionY=a._positionY,n._positionZ=a._positionZ,n._rotation00=a._rotation00,n._rotation01=a._rotation01,n._rotation02=a._rotation02,n._rotation10=a._rotation10,n._rotation11=a._rotation11,n._rotation12=a._rotation12,n._rotation20=a._rotation20,n._rotation21=a._rotation21,n._rotation22=a._rotation22;let o=this._transform,e=this._localTransform;o._positionX=e._positionX,o._positionY=e._positionY,o._positionZ=e._positionZ,o._rotation00=e._rotation00,o._rotation01=e._rotation01,o._rotation02=e._rotation02,o._rotation10=e._rotation10,o._rotation11=e._rotation11,o._rotation12=e._rotation12,o._rotation20=e._rotation20,o._rotation21=e._rotation21,o._rotation22=e._rotation22,this._restitution=t.restitution,this._friction=t.friction,this._density=t.density,this._geom=t.geometry,this._collisionGroup=t.collisionGroup,this._collisionMask=t.collisionMask,this._contactCallback=t.contactCallback,this._aabb=new Ut.collision.geometry.Aabb,this._proxy=null,this.displacement=new Ut.common.Vec3}getFriction(){return this._friction}setFriction(t){this._friction=t}getRestitution(){return this._restitution}setRestitution(t){this._restitution=t}getLocalTransform(){let t=this._localTransform,i=new Ut.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i}getLocalTransformTo(t){let i=this._localTransform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}getTransform(){let t=this._transform,i=new Ut.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i}getTransformTo(t){let i=this._transform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}setLocalTransform(t){let i=this._localTransform;if(i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,null!=this._rigidBody){let t=this._rigidBody;t.updateMass();let i=t._shapeList;for(;null!=i;){let s,n,a,o,e,r,_,h,l,c,m,b,p=i._next,d=t._ptransform,u=t._transform,f=i._ptransform,x=i._localTransform;s=d._rotation00*x._rotation00+d._rotation01*x._rotation10+d._rotation02*x._rotation20,n=d._rotation00*x._rotation01+d._rotation01*x._rotation11+d._rotation02*x._rotation21,a=d._rotation00*x._rotation02+d._rotation01*x._rotation12+d._rotation02*x._rotation22,o=d._rotation10*x._rotation00+d._rotation11*x._rotation10+d._rotation12*x._rotation20,e=d._rotation10*x._rotation01+d._rotation11*x._rotation11+d._rotation12*x._rotation21,r=d._rotation10*x._rotation02+d._rotation11*x._rotation12+d._rotation12*x._rotation22,_=d._rotation20*x._rotation00+d._rotation21*x._rotation10+d._rotation22*x._rotation20,h=d._rotation20*x._rotation01+d._rotation21*x._rotation11+d._rotation22*x._rotation21,l=d._rotation20*x._rotation02+d._rotation21*x._rotation12+d._rotation22*x._rotation22,f._rotation00=s,f._rotation01=n,f._rotation02=a,f._rotation10=o,f._rotation11=e,f._rotation12=r,f._rotation20=_,f._rotation21=h,f._rotation22=l,c=d._rotation00*x._positionX+d._rotation01*x._positionY+d._rotation02*x._positionZ,m=d._rotation10*x._positionX+d._rotation11*x._positionY+d._rotation12*x._positionZ,b=d._rotation20*x._positionX+d._rotation21*x._positionY+d._rotation22*x._positionZ,f._positionX=c,f._positionY=m,f._positionZ=b,f._positionX+=d._positionX,f._positionY+=d._positionY,f._positionZ+=d._positionZ;let g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C,T=i._transform,j=i._localTransform;if(g=u._rotation00*j._rotation00+u._rotation01*j._rotation10+u._rotation02*j._rotation20,v=u._rotation00*j._rotation01+u._rotation01*j._rotation11+u._rotation02*j._rotation21,y=u._rotation00*j._rotation02+u._rotation01*j._rotation12+u._rotation02*j._rotation22,X=u._rotation10*j._rotation00+u._rotation11*j._rotation10+u._rotation12*j._rotation20,z=u._rotation10*j._rotation01+u._rotation11*j._rotation11+u._rotation12*j._rotation21,M=u._rotation10*j._rotation02+u._rotation11*j._rotation12+u._rotation12*j._rotation22,Y=u._rotation20*j._rotation00+u._rotation21*j._rotation10+u._rotation22*j._rotation20,Z=u._rotation20*j._rotation01+u._rotation21*j._rotation11+u._rotation22*j._rotation21,w=u._rotation20*j._rotation02+u._rotation21*j._rotation12+u._rotation22*j._rotation22,T._rotation00=g,T._rotation01=v,T._rotation02=y,T._rotation10=X,T._rotation11=z,T._rotation12=M,T._rotation20=Y,T._rotation21=Z,T._rotation22=w,I=u._rotation00*j._positionX+u._rotation01*j._positionY+u._rotation02*j._positionZ,V=u._rotation10*j._positionX+u._rotation11*j._positionY+u._rotation12*j._positionZ,L=u._rotation20*j._positionX+u._rotation21*j._positionY+u._rotation22*j._positionZ,T._positionX=I,T._positionY=V,T._positionZ=L,T._positionX+=u._positionX,T._positionY+=u._positionY,T._positionZ+=u._positionZ,i._geom._computeAabb(i._aabb,i._ptransform),A=i._aabb._minX,k=i._aabb._minY,S=i._aabb._minZ,B=i._aabb._maxX,P=i._aabb._maxY,C=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=A<i._aabb._minX?A:i._aabb._minX,i._aabb._minY=k<i._aabb._minY?k:i._aabb._minY,i._aabb._minZ=S<i._aabb._minZ?S:i._aabb._minZ,i._aabb._maxX=B>i._aabb._maxX?B:i._aabb._maxX,i._aabb._maxY=P>i._aabb._maxY?P:i._aabb._maxY,i._aabb._maxZ=C>i._aabb._maxZ?C:i._aabb._maxZ,null!=i._proxy){let t,s,n;t=i._transform._positionX-i._ptransform._positionX,s=i._transform._positionY-i._ptransform._positionY,n=i._transform._positionZ-i._ptransform._positionZ;let a=i.displacement;a.x=t,a.y=s,a.z=n,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=p}}}getDensity(){return this._density}setDensity(t){if(this._density=t,null!=this._rigidBody){let t=this._rigidBody;t.updateMass();let i=t._shapeList;for(;null!=i;){let s,n,a,o,e,r,_,h,l,c,m,b,p=i._next,d=t._ptransform,u=t._transform,f=i._ptransform,x=i._localTransform;s=d._rotation00*x._rotation00+d._rotation01*x._rotation10+d._rotation02*x._rotation20,n=d._rotation00*x._rotation01+d._rotation01*x._rotation11+d._rotation02*x._rotation21,a=d._rotation00*x._rotation02+d._rotation01*x._rotation12+d._rotation02*x._rotation22,o=d._rotation10*x._rotation00+d._rotation11*x._rotation10+d._rotation12*x._rotation20,e=d._rotation10*x._rotation01+d._rotation11*x._rotation11+d._rotation12*x._rotation21,r=d._rotation10*x._rotation02+d._rotation11*x._rotation12+d._rotation12*x._rotation22,_=d._rotation20*x._rotation00+d._rotation21*x._rotation10+d._rotation22*x._rotation20,h=d._rotation20*x._rotation01+d._rotation21*x._rotation11+d._rotation22*x._rotation21,l=d._rotation20*x._rotation02+d._rotation21*x._rotation12+d._rotation22*x._rotation22,f._rotation00=s,f._rotation01=n,f._rotation02=a,f._rotation10=o,f._rotation11=e,f._rotation12=r,f._rotation20=_,f._rotation21=h,f._rotation22=l,c=d._rotation00*x._positionX+d._rotation01*x._positionY+d._rotation02*x._positionZ,m=d._rotation10*x._positionX+d._rotation11*x._positionY+d._rotation12*x._positionZ,b=d._rotation20*x._positionX+d._rotation21*x._positionY+d._rotation22*x._positionZ,f._positionX=c,f._positionY=m,f._positionZ=b,f._positionX+=d._positionX,f._positionY+=d._positionY,f._positionZ+=d._positionZ;let g,v,y,X,z,M,Y,Z,w,I,V,L,A,k,S,B,P,C,T=i._transform,j=i._localTransform;if(g=u._rotation00*j._rotation00+u._rotation01*j._rotation10+u._rotation02*j._rotation20,v=u._rotation00*j._rotation01+u._rotation01*j._rotation11+u._rotation02*j._rotation21,y=u._rotation00*j._rotation02+u._rotation01*j._rotation12+u._rotation02*j._rotation22,X=u._rotation10*j._rotation00+u._rotation11*j._rotation10+u._rotation12*j._rotation20,z=u._rotation10*j._rotation01+u._rotation11*j._rotation11+u._rotation12*j._rotation21,M=u._rotation10*j._rotation02+u._rotation11*j._rotation12+u._rotation12*j._rotation22,Y=u._rotation20*j._rotation00+u._rotation21*j._rotation10+u._rotation22*j._rotation20,Z=u._rotation20*j._rotation01+u._rotation21*j._rotation11+u._rotation22*j._rotation21,w=u._rotation20*j._rotation02+u._rotation21*j._rotation12+u._rotation22*j._rotation22,T._rotation00=g,T._rotation01=v,T._rotation02=y,T._rotation10=X,T._rotation11=z,T._rotation12=M,T._rotation20=Y,T._rotation21=Z,T._rotation22=w,I=u._rotation00*j._positionX+u._rotation01*j._positionY+u._rotation02*j._positionZ,V=u._rotation10*j._positionX+u._rotation11*j._positionY+u._rotation12*j._positionZ,L=u._rotation20*j._positionX+u._rotation21*j._positionY+u._rotation22*j._positionZ,T._positionX=I,T._positionY=V,T._positionZ=L,T._positionX+=u._positionX,T._positionY+=u._positionY,T._positionZ+=u._positionZ,i._geom._computeAabb(i._aabb,i._ptransform),A=i._aabb._minX,k=i._aabb._minY,S=i._aabb._minZ,B=i._aabb._maxX,P=i._aabb._maxY,C=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=A<i._aabb._minX?A:i._aabb._minX,i._aabb._minY=k<i._aabb._minY?k:i._aabb._minY,i._aabb._minZ=S<i._aabb._minZ?S:i._aabb._minZ,i._aabb._maxX=B>i._aabb._maxX?B:i._aabb._maxX,i._aabb._maxY=P>i._aabb._maxY?P:i._aabb._maxY,i._aabb._maxZ=C>i._aabb._maxZ?C:i._aabb._maxZ,null!=i._proxy){let t,s,n;t=i._transform._positionX-i._ptransform._positionX,s=i._transform._positionY-i._ptransform._positionY,n=i._transform._positionZ-i._ptransform._positionZ;let a=i.displacement;a.x=t,a.y=s,a.z=n,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=p}}}getAabb(){return this._aabb.clone()}getAabbTo(t){t.copyFrom(this._aabb)}getGeometry(){return this._geom}getRigidBody(){return this._rigidBody}getCollisionGroup(){return this._collisionGroup}setCollisionGroup(t){this._collisionGroup=t}getCollisionMask(){return this._collisionMask}setCollisionMask(t){this._collisionMask=t}getContactCallback(){return this._contactCallback}setContactCallback(t){this._contactCallback=t}getPrev(){return this._prev}getNext(){return this._next}},Ut.dynamics.rigidbody.ShapeConfig=class{constructor(){this.position=new Ut.common.Vec3,this.rotation=new Ut.common.Mat3,this.friction=Ut.common.Setting.defaultFriction,this.restitution=Ut.common.Setting.defaultRestitution,this.density=Ut.common.Setting.defaultDensity,this.collisionGroup=Ut.common.Setting.defaultCollisionGroup,this.collisionMask=Ut.common.Setting.defaultCollisionMask,this.geometry=null,this.contactCallback=null}},Ut.m||(Ut.m={}),Ut.m.M=class{},Ut.collision.broadphase.BroadPhaseType._BRUTE_FORCE=1,Ut.collision.broadphase.BroadPhaseType._BVH=2,Ut.collision.broadphase.BroadPhaseType.BRUTE_FORCE=1,Ut.collision.broadphase.BroadPhaseType.BVH=2,Ut.collision.broadphase.bvh.BvhInsertionStrategy.SIMPLE=0,Ut.collision.broadphase.bvh.BvhInsertionStrategy.MINIMIZE_SURFACE_AREA=1,Ut.collision.geometry.GeometryType._SPHERE=0,Ut.collision.geometry.GeometryType._BOX=1,Ut.collision.geometry.GeometryType._CYLINDER=2,Ut.collision.geometry.GeometryType._CONE=3,Ut.collision.geometry.GeometryType._CAPSULE=4,Ut.collision.geometry.GeometryType._CONVEX_HULL=5,Ut.collision.geometry.GeometryType._CONVEX_MIN=0,Ut.collision.geometry.GeometryType._CONVEX_MAX=5,Ut.collision.geometry.GeometryType.SPHERE=0,Ut.collision.geometry.GeometryType.BOX=1,Ut.collision.geometry.GeometryType.CYLINDER=2,Ut.collision.geometry.GeometryType.CONE=3,Ut.collision.geometry.GeometryType.CAPSULE=4,Ut.collision.geometry.GeometryType.CONVEX_HULL=5,Ut.collision.narrowphase.detector.BoxBoxDetector.EDGE_BIAS_MULT=1,Ut.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.OK=0,Ut.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.INVALID_TRIANGLE=1,Ut.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_PAIR_INDEX=2,Ut.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_TRIANGLE=3,Ut.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.EDGE_LOOP_BROKEN=4,Ut.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_OUTER_TRIANGLE=5,Ut.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.TRIANGLE_INVISIBLE=6,Ut.collision.narrowphase.detector.gjkepa.EpaTriangle.count=0,Ut.common.Vec3.numCreations=0,Ut.common.Setting.defaultFriction=.2,Ut.common.Setting.defaultRestitution=.2,Ut.common.Setting.defaultDensity=1,Ut.common.Setting.defaultCollisionGroup=1,Ut.common.Setting.defaultCollisionMask=1,Ut.common.Setting.maxTranslationPerStep=20,Ut.common.Setting.maxRotationPerStep=3.14159265358979,Ut.common.Setting.bvhProxyPadding=.1,Ut.common.Setting.bvhIncrementalCollisionThreshold=.45,Ut.common.Setting.defaultGJKMargin=.05,Ut.common.Setting.enableGJKCaching=!0,Ut.common.Setting.maxEPAVertices=128,Ut.common.Setting.maxEPAPolyhedronFaces=128,Ut.common.Setting.contactEnableBounceThreshold=.5,Ut.common.Setting.velocityBaumgarte=.2,Ut.common.Setting.positionSplitImpulseBaumgarte=.4,Ut.common.Setting.positionNgsBaumgarte=1,Ut.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold=.05,Ut.common.Setting.defaultContactPositionCorrectionAlgorithm=0,Ut.common.Setting.alternativeContactPositionCorrectionAlgorithm=1,Ut.common.Setting.contactPersistenceThreshold=.05,Ut.common.Setting.maxManifoldPoints=4,Ut.common.Setting.defaultJointConstraintSolverType=0,Ut.common.Setting.defaultJointPositionCorrectionAlgorithm=0,Ut.common.Setting.jointWarmStartingFactorForBaungarte=.8,Ut.common.Setting.jointWarmStartingFactor=.95,Ut.common.Setting.minSpringDamperDampingRatio=1e-6,Ut.common.Setting.minRagdollMaxSwingAngle=1e-6,Ut.common.Setting.maxJacobianRows=6,Ut.common.Setting.directMlcpSolverEps=1e-9,Ut.common.Setting.islandInitialRigidBodyArraySize=128,Ut.common.Setting.islandInitialConstraintArraySize=128,Ut.common.Setting.sleepingVelocityThreshold=.2,Ut.common.Setting.sleepingAngularVelocityThreshold=.5,Ut.common.Setting.sleepingTimeThreshold=1,Ut.common.Setting.disableSleeping=!1,Ut.common.Setting.linearSlop=.005,Ut.common.Setting.angularSlop=.017453292519943278,Ut.collision.narrowphase.detector.gjkepa.GjkEpa.instance=new Ut.collision.narrowphase.detector.gjkepa.GjkEpa,Ut.collision.narrowphase.detector.gjkepa.GjkEpaResultState._SUCCEEDED=0,Ut.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_FAILED_TO_MAKE_TETRAHEDRON=1,Ut.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_DID_NOT_CONVERGE=2,Ut.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_INIT=257,Ut.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_ADD_VERTEX=258,Ut.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_DID_NOT_CONVERGE=259,Ut.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED=0,Ut.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_FAILED_TO_MAKE_TETRAHEDRON=1,Ut.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_DID_NOT_CONVERGE=2,Ut.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT=257,Ut.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX=258,Ut.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE=259,Ut.common.Mat3.numCreations=0,Ut.common.Mat4.numCreations=0,Ut.common.MathUtil.POSITIVE_INFINITY=1/0,Ut.common.MathUtil.NEGATIVE_INFINITY=-1/0,Ut.common.MathUtil.PI=3.14159265358979,Ut.common.MathUtil.TWO_PI=6.28318530717958,Ut.common.MathUtil.HALF_PI=1.570796326794895,Ut.common.MathUtil.TO_RADIANS=.017453292519943278,Ut.common.MathUtil.TO_DEGREES=57.29577951308238,Ut.common.Quat.numCreations=0,Ut.dynamics.common.DebugDraw.SPHERE_PHI_DIVISION=8,Ut.dynamics.common.DebugDraw.SPHERE_THETA_DIVISION=4,Ut.dynamics.common.DebugDraw.CIRCLE_THETA_DIVISION=8,Ut.dynamics.common.Performance.broadPhaseCollisionTime=0,Ut.dynamics.common.Performance.narrowPhaseCollisionTime=0,Ut.dynamics.common.Performance.dynamicsTime=0,Ut.dynamics.common.Performance.totalTime=0,Ut.dynamics.constraint.PositionCorrectionAlgorithm._BAUMGARTE=0,Ut.dynamics.constraint.PositionCorrectionAlgorithm._SPLIT_IMPULSE=1,Ut.dynamics.constraint.PositionCorrectionAlgorithm._NGS=2,Ut.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE=0,Ut.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE=1,Ut.dynamics.constraint.PositionCorrectionAlgorithm.NGS=2,Ut.dynamics.constraint.info.JacobianRow.BIT_LINEAR_SET=1,Ut.dynamics.constraint.info.JacobianRow.BIT_ANGULAR_SET=2,Ut.dynamics.constraint.joint.JointType._SPHERICAL=0,Ut.dynamics.constraint.joint.JointType._REVOLUTE=1,Ut.dynamics.constraint.joint.JointType._CYLINDRICAL=2,Ut.dynamics.constraint.joint.JointType._PRISMATIC=3,Ut.dynamics.constraint.joint.JointType._UNIVERSAL=4,Ut.dynamics.constraint.joint.JointType._RAGDOLL=5,Ut.dynamics.constraint.joint.JointType._GENERIC=6,Ut.dynamics.constraint.joint.JointType.SPHERICAL=0,Ut.dynamics.constraint.joint.JointType.REVOLUTE=1,Ut.dynamics.constraint.joint.JointType.CYLINDRICAL=2,Ut.dynamics.constraint.joint.JointType.PRISMATIC=3,Ut.dynamics.constraint.joint.JointType.UNIVERSAL=4,Ut.dynamics.constraint.joint.JointType.RAGDOLL=5,Ut.dynamics.constraint.joint.JointType.GENERIC=6,Ut.dynamics.constraint.solver.ConstraintSolverType._ITERATIVE=0,Ut.dynamics.constraint.solver.ConstraintSolverType._DIRECT=1,Ut.dynamics.constraint.solver.ConstraintSolverType.ITERATIVE=0,Ut.dynamics.constraint.solver.ConstraintSolverType.DIRECT=1,Ut.dynamics.rigidbody.RigidBodyType._DYNAMIC=0,Ut.dynamics.rigidbody.RigidBodyType._STATIC=1,Ut.dynamics.rigidbody.RigidBodyType._KINEMATIC=2,Ut.dynamics.rigidbody.RigidBodyType.DYNAMIC=0,Ut.dynamics.rigidbody.RigidBodyType.STATIC=1,Ut.dynamics.rigidbody.RigidBodyType.KINEMATIC=2;const Jt=Ut.dynamics.World,$t=Ut.dynamics.rigidbody.RigidBodyType,Kt=Ut.dynamics.rigidbody.RigidBodyConfig,Qt=Ut.dynamics.rigidbody.ShapeConfig,ti=Ut.dynamics.rigidbody.RigidBody,ii=Ut.dynamics.rigidbody.Shape;Ut.dynamics.constraint.joint.SphericalJoint,Ut.dynamics.constraint.joint.RevoluteJointConfig,Ut.dynamics.constraint.joint.UniversalJointConfig,Ut.dynamics.constraint.joint.CylindricalJoint,Ut.dynamics.constraint.joint.PrismaticJoint,Ut.dynamics.constraint.joint.PrismaticJointConfig,Ut.dynamics.constraint.joint.RevoluteJoint,Ut.dynamics.constraint.joint.RagdollJoint,Ut.dynamics.constraint.joint.CylindricalJointConfig,Ut.dynamics.constraint.joint.SphericalJointConfig,Ut.dynamics.constraint.joint.RagdollJointConfig,Ut.dynamics.constraint.joint.SpringDamper,Ut.dynamics.constraint.joint.TranslationalLimitMotor,Ut.dynamics.constraint.joint.RotationalLimitMotor,Ut.dynamics.constraint.joint.UniversalJoint;const si=Ut.common.Vec3;Ut.common.Quat,Ut.common.Mat3,Ut.common.MathUtil,Ut.common.Transform,Ut.collision.geometry.CapsuleGeometry,Ut.collision.geometry.ConvexHullGeometry;const ni=Ut.collision.geometry.BoxGeometry,ai=Ut.collision.geometry.SphereGeometry;async function oi(){const t=new Jt(2,new si(0,-9.8,0));const i=[],s=new WeakMap;let n=0;return setInterval((function(){const a=performance.now();n>0&&t.step(1/60),n=a;for(let t=0,n=i.length;t<n;t++){const n=i[t];if(n.isInstancedMesh){const t=n.instanceMatrix.array,i=s.get(n);for(let s=0;s<i.length;s++){const n=i[s];ei(n.getPosition(),n.getOrientation(),t,16*s)}n.instanceMatrix.needsUpdate=!0}else if(n.isMesh){const t=s.get(n);n.position.copy(t.getPosition()),n.quaternion.copy(t.getOrientation())}}}),1e3/60),{addMesh:function(n,a=0){const o=function(t){const i=t.parameters;if("BoxGeometry"===t.type){const t=void 0!==i.width?i.width/2:.5,s=void 0!==i.height?i.height/2:.5,n=void 0!==i.depth?i.depth/2:.5;return new ni(new si(t,s,n))}if("SphereGeometry"===t.type||"IcosahedronGeometry"===t.type){const t=void 0!==i.radius?i.radius:1;return new ai(t)}return null}(n.geometry);null!==o&&(n.isInstancedMesh?function(n,a,o){const e=n.instanceMatrix.array,r=[];for(let i=0;i<n.count;i++){const s=16*i,n=new Qt;n.geometry=o;const _=new Kt;_.type=0===a?$t.STATIC:$t.DYNAMIC,_.position=new si(e[s+12],e[s+13],e[s+14]);const h=new ti(_);h.addShape(new ii(n)),t.addRigidBody(h),r.push(h)}a>0&&(i.push(n),s.set(n,r))}(n,a,o):n.isMesh&&function(n,a,o){const e=new Qt;e.geometry=o;const r=new Kt;r.type=0===a?$t.STATIC:$t.DYNAMIC,r.position=new si(n.position.x,n.position.y,n.position.z);const _=new ti(r);_.addShape(new ii(e)),t.addRigidBody(_),a>0&&(i.push(n),s.set(n,_))}(n,a,o))},setMeshPosition:function(t,i,n=0){if(t.isInstancedMesh){s.get(t)[n].setPosition(new si(i.x,i.y,i.z))}else if(t.isMesh){s.get(t).setPosition(new si(i.x,i.y,i.z))}}}}function ei(t,i,s,n){const a=i.x,o=i.y,e=i.z,r=i.w,_=a+a,h=o+o,l=e+e,c=a*_,m=a*h,b=a*l,p=o*h,d=o*l,u=e*l,f=r*_,x=r*h,g=r*l;s[n+0]=1-(p+u),s[n+1]=m+g,s[n+2]=b-x,s[n+3]=0,s[n+4]=m-g,s[n+5]=1-(c+u),s[n+6]=d+f,s[n+7]=0,s[n+8]=b+x,s[n+9]=d-f,s[n+10]=1-(c+p),s[n+11]=0,s[n+12]=t.x,s[n+13]=t.y,s[n+14]=t.z,s[n+15]=1}Ut.collision.geometry.CylinderGeometry,Ut.collision.geometry.ConeGeometry,Ut.collision.geometry.Geometry,Ut.dynamics.callback.RayCastClosest;var ri=Object.freeze(Object.defineProperty({__proto__:null,default:class{constructor(){i(this,"scene"),i(this,"camera"),i(this,"renderer"),i(this,"controls",null),i(this,"gui",new Ht),i(this,"stats",Gt()),i(this,"axesHelper",new p(3)),i(this,"hemiLight",new X(16777215,8947848)),i(this,"dirLight",new I),i(this,"physics"),i(this,"floor",new b),i(this,"boxes"),i(this,"spheres"),i(this,"count"),this.scene=new l,this.camera=new d(60,window.innerWidth/window.innerHeight,.1,100),this.renderer=new h({antialias:!0}),this.count=100,this.init()}init(){this.initCamera(),this.initRender(),this.initScene(),this.buildGUI(),this.initListener(),this.enabledPhysics(),this.render()}initCamera(){this.camera.position.set(4,4,4),this.camera.lookAt(0,0,0)}initRender(){this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.shadowMap.enabled=!0,document.body.appendChild(this.renderer.domElement),document.body.appendChild(this.stats.dom),this.controls=new It(this.camera,this.renderer.domElement)}initScene(){this.scene.background=new z(8947848),this.scene.add(this.axesHelper),this.initLight(),this.initMesh()}initLight(){this.hemiLight.position.set(0,1,0),this.hemiLight.intensity=.35,this.scene.add(this.hemiLight),this.dirLight.position.set(5,5,-5),this.dirLight.castShadow=!0,this.dirLight.shadow.camera.zoom=2,this.scene.add(this.dirLight)}initMesh(){const t=new c(10,5,10),i=new V({color:1118481});this.floor=new b(t,i),this.floor.position.y=-2.5,this.floor.receiveShadow=!0,this.scene.add(this.floor);const s=new c(.1,.1,.1),n=new L,a=new w,o=new z;this.boxes=new Z(s,n,this.count),this.boxes.instanceMatrix.setUsage(A),this.boxes.castShadow=!0,this.boxes.receiveShadow=!0;for(let r=0;r<this.boxes.count;r++)a.setPosition(Math.random()-.5,2*Math.random(),Math.random()-.5),this.boxes.setMatrixAt(r,a),this.boxes.setColorAt(r,o.setHex(16777215*Math.random()));this.scene.add(this.boxes);const e=new Y(.075,3);this.spheres=new Z(e,n,this.count),this.spheres.instanceMatrix.setUsage(A),this.spheres.castShadow=!0,this.spheres.receiveShadow=!0;for(let r=0;r<this.spheres.count;r++)a.setPosition(Math.random()-.5,2*Math.random(),Math.random()-.5),this.spheres.setMatrixAt(r,a),this.spheres.setColorAt(r,o.setHex(16777215*Math.random()));this.scene.add(this.spheres)}buildGUI(){this.gui=new Ht,this.gui.close()}initListener(){window.addEventListener("resize",(()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}))}async enabledPhysics(){this.physics=await oi(),this.physics.addMesh(this.floor),this.physics.addMesh(this.boxes,1),this.physics.addMesh(this.spheres,1)}render(){this.animate()}animate(){if(this.renderer.render(this.scene,this.camera),this.stats.update(),this.physics){let t=Math.floor(Math.random()*this.boxes.count);const i=new n;i.set(0,2,0),this.physics.setMeshPosition(this.boxes,i,t),t=Math.floor(Math.random()*this.spheres.count),i.set(0,Math.random()+1,0),this.physics.setMeshPosition(this.spheres,i,t)}requestAnimationFrame((()=>{this.animate()}))}}},Symbol.toStringTag,{value:"Module"}));const _i={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\t#include <packing>\n\n\t\tvoid main() {\n\n\t\t\tfloat depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );\n\t\t\tgl_FragColor = vec4( vec3( depth ), opacity );\n\n\t\t}"};class hi{constructor(t){const i=this,s=void 0!==t.name&&""!==t.name;let n;const a=10,o=10,e=256,r=256,_=new k(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,1,10);_.position.set(0,0,2);const h=new l,c=_i,p=S.clone(c.uniforms),d=new B({uniforms:p,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}),u=new g(e,r),f=new b(u,d);let x,v;if(h.add(f),s){x=document.createElement("canvas");const i=x.getContext("2d");i.font="Bold 20px Arial";const s=i.measureText(t.name).width;x.width=s,x.height=25,i.font="Bold 20px Arial",i.fillStyle="rgba( 255, 0, 0, 1 )",i.fillText(t.name,0,20);const n=new P(x);n.magFilter=C,n.minFilter=C,n.needsUpdate=!0;const a=new m({map:n,side:T});a.transparent=!0;const o=new g(x.width,x.height);v=new b(o,a),h.add(v)}this.enabled=!0,this.size={width:e,height:r,set:function(t,s){this.width=t,this.height=s,f.scale.set(this.width/e,this.height/r,1),i.position.set(i.position.x,i.position.y)}},this.position={x:a,y:o,set:function(t,n){this.x=t,this.y=n;const a=i.size.width,o=i.size.height;f.position.set(-window.innerWidth/2+a/2+this.x,window.innerHeight/2-o/2-this.y,0),s&&v.position.set(f.position.x,f.position.y-i.size.height/2+x.height/2,0)}},this.render=function(i){this.enabled&&(p.tDiffuse.value=t.shadow.map.texture,n=i.autoClear,i.autoClear=!1,i.clearDepth(),i.render(h,_),i.autoClear=n)},this.updateForWindowResize=function(){this.enabled&&(_.left=window.innerWidth/-2,_.right=window.innerWidth/2,_.top=window.innerHeight/2,_.bottom=window.innerHeight/-2,_.updateProjectionMatrix(),this.update())},this.update=function(){this.position.set(this.position.x,this.position.y),this.size.set(this.size.width,this.size.height)},this.update()}}var li=Object.freeze(Object.defineProperty({__proto__:null,default:class{constructor(){i(this,"scene"),i(this,"camera"),i(this,"renderer"),i(this,"controls",null),i(this,"gui",new Ht),i(this,"stats",Gt()),i(this,"axesHelper",new p(3)),i(this,"ambientLight",new u(4210752)),i(this,"spotLight",new f(16777215)),i(this,"dirLight",new I(16777215,1)),i(this,"torusKnot",new b),i(this,"cube",new b),i(this,"ground",new b),i(this,"clock",new j),i(this,"dirLightShadowMapViewer"),i(this,"spotLightShadowMapViewer"),this.scene=new l,this.camera=new d(45,window.innerWidth/window.innerHeight,.1,1e3),this.renderer=new h({antialias:!0}),this.init()}init(){this.initCamera(),this.initRender(),this.initScene(),this.buildGUI(),this.initListener(),this.render()}initCamera(){this.camera.position.set(0,15,35),this.camera.lookAt(0,0,0)}initRender(){this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),document.body.appendChild(this.stats.dom),this.controls=new It(this.camera,this.renderer.domElement)}initScene(){this.initLight(),this.initMesh(),this.initShadow(),this.initHelper(),this.initShadowMapViewer()}initLight(){this.scene.add(this.ambientLight),this.spotLight.name="Spot Light",this.spotLight.angle=Math.PI/5,this.spotLight.penumbra=.3,this.spotLight.position.set(10,10,5),this.scene.add(this.spotLight),this.dirLight.name="Dir. Light",this.dirLight.position.set(0,10,0),this.scene.add(this.dirLight)}initShadow(){this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=E,this.spotLight.castShadow=!0,this.spotLight.shadow.camera.near=8,this.spotLight.shadow.camera.far=30,this.spotLight.shadow.mapSize.width=1024,this.spotLight.shadow.mapSize.height=1024,this.dirLight.castShadow=!0,this.dirLight.shadow.camera.near=1,this.dirLight.shadow.camera.far=10,this.dirLight.shadow.camera.right=15,this.dirLight.shadow.camera.left=-15,this.dirLight.shadow.camera.top=15,this.dirLight.shadow.camera.bottom=-15,this.dirLight.shadow.mapSize.width=1024,this.dirLight.shadow.mapSize.height=1024,this.torusKnot.castShadow=!0,this.torusKnot.receiveShadow=!0,this.cube.castShadow=!0,this.cube.receiveShadow=!0,this.ground.castShadow=!1,this.ground.receiveShadow=!0}initMesh(){const t=new R(25,8,75,20);let i=new v({color:8947848,shininess:150,specular:2236962});this.torusKnot=new b(t,i),this.torusKnot.scale.multiplyScalar(1/18),this.torusKnot.position.y=3,this.scene.add(this.torusKnot);let s=new c(3,3,3);this.cube=new b(s,i),this.cube.position.set(8,3,8),this.scene.add(this.cube),s=new c(10,.15,10),i=new v({color:10530223,shininess:150,specular:1118481}),this.ground=new b(s,i),this.ground.scale.multiplyScalar(3),this.scene.add(this.ground)}initHelper(){this.scene.add(this.axesHelper),this.scene.add(new D(this.spotLight.shadow.camera)),this.scene.add(new D(this.dirLight.shadow.camera))}buildGUI(){this.gui=new Ht,this.gui.close()}initListener(){window.addEventListener("resize",(()=>{var t,i;this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight),this.resizeShadowMapViewer(),null==(t=this.dirLightShadowMapViewer)||t.updateForWindowResize(),null==(i=this.spotLightShadowMapViewer)||i.updateForWindowResize()}))}initShadowMapViewer(){this.dirLightShadowMapViewer=new hi(this.dirLight),this.spotLightShadowMapViewer=new hi(this.spotLight),this.resizeShadowMapViewer()}resizeShadowMapViewer(){const t=.15*window.innerWidth;this.dirLightShadowMapViewer&&(this.dirLightShadowMapViewer.position.x=10,this.dirLightShadowMapViewer.position.y=50,this.dirLightShadowMapViewer.size.width=t,this.dirLightShadowMapViewer.size.height=t,this.dirLightShadowMapViewer.update()),this.spotLightShadowMapViewer&&(this.spotLightShadowMapViewer.size.set(t,t),this.spotLightShadowMapViewer.position.set(t+20,50))}render(){this.animate()}animate(){var t,i;this.renderer.render(this.scene,this.camera),null==(t=this.dirLightShadowMapViewer)||t.render(this.renderer),null==(i=this.spotLightShadowMapViewer)||i.render(this.renderer),this.stats.update();const s=this.clock.getDelta();this.torusKnot.rotation.x+=.25*s,this.torusKnot.rotation.y+=2*s,this.torusKnot.rotation.z+=1*s,this.cube.rotation.x+=.1*s,this.cube.rotation.y+=.2*s,this.cube.rotation.z+=.5*s,requestAnimationFrame((()=>{this.animate()}))}}},Symbol.toStringTag,{value:"Module"}));var ci=Object.freeze(Object.defineProperty({__proto__:null,default:class{constructor(){i(this,"scene"),i(this,"camera"),i(this,"renderer"),i(this,"controls"),i(this,"gui",new Ht),i(this,"stats",Gt()),i(this,"axesHelper",new p(30)),i(this,"cube",new b),i(this,"clock",new j),i(this,"mixer"),this.scene=new l,this.camera=new d(45,window.innerWidth/window.innerHeight,.1,1e3),this.renderer=new h({antialias:!0}),this.init()}init(){this.initCamera(),this.initRender(),this.initScene(),this.buildGUI(),this.initListener(),this.render()}initCamera(){this.camera.position.set(50,50,50),this.camera.lookAt(0,0,0)}initRender(){this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.shadowMap.enabled=!0,document.body.appendChild(this.renderer.domElement),document.body.appendChild(this.stats.dom),this.controls=new It(this.camera,this.renderer.domElement)}initScene(){this.initMesh(),this.initHelper(),this.initAnimation()}initMesh(){const t=new m({color:16777215,transparent:!0}),i=new c(3,3,3);this.cube=new b(i,t),this.cube.position.set(0,0,0),this.scene.add(this.cube)}initHelper(){this.scene.add(this.axesHelper)}initAnimation(){const t=new F(".position",[0,1,2,3],[0,0,0,30,0,0,30,30,0,0,0,0]),i=new F(".scale",[0,1,2,3],[1,1,1,2,2,2,2,2,2,1,1,1]),s=new n(1,0,0),a=(new e).setFromAxisAngle(s,0),o=(new e).setFromAxisAngle(s,Math.PI),r=new q(".quaternion",[0,1,2,3],[a.x,a.y,a.z,a.w,o.x,o.y,o.z,o.w,o.x,o.y,o.z,o.w,a.x,a.y,a.z,a.w]),_=new N(".material.color",[0,1,2,3],[1,0,0,0,1,0,0,0,1,1,0,0],H),h=new O(".material.opacity",[0,1,2,3],[1,0,.5,1]),l=new W("Action",4,[i,t,r,_,h]);this.mixer=new G(this.cube);this.mixer.clipAction(l).play()}buildGUI(){this.gui=new Ht,this.gui.close()}initListener(){window.addEventListener("resize",(()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}))}render(){this.animate()}animate(){this.renderer.render(this.scene,this.camera),this.stats.update();const t=this.clock.getDelta();this.mixer&&this.mixer.update(t),requestAnimationFrame((()=>{this.animate()}))}}},Symbol.toStringTag,{value:"Module"}));class mi extends U{constructor(t){super(t),this.type=J}parse(t){const i=function(t,i){switch(t){case 1:console.error("THREE.RGBELoader Read Error: "+(i||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(i||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(i||""));break;default:console.error("THREE.RGBELoader: Error: "+(i||""))}return-1},s=function(t,i,s){i=i||1024;let n=t.pos,a=-1,o=0,e="",r=String.fromCharCode.apply(null,new Uint16Array(t.subarray(n,n+128)));for(;0>(a=r.indexOf("\n"))&&o<i&&n<t.byteLength;)e+=r,o+=r.length,n+=128,r+=String.fromCharCode.apply(null,new Uint16Array(t.subarray(n,n+128)));return-1<a&&(!1!==s&&(t.pos+=o+a+1),e+r.slice(0,a))},n=function(t,i,s,n){const a=t[i+3],o=Math.pow(2,a-128)/255;s[n+0]=t[i+0]*o,s[n+1]=t[i+1]*o,s[n+2]=t[i+2]*o,s[n+3]=1},a=function(t,i,s,n){const a=t[i+3],o=Math.pow(2,a-128)/255;s[n+0]=K.toHalfFloat(Math.min(t[i+0]*o,65504)),s[n+1]=K.toHalfFloat(Math.min(t[i+1]*o,65504)),s[n+2]=K.toHalfFloat(Math.min(t[i+2]*o,65504)),s[n+3]=K.toHalfFloat(1)},o=new Uint8Array(t);o.pos=0;const e=function(t){const n=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*FORMAT=(\S+)\s*$/,e=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,r={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let _,h;if(t.pos>=t.byteLength||!(_=s(t)))return i(1,"no header found");if(!(h=_.match(/^#\?(\S+)/)))return i(3,"bad initial token");for(r.valid|=1,r.programtype=h[1],r.string+=_+"\n";_=s(t),!1!==_;)if(r.string+=_+"\n","#"!==_.charAt(0)){if((h=_.match(n))&&(r.gamma=parseFloat(h[1])),(h=_.match(a))&&(r.exposure=parseFloat(h[1])),(h=_.match(o))&&(r.valid|=2,r.format=h[1]),(h=_.match(e))&&(r.valid|=4,r.height=parseInt(h[1],10),r.width=parseInt(h[2],10)),2&r.valid&&4&r.valid)break}else r.comments+=_+"\n";return 2&r.valid?4&r.valid?r:i(3,"missing image size specifier"):i(3,"missing format specifier")}(o);if(-1!==e){const t=e.width,s=e.height,r=function(t,s,n){const a=s;if(a<8||a>32767||2!==t[0]||2!==t[1]||128&t[2])return new Uint8Array(t);if(a!==(t[2]<<8|t[3]))return i(3,"wrong scanline width");const o=new Uint8Array(4*s*n);if(!o.length)return i(4,"unable to allocate buffer space");let e=0,r=0;const _=4*a,h=new Uint8Array(4),l=new Uint8Array(_);let c=n;for(;c>0&&r<t.byteLength;){if(r+4>t.byteLength)return i(1);if(h[0]=t[r++],h[1]=t[r++],h[2]=t[r++],h[3]=t[r++],2!=h[0]||2!=h[1]||(h[2]<<8|h[3])!=a)return i(3,"bad rgbe scanline format");let s,n=0;for(;n<_&&r<t.byteLength;){s=t[r++];const a=s>128;if(a&&(s-=128),0===s||n+s>_)return i(3,"bad scanline data");if(a){const i=t[r++];for(let t=0;t<s;t++)l[n++]=i}else l.set(t.subarray(r,r+s),n),n+=s,r+=s}const m=a;for(let t=0;t<m;t++){let i=0;o[e]=l[t+i],i+=a,o[e+1]=l[t+i],i+=a,o[e+2]=l[t+i],i+=a,o[e+3]=l[t+i],e+=4}c--}return o}(o.subarray(o.pos),t,s);if(-1!==r){let i,o,_,h;switch(this.type){case $:h=r.length/4;const t=new Float32Array(4*h);for(let i=0;i<h;i++)n(r,4*i,t,4*i);i=t,_=$;break;case J:h=r.length/4;const s=new Uint16Array(4*h);for(let i=0;i<h;i++)a(r,4*i,s,4*i);i=s,_=J;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:t,height:s,data:i,header:e.string,gamma:e.gamma,exposure:e.exposure,format:o,type:_}}}return null}setDataType(t){return this.type=t,this}load(t,i,s,n){return super.load(t,(function(t,s){switch(t.type){case $:case J:t.encoding=Q,t.minFilter=C,t.magFilter=C,t.generateMipmaps=!1,t.flipY=!0}i&&i(t,s)}),s,n)}}var bi=Object.freeze(Object.defineProperty({__proto__:null,default:class{constructor(){i(this,"scene"),i(this,"camera"),i(this,"renderer"),i(this,"controls"),i(this,"gui",new Ht),i(this,"stats",Gt()),i(this,"axesHelper",new p(30)),i(this,"clock",new j),this.scene=new l,this.camera=new d(45,window.innerWidth/window.innerHeight,.1,1e3),this.renderer=new h({antialias:!0}),this.init()}init(){this.initCamera(),this.initRender(),this.initScene(),this.buildGUI(),this.initListener(),this.render()}initCamera(){this.camera.position.set(-1.8,.6,2.7),this.camera.lookAt(0,0,0)}initRender(){this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.toneMapping=tt,this.renderer.toneMappingExposure=1,this.renderer.outputEncoding=it,document.body.appendChild(this.renderer.domElement),document.body.appendChild(this.stats.dom),this.controls=new It(this.camera,this.renderer.domElement),this.controls.minDistance=2,this.controls.maxDistance=10,this.controls.target.set(0,0,-.2),this.controls.update()}initScene(){this.initHelper(),this.initEnv(),this.initGLTF()}initHelper(){this.scene.add(this.axesHelper)}initEnv(){(new mi).setPath("textures/equirectangular/").load("royal_esplanade_1k.hdr",(t=>{t.mapping=st,this.scene.background=t,this.scene.environment=t}))}initGLTF(){(new vt).setPath("models/gltf/DamagedHelmet/glTF/").load("DamagedHelmet.gltf",(t=>{this.scene.add(t.scene)}))}buildGUI(){this.gui=new Ht,this.gui.close()}initListener(){window.addEventListener("resize",(()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}))}render(){this.animate()}animate(){this.renderer.render(this.scene,this.camera),this.stats.update(),this.clock.getDelta(),requestAnimationFrame((()=>{this.animate()}))}}},Symbol.toStringTag,{value:"Module"}));var pi=Object.freeze(Object.defineProperty({__proto__:null,default:class{constructor(){i(this,"scene"),i(this,"camera"),i(this,"renderer"),i(this,"controls"),i(this,"gui",new Ht),i(this,"stats",Gt()),i(this,"axesHelper",new p(5)),i(this,"clock",new j),i(this,"hemiLight"),i(this,"dirLight"),i(this,"actions",[]),i(this,"model"),i(this,"skeleton"),i(this,"mixer"),this.scene=new l,this.camera=new d(45,window.innerWidth/window.innerHeight,.1,1e3),this.renderer=new h({antialias:!0}),this.init()}init(){this.initCamera(),this.initRender(),this.initScene(),this.buildGUI(),this.initListener(),this.render()}initCamera(){this.camera.position.set(2,2,-5),this.camera.lookAt(0,1,0)}initRender(){this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.outputEncoding=it,this.renderer.shadowMap.enabled=!0,document.body.appendChild(this.renderer.domElement),document.body.appendChild(this.stats.dom),this.controls=new It(this.camera,this.renderer.domElement)}initScene(){this.scene.background=new z(10526880),this.scene.fog=new nt(10526880,10,50),this.initHelper(),this.initLight(),this.initMesh(),this.initGLTF()}initHelper(){this.scene.add(this.axesHelper)}initLight(){this.hemiLight=new X(16777215,4473924),this.hemiLight.position.set(0,20,0),this.scene.add(this.hemiLight),this.dirLight=new I(16777215),this.dirLight.position.set(-3,10,-10),this.dirLight.castShadow=!0,this.dirLight.shadow.camera.top=2,this.dirLight.shadow.camera.bottom=-2,this.dirLight.shadow.camera.left=-2,this.dirLight.shadow.camera.right=2,this.dirLight.shadow.camera.near=.1,this.dirLight.shadow.camera.far=40,this.scene.add(this.dirLight)}initMesh(){const t=new g(100,100),i=new v({color:10066329}),s=new b(t,i);s.rotation.x=-Math.PI/2,s.receiveShadow=!0,this.scene.add(s)}initGLTF(){(new vt).setPath("models/gltf/").load("Soldier.glb",(t=>{const{scene:i,animations:s}=t;i.traverse((t=>{t.isMesh&&(t.castShadow=!0)})),this.model=i,this.scene.add(this.model),this.skeleton=new at(this.model),this.skeleton.visible=!1,this.scene.add(this.skeleton),this.mixer=new G(i);const n=this.mixer.clipAction(s[0]),a=this.mixer.clipAction(s[3]),o=this.mixer.clipAction(s[1]);this.actions=[n,a,o],this.actions[1].play()}))}initListener(){window.addEventListener("resize",(()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}))}buildGUI(){this.gui=new Ht({width:310}),this.visibleGUI(),this.activeGUI(),this.weightGUI()}visibleGUI(){const t={"show model":!0,"show skeleton":!1},i=this.gui.addFolder("Visibility");i.add(t,"show model").onChange((t=>{this.model&&(this.model.visible=t)})),i.add(t,"show skeleton").onChange((t=>{this.skeleton&&(this.skeleton.visible=t)}))}activeGUI(){const t={"deactivate all":()=>{this.actions.forEach((t=>{t.stop()}))},"activate all":()=>{this.actions.forEach((t=>{t.play()}))},"pause/continue":()=>{this.actions[0].paused?this.actions.forEach((t=>{t.paused=!1})):this.actions.forEach((t=>{t.paused=!0}))}},i=this.gui.addFolder("Active");i.add(t,"deactivate all"),i.add(t,"activate all"),i.add(t,"pause/continue")}weightGUI(){const t={"modify idle weight":0,"modify walk weight":1,"modify run weight":0,"modify time scale":1},i=(t,i)=>{t.enabled=!0,t.setEffectiveTimeScale(1),t.setEffectiveWeight(i)},s=this.gui.addFolder("Weight");s.add(t,"modify idle weight",0,1,.01).listen().onChange((t=>{i(this.actions[0],t)})),s.add(t,"modify walk weight",0,1,.01).listen().onChange((t=>{i(this.actions[1],t)})),s.add(t,"modify run weight",0,1,.01).listen().onChange((t=>{i(this.actions[2],t)})),s.add(t,"modify time scale",0,1.5,.01).onChange((t=>{this.mixer&&(this.mixer.timeScale=t)}))}render(){this.animate()}animate(){this.renderer.render(this.scene,this.camera),this.stats.update();const t=this.clock.getDelta();this.mixer&&this.mixer.update(t),requestAnimationFrame((()=>{this.animate()}))}}},Symbol.toStringTag,{value:"Module"}));const di=new WeakMap;class ui extends ot{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,i,s,n){const a=new et(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(t=>{const s={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(t,s).then(i).catch(n)}),s,n)}decodeDracoFile(t,i,s,n){const a={attributeIDs:s||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!s};this.decodeGeometry(t,a).then(i)}decodeGeometry(t,i){for(const r in i.attributeTypes){const t=i.attributeTypes[r];void 0!==t.BYTES_PER_ELEMENT&&(i.attributeTypes[r]=t.name)}const s=JSON.stringify(i);if(di.has(t)){const i=di.get(t);if(i.key===s)return i.promise;if(0===t.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const a=this.workerNextTaskID++,o=t.byteLength,e=this._getWorker(a,o).then((s=>(n=s,new Promise(((s,o)=>{n._callbacks[a]={resolve:s,reject:o},n.postMessage({type:"decode",id:a,taskConfig:i,buffer:t},[t])}))))).then((t=>this._createGeometry(t.geometry)));return e.catch((()=>!0)).then((()=>{n&&a&&this._releaseTask(n,a)})),di.set(t,{key:s,promise:e}),e}_createGeometry(t){const i=new rt;t.index&&i.setIndex(new _t(t.index.array,1));for(let s=0;s<t.attributes.length;s++){const n=t.attributes[s],a=n.name,o=n.array,e=n.itemSize;i.setAttribute(a,new _t(o,e))}return i}_loadLibrary(t,i){const s=new et(this.manager);return s.setPath(this.decoderPath),s.setResponseType(i),s.setWithCredentials(this.withCredentials),new Promise(((i,n)=>{s.load(t,i,void 0,n)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,i=[];return t?i.push(this._loadLibrary("draco_decoder.js","text")):(i.push(this._loadLibrary("draco_wasm_wrapper.js","text")),i.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(i).then((i=>{const s=i[0];t||(this.decoderConfig.wasmBinary=i[1]);const n=fi.toString(),a=["/* draco decoder */",s,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([a]))})),this.decoderPending}_getWorker(t,i){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const t=new Worker(this.workerSourceURL);t._callbacks={},t._taskCosts={},t._taskLoad=0,t.postMessage({type:"init",decoderConfig:this.decoderConfig}),t.onmessage=function(i){const s=i.data;switch(s.type){case"decode":t._callbacks[s.id].resolve(s);break;case"error":t._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(t)}else this.workerPool.sort((function(t,i){return t._taskLoad>i._taskLoad?-1:1}));const s=this.workerPool[this.workerPool.length-1];return s._taskCosts[t]=i,s._taskLoad+=i,s}))}_releaseTask(t,i){t._taskLoad-=t._taskCosts[i],delete t._callbacks[i],delete t._taskCosts[i]}debug(){console.log("Task load: ",this.workerPool.map((t=>t._taskLoad)))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this}}function fi(){let t,i;function s(t,i,s,n,a,o){const e=o.num_components(),r=s.num_points()*e,_=r*a.BYTES_PER_ELEMENT,h=function(t,i){switch(i){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32}}(t,a),l=t._malloc(_);i.GetAttributeDataArrayForAllPoints(s,o,h,_,l);const c=new a(t.HEAPF32.buffer,l,r).slice();return t._free(l),{name:n,array:c,itemSize:e}}onmessage=function(n){const a=n.data;switch(a.type){case"init":t=a.decoderConfig,i=new Promise((function(i){t.onModuleLoaded=function(t){i({draco:t})},DracoDecoderModule(t)}));break;case"decode":const n=a.buffer,o=a.taskConfig;i.then((t=>{const i=t.draco,e=new i.Decoder,r=new i.DecoderBuffer;r.Init(new Int8Array(n),n.byteLength);try{const t=function(t,i,n,a){const o=a.attributeIDs,e=a.attributeTypes;let r,_;const h=i.GetEncodedGeometryType(n);if(h===t.TRIANGULAR_MESH)r=new t.Mesh,_=i.DecodeBufferToMesh(n,r);else{if(h!==t.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");r=new t.PointCloud,_=i.DecodeBufferToPointCloud(n,r)}if(!_.ok()||0===r.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+_.error_msg());const l={index:null,attributes:[]};for(const c in o){const n=self[e[c]];let _,h;if(a.useUniqueIDs)h=o[c],_=i.GetAttributeByUniqueId(r,h);else{if(h=i.GetAttributeId(r,t[o[c]]),-1===h)continue;_=i.GetAttribute(r,h)}l.attributes.push(s(t,i,r,c,n,_))}h===t.TRIANGULAR_MESH&&(l.index=function(t,i,s){const n=3*s.num_faces(),a=4*n,o=t._malloc(a);i.GetTrianglesUInt32Array(s,a,o);const e=new Uint32Array(t.HEAPF32.buffer,o,n).slice();return t._free(o),{array:e,itemSize:1}}(t,i,r));return t.destroy(r),l}(i,e,r,o),n=t.attributes.map((t=>t.array.buffer));t.index&&n.push(t.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:t},n)}catch(_){console.error(_),self.postMessage({type:"error",id:a.id,error:_.message})}finally{i.destroy(r),i.destroy(e)}}))}}}class xi extends l{constructor(){super();const t=new c;t.deleteAttribute("uv");const i=new ht({side:lt}),s=new ht,n=new ct(16777215,5,28,2);n.position.set(.418,16.199,.3),this.add(n);const a=new b(t,i);a.position.set(-.757,13.219,.717),a.scale.set(31.713,28.305,28.591),this.add(a);const o=new b(t,s);o.position.set(-10.906,2.009,1.846),o.rotation.set(0,-.195,0),o.scale.set(2.328,7.905,4.651),this.add(o);const e=new b(t,s);e.position.set(-5.607,-.754,-.758),e.rotation.set(0,.994,0),e.scale.set(1.97,1.534,3.955),this.add(e);const r=new b(t,s);r.position.set(6.167,.857,7.803),r.rotation.set(0,.561,0),r.scale.set(3.927,6.285,3.687),this.add(r);const _=new b(t,s);_.position.set(-2.017,.018,6.124),_.rotation.set(0,.333,0),_.scale.set(2.002,4.566,2.064),this.add(_);const h=new b(t,s);h.position.set(2.291,-.756,-2.621),h.rotation.set(0,-.286,0),h.scale.set(1.546,1.552,1.496),this.add(h);const l=new b(t,s);l.position.set(-2.193,-.369,-5.547),l.rotation.set(0,.516,0),l.scale.set(3.875,3.487,2.986),this.add(l);const m=new b(t,gi(50));m.position.set(-16.116,14.37,8.208),m.scale.set(.1,2.428,2.739),this.add(m);const p=new b(t,gi(50));p.position.set(-16.109,18.021,-8.207),p.scale.set(.1,2.425,2.751),this.add(p);const d=new b(t,gi(17));d.position.set(14.904,12.198,-1.832),d.scale.set(.15,4.265,6.331),this.add(d);const u=new b(t,gi(43));u.position.set(-.462,8.89,14.52),u.scale.set(4.38,5.441,.088),this.add(u);const f=new b(t,gi(20));f.position.set(3.235,11.486,-12.541),f.scale.set(2.5,2,.1),this.add(f);const x=new b(t,gi(100));x.position.set(0,20,0),x.scale.set(1,.1,1),this.add(x)}}function gi(t){const i=new m;return i.color.setScalar(t),i}var vi=Object.freeze(Object.defineProperty({__proto__:null,default:class{constructor(){i(this,"scene"),i(this,"camera"),i(this,"renderer"),i(this,"controls"),i(this,"gui",new Ht),i(this,"stats",Gt()),i(this,"axesHelper",new p(10)),i(this,"clock",new j),i(this,"mixer"),this.scene=new l,this.camera=new d(40,window.innerWidth/window.innerHeight,.1,1e3),this.renderer=new h({antialias:!0}),this.init()}init(){this.initCamera(),this.initRender(),this.initScene(),this.buildGUI(),this.initListener(),this.render()}initCamera(){this.camera.position.set(5,2,8),this.camera.lookAt(0,0,0)}initRender(){this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.toneMapping=tt,this.renderer.toneMappingExposure=1,this.renderer.outputEncoding=it,document.body.appendChild(this.renderer.domElement),document.body.appendChild(this.stats.dom),this.controls=new It(this.camera,this.renderer.domElement),this.controls.target.set(0,.5,0),this.controls.enablePan=!1,this.controls.enableDamping=!0}initScene(){this.scene.background=new z(12575709),this.initHelper(),this.initEnv(),this.initGLTF()}initHelper(){this.scene.add(this.axesHelper)}initEnv(){const t=new mt(this.renderer);this.scene.environment=t.fromScene(new xi,.04).texture}initGLTF(){const t=new vt,i=new ui;i.setDecoderPath("js/libs/draco/gltf/"),t.setPath("models/gltf/"),t.setDRACOLoader(i),t.load("LittlestTokyo.glb",(t=>{const{scene:i,animations:s}=t;i.position.set(1,1,0),i.scale.set(.01,.01,.01),this.scene.add(i),this.mixer=new G(i),this.mixer.clipAction(s[0]).play()}))}buildGUI(){this.gui=new Ht,this.gui.close()}initListener(){window.addEventListener("resize",(()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}))}render(){this.animate()}animate(){var t,i;this.renderer.render(this.scene,this.camera),this.stats.update(),null==(t=this.controls)||t.update();const s=this.clock.getDelta();null==(i=this.mixer)||i.update(s),requestAnimationFrame((()=>{this.animate()}))}}},Symbol.toStringTag,{value:"Module"}));var yi=Object.freeze(Object.defineProperty({__proto__:null,default:class{constructor(){i(this,"scene"),i(this,"camera"),i(this,"renderer"),i(this,"controls",null),i(this,"gui",new Ht),i(this,"stats",Gt()),i(this,"axesHelper",new p(3)),i(this,"ambientLight",new u(4210752)),i(this,"spotLight",new f(16777215)),i(this,"dirLight",new I(16777215,1)),i(this,"torusKnot",new b),i(this,"cube",new b),i(this,"ground",new b),i(this,"clock",new j),i(this,"globalPlane",new bt(new n(-1,0,0),9)),i(this,"cubeClip",new bt(new n(0,1,0),-3)),i(this,"torusKnotClip",new bt(new n(-1,0,0),.1)),this.scene=new l,this.camera=new d(45,window.innerWidth/window.innerHeight,.1,1e3),this.renderer=new h({antialias:!0}),this.init()}init(){this.initCamera(),this.initRender(),this.initScene(),this.buildGUI(),this.initListener(),this.render()}initCamera(){this.camera.position.set(0,15,35),this.camera.lookAt(0,0,0)}initRender(){this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),document.body.appendChild(this.stats.dom),this.controls=new It(this.camera,this.renderer.domElement)}initScene(){this.initLight(),this.initMesh(),this.initShadow(),this.initHelper(),this.initClipping()}initLight(){this.scene.add(this.ambientLight),this.spotLight.name="Spot Light",this.spotLight.angle=Math.PI/5,this.spotLight.penumbra=.3,this.spotLight.position.set(10,10,5),this.scene.add(this.spotLight),this.dirLight.name="Dir. Light",this.dirLight.position.set(0,10,0),this.scene.add(this.dirLight)}initShadow(){this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=E,this.spotLight.castShadow=!0,this.spotLight.shadow.camera.near=8,this.spotLight.shadow.camera.far=30,this.spotLight.shadow.mapSize.width=1024,this.spotLight.shadow.mapSize.height=1024,this.dirLight.castShadow=!0,this.dirLight.shadow.camera.near=1,this.dirLight.shadow.camera.far=10,this.dirLight.shadow.camera.right=15,this.dirLight.shadow.camera.left=-15,this.dirLight.shadow.camera.top=15,this.dirLight.shadow.camera.bottom=-15,this.dirLight.shadow.mapSize.width=1024,this.dirLight.shadow.mapSize.height=1024,this.torusKnot.castShadow=!0,this.torusKnot.receiveShadow=!0,this.cube.castShadow=!0,this.cube.receiveShadow=!0,this.ground.castShadow=!1,this.ground.receiveShadow=!0}initMesh(){const t=new R(25,8,75,20);let i=new v({color:8947848,shininess:150,specular:2236962,side:T,clippingPlanes:[this.torusKnotClip],clipShadows:!0});this.torusKnot=new b(t,i),this.torusKnot.scale.multiplyScalar(1/18),this.torusKnot.position.y=3,this.scene.add(this.torusKnot);let s=new c(3,3,3);const n=new v({color:8947848,shininess:150,specular:2236962,side:T});this.cube=new b(s,n),this.cube.position.set(8,3,8),this.scene.add(this.cube),s=new c(10,.15,10),i=new v({color:10530223,shininess:150,specular:1118481}),this.ground=new b(s,i),this.ground.scale.multiplyScalar(3),this.scene.add(this.ground)}initHelper(){this.scene.add(this.axesHelper)}initClipping(){this.renderer.clippingPlanes=[this.globalPlane],this.renderer.localClippingEnabled=!0,Object.assign(this.cube.material,{clippingPlanes:[this.cubeClip],clipShadows:!0})}buildGUI(){this.gui=new Ht,this.globalClipGUI(),this.localClipGUI()}globalClipGUI(){const t=this.gui.addFolder("Global"),i={"Enabled/Disabled":()=>{this.renderer.clippingPlanes.length?this.renderer.clippingPlanes=[]:this.renderer.clippingPlanes=[this.globalPlane]}};t.add(i,"Enabled/Disabled"),t.add(this.globalPlane,"constant",-15,15)}localClipGUI(){const t=this.gui.addFolder("Local"),i={"Enabled/Disabled Locale Clip":()=>{this.renderer.localClippingEnabled=!this.renderer.localClippingEnabled}};t.add(i,"Enabled/Disabled Locale Clip"),t.add(this.cubeClip,"constant",-5,0).name("cube clip"),t.add(this.torusKnotClip,"constant",-10,10).name("torus clip")}initListener(){window.addEventListener("resize",(()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}))}render(){this.animate()}animate(){this.renderer.render(this.scene,this.camera),this.stats.update();const t=this.clock.getDelta();this.torusKnot.rotation.x+=.25*t,this.torusKnot.rotation.y+=2*t,this.torusKnot.rotation.z+=1*t,this.cube.rotation.x+=.1*t,this.cube.rotation.y+=.2*t,this.cube.rotation.z+=.5*t,requestAnimationFrame((()=>{this.animate()}))}}},Symbol.toStringTag,{value:"Module"}));var Xi=Object.freeze(Object.defineProperty({__proto__:null,default:class{constructor(){i(this,"scene"),i(this,"camera"),i(this,"renderer"),i(this,"controls",null),i(this,"stats",Gt()),i(this,"axesHelper",new p(3)),i(this,"cube",new b),i(this,"clock",new j),this.scene=new l,this.camera=new d(70,window.innerWidth/window.innerHeight,.1,1e3),this.renderer=new h({antialias:!0}),this.init()}init(){this.initCamera(),this.initRender(),this.initScene(),this.initListener(),this.render()}initCamera(){this.camera.position.set(0,0,400),this.camera.lookAt(0,0,0)}initRender(){this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),document.body.appendChild(this.stats.dom),this.controls=new It(this.camera,this.renderer.domElement)}initScene(){this.initMesh(),this.initHelper()}initMesh(){const t=(new pt).load("textures/crate.gif"),i=new c(200,200,200),s=new m({map:t});this.cube=new b(i,s),this.scene.add(this.cube)}initHelper(){this.scene.add(this.axesHelper)}initListener(){window.addEventListener("resize",(()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}))}render(){this.animate()}animate(){var t;this.renderer.render(this.scene,this.camera),this.stats.update(),null==(t=this.controls)||t.update();const i=this.clock.getDelta();this.cube.rotation.x+=.1*i,this.cube.rotation.y+=.2*i,this.cube.rotation.z+=.5*i,requestAnimationFrame((()=>{this.animate()}))}}},Symbol.toStringTag,{value:"Module"})),zi="varying vec2 vUv;\n\nuniform float time;\n\nvoid main(){\n  vec2 p=-1.+2.*vUv;\n  float a=time*40.;\n  float d,e,f,g=1./40.,h,i,r,q;\n\n  e=400.*(p.x*.5+.5);\n  f=400.*(p.y*.5+.5);\n  i=200.+sin(e*g+a/150.)*20.;\n  d=200.+cos(f*g/2.)*18.+cos(e*g)*7.;\n  r=sqrt(pow(abs(i-e),2.)+pow(abs(d-f),2.));\n  q=f/r;\n  e=(r*cos(q))-a/2.;\n  f=(r*sin(q))-a/2.;\n  d=sin(e*g)*176.+sin(e*g)*164.+r;\n  h=((f+d)+a/2.)*g;\n  i=cos(h+r*p.x/1.3)*(e+e+a)+cos(q*g*6.)*(r+h/3.);\n  h=sin(f*g)*144.-sin(e*g)*212.*p.x;\n  h=(h+(f-e)*q+sin(r-(a+h)/7.)*10.+i/4.)*g;\n  i+=cos(h*2.3*sin(a/350.-q))*184.*sin(q-(r*4.3+a/12.)*g)+tan(r*g+h)*184.*cos(r*g+h);\n  i=mod(i/5.6,256.)/64.;\n  if(i<0.)i+=4.;\n  if(i>=2.)i=4.-i;\n  d=r/350.;\n  d+=sin(d*d*8.)*.52;\n  f=(sin(a*g)+1.)/2.;\n  gl_FragColor=vec4(vec3(f*i/1.6,i/2.+d/13.,i)*d*p.x+vec3(i/1.3+d/8.,i/2.+d/18.,i)*d*(1.-p.x),1.);\n}";var Mi=Object.freeze(Object.defineProperty({__proto__:null,default:class{constructor(){i(this,"scene"),i(this,"camera"),i(this,"renderer"),i(this,"stats",Gt()),i(this,"mesh",new b),i(this,"uniforms",{time:{value:1}}),this.scene=new l,this.camera=new k(-1,1,1,-1,0,1),this.renderer=new h({antialias:!0}),this.init()}init(){this.initRender(),this.initScene(),this.initListener(),this.render()}initRender(){this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),document.body.appendChild(this.stats.dom)}initScene(){const t=new g(2,2),i=new B({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\n\nvoid main () {\n  vUv = uv;\n  gl_Position = vec4(position, 1.0);\n}",fragmentShader:zi});this.mesh=new b(t,i),this.scene.add(this.mesh)}initListener(){window.addEventListener("resize",(()=>{this.renderer.setSize(window.innerWidth,window.innerHeight)}))}render(){this.animate()}animate(){this.renderer.render(this.scene,this.camera),this.stats.update(),this.uniforms.time.value=performance.now()/1e3,requestAnimationFrame((()=>{this.animate()}))}}},Symbol.toStringTag,{value:"Module"})),Yi="varying vec2 vUv;\n\nvoid main()\n{\n\tvUv=uv;\n\tvec4 mvPosition=modelViewMatrix*vec4(position,1.);\n\tgl_Position=projectionMatrix*mvPosition;\n}";var Zi=Object.freeze(Object.defineProperty({__proto__:null,default:class{constructor(){i(this,"scene"),i(this,"camera"),i(this,"renderer"),i(this,"controls"),i(this,"stats",Gt()),i(this,"clock",new j),i(this,"mesh",new b),i(this,"uniforms1",{time:{value:1}}),i(this,"uniforms2",{time:{value:1},colorTexture:{value:(new pt).load("textures/disturb.jpg")}}),this.scene=new l,this.camera=new d(40,window.innerWidth/window.innerHeight,1,3e3),this.renderer=new h({antialias:!0}),this.init()}init(){this.initCamera(),this.initRender(),this.initScene(),this.initListener(),this.render()}initCamera(){this.camera.position.z=4}initRender(){this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),document.body.appendChild(this.stats.dom),this.controls=new It(this.camera,this.renderer.domElement)}initScene(){this.uniforms2.colorTexture.value.wrapS=dt,this.uniforms2.colorTexture.value.wrapT=dt;const t={shader1:{uniform:this.uniforms1,frag:zi},shader2:{uniform:this.uniforms2,frag:"// accoding to https://www.shadertoy.com/view/XsVSDz\nuniform float time;\n\nuniform sampler2D colorTexture;\n\nvarying vec2 vUv;\n\nvoid main(void){\n  vec2 vp = vec2(320.0, 200.0);\n  float t = time * 10.0;\n  vec2 p0 = (vUv - 0.5) * vp;\n  vec2 hvp = vp * 0.5;\n\n  vec2 p1d = vec2(cos( t / 98.0),  sin( t / 178.0)) * hvp - p0;\n\tvec2 p2d = vec2(sin(-t / 124.0), cos(-t / 104.0)) * hvp - p0;\n\tvec2 p3d = vec2(cos(-t / 165.0), cos( t / 45.0))  * hvp - p0;\n  \n  float sum = 0.5 + 0.5 * (\n\t\tcos(length(p1d) / 30.0) +\n\t\tcos(length(p2d) / 20.0) +\n\t\tsin(length(p3d) / 25.0) * sin(p3d.x / 20.0) * sin(p3d.y / 15.0));\n  \n  gl_FragColor=texture2D(colorTexture, vec2(fract(sum), 0));\n}"},shader3:{uniform:this.uniforms1,frag:"uniform float time;\n\nvarying vec2 vUv;\n\nvoid main(void){\n  \n  vec2 position=vUv;\n  \n  float color=0.;\n  color+=sin(position.x*cos(time/15.)*80.)+cos(position.y*cos(time/15.)*10.);\n  color+=sin(position.y*sin(time/10.)*40.)+cos(position.x*sin(time/25.)*40.);\n  color+=sin(position.x*sin(time/5.)*10.)+sin(position.y*sin(time/35.)*80.);\n  color*=sin(time/10.)*.5;\n  \n  gl_FragColor=vec4(vec3(color,color*.5,sin(color+time/3.)*.75),1.);\n  \n}\n"},shader4:{uniform:this.uniforms1,frag:"uniform float time;\n\nvarying vec2 vUv;\n\nvoid main(void){\n  \n  vec2 position=-1.+2.*vUv;\n  \n  float red=abs(sin(position.x*position.y+time/5.));\n  float green=abs(sin(position.x*position.y+time/4.));\n  float blue=abs(sin(position.x*position.y+time/3.));\n  gl_FragColor=vec4(red,green,blue,1.);\n  \n}"}},i=new c(.75,.75,.75);Object.keys(t).forEach(((s,n)=>{const a=t[s],o=new B({uniforms:a.uniform,vertexShader:Yi,fragmentShader:a.frag}),e=new b(i,o);e.position.x=n-(Object.keys(t).length-1)/2,e.position.y=n%2-.5,this.scene.add(e)}))}initListener(){window.addEventListener("resize",(()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}))}render(){this.animate()}animate(){var t;this.renderer.render(this.scene,this.camera),this.stats.update(),null==(t=this.controls)||t.update();const i=this.clock.getDelta();this.uniforms1.time.value+=5*i,this.uniforms2.time.value=this.clock.elapsedTime;for(let s=0;s<this.scene.children.length;s++){const t=this.scene.children[s];t.rotation.y+=.5*i*(s%2?1:-1),t.rotation.x+=.5*i*(s%2?-1:1)}requestAnimationFrame((()=>{this.animate()}))}}},Symbol.toStringTag,{value:"Module"}));const wi={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor.a *= opacity;\n\n\n\t\t}"};class Ii{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const Vi=new k(-1,1,1,-1,0,1),Li=new rt;Li.setAttribute("position",new ut([-1,3,0,-1,-1,0,3,-1,0],3)),Li.setAttribute("uv",new ut([0,2,0,0,2,0],2));class Ai{constructor(t){this._mesh=new b(Li,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,Vi)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}}class ki extends Ii{constructor(t,i){super(),this.textureID=void 0!==i?i:"tDiffuse",t instanceof B?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=S.clone(t.uniforms),this.material=new B({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new Ai(this.material)}render(t,i,s){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=s.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(i),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}}class Si extends Ii{constructor(t,i){super(),this.scene=t,this.camera=i,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(t,i,s){const n=t.getContext(),a=t.state;let o,e;a.buffers.color.setMask(!1),a.buffers.depth.setMask(!1),a.buffers.color.setLocked(!0),a.buffers.depth.setLocked(!0),this.inverse?(o=0,e=1):(o=1,e=0),a.buffers.stencil.setTest(!0),a.buffers.stencil.setOp(n.REPLACE,n.REPLACE,n.REPLACE),a.buffers.stencil.setFunc(n.ALWAYS,o,4294967295),a.buffers.stencil.setClear(e),a.buffers.stencil.setLocked(!0),t.setRenderTarget(s),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(i),this.clear&&t.clear(),t.render(this.scene,this.camera),a.buffers.color.setLocked(!1),a.buffers.depth.setLocked(!1),a.buffers.stencil.setLocked(!1),a.buffers.stencil.setFunc(n.EQUAL,1,4294967295),a.buffers.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),a.buffers.stencil.setLocked(!0)}}class Bi extends Ii{constructor(){super(),this.needsSwap=!1}render(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}}class Pi{constructor(t,i){if(this.renderer=t,void 0===i){const s=t.getSize(new _);this._pixelRatio=t.getPixelRatio(),this._width=s.width,this._height=s.height,(i=new ft(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=i.width,this._height=i.height;this.renderTarget1=i,this.renderTarget2=i.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===wi&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===ki&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new ki(wi),this.clock=new j}swapBuffers(){const t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}addPass(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(t,i){this.passes.splice(i,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(t){const i=this.passes.indexOf(t);-1!==i&&this.passes.splice(i,1)}isLastEnabledPass(t){for(let i=t+1;i<this.passes.length;i++)if(this.passes[i].enabled)return!1;return!0}render(t){void 0===t&&(t=this.clock.getDelta());const i=this.renderer.getRenderTarget();let s=!1;for(let n=0,a=this.passes.length;n<a;n++){const i=this.passes[n];if(!1!==i.enabled){if(i.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),i.render(this.renderer,this.writeBuffer,this.readBuffer,t,s),i.needsSwap){if(s){const i=this.renderer.getContext(),s=this.renderer.state.buffers.stencil;s.setFunc(i.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),s.setFunc(i.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==Si&&(i instanceof Si?s=!0:i instanceof Bi&&(s=!1))}}this.renderer.setRenderTarget(i)}reset(t){if(void 0===t){const i=this.renderer.getSize(new _);this._pixelRatio=this.renderer.getPixelRatio(),this._width=i.width,this._height=i.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(t,i){this._width=t,this._height=i;const s=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(s,n),this.renderTarget2.setSize(s,n);for(let a=0;a<this.passes.length;a++)this.passes[a].setSize(s,n)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}}new k(-1,1,1,-1,0,1);const Ci=new rt;Ci.setAttribute("position",new ut([-1,3,0,-1,-1,0,3,-1,0],3)),Ci.setAttribute("uv",new ut([0,2,0,0,2,0],2));class Ti extends Ii{constructor(t,i,s,n,a){super(),this.scene=t,this.camera=i,this.overrideMaterial=s,this.clearColor=n,this.clearAlpha=void 0!==a?a:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new z}render(t,i,s){const n=t.autoClear;let a,o;t.autoClear=!1,void 0!==this.overrideMaterial&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(t.getClearColor(this._oldClearColor),a=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:s),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor&&t.setClearColor(this._oldClearColor,a),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=o),t.autoClear=n}}const ji={uniforms:{tDiffuse:{value:null},time:{value:0},nIntensity:{value:.5},sIntensity:{value:.05},sCount:{value:4096},grayscale:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\n\t\t// control parameter\n\t\tuniform float time;\n\n\t\tuniform bool grayscale;\n\n\t\t// noise effect intensity value (0 = no effect, 1 = full effect)\n\t\tuniform float nIntensity;\n\n\t\t// scanlines effect intensity value (0 = no effect, 1 = full effect)\n\t\tuniform float sIntensity;\n\n\t\t// scanlines effect count value (0 = no effect, 4096 = full effect)\n\t\tuniform float sCount;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t// sample the source\n\t\t\tvec4 cTextureScreen = texture2D( tDiffuse, vUv );\n\n\t\t// make some noise\n\t\t\tfloat dx = rand( vUv + time );\n\n\t\t// add noise\n\t\t\tvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx, 0.0, 1.0 );\n\n\t\t// get us a sine and cosine\n\t\t\tvec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );\n\n\t\t// add scanlines\n\t\t\tcResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;\n\n\t\t// interpolate between source and result by intensity\n\t\t\tcResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );\n\n\t\t// convert to grayscale if desired\n\t\t\tif( grayscale ) {\n\n\t\t\t\tcResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );\n\n\t\t\t}\n\n\t\t\tgl_FragColor =  vec4( cResult, cTextureScreen.a );\n\n\t\t}"};class Ei extends Ii{constructor(t,i,s,n){super(),void 0===ji&&console.error("THREE.FilmPass relies on FilmShader");const a=ji;this.uniforms=S.clone(a.uniforms),this.material=new B({uniforms:this.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}),void 0!==n&&(this.uniforms.grayscale.value=n),void 0!==t&&(this.uniforms.nIntensity.value=t),void 0!==i&&(this.uniforms.sIntensity.value=i),void 0!==s&&(this.uniforms.sCount.value=s),this.fsQuad=new Ai(this.material)}render(t,i,s,n){this.uniforms.tDiffuse.value=s.texture,this.uniforms.time.value+=n,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(i),this.clear&&t.clear(),this.fsQuad.render(t))}}const Ri={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{value:null},uImageIncrement:{value:new _(.001953125,0)},cKernel:{value:[]}},vertexShader:"\n\n\t\tuniform vec2 uImageIncrement;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float cKernel[ KERNEL_SIZE_INT ];\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec2 uImageIncrement;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec2 imageCoord = vUv;\n\t\t\tvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );\n\n\t\t\tfor( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {\n\n\t\t\t\tsum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];\n\t\t\t\timageCoord += uImageIncrement;\n\n\t\t\t}\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}",buildKernel:function(t){let i=2*Math.ceil(3*t)+1;i>25&&(i=25);const s=.5*(i-1),n=new Array(i);let a=0;for(let o=0;o<i;++o)n[o]=Di(o-s,t),a+=n[o];for(let o=0;o<i;++o)n[o]/=a;return n}};function Di(t,i){return Math.exp(-t*t/(2*i*i))}class Fi extends Ii{constructor(t=1,i=25,s=4,n=256){super(),this.renderTargetX=new ft(n,n),this.renderTargetX.texture.name="BloomPass.x",this.renderTargetY=new ft(n,n),this.renderTargetY.texture.name="BloomPass.y",this.combineUniforms=S.clone(qi.uniforms),this.combineUniforms.strength.value=t,this.materialCombine=new B({uniforms:this.combineUniforms,vertexShader:qi.vertexShader,fragmentShader:qi.fragmentShader,blending:xt,transparent:!0}),void 0===Ri&&console.error("THREE.BloomPass relies on ConvolutionShader");const a=Ri;this.convolutionUniforms=S.clone(a.uniforms),this.convolutionUniforms.uImageIncrement.value=Fi.blurX,this.convolutionUniforms.cKernel.value=Ri.buildKernel(s),this.materialConvolution=new B({uniforms:this.convolutionUniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,defines:{KERNEL_SIZE_FLOAT:i.toFixed(1),KERNEL_SIZE_INT:i.toFixed(0)}}),this.needsSwap=!1,this.fsQuad=new Ai(null)}render(t,i,s,n,a){a&&t.state.buffers.stencil.setTest(!1),this.fsQuad.material=this.materialConvolution,this.convolutionUniforms.tDiffuse.value=s.texture,this.convolutionUniforms.uImageIncrement.value=Fi.blurX,t.setRenderTarget(this.renderTargetX),t.clear(),this.fsQuad.render(t),this.convolutionUniforms.tDiffuse.value=this.renderTargetX.texture,this.convolutionUniforms.uImageIncrement.value=Fi.blurY,t.setRenderTarget(this.renderTargetY),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.materialCombine,this.combineUniforms.tDiffuse.value=this.renderTargetY.texture,a&&t.state.buffers.stencil.setTest(!0),t.setRenderTarget(s),this.clear&&t.clear(),this.fsQuad.render(t)}}const qi={uniforms:{tDiffuse:{value:null},strength:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float strength;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = strength * texel;\n\n\t\t}"};Fi.blurX=new _(.001953125,0),Fi.blurY=new _(0,.001953125);var Ni=Object.freeze(Object.defineProperty({__proto__:null,default:class{constructor(){i(this,"scene"),i(this,"camera"),i(this,"renderer"),i(this,"controls"),i(this,"composer"),i(this,"stats",Gt()),i(this,"clock",new j),i(this,"mesh",new b),i(this,"uniforms",{fogDensity:{value:.45},fogColor:{value:new n(0,0,0)},time:{value:1},uvScale:{value:new _(3,1)},texture1:{value:(new pt).load("textures/lava/cloud.png")},texture2:{value:(new pt).load("textures/lava/lavatile.jpg")}}),this.scene=new l,this.camera=new d(35,window.innerWidth/window.innerHeight,1,3e3),this.renderer=new h({antialias:!0}),this.init()}init(){this.initCamera(),this.initRender(),this.initScene(),this.initPostProcess(),this.initListener(),this.render()}initCamera(){this.camera.position.z=4}initRender(){this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),document.body.appendChild(this.stats.dom),this.controls=new It(this.camera,this.renderer.domElement),this.composer=new Pi(this.renderer)}initScene(){this.uniforms.texture1.value.wrapS=dt,this.uniforms.texture1.value.wrapT=dt,this.uniforms.texture2.value.wrapS=dt,this.uniforms.texture2.value.wrapT=dt;const t=new gt(.65,.3,30,30),i=new B({uniforms:this.uniforms,vertexShader:Yi,fragmentShader:"uniform float time;\n\nuniform float fogDensity;\nuniform vec3 fogColor;\n\nuniform sampler2D texture1;\nuniform sampler2D texture2;\n\nuniform vec2 uvScale;\n\nvarying vec2 vUv;\n\nvoid main(void){\n  vec2 sUv = uvScale * vUv;\n  vec2 position=-1.+2.*sUv;\n  \n  vec4 noise=texture2D(texture1,sUv);\n  vec2 T1=sUv+vec2(1.5,-1.5)*time*.02;\n  vec2 T2=sUv+vec2(-.5,2.)*time*.01;\n  \n  T1.x+=noise.x*2.;\n  T1.y+=noise.y*2.;\n  T2.x-=noise.y*.2;\n  T2.y+=noise.z*.2;\n  \n  float p=texture2D(texture1,T1*2.).a;\n  \n  vec4 color=texture2D(texture2,T2*2.);\n  vec4 temp=color*(vec4(p,p,p,p)*2.)+(color*color-.1);\n  \n  if(temp.r>1.){temp.bg+=clamp(temp.r-2.,0.,100.);}\n  if(temp.g>1.){temp.rb+=temp.g-1.;}\n  if(temp.b>1.){temp.rg+=temp.b-1.;}\n  \n  gl_FragColor=temp;\n  \n  float depth=gl_FragCoord.z/gl_FragCoord.w;\n  const float LOG2=1.442695;\n  float fogFactor=exp2(-fogDensity*fogDensity*depth*depth*LOG2);\n  fogFactor=1.-clamp(fogFactor,0.,1.);\n  \n  gl_FragColor=mix(gl_FragColor,vec4(fogColor,gl_FragColor.w),fogFactor);\n  \n}"}),s=new b(t,i);s.rotation.x=.3,this.scene.add(s)}initPostProcess(){var t,i,s;const n=new Ti(this.scene,this.camera),a=new Fi(2),o=new Ei(.35,.95,2048,0);null==(t=this.composer)||t.addPass(n),null==(i=this.composer)||i.addPass(a),null==(s=this.composer)||s.addPass(o)}initListener(){window.addEventListener("resize",(()=>{var t;this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight),null==(t=this.composer)||t.setSize(window.innerWidth,window.innerHeight)}))}render(){this.animate()}animate(){var t,i;null==(t=this.composer)||t.render(.01),this.stats.update(),null==(i=this.controls)||i.update();const s=this.clock.getDelta();this.uniforms.time.value+=1*s,requestAnimationFrame((()=>{this.animate()}))}}},Symbol.toStringTag,{value:"Module"}));const Hi=yt({__name:"index",setup(t){const{example:i="01-base-three"}=Xt().params,s={"./01-base-three.ts":Vt,"./02-spot-light-shadow.ts":Lt,"./03-gui.ts":Ot,"./04-instance-raycaster.ts":Wt,"./05-omitPhysics.ts":ri,"./06-shadow-map-viewer.ts":li,"./07-animation.ts":ci,"./08-gltf-loader.ts":bi,"./09-skinning-blending.ts":pi,"./10-littlest-tokyo.ts":vi,"./11-clipping.ts":yi,"./12-texture.ts":Xi,"./13-shader-plane.ts":Mi,"./14-shader-cube.ts":Zi,"./15-shader-lava.ts":Ni}[`./${i}.ts`];return s&&new s.default,(t,i)=>(zt(),Mt("div"))}});export{Hi as default};
